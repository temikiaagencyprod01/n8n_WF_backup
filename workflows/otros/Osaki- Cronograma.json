{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-02-23T22:16:02.000Z",
    "createdAt": "2026-02-17T22:15:24.715Z",
    "versionId": "75ece487-e59b-441c-ac23-3db14ebd1b79",
    "workflowId": "VLP59OWZ9ExHBRXx",
    "nodes": [
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
            "mode": "name"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1056,
          832
        ],
        "id": "7b1d7e3c-0718-48b8-91c5-546b3c654a72",
        "name": "Get Reserv Sheets",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1453691080,
            "mode": "list",
            "cachedResultName": "Historicos",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1453691080"
          },
          "keepFirstRow": true
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1616,
          1648
        ],
        "id": "58d96e47-f110-4a4e-8d1c-594fcb18cf23",
        "name": "Limpia Históricos",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Get Initial Data').first().json.schema }}.reservaciones \n  WHERE fecha_reservacion >= '{{ $('Get Initial Data').first().json.fecha_hoy }}'::date - INTERVAL '3 months'\nAND fecha_reservacion < '{{ $('Get Initial Data').first().json.fecha_hoy }}'\n    order by fecha_reservacion ASC;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1392,
          1648
        ],
        "id": "2d53ed3d-4a62-45df-8b03-59a72b0adac5",
        "name": "Get Historic",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1453691080,
            "mode": "list",
            "cachedResultName": "Historicos",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1453691080"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1168,
          1648
        ],
        "id": "34eb8f13-e082-4c36-ab58-0b6dee1093e0",
        "name": "Update Historic",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes_reserva",
            "mode": "list",
            "cachedResultName": "clientes_reserva"
          },
          "where": {
            "values": [
              {
                "column": "nombre_completo",
                "value": "={{ $json.cliente }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          80,
          0
        ],
        "id": "83d721aa-03f0-480b-ab85-9910c76c7b1c",
        "name": "Revisa Cliente",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes_reserva",
            "mode": "list",
            "cachedResultName": "clientes_reserva"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "nombre_completo": "={{ $('Loop Over Items3').item.json.cliente }}",
              "email": "={{ $('Loop Over Items3').item.json.email_contacto }}",
              "telefono_contacto": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
              "total_reservaciones": 1,
              "ultima_fecha_reservacion": "={{ new Date( $('Loop Over Items3').item.json.fecha_reservacion) }}",
              "ultima_hora_reservacion": "={{ $('Loop Over Items3').item.json.hora_reservacion }}",
              "created_at": "={{ $now }}",
              "updated_at": "={{ $now }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "nombre_completo",
                "displayName": "nombre_completo",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "email",
                "displayName": "email",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "clasificacion_cliente",
                "displayName": "clasificacion_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "ultima_fecha_reservacion",
                "displayName": "ultima_fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "ultima_hora_reservacion",
                "displayName": "ultima_hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          608,
          -96
        ],
        "id": "b16d93ab-e572-48f0-8e13-5e97205af854",
        "name": "Registra Cliente",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1296,
          816
        ],
        "id": "19163e0d-961f-4f35-8ab2-998c5aa92706",
        "name": "Loop Over Items1"
      },
      {
        "parameters": {
          "operation": "create",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "title": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -464,
          832
        ],
        "id": "00f20ac6-a210-4c58-96cf-511c58ce91dd",
        "name": "Create sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE fecha_reservacion = '{{ $('Loop Over Items1').item.json.fecha_reservacion }}'  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -304,
          832
        ],
        "id": "4c069244-2194-4eae-99b0-552d69cb322d",
        "name": "Get Reserv1",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -144,
          832
        ],
        "id": "bab9f449-b1c8-4390-ac49-e56d6bddbe96",
        "name": "Llena Documento1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "remove",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.fecha_reservacion }}",
            "mode": "name"
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -336,
          1664
        ],
        "id": "d24f3728-5957-4013-a38a-fd3fc75ae0d4",
        "name": "Delete sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.fecha_reservacion }}",
            "mode": "name"
          },
          "keepFirstRow": true
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1072,
          640
        ],
        "id": "23bd5028-3d08-409d-95ec-877a3b4774b3",
        "name": "Limpia Documento",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.fecha_reservacion }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "actualiza_base",
                "displayName": "actualiza_base",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1520,
          640
        ],
        "id": "6523e24b-239d-4a97-915d-c5dc9d97b892",
        "name": "Llena Documento",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE fecha_reservacion = '{{ $json.fecha_reservacion }}'  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          1296,
          640
        ],
        "id": "1f1b96ee-1584-4f06-83f4-501b7255afd7",
        "name": "Get Reserv",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "cliente": "={{ $json.cliente }}",
              "fecha_reservacion": "={{ $json.fecha_reservacion }}",
              "hora_reservacion": "={{ $json.hora_reservacion }}",
              "numero_personas": "={{ $json.numero_personas }}",
              "estado": "={{ $json.estado }}",
              "dia_semana": "={{ $json.dia_semana }}",
              "email_contacto": "={{ $json.email_contacto }}",
              "telefono_contacto": "={{ $json.telefono_contacto }}",
              "notas": "={{ $json.notas }}",
              "zona": "={{ $json.zona }}",
              "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "codigo_reserva": "={{ $json.codigo_reserva }}",
              "mesas_reserva": "={{\n  (function() {\n    const p = $json.numero_personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}"
            },
            "matchingColumns": [
              "codigo_reserva"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "ubicacion",
                "displayName": "ubicacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_solicitante",
                "displayName": "telefono_solicitante",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "mesas_reserva",
                "displayName": "mesas_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -32,
          368
        ],
        "id": "56e0858b-df07-48fa-830a-4b7672394d3c",
        "name": "Actualiza Base1",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "f153c500-16e3-4382-b59f-1a0c21933cba",
                      "leftValue": "={{ ($json.codigo_reserva.isEmpty() && $json.actualiza_base == 'Sí' ) }}",
                      "rightValue": "",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Nueva Reserva"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.actualiza_base.replace(/í/g, 'i').toLowerCase().replace(/\\s/g, '') }}",
                      "rightValue": "si",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "3a41c2e6-eff1-435c-aa27-9b4291c75e3e"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Actualiza Base"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          -816,
          576
        ],
        "id": "cf15d1f5-c84e-44ec-83d2-e4b670f075da",
        "name": "Switch"
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "fecha_reservacion"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          176,
          624
        ],
        "id": "cceb2ed7-9513-4d64-8e24-17ba307db4eb",
        "name": "Aggregate"
      },
      {
        "parameters": {
          "fieldToSplitOut": "fecha_reservacion",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          592,
          624
        ],
        "id": "29bdac86-586a-409e-8f27-5b2cf9fd2a8f",
        "name": "Split Out"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          800,
          624
        ],
        "id": "56fc304d-f752-46b6-b504-6eb914ccd00a",
        "name": "Loop Over Items"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1429491814,
            "mode": "list",
            "cachedResultName": "Reservas Nuevas",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1429491814"
          },
          "options": {
            "dataLocationOnSheet": {
              "values": {
                "rangeDefinition": "specifyRange",
                "headerRow": 2,
                "firstDataRow": 3
              }
            }
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1696,
          16
        ],
        "id": "ee321f4b-bc54-4af3-a5b5-9adff82c3572",
        "name": "Check New",
        "alwaysOutputData": false,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// 1. Obtener todos los items del nodo \"Check New\".\n// $items() ya devuelve el array, no se necesita .all()\nconst items = $items(\"Datos Completos?\");\n\n// 4. Devolver los items modificados\nreturn items;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -416,
          -16
        ],
        "id": "cd6061e3-cd4d-4008-bf3b-86478a5c093f",
        "name": "Get Data"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -224,
          352
        ],
        "id": "36f6a34a-29fa-433c-a99d-58da07fa511a",
        "name": "Loop Over Items2"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -192,
          -16
        ],
        "id": "f5ac0b77-39d5-43c5-a434-3ce943a53279",
        "name": "Loop Over Items3"
      },
      {
        "parameters": {
          "numberInputs": 3
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1584,
          320
        ],
        "id": "21bab4e9-57c3-4b01-834e-b9273799bcb1",
        "name": "Merge"
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          1808,
          336
        ],
        "id": "92f46abb-8e4a-42b8-a072-29a08a3d8bcf",
        "name": "Aggregate1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "\nSELECT \n    TO_CHAR(fecha_reservacion,'YYYY-MM-DD')::text as fecha_reservacion , count(*)\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE fecha_reservacion >= '{{ $('Calcula Fecha y Hora Actual').item.json.fecha_hoy }}'\n  group by fecha_reservacion\n    order by fecha_reservacion;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1744,
          1024
        ],
        "id": "5f7e5d98-a467-4ffd-9eea-a3e9e94fc110",
        "name": "Obtiene Fechas Reservas",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "content": "## Nuevas Reservaciones Manuales\n\n- Se Analiza la hoja llamada \"Nuevos\"\n- Si hay registros nuevos extrae aquellos",
          "height": 336,
          "width": 496
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1792,
          -128
        ],
        "typeVersion": 1,
        "id": "e28748bb-3af1-4bba-86d3-2816fed1bb3a",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "## Inserta Nuevos Registros\n\n- Aquellos registros que existan en Excel y no existan en la base de datos\n- Se insertan en la base de datos\n- Si el cliente no existe se da de alta",
          "height": 80,
          "width": 2160,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -304,
          176
        ],
        "typeVersion": 1,
        "id": "f1ae3452-c71a-4631-a918-8d672ac7334b",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $('Loop Over Items3').item.json.fecha_reservacion }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $json.codigo_reserva }}",
              "actualiza_base": "No",
              "cliente": "={{ $json.cliente }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actualiza_base",
                "displayName": "actualiza_base",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1248,
          64
        ],
        "id": "5b21e725-2b74-4aee-96cc-e6facc271c7a",
        "name": "Restaura Marca de Actualizacion",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "5ea1bd40-00d3-45ae-b9a6-9370f82a09c4",
                "leftValue": "={{ $if($('Check New').isExecuted,'Nuevo') }}",
                "rightValue": "Nuevo",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1040,
          16
        ],
        "id": "3e308ad4-ccd7-48fe-83f4-40fdcf18cae0",
        "name": "Registro Nuevo?"
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "cliente": "={{ $('Loop Over Items3').item.json.cliente }}",
              "fecha_reservacion": "={{  $('Loop Over Items3').item.json.fecha_reservacion.toDateTime() }}",
              "hora_reservacion": "={{  $('Loop Over Items3').item.json.hora_reservacion }}",
              "numero_personas": "={{ parseInt($('Loop Over Items3').item.json.numero_personas, 10) }}",
              "estado": "={{ $('Loop Over Items3').item.json.estado }}",
              "dia_semana": "={{ $('Loop Over Items3').item.json.dia_semana }}",
              "email_contacto": "={{ $('Loop Over Items3').item.json.email_contacto }}",
              "telefono_contacto": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
              "notas": "={{ $('Loop Over Items3').item.json.notas }}",
              "zona": "={{ $('Loop Over Items3').item.json.zona }}",
              "ubicacion": "Osaki Sushi - Restó (Calle 47 N°717, La Plata)",
              "telefono_solicitante": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
              "created_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "codigo_reserva": "={{ `OSK-${$now.setZone('America/Argentina/Buenos_Aires').toFormat('yyMMdd')}-${Array.from({length: 4}, () => String.fromCharCode(65 + Math.floor(Math.random() * 26))).join('')}` }}",
              "mesas_reserva": "={{\n  (function() {\n    const p = $('Loop Over Items3').item.json.numero_personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
              "Canal": "Google Sheets"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "ubicacion",
                "displayName": "ubicacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_solicitante",
                "displayName": "telefono_solicitante",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "mesas_reserva",
                "displayName": "mesas_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "intento_confirmacion",
                "displayName": "intento_confirmacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Canal",
                "displayName": "Canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          832,
          16
        ],
        "id": "1cb16ccb-bfdd-47e6-923a-155b24552e33",
        "name": "Ingresa Registro",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "bf90ef92-dc44-4f31-95f6-78a482ec864f",
                "leftValue": "={{ $json.isEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          320,
          0
        ],
        "id": "5c3691c4-be1d-487c-b7f6-136bb532f1b7",
        "name": "No Existe?"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "actualiza_base": "No",
              "codigo_reserva": "={{ $json.codigo_reserva }}"
            },
            "matchingColumns": [
              "codigo_reserva"
            ],
            "schema": [
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actualiza_base",
                "displayName": "actualiza_base",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          160,
          368
        ],
        "id": "b396e209-f6f6-4ddf-9861-fa8c2c258081",
        "name": "Restaura Marca de Actualizacion1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1429491814,
            "mode": "list",
            "cachedResultName": "Reservas Nuevas",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1429491814"
          },
          "clear": "specificRows",
          "startIndex": 3,
          "rowsToDelete": 50
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2448,
          320
        ],
        "id": "21962dd0-9596-4373-8649-cdadaf1faba0",
        "name": "Limpia Hoja de Nuevos",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "5ea1bd40-00d3-45ae-b9a6-9370f82a09c4",
                "leftValue": "={{ $if($('Check New').isExecuted,'Nuevo') }}",
                "rightValue": "Nuevo",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          2032,
          336
        ],
        "id": "576988e2-7ab9-4a0e-8321-79f934fe5c20",
        "name": "Hubo Nuevos?"
      },
      {
        "parameters": {
          "jsCode": "const inputData = $input.first().json;\nconst fechasUnicas = [...new Set(inputData.fecha_reservacion)];\n\nreturn [\n  {\n    json: {\n      fecha_reservacion: fechasUnicas.sort((a, b) => new Date(a) - new Date(b))\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          384,
          624
        ],
        "id": "825f5bdb-75c0-49d7-98d8-760a7400b157",
        "name": "Deduplica Fechas"
      },
      {
        "parameters": {
          "content": "## Acxtualiza Existentes\n- Toma los registros marcados como Sí en actualización de base\n- Actualiza todo el registro en la base",
          "height": 256,
          "width": 704,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -368,
          272
        ],
        "typeVersion": 1,
        "id": "c0e06f31-9db4-4b18-a3fb-f8eaafc855ec",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "## Crea Espejo de Postgres\n- Limpia la hoja por fecha\n- Toma todos los registros existentes de dicha fecha de la base\n- Reinserta esos registros en la hoja de excel",
          "height": 288,
          "width": 1808,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          96,
          544
        ],
        "typeVersion": 1,
        "id": "f7690604-e4db-41d6-9ae4-488e364dd4bb",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "content": "## Nuevas Fechas NO existen en Excel\n\n- Si hay reservaciones en cierta fecha y no existe su hoja en excel la crea\n- Pobla todos los datos de dicha fecha en el excel",
          "height": 304,
          "width": 1360,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1312,
          752
        ],
        "typeVersion": 1,
        "id": "34978953-4660-4f1a-b477-99cc8ef33d95",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "content": "## Rellena Reservaciones Históricas\n\n- Toma todos los registros antiguos\n- Limpia el historial en excel\n. Rellena los registros en excel",
          "height": 336,
          "width": 1744,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1904,
          1520
        ],
        "typeVersion": 1,
        "id": "9b300582-f487-455f-9cfb-3f7d872086d1",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "operation": "create",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "title": "={{ $json.fecha_reservacion }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1168,
          -16
        ],
        "id": "34e5a15c-e566-4681-8779-cf2cb26b651e",
        "name": "Create sheet1",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.fecha_reservacion }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {
              "id": "={{ $json.id }}",
              "cliente": "={{ $json.cliente }}",
              "fecha_reservacion": "={{ $json.hora_reservacion }}",
              "numero_personas": "={{ $json.numero_personas }}",
              "hora_reservacion": "={{ $json.hora_reservacion }}",
              "dia_semana": "={{ $json.dia_semana }}",
              "zona": "={{ $json.zona }}",
              "email_contacto": "={{ $json.email_contacto }}",
              "estado": "={{ $json.estado }}",
              "notas": "={{ $json.notas }}",
              "telefono_contacto": "={{ $json.telefono_contacto }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "actualiza_base",
                "displayName": "actualiza_base",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1696,
          0
        ],
        "id": "82a5744a-87af-428e-b8ff-6848a7e5e022",
        "name": "Append row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "fc8344fa-5d2e-45e5-94b4-9e6feaa4041e",
                "name": "codigo_reserva",
                "value": "={{ $json.codigo_reserva }}",
                "type": "string"
              },
              {
                "id": "97bb94de-dbb0-4b92-8045-9e342e8056e3",
                "name": "cliente",
                "value": "={{ $('Loop Over Items3').item.json.cliente }}",
                "type": "string"
              },
              {
                "id": "c0c43f6f-fcce-4bc0-aaeb-70a9b3f1b11c",
                "name": "fecha_reservacion",
                "value": "={{ $('Loop Over Items3').item.json.fecha_reservacion }}",
                "type": "string"
              },
              {
                "id": "5d95b4ee-07a0-405f-a6cd-7306aa278baa",
                "name": "hora_reservacion",
                "value": "={{ $('Loop Over Items3').item.json.hora_reservacion }}",
                "type": "string"
              },
              {
                "id": "ee496e22-4961-4cba-9266-ce200d0525ff",
                "name": "dia_semana",
                "value": "={{ $('Loop Over Items3').item.json.dia_semana }}",
                "type": "string"
              },
              {
                "id": "04d36865-48f8-49f6-bf11-fa33472d4e42",
                "name": "numero_personas",
                "value": "={{ $('Loop Over Items3').item.json.numero_personas }}",
                "type": "number"
              },
              {
                "id": "bf14f55b-09c7-4056-b6a2-bbc5a83e7151",
                "name": "mesas_sugeridas",
                "value": "={{\n  (function() {\n    const p = $('Loop Over Items3').item.json.numero_personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
                "type": "string"
              },
              {
                "id": "c3f5c68d-dc5d-43eb-b0b8-de782c6f1410",
                "name": "zona",
                "value": "={{ $('Loop Over Items3').item.json.zona }}",
                "type": "string"
              },
              {
                "id": "541e812c-8f33-4983-8752-6958b05c7f65",
                "name": "email_contacto",
                "value": "={{ $('Loop Over Items3').item.json.email_contacto }}",
                "type": "string"
              },
              {
                "id": "8bc40567-83eb-43fe-b595-9956115ee769",
                "name": "telefono_contacto",
                "value": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
                "type": "string"
              },
              {
                "id": "8a10b2fa-b10b-4ba2-b46a-ee2c550b67b4",
                "name": "estado",
                "value": "={{ $('Loop Over Items3').item.json.estado }}",
                "type": "string"
              },
              {
                "id": "8c7c05cc-6bc8-4cf4-88e3-fc4e7a8389e8",
                "name": "notas",
                "value": "={{ $('Loop Over Items3').item.json.notas }}",
                "type": "string"
              },
              {
                "id": "cff06e47-803c-4dd0-abb6-849d430064f9",
                "name": "actualiza_base",
                "value": "No",
                "type": "string"
              },
              {
                "id": "9f79241f-a18f-4ea5-8a0c-97a64c85a80d",
                "name": "created_at",
                "value": "={{ $now.format('yyyy-MM-dd') }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1456,
          0
        ],
        "id": "788bdc2a-ef75-4c6d-a43c-0e0144195eaa",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          1744,
          640
        ],
        "id": "74101a03-2172-4633-b217-80eff92b71a6",
        "name": "Wait",
        "webhookId": "85600c23-88ca-4c42-a276-c8139577c939"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */10 10-23 * * *"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          -2640,
          480
        ],
        "id": "f1855aba-ea0d-402f-97ba-90fdddac021d",
        "name": "Cada 10 min"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "UPDATE {{ $('Get Initial Data').first().json.schema }}.clientes\nSET tipo_atencion = 'IA', intencion='Información'\nWHERE (tipo_atencion != 'IA' or intencion !='Información')\nAND id != 1\n;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1840,
          2032
        ],
        "id": "2beeb72f-bca0-4ee1-bae7-8fae74179a32",
        "name": "Actualiza Atencion IA ",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT *\nFROM osaki_main.n8n_chat_histories\nWHERE fec_registro < NOW() - INTERVAL '4 days'\nORDER BY session_id asc, id asc;\n",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1376,
          2032
        ],
        "id": "85668325-9d92-4e34-8c04-543be3ece051",
        "name": "Obtiene Historial a Borrar",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "  INSERT INTO {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_bkup\n  (session_id,message, old_id, fec_registro)\n  select session_id,message, id , fec_registro\n  from {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories\n  WHERE session_id='{{ $json.session_id }}'\n  and id ={{ $json.id }}",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -912,
          2048
        ],
        "id": "eae2befd-1f96-4021-a144-f768e2e95aa7",
        "name": "Respalda Conversación",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "deleteTable",
          "schema": {
            "__rl": true,
            "value": "={{ $('Get Initial Data').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories"
          },
          "deleteCommand": "delete",
          "where": {
            "values": [
              {
                "column": "session_id",
                "value": "={{ $('Loop Over Items4').item.json.session_id }}"
              },
              {
                "column": "id",
                "value": "={{ $('Loop Over Items4').item.json.id }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -688,
          2048
        ],
        "id": "c6c7e0ab-43bb-4dcd-ab19-c0c68526e0fd",
        "name": "Limpiando Historial",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1120,
          2032
        ],
        "id": "daaf6e30-3ae3-4a50-8967-36dabc9a1ec1",
        "name": "Loop Over Items4"
      },
      {
        "parameters": {
          "content": "## Respaldo y limpieza de converaciones\n* Migra las conversaciones de más de 3 días hacía un backup\n* Elimina de productivo todas las conversaciones de más de 3 días\n* Restaura la atención de todas las conversaciones a IA",
          "height": 784,
          "width": 1376
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1456,
          1872
        ],
        "typeVersion": 1,
        "id": "fd0468ce-883a-4e96-abb6-3e709ec7b2a3",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "a8614567-2157-4cc1-b4e9-4125a3b00762",
                "leftValue": "={{ $json.error }}",
                "rightValue": "=not found",
                "operator": {
                  "type": "string",
                  "operation": "endsWith"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          368,
          368
        ],
        "id": "a72d5a60-6bc3-4be3-9fa1-192737094a37",
        "name": "If1"
      },
      {
        "parameters": {
          "operation": "create",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "title": "={{ $json.fecha_reservacion }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          944,
          352
        ],
        "id": "d86d91cc-d6ca-4bc7-9889-6decb77e8d0a",
        "name": "Create sheet2",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.title }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          1360,
          352
        ],
        "id": "b1e2f577-cee3-4dd4-8bd5-5016963c2683",
        "name": "Append row in sheet1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas,\n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE id = $1  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
          "options": {
            "queryReplacement": "={{ $('Actualiza Base1').item.json.id }}"
          }
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          1152,
          352
        ],
        "id": "f77cf367-093b-48e8-8b5e-ac6dcc03b70e",
        "name": "Execute a SQL query",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "/*\n * Este es un nodo de Código (Code) en n8n.\n * Asume que los datos de entrada (items) son un array de objetos,\n * donde cada objeto tiene una propiedad `json` con `fecha_reservacion`.\n *\n * Ejemplo de entrada (un item):\n * {\n * \"json\": {\n * \"fecha_reservacion\": \"2025-11-12\",\n * \"count\": \"3\"\n * }\n * }\n *\n * El nodo recibirá MÚLTIPLES items de este tipo.\n */\n\n// --- Helper Function ---\n/**\n * Convierte un objeto Date a un string en formato YYYY-MM-DD.\n * @param {Date} d - El objeto Date a formatear.\n * @returns {string} - La fecha en formato YYYY-MM-DD.\n */\nconst toYYYYMMDD = (d) => {\n  const year = d.getFullYear();\n  // getMonth() es 0-indexado (0=Enero), por eso +1\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n// --- Main Logic ---\n\n// 1. Obtener la fecha de hoy, normalizada a medianoche (hora local)\nconst today = new Date();\ntoday.setHours(0, 0, 0, 0);\n\n// 2. Procesar todos los items de entrada\nconst existingDates = new Set();\nlet maxDate = null;\n\nfor (const item of items) {\n  const dateStr = item.json.fecha_reservacion;\n  if (!dateStr) {\n    continue; // Ignorar items sin fecha\n  }\n\n  // Añadir el string de la fecha al Set para búsqueda rápida\n  existingDates.add(dateStr);\n\n  // Encontrar la fecha máxima\n  // Parsear la fecha como local. new Date(Y, M-1, D) es lo más seguro.\n  const [year, month, day] = dateStr.split('-').map(Number);\n  const currentDate = new Date(year, month - 1, day);\n\n  if (!maxDate || currentDate > maxDate) {\n    maxDate = currentDate;\n  }\n}\n\n// 3. Verificar si tenemos una fecha máxima válida\nif (!maxDate) {\n  // No se encontraron fechas en la entrada\n  return [];\n}\n\n// 4. Si la fecha máxima es anterior a hoy, no hay rango para verificar\nif (maxDate < today) {\n  return [];\n}\n\n// 5. Iterar desde \"hoy\" hasta \"maxDate\" (inclusive)\nconst missingDates = [];\n// Clonamos 'today' para usarlo como nuestro iterador\nconst loopDate = new Date(today.getTime());\n\nwhile (loopDate <= maxDate) {\n  // Convertir la fecha del bucle a string YYYY-MM-DD\n  const loopDateStr = toYYYYMMDD(loopDate);\n\n  // Comprobar si esta fecha NO está en nuestra lista de entrada\n  if (!existingDates.has(loopDateStr)) {\n    // Si no está, la añadimos al resultado\n    missingDates.push({\n      json: {\n        fecha_faltante: loopDateStr\n      }\n    });\n  }\n\n  // Avanzar al siguiente día\n  loopDate.setDate(loopDate.getDate() + 1);\n}\n\n// 7. Devolver el array de objetos con las fechas faltantes\nreturn missingDates;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2176,
          1024
        ],
        "id": "0ef1f385-66c3-407e-963a-ef05cbc2fcc4",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "useDataOfInput": 2
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          2880,
          1008
        ],
        "id": "6da25126-8094-4e57-b30d-9543f6a4fdc3",
        "name": "Merge1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          3104,
          1008
        ],
        "id": "35ab282b-12b2-4027-93b3-3fcc29e18f71",
        "name": "Loop Over Items5"
      },
      {
        "parameters": {
          "operation": "remove",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.fecha_faltante }}",
            "mode": "name"
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          3600,
          1024
        ],
        "id": "42832200-a8e2-42bf-9f44-c7f0c23e4a3b",
        "name": "Delete sheet1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "1efa10e6-ab32-496b-b0c2-7fd972f57600",
                "name": "fecha_reservacion",
                "value": "={{ $('Actualiza Base1').item.json.fecha_reservacion.substring(0,10) }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          640,
          352
        ],
        "id": "9c3d3411-ec07-4f3e-87b5-19c26b0777c1",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "cd2d4c20-a520-4a27-bfb5-82a50873546a",
                "leftValue": "={{ $json.estado.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1456,
          0
        ],
        "id": "fef81c9a-34aa-44bd-a0f4-5cabb7e111ba",
        "name": "Datos Completos?"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          3392,
          1024
        ],
        "id": "f01f6d34-923f-4d21-9655-ecbe8aab050a",
        "name": "Wait1",
        "webhookId": "ecff492e-3f22-44db-83fd-588be9831033"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "77d1c36a-901f-46ce-bb1b-36ed256548f9",
                "name": "fecha_hoy",
                "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
                "type": "string"
              },
              {
                "id": "4c0d264c-a98f-418c-b424-81ce227f92d8",
                "name": "=hora_ahora",
                "value": "={{ new Date().toLocaleString('en-GB', { timeZone: 'America/Argentina/Buenos_Aires', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) }}",
                "type": "string"
              },
              {
                "id": "5beed38e-1087-4ec6-8ffb-c77119e18396",
                "name": "schema",
                "value": "osaki_main",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2432,
          480
        ],
        "id": "5b377084-d4b4-4e72-9eda-4d08a1047ced",
        "name": "Calcula Fecha y Hora Actual"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "  UPDATE {{ $('Get Initial Data').item.json.schema }}.reservaciones a\n  SET ESTADO='Realizada Sin Confirmar'\n  -- select * from osaki_main.reservaciones a\n  where estado ='Pendiente'\n  and (a.fecha_reservacion::date + a.hora_reservacion::time) < current_date",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1840,
          1648
        ],
        "id": "19180504-6c4d-496f-9d59-f3477e44ffd0",
        "name": "Actualiza Estado Reserv Realizada",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "77d1c36a-901f-46ce-bb1b-36ed256548f9",
                "name": "fecha_hoy",
                "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
                "type": "string"
              },
              {
                "id": "4c0d264c-a98f-418c-b424-81ce227f92d8",
                "name": "=hora_ahora",
                "value": "={{ new Date().toLocaleString('en-GB', { timeZone: 'America/Argentina/Buenos_Aires', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) }}",
                "type": "string"
              },
              {
                "id": "5beed38e-1087-4ec6-8ffb-c77119e18396",
                "name": "schema",
                "value": "osaki_main",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -2736,
          1888
        ],
        "id": "212c95a6-d71c-411e-b344-35baa905b2f8",
        "name": "Get Initial Data"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "UPDATE {{ $('Get Initial Data').first().json.schema }}.clientes\nSET negativos_intentos=0\nWHERE negativos_intentos != 0\n;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1632,
          2032
        ],
        "id": "5c3b4ad8-7470-478d-a028-177f38c0e6aa",
        "name": "ACtualiza Intentos Negativos",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1104,
          2240
        ],
        "id": "0ebc1a6a-b52e-4937-be85-3467923fc564",
        "name": "Loop Over Items8"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 0 1 * * *"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.3,
        "position": [
          -2944,
          1888
        ],
        "id": "365a7b76-dffd-4ef4-b2cf-06fef1541fd2",
        "name": "1 am",
        "disabled": true
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
            "mode": "list",
            "cachedResultName": "Control Calle 9",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1312669213,
            "mode": "list",
            "cachedResultName": "Clientes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1312669213"
          },
          "keepFirstRow": true
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1376,
          2816
        ],
        "id": "50999627-a25e-4b6b-a513-064bd41e7a74",
        "name": "Limpia Hoja Clientes Calle 9",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Clientes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=0"
          },
          "keepFirstRow": true
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1376,
          2640
        ],
        "id": "defddf62-2566-4cbf-b297-ec78c396d070",
        "name": "Limpia Hoja Clientes Calle 47",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1120,
          2448
        ],
        "id": "24d1b399-43ae-4bd3-88ae-3ace0a5ad9c0",
        "name": "Loop Over Items11"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT *\nFROM osaki_main.n8n_chat_histories_delivery_calle_47\nWHERE fec_registro < NOW() - INTERVAL '4 days'\nORDER BY session_id asc, id asc;\n",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1376,
          2240
        ],
        "id": "79c700e8-50f6-483e-a61a-eb8cc800077c",
        "name": "Obtiene Historial a Borrar Deli Calle 47",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT *\nFROM osaki_main.n8n_chat_histories_delivery_calle_9\nWHERE fec_registro < NOW() - INTERVAL '4 days'\nORDER BY session_id asc, id asc;\n",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1376,
          2448
        ],
        "id": "4fba3c46-730c-4e37-be2b-65fb471e65f3",
        "name": "Obtiene Historial a Borrar Deli Calle 9",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "  INSERT INTO {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_47_bkup\n  (session_id,message, old_id, fec_registro)\n  select session_id,message, id, fec_registro\n  from {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_47\n  WHERE session_id='{{ $json.session_id }}'\n  and id ={{ $json.id }}",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -896,
          2256
        ],
        "id": "abf450af-70b1-4b75-8983-5338fd085b5c",
        "name": "Respalda Conversación Deli 47",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "  INSERT INTO {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_9_bkup\n  (session_id,message, old_id, fec_registro)\n  select session_id,message, id, fec_registro\n  from {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_9\n  WHERE session_id='{{ $json.session_id }}'\n  and id ={{ $json.id }}",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -912,
          2464
        ],
        "id": "e7ec0a6e-1f99-415e-b275-335ea51a6d13",
        "name": "Respalda Conversación Deli 9",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "deleteTable",
          "schema": {
            "__rl": true,
            "value": "={{ $('Get Initial Data').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories_delivery_calle_47",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories_delivery_calle_47"
          },
          "deleteCommand": "delete",
          "where": {
            "values": [
              {
                "column": "session_id",
                "value": "={{ $('Loop Over Items8').item.json.session_id }}"
              },
              {
                "column": "id",
                "value": "={{ $('Loop Over Items8').item.json.id }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -672,
          2256
        ],
        "id": "8046796f-f66c-45ff-813e-b5944fc7dbe4",
        "name": "Limpiando Historial Deli 47",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "deleteTable",
          "schema": {
            "__rl": true,
            "value": "={{ $('Get Initial Data').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories_delivery_calle_9",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories_delivery_calle_9"
          },
          "deleteCommand": "delete",
          "where": {
            "values": [
              {
                "column": "session_id",
                "value": "={{ $('Loop Over Items11').item.json.session_id }}"
              },
              {
                "column": "id",
                "value": "={{ $('Loop Over Items11').item.json.id }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -688,
          2464
        ],
        "id": "d82ea3f4-d056-44e5-914c-e2816e242b30",
        "name": "Limpiando Historial Deli 9",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 * 10-23 * * *"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          -3344,
          4000
        ],
        "id": "13159c0b-54eb-4b8d-be3b-37a2638f83c3",
        "name": "Cada 1 Min"
      },
      {
        "parameters": {
          "fieldToSplitOut": "sheets",
          "include": "allOtherFields",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -2912,
          4000
        ],
        "id": "0df71b31-b8e9-4576-848e-c35d0b7bc284",
        "name": "Split Out1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1648,
          3168
        ],
        "id": "ece6cf16-6ae9-45ba-a688-e98f2fbc86c3",
        "name": "Loop Over Items12"
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "where": {
            "values": [
              {
                "column": "telefono",
                "value": "={{ $json.Telefono.toString().replace(/[^\\d]/g, '') }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1200,
          3168
        ],
        "id": "260b8a51-c027-4ff3-9352-64c7da9b0861",
        "name": "Select rows from a table2",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c8eefa99-e4dc-4ddf-9dd5-0eb745e2eef9",
                "leftValue": "={{ $json.isEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -976,
          3168
        ],
        "id": "e64bb761-ac71-48b1-a15f-cef8b8d0235e",
        "name": "If10"
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "fecha_registro": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "canal": "Google Sheets",
              "telefono": "={{ $('Loop Over Items12').item.json.Telefono.toString().replace(/\\D/g, '').slice(-10) }}",
              "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "tipo_atencion": "={{ $('Loop Over Items12').item.json['TipoAtención'] }}",
              "notas": "Registro creado desde Google Sheets",
              "intencion": "Información",
              "num_mensaje_largo": 0,
              "actitud": 1,
              "negativos_intentos": 0,
              "total_reservaciones": 0,
              "pregunta_verifica_reserva": "={{ false }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -544,
          3152
        ],
        "id": "1794c484-5f94-4039-8685-6e1e9ea8c237",
        "name": "Insert rows in a table4",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 624839784,
            "mode": "list",
            "cachedResultName": "Blacklist",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=624839784"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1664,
          3456
        ],
        "id": "4499a663-a386-4a71-81c2-3bacd3b161ef",
        "name": "Get BlackList3",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Variables 47').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "=blacklist_phones_{{ $('Variables 47').first().json.sheets.sucursal }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "phone": "={{ $json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "phone",
                "displayName": "phone",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "descripcion",
                "displayName": "descripcion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_id",
                "displayName": "sucursal_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fec_registro",
                "displayName": "fec_registro",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -640,
          3440
        ],
        "id": "94cf1a06-cfee-4fa2-b0ae-5fa038193092",
        "name": "Insert rows in a table5",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('Variables 47').first().json.sheets.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Blacklist",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Teléfono": "={{ $('Loop Over Items6').item.json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}",
              "Estado": "Agregado",
              "row_number": "={{ $('Loop Over Items6').item.json.row_number }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
                "displayName": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
                "displayName": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Esta es una lista PERMANENTE. El agente nunca responderá a los números aquí registrados",
                "displayName": "Esta es una lista PERMANENTE. El agente nunca responderá a los números aquí registrados",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -416,
          3440
        ],
        "id": "552d5f0d-3309-47b5-8d93-12bc105a08b4",
        "name": "Update row in sheet2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "deleteTable",
          "schema": {
            "__rl": true,
            "value": "={{ $('Variables 47').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "=blacklist_phones_{{ $('Variables 47').first().json.sheets.sucursal }}",
            "mode": "name"
          },
          "deleteCommand": "delete",
          "where": {
            "values": [
              {
                "column": "phone",
                "value": "={{ $json['Teléfono'] }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -640,
          3600
        ],
        "id": "08a0ce4d-269d-4809-80cd-b54da75455b0",
        "name": "Delete table or rows2",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "delete",
          "documentId": {
            "__rl": true,
            "value": "={{ $('Variables 47').first().json.sheets.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Blacklist",
            "mode": "name"
          },
          "startIndex": "={{ $('Switch1').item.json.row_number }}"
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -416,
          3600
        ],
        "id": "84bcc25a-616d-4471-af88-f3fa1793892e",
        "name": "Delete rows or columns from sheet2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "f6d51aee-383f-498d-95df-f11e34c263c2",
                "leftValue": "={{ $json['TipoAtención'].isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              },
              {
                "id": "68852586-24e2-49c2-9e95-6b502c35b4b2",
                "leftValue": "={{ $json.Telefono.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1440,
          3184
        ],
        "id": "bd196d31-f057-40d3-99f2-e5e3160bd085",
        "name": "If11"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "7e487e61-aef8-4874-b972-019cfeba6c0d",
                "leftValue": "={{ $('Loop Over Items12').item.json['TipoAtención'] }}",
                "rightValue": "={{ $json.tipo_atencion }}",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -768,
          3216
        ],
        "id": "ba2637d9-fbca-480f-95e9-3c608dedcfd5",
        "name": "If12"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "06cb9b12-57dd-43b3-b321-4a700bb2ed51",
                "name": "sheets",
                "value": "[  { \"sucursal\":\"calle_47\", \"id\": \"16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0\"},    { \"sucursal\":\"calle_9\",\"id\": \"15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g\"}]   ",
                "type": "array"
              },
              {
                "id": "a5334687-67f0-462f-b4ed-4280f95f783d",
                "name": "schema",
                "value": "osaki_main",
                "type": "string"
              },
              {
                "id": "9e13ba25-fbac-499a-bf25-ab9764f99541",
                "name": "fecha_hoy",
                "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3136,
          4000
        ],
        "id": "752a7c6a-5ba6-4499-8440-7a1c1008395d",
        "name": "Obtiene Datos Iniciales"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.Estado }}",
                      "rightValue": "Nuevo",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "30fb3e4f-55ac-4673-9c06-ae2708bd3865"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Nuevo"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "eb0ac507-aeef-4546-bef2-84456d4dc0a6",
                      "leftValue": "={{ $json.Estado }}",
                      "rightValue": "Eliminar",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Eliminar"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Otro"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -976,
          3456
        ],
        "id": "22ac6e9b-a6e1-4bae-8bcd-9f70f96bcf12",
        "name": "Switch1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d5ffa888-9090-46a3-9f1d-2b0bd27331ae",
                "leftValue": "={{ $json.sheets.sucursal }}",
                "rightValue": "calle_47",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -2704,
          4000
        ],
        "id": "7cf9bc46-3af9-472b-a61c-c33d3e8a87f8",
        "name": "If"
      },
      {
        "parameters": {
          "jsCode": "return $input.all();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1872,
          3456
        ],
        "id": "cf57971c-fb42-4402-b5c2-18ef7ad6c5c2",
        "name": "Variables 47"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
            "mode": "list",
            "cachedResultName": "Control Calle 9",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1317093169,
            "mode": "list",
            "cachedResultName": "Blacklist",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1317093169"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1632,
          4880
        ],
        "id": "f9d3917b-7bf4-4c06-a77c-2b9019ac5171",
        "name": "Get BlackList",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Variables 9').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "=blacklist_phones_{{ $('Variables 9').first().json.sheets.sucursal }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "phone": "={{ $json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "phone",
                "displayName": "phone",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "descripcion",
                "displayName": "descripcion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_id",
                "displayName": "sucursal_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fec_registro",
                "displayName": "fec_registro",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -624,
          4864
        ],
        "id": "39f4a6c2-7273-462c-96f2-15aaf39635d1",
        "name": "Insert rows in a table",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('Variables 9').item.json.sheets.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Blacklist",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Teléfono": "={{ $('Loop Over Items7').item.json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}",
              "Estado": "Agregado",
              "row_number": "={{ $('Loop Over Items7').item.json.row_number }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
                "displayName": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
                "displayName": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "En esta lista se incluyen todo aquellos números de teléfono (10 dígitos) que serán excluídos de la atención que realiza el agente IA de manera PERMANENTE, es decir, si alguno de estos números se comunica con el agente, este NO responderá.",
                "displayName": "En esta lista se incluyen todo aquellos números de teléfono (10 dígitos) que serán excluídos de la atención que realiza el agente IA de manera PERMANENTE, es decir, si alguno de estos números se comunica con el agente, este NO responderá.",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -400,
          4864
        ],
        "id": "3fbcc3f3-04c2-499c-aa56-f3470b05d2f7",
        "name": "Update row in sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "deleteTable",
          "schema": {
            "__rl": true,
            "value": "={{ $('Variables 9').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "=blacklist_phones_{{ $('Variables 9').first().json.sheets.sucursal }}",
            "mode": "name"
          },
          "deleteCommand": "delete",
          "where": {
            "values": [
              {
                "column": "phone",
                "value": "={{ $json['Teléfono'] }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -624,
          5024
        ],
        "id": "5a839245-411b-4b2d-b581-281c6f2e6aa8",
        "name": "Delete table or rows",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "delete",
          "documentId": {
            "__rl": true,
            "value": "={{ $('Variables 9').first().json.sheets.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": 1317093169,
            "mode": "list",
            "cachedResultName": "Blacklist",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1317093169"
          },
          "startIndex": "={{ $('Switch2').item.json.row_number }}"
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -400,
          5024
        ],
        "id": "49fdf290-6a71-4fcb-a001-9da816583ae1",
        "name": "Delete rows or columns from sheet",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "return $input.all();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1840,
          4880
        ],
        "id": "599f46ee-696d-47ef-9575-ddce1c3e1548",
        "name": "Variables 9"
      },
      {
        "parameters": {
          "jsCode": "return $input.all().reverse();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1424,
          4880
        ],
        "id": "e03c8dda-c60f-41f3-8ad3-6fafeb735238",
        "name": "Reverse 9"
      },
      {
        "parameters": {
          "jsCode": "return $input.all().reverse();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1456,
          3456
        ],
        "id": "282b1395-01ef-42dc-96f4-529f56f002be",
        "name": "Reverse 47"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1632,
          4592
        ],
        "id": "a2d06fae-ef8d-4b29-90a9-c729870b24fd",
        "name": "Loop Over Items13"
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "telefono": "={{ $('Select rows from a table').item.json.telefono }}",
              "tipo_atencion": "={{ $('Loop Over Items13').item.json['TipoAtención'] }}"
            },
            "matchingColumns": [
              "telefono"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -208,
          4624
        ],
        "id": "661265d9-3169-4ab0-8bc1-059b9c9bc6c3",
        "name": "Update rows in a table",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "where": {
            "values": [
              {
                "column": "telefono",
                "value": "={{ $json.Telefono.toString().replace(/[^\\d]/g, '').slice(-10) }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1184,
          4592
        ],
        "id": "94a0ca8b-668a-4a58-922d-c557bce70be9",
        "name": "Select rows from a table",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "fecha_registro": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "canal": "Google Sheets",
              "telefono": "={{ $('Loop Over Items13').item.json.Telefono.toString().replace(/\\D/g, '').slice(-10) }}",
              "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "tipo_atencion": "={{ $('Loop Over Items13').item.json['TipoAtención'] }}",
              "notas": "Registro creado desde Google Sheets",
              "intencion": "Información",
              "num_mensaje_largo": 0,
              "actitud": 1,
              "negativos_intentos": 0,
              "total_reservaciones": 0,
              "pregunta_verifica_reserva": "={{ false }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -448,
          4576
        ],
        "id": "2a4ca1da-6d7d-4fef-a180-5f729eb6380d",
        "name": "Insert rows in a table6",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "f6d51aee-383f-498d-95df-f11e34c263c2",
                "leftValue": "={{ $json['TipoAtención'].isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              },
              {
                "id": "68852586-24e2-49c2-9e95-6b502c35b4b2",
                "leftValue": "={{ $json.Telefono.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1424,
          4608
        ],
        "id": "869eae78-de12-4ff5-a197-fb5bd005ff52",
        "name": "If14"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "7e487e61-aef8-4874-b972-019cfeba6c0d",
                "leftValue": "={{ $('Loop Over Items13').item.json['TipoAtención'] }}",
                "rightValue": "={{ $json.tipo_atencion }}",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -752,
          4640
        ],
        "id": "d00014aa-0d3c-4eb2-8844-b369a16862ce",
        "name": "If15"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
            "mode": "list",
            "cachedResultName": "Control Calle 9",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1312669213,
            "mode": "list",
            "cachedResultName": "Clientes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1312669213"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1856,
          4592
        ],
        "id": "348c0182-0564-46df-b3b4-36ee2e100394",
        "name": "Get Clientes Sheet",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "telefono": "={{ $('Select rows from a table2').item.json.telefono }}",
              "tipo_atencion": "={{ $('Loop Over Items12').item.json['TipoAtención'] }}"
            },
            "matchingColumns": [
              "telefono"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          48,
          3200
        ],
        "id": "908d06ca-8a89-450a-a878-036213c42a2d",
        "name": "Update rows in a table3",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1200,
          3456
        ],
        "id": "88d410af-ff4c-4ea2-b8c7-5fed7da1b62b",
        "name": "Loop Over Items6"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.Estado }}",
                      "rightValue": "Nuevo",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "30fb3e4f-55ac-4673-9c06-ae2708bd3865"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Nuevo"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "eb0ac507-aeef-4546-bef2-84456d4dc0a6",
                      "leftValue": "={{ $json.Estado }}",
                      "rightValue": "Eliminar",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Eliminar"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Otro"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -960,
          4880
        ],
        "id": "3c5e8606-23b7-4cb0-8972-ed48eee0a733",
        "name": "Switch2"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1184,
          4880
        ],
        "id": "516c3f61-1d40-4aef-b620-2d4da2730b1f",
        "name": "Loop Over Items7"
      },
      {
        "parameters": {
          "amount": 2
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -208,
          3600
        ],
        "id": "7d8a1863-0ffd-4d72-aa71-543a0974b59e",
        "name": "Wait2",
        "webhookId": "c8017ecc-bb42-4c4e-985d-b0ef8e72d48f"
      },
      {
        "parameters": {
          "amount": 2
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -176,
          5024
        ],
        "id": "b546b867-f22a-43cd-aa6d-4bf547cb8c0b",
        "name": "Wait3",
        "webhookId": "c8017ecc-bb42-4c4e-985d-b0ef8e72d48f"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c8eefa99-e4dc-4ddf-9dd5-0eb745e2eef9",
                "leftValue": "={{ $json.isEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -960,
          4592
        ],
        "id": "b8b823f5-3e9c-4c25-a732-e6cc3ee6c450",
        "name": "If16"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Clientes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1872,
          3168
        ],
        "id": "cee1c9a3-41fe-434e-b0dd-6c8495ed583f",
        "name": "Get Clientes Sheet2",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          -1024,
          1232
        ],
        "id": "9fd9e270-ead8-4241-8337-816e17500724",
        "name": "When clicking ‘Execute workflow’"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "Clientes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $('Loop Over Items12').item.json.row_number}}",
              "Telefono": "={{ $('Loop Over Items12').item.json.Telefono.toString().replace(/\\D/g, '').slice(-10) }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Telefono",
                "displayName": "Telefono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "TipoAtención",
                "displayName": "TipoAtención",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
                "displayName": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "TipoAtención: ¿Quién atenderá al número?\n\n\"IA\" o \"Humano\"",
                "displayName": "TipoAtención: ¿Quién atenderá al número?\n\n\"IA\" o \"Humano\"",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Esta es una lista TEMPORAL. Al finalizar el día se limpia",
                "displayName": "Esta es una lista TEMPORAL. Al finalizar el día se limpia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -256,
          3152
        ],
        "id": "a19957f6-535e-4c81-ba1a-b6bc1acb42a6",
        "name": "Update row in sheet3",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "remove",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}"
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -640,
          736
        ],
        "id": "edd38fad-39ad-47b2-a4cb-795abab7b14a",
        "name": "Delete sheet2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.keys().length }}",
                      "rightValue": 0,
                      "operator": {
                        "type": "number",
                        "operation": "equals"
                      },
                      "id": "cbdc5593-7972-48b5-841e-974f43b18529"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Hoja Vacía"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "bfe69bdd-73cf-4738-9352-b51bdf0494e4",
                      "leftValue": "={{ $json.error }}",
                      "rightValue": "=Sheet with name {{ $('Loop Over Items1').item.json.fecha_reservacion }} not found",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Hoja Inexistente"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -848,
          816
        ],
        "id": "34235d61-5a38-463c-9dc0-9e7d7c2ef367",
        "name": "Evalua Hojas"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "  \nSELECT distinct TO_CHAR(fecha_reservacion, 'YYYY-MM-DD') as fecha_reservacion\n  FROM {{ $('Get Initial Data').first().json.schema }}.reservaciones \n    WHERE fecha_reservacion >= '{{ $('Get Initial Data').first().json.fecha_hoy }}'::date - INTERVAL '1 months'\n  AND fecha_reservacion < '{{ $('Get Initial Data').first().json.fecha_hoy }}'\n  order by fecha_reservacion asc;\n\n\n",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -768,
          1648
        ],
        "id": "23a6bb5c-462d-4cb8-8f70-57e1bcef05b3",
        "name": "Obtiene Todas Fechas",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -544,
          1648
        ],
        "id": "ed939b67-c701-4124-aecf-8ddfed766a87",
        "name": "Loop Over Items9"
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          -960,
          1648
        ],
        "id": "0e53a899-b381-414a-99a8-f48a1010c6c7",
        "name": "Aggregate2"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1807951179,
            "mode": "list",
            "cachedResultName": "Reportes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1807951179"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1840,
          3984
        ],
        "id": "07dbb707-443d-4b7c-9c5e-801f8258aa9c",
        "name": "Obtiene Google Sheets",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT  id, TO_CHAR(fecha_reporte, 'YYYY-MM-DD HH24:MI')  as fecha_reporte,num_telefono, resumen_intencion, notas_tono_sentimiento, notas_urgencia, sucursal, resumen_datos_clave, estado_seguimiento\nFROM {{ $('Obtiene Datos Iniciales').first().json.schema }}.seguimiento_reportes\nWHERE fecha_reporte >= '{{ $('Obtiene Datos Iniciales').first().json.fecha_hoy }}'::date - INTERVAL '1 DAY'\n  and sucursal !='Delivery-Calle 9'\norder by fecha_reporte asc, num_telefono asc;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1840,
          3792
        ],
        "id": "87a151be-d7bc-42f4-9916-12bf7f7223af",
        "name": "Obtiene Postgres",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1807951179,
            "mode": "list",
            "cachedResultName": "Reportes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1807951179"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "num_telefono": "={{ $json.num_telefono }}",
              "fecha_reporte": "={{ $json.fecha_reporte }}",
              "resumen_intencion": "={{ $json.resumen_intencion }}",
              "notas_tono_sentimiento": "={{ $json.notas_tono_sentimiento}}",
              "notas_urgencia": "={{ $json.notas_urgencia}}",
              "sucursal": "={{ $json.sucursal}}",
              "resumen_datos_clave": "={{ $json.resumen_datos_clave}}",
              "estado_seguimiento": "={{ $json.estado_seguimiento}}"
            },
            "matchingColumns": [
              "num_telefono"
            ],
            "schema": [
              {
                "id": "fecha_reporte",
                "displayName": "fecha_reporte",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "num_telefono",
                "displayName": "num_telefono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "resumen_intencion",
                "displayName": "resumen_intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas_tono_sentimiento",
                "displayName": "notas_tono_sentimiento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas_urgencia",
                "displayName": "notas_urgencia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal",
                "displayName": "sucursal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "resumen_datos_clave",
                "displayName": "resumen_datos_clave",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "estado_seguimiento",
                "displayName": "estado_seguimiento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -384,
          3856
        ],
        "id": "132d3194-977e-4476-8bf7-87d4f5c89115",
        "name": "Registra Reporte",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "UPDATE osaki_main.seguimiento_reportes\nSET estado_seguimiento = '{{ $json.nuevo_estado }}'\nWHERE num_telefono = '{{ $json.num_telefono }}'\nAND id={{ $json.id }};",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -384,
          4032
        ],
        "id": "a5c1acb6-234d-45ca-8b4c-19a5a8e8d693",
        "name": "Actualiza Reporte",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "fieldToSplitOut": "items",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -544,
          4032
        ],
        "id": "3e5931aa-c6db-450c-a08d-a30c8e49e36b",
        "name": "Split Out2"
      },
      {
        "parameters": {
          "jsCode": "// 1. Obtenemos los datos de los nodos de entrada\nconst postgresItems = $(\"Obtiene Postgres\").all().map(i => i.json);\nconst googleSheetsItems = $(\"Obtiene Google Sheets\").all().map(i => i.json);\n\n// Función para generar la llave única de comparación\nconst createKey = (item) => {\n  const tel = item.num_telefono ? item.num_telefono.toString() : '';\n  return `${item.fecha_reporte}|${tel}|${item.resumen_intencion}|${item.sucursal}|${item.resumen_datos_clave}`;\n};\n\n// 2. Mapeamos Google Sheets para búsqueda eficiente\nconst gsMap = new Map();\ngoogleSheetsItems.forEach(item => {\n  gsMap.set(createKey(item), item);\n});\n\nconst nuevos = [];\nconst actualizaciones = [];\n\n// 3. Comparación lógica\npostgresItems.forEach(pg => {\n  const key = createKey(pg);\n  const gsMatch = gsMap.get(key);\n\n  if (!gsMatch) {\n    // Es nuevo: está en Postgres pero no en Sheets\n    nuevos.push({\n      ...pg\n    });\n  } else if (pg.estado_seguimiento !== gsMatch.estado_seguimiento) {\n    // Es actualización: el estado en Sheets es distinto al de Postgres\n    actualizaciones.push({\n      id: pg.id,\n      num_telefono: pg.num_telefono.toString(),\n      fecha_reporte: pg.fecha_reporte,\n      nuevo_estado: gsMatch.estado_seguimiento,\n      row_number: gsMatch.row_number,\n      estado_pg: pg.estado_seguimiento\n    });\n  }\n});\n\n// 4. Construimos el resultado final condicionalmente\nconst resultado = [];\n\nif (nuevos.length > 0) {\n  resultado.push({\n    tipo: \"nuevo\",\n    items: nuevos\n  });\n}\n\nif (actualizaciones.length > 0) {\n  resultado.push({\n    tipo: \"actualizacion\",\n    items: actualizaciones\n  });\n}\n\nreturn resultado;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1392,
          3920
        ],
        "id": "8b977796-b3f2-484a-b9b4-dfe322a0ba10",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1184,
          3920
        ],
        "id": "5d1a2396-7c3c-4789-8b60-aa77048fa235",
        "name": "Loop Over Items10"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.tipo }}",
                      "rightValue": "nuevo",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "68532fa8-5992-4b78-b130-eaccfad4ae33"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Nuevo"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "e0586bac-ebef-4869-ad1f-11643c7c9137",
                      "leftValue": "={{ $json.tipo }}",
                      "rightValue": "actualizacion",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Actualización"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -864,
          3936
        ],
        "id": "8c394d39-81fb-478e-8549-7f63c7009019",
        "name": "Switch3"
      },
      {
        "parameters": {
          "fieldToSplitOut": "items",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -544,
          3856
        ],
        "id": "f9d64884-9e8f-4a2f-ab11-1c8ee13d592a",
        "name": "Split Out4"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          -1584,
          3920
        ],
        "id": "9a29a219-a208-4078-a887-e2b514f1adb4",
        "name": "Merge2"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
            "mode": "list",
            "cachedResultName": "Control Calle 9",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1032791827,
            "mode": "list",
            "cachedResultName": "Reportes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1032791827"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1728,
          5568
        ],
        "id": "1f23f132-a1cc-485b-adeb-46dd1645bfd7",
        "name": "Obtiene Google Sheets1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT  id, TO_CHAR(fecha_reporte, 'YYYY-MM-DD HH24:MI')  as fecha_reporte,num_telefono, resumen_intencion, notas_tono_sentimiento, notas_urgencia, sucursal, resumen_datos_clave, estado_seguimiento\nFROM {{ $('Obtiene Datos Iniciales').first().json.schema }}.seguimiento_reportes\nWHERE fecha_reporte >= '{{ $('Obtiene Datos Iniciales').first().json.fecha_hoy }}'::date - INTERVAL '1 DAY'\n  and sucursal ='Delivery-Calle 9'\norder by fecha_reporte asc, num_telefono asc;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -1728,
          5376
        ],
        "id": "333941d8-5cbc-49f0-9182-092f850c0e13",
        "name": "Obtiene Postgres1",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
            "mode": "list",
            "cachedResultName": "Control Calle 9",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1032791827,
            "mode": "list",
            "cachedResultName": "Reportes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1032791827"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "num_telefono": "={{ $json.num_telefono }}",
              "fecha_reporte": "={{ $json.fecha_reporte }}",
              "resumen_intencion": "={{ $json.resumen_intencion }}",
              "notas_tono_sentimiento": "={{ $json.notas_tono_sentimiento}}",
              "notas_urgencia": "={{ $json.notas_urgencia}}",
              "sucursal": "={{ $json.sucursal}}",
              "resumen_datos_clave": "={{ $json.resumen_datos_clave}}",
              "estado_seguimiento": "={{ $json.estado_seguimiento}}"
            },
            "matchingColumns": [
              "num_telefono"
            ],
            "schema": [
              {
                "id": "fecha_reporte",
                "displayName": "fecha_reporte",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "num_telefono",
                "displayName": "num_telefono",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "resumen_intencion",
                "displayName": "resumen_intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas_tono_sentimiento",
                "displayName": "notas_tono_sentimiento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "notas_urgencia",
                "displayName": "notas_urgencia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "sucursal",
                "displayName": "sucursal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "resumen_datos_clave",
                "displayName": "resumen_datos_clave",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "estado_seguimiento",
                "displayName": "estado_seguimiento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -272,
          5440
        ],
        "id": "abb67c63-1e2a-42d6-be83-ec6927ac86ae",
        "name": "Registra Reporte1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "UPDATE osaki_main.seguimiento_reportes\nSET estado_seguimiento = '{{ $json.nuevo_estado }}'\nWHERE num_telefono = '{{ $json.num_telefono }}'\nAND id={{ $json.id }};",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -272,
          5616
        ],
        "id": "daf81487-ef07-4d45-83ea-764e5cdbbf01",
        "name": "Actualiza Reporte1",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "fieldToSplitOut": "items",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -432,
          5616
        ],
        "id": "1baad8ba-16cc-417f-8f32-65ad03b78bee",
        "name": "Split Out3",
        "disabled": true
      },
      {
        "parameters": {
          "jsCode": "// 1. Obtenemos los datos de los nodos de entrada\nconst postgresItems = $(\"Obtiene Postgres1\").all().map(i => i.json);\nconst googleSheetsItems = $(\"Obtiene Google Sheets1\").all().map(i => i.json);\n\n// Función para generar la llave única de comparación\nconst createKey = (item) => {\n  const tel = item.num_telefono ? item.num_telefono.toString() : '';\n  return `${item.fecha_reporte}|${tel}|${item.resumen_intencion}|${item.sucursal}|${item.resumen_datos_clave}`;\n};\n\n// 2. Mapeamos Google Sheets para búsqueda eficiente\nconst gsMap = new Map();\ngoogleSheetsItems.forEach(item => {\n  gsMap.set(createKey(item), item);\n});\n\nconst nuevos = [];\nconst actualizaciones = [];\n\n// 3. Comparación lógica\npostgresItems.forEach(pg => {\n  const key = createKey(pg);\n  const gsMatch = gsMap.get(key);\n\n  if (!gsMatch) {\n    // Es nuevo: está en Postgres pero no en Sheets\n    nuevos.push({\n      ...pg\n    });\n  } else if (pg.estado_seguimiento !== gsMatch.estado_seguimiento) {\n    // Es actualización: el estado en Sheets es distinto al de Postgres\n    actualizaciones.push({\n      id: pg.id,\n      num_telefono: pg.num_telefono.toString(),\n      fecha_reporte: pg.fecha_reporte,\n      nuevo_estado: gsMatch.estado_seguimiento,\n      row_number: gsMatch.row_number,\n      estado_pg: pg.estado_seguimiento\n    });\n  }\n});\n\n// 4. Construimos el resultado final condicionalmente\nconst resultado = [];\n\nif (nuevos.length > 0) {\n  resultado.push({\n    tipo: \"nuevo\",\n    items: nuevos\n  });\n}\n\nif (actualizaciones.length > 0) {\n  resultado.push({\n    tipo: \"actualizacion\",\n    items: actualizaciones\n  });\n}\n\nreturn resultado;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1280,
          5504
        ],
        "id": "a018be5e-c1fa-41ca-a86a-0681451c7b13",
        "name": "Code in JavaScript2",
        "disabled": true
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -1072,
          5504
        ],
        "id": "27aae7e8-63d3-4bdf-ad5b-14ae8b0ae431",
        "name": "Loop Over Items14",
        "disabled": true
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.tipo }}",
                      "rightValue": "nuevo",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "68532fa8-5992-4b78-b130-eaccfad4ae33"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Nuevo"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "e0586bac-ebef-4869-ad1f-11643c7c9137",
                      "leftValue": "={{ $json.tipo }}",
                      "rightValue": "actualizacion",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Actualización"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -752,
          5520
        ],
        "id": "d97f4065-51bd-4aa9-a078-b00ad312b758",
        "name": "Switch4",
        "disabled": true
      },
      {
        "parameters": {
          "fieldToSplitOut": "items",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -432,
          5440
        ],
        "id": "e6139ec1-59a0-4181-8875-5431b3f69b59",
        "name": "Split Out5",
        "disabled": true
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          -1472,
          5504
        ],
        "id": "2e43d6c8-e56c-423c-9475-7d215d8256ea",
        "name": "Merge3",
        "disabled": true
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1807951179,
            "mode": "list",
            "cachedResultName": "Reportes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1807951179"
          },
          "keepFirstRow": true
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1168,
          2640
        ],
        "id": "d1c7f79e-8157-462a-903f-284733bdf4fb",
        "name": "Limpia Hoja Reportes Calle 47",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "clear",
          "documentId": {
            "__rl": true,
            "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
            "mode": "list",
            "cachedResultName": "Control Calle 9",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1032791827,
            "mode": "list",
            "cachedResultName": "Reportes",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1032791827"
          },
          "keepFirstRow": true
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -1168,
          2816
        ],
        "id": "086f714e-6b65-46a4-95e8-a0d08399ebf5",
        "name": "Limpia Hoja Reportes Calle  9",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      }
    ],
    "connections": {
      "Get Reserv Sheets": {
        "main": [
          [
            {
              "node": "Evalua Hojas",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Limpia Históricos": {
        "main": [
          [
            {
              "node": "Get Historic",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Historic": {
        "main": [
          [
            {
              "node": "Update Historic",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Revisa Cliente": {
        "main": [
          [
            {
              "node": "No Existe?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Registra Cliente": {
        "main": [
          [
            {
              "node": "Ingresa Registro",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items1": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Reserv Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create sheet": {
        "main": [
          [
            {
              "node": "Get Reserv1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Llena Documento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Reserv1": {
        "main": [
          [
            {
              "node": "Llena Documento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Llena Documento1": {
        "main": [
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Historic": {
        "main": [
          [
            {
              "node": "Aggregate2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpia Documento": {
        "main": [
          [
            {
              "node": "Get Reserv",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Llena Documento": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Reserv": {
        "main": [
          [
            {
              "node": "Llena Documento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Base1": {
        "main": [
          [
            {
              "node": "Restaura Marca de Actualizacion1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Get Data",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "Deduplica Fechas",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 2
            }
          ],
          [
            {
              "node": "Limpia Documento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check New": {
        "main": [
          [
            {
              "node": "Datos Completos?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Data": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items2": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ],
          [
            {
              "node": "Actualiza Base1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items3": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Revisa Cliente",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Aggregate1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate1": {
        "main": [
          [
            {
              "node": "Hubo Nuevos?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Fechas Reservas": {
        "main": [
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Restaura Marca de Actualizacion": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Registro Nuevo?": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Restaura Marca de Actualizacion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ingresa Registro": {
        "main": [
          [
            {
              "node": "Registro Nuevo?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "No Existe?": {
        "main": [
          [
            {
              "node": "Registra Cliente",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Ingresa Registro",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Restaura Marca de Actualizacion1": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Hubo Nuevos?": {
        "main": [
          [
            {
              "node": "Limpia Hoja de Nuevos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Deduplica Fechas": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create sheet1": {
        "main": [
          [
            {
              "node": "Get Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Append row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cada 10 min": {
        "main": [
          [
            {
              "node": "Calcula Fecha y Hora Actual",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Historial a Borrar": {
        "main": [
          [
            {
              "node": "Loop Over Items4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respalda Conversación": {
        "main": [
          [
            {
              "node": "Limpiando Historial",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items4": {
        "main": [
          [],
          [
            {
              "node": "Respalda Conversación",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpiando Historial": {
        "main": [
          [
            {
              "node": "Loop Over Items4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Atencion IA ": {
        "main": [
          [
            {
              "node": "ACtualiza Intentos Negativos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create sheet2": {
        "main": [
          [
            {
              "node": "Execute a SQL query",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute a SQL query": {
        "main": [
          [
            {
              "node": "Append row in sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet1": {
        "main": [
          [
            {
              "node": "Loop Over Items2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpia Hoja de Nuevos": {
        "main": [
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge1": {
        "main": [
          [
            {
              "node": "Loop Over Items5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items5": {
        "main": [
          [],
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete sheet1": {
        "main": [
          [
            {
              "node": "Loop Over Items5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "Create sheet2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Datos Completos?": {
        "main": [
          [
            {
              "node": "Create sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "Delete sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calcula Fecha y Hora Actual": {
        "main": [
          [
            {
              "node": "Check New",
              "type": "main",
              "index": 0
            },
            {
              "node": "Obtiene Fechas Reservas",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Estado Reserv Realizada": {
        "main": [
          [
            {
              "node": "Limpia Históricos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Initial Data": {
        "main": [
          [
            {
              "node": "Obtiene Historial a Borrar Deli Calle 9",
              "type": "main",
              "index": 0
            },
            {
              "node": "Actualiza Estado Reserv Realizada",
              "type": "main",
              "index": 0
            },
            {
              "node": "Actualiza Atencion IA ",
              "type": "main",
              "index": 0
            },
            {
              "node": "Limpia Hoja Clientes Calle 47",
              "type": "main",
              "index": 0
            },
            {
              "node": "Limpia Hoja Clientes Calle 9",
              "type": "main",
              "index": 0
            },
            {
              "node": "Obtiene Historial a Borrar Deli Calle 47",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ACtualiza Intentos Negativos": {
        "main": [
          [
            {
              "node": "Obtiene Historial a Borrar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items8": {
        "main": [
          [],
          [
            {
              "node": "Respalda Conversación Deli 47",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1 am": {
        "main": [
          [
            {
              "node": "Get Initial Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items11": {
        "main": [
          [],
          [
            {
              "node": "Respalda Conversación Deli 9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpia Hoja Clientes Calle 47": {
        "main": [
          [
            {
              "node": "Limpia Hoja Reportes Calle 47",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpia Hoja Clientes Calle 9": {
        "main": [
          [
            {
              "node": "Limpia Hoja Reportes Calle  9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Historial a Borrar Deli Calle 47": {
        "main": [
          [
            {
              "node": "Loop Over Items8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Historial a Borrar Deli Calle 9": {
        "main": [
          [
            {
              "node": "Loop Over Items11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respalda Conversación Deli 47": {
        "main": [
          [
            {
              "node": "Limpiando Historial Deli 47",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Respalda Conversación Deli 9": {
        "main": [
          [
            {
              "node": "Limpiando Historial Deli 9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpiando Historial Deli 47": {
        "main": [
          [
            {
              "node": "Loop Over Items8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limpiando Historial Deli 9": {
        "main": [
          [
            {
              "node": "Loop Over Items11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cada 1 Min": {
        "main": [
          [
            {
              "node": "Obtiene Datos Iniciales",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out1": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items12": {
        "main": [
          [],
          [
            {
              "node": "If11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Select rows from a table2": {
        "main": [
          [
            {
              "node": "If10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If10": {
        "main": [
          [
            {
              "node": "Insert rows in a table4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "If12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert rows in a table4": {
        "main": [
          [
            {
              "node": "Update row in sheet3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get BlackList3": {
        "main": [
          [
            {
              "node": "Reverse 47",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert rows in a table5": {
        "main": [
          [
            {
              "node": "Update row in sheet2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet2": {
        "main": [
          [
            {
              "node": "Loop Over Items6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete table or rows2": {
        "main": [
          [
            {
              "node": "Delete rows or columns from sheet2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete rows or columns from sheet2": {
        "main": [
          [
            {
              "node": "Wait2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If11": {
        "main": [
          [
            {
              "node": "Select rows from a table2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If12": {
        "main": [
          [
            {
              "node": "Update rows in a table3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Datos Iniciales": {
        "main": [
          [
            {
              "node": "Split Out1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Insert rows in a table5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Delete table or rows2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Variables 47",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Clientes Sheet2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Obtiene Postgres",
              "type": "main",
              "index": 0
            },
            {
              "node": "Obtiene Google Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Clientes Sheet",
              "type": "main",
              "index": 0
            },
            {
              "node": "Variables 9",
              "type": "main",
              "index": 0
            },
            {
              "node": "Obtiene Postgres1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Obtiene Google Sheets1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Variables 47": {
        "main": [
          [
            {
              "node": "Get BlackList3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get BlackList": {
        "main": [
          [
            {
              "node": "Reverse 9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert rows in a table": {
        "main": [
          [
            {
              "node": "Update row in sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet": {
        "main": [
          [
            {
              "node": "Loop Over Items7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete table or rows": {
        "main": [
          [
            {
              "node": "Delete rows or columns from sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete rows or columns from sheet": {
        "main": [
          [
            {
              "node": "Wait3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Variables 9": {
        "main": [
          [
            {
              "node": "Get BlackList",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reverse 9": {
        "main": [
          [
            {
              "node": "Loop Over Items7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reverse 47": {
        "main": [
          [
            {
              "node": "Loop Over Items6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items13": {
        "main": [
          [],
          [
            {
              "node": "If14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update rows in a table": {
        "main": [
          [
            {
              "node": "Loop Over Items13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Select rows from a table": {
        "main": [
          [
            {
              "node": "If16",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert rows in a table6": {
        "main": [
          [
            {
              "node": "Loop Over Items13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If14": {
        "main": [
          [
            {
              "node": "Select rows from a table",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If15": {
        "main": [
          [
            {
              "node": "Update rows in a table",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Clientes Sheet": {
        "main": [
          [
            {
              "node": "Loop Over Items13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update rows in a table3": {
        "main": [
          [
            {
              "node": "Loop Over Items12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items6": {
        "main": [
          [],
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch2": {
        "main": [
          [
            {
              "node": "Insert rows in a table",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Delete table or rows",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items7": {
        "main": [
          [],
          [
            {
              "node": "Switch2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait2": {
        "main": [
          [
            {
              "node": "Loop Over Items6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait3": {
        "main": [
          [
            {
              "node": "Loop Over Items7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If16": {
        "main": [
          [
            {
              "node": "Insert rows in a table6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "If15",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Clientes Sheet2": {
        "main": [
          [
            {
              "node": "Loop Over Items12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‘Execute workflow’": {
        "main": [
          []
        ]
      },
      "Update row in sheet3": {
        "main": [
          [
            {
              "node": "Loop Over Items12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete sheet2": {
        "main": [
          [
            {
              "node": "Create sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evalua Hojas": {
        "main": [
          [
            {
              "node": "Delete sheet2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Create sheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Loop Over Items1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Todas Fechas": {
        "main": [
          [
            {
              "node": "Loop Over Items9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items9": {
        "main": [
          [],
          [
            {
              "node": "Delete sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete sheet": {
        "main": [
          [
            {
              "node": "Loop Over Items9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate2": {
        "main": [
          [
            {
              "node": "Obtiene Todas Fechas",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Google Sheets": {
        "main": [
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Obtiene Postgres": {
        "main": [
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Registra Reporte": {
        "main": [
          [
            {
              "node": "Loop Over Items10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Reporte": {
        "main": [
          [
            {
              "node": "Loop Over Items10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out2": {
        "main": [
          [
            {
              "node": "Actualiza Reporte",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "Loop Over Items10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items10": {
        "main": [
          [],
          [
            {
              "node": "Switch3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch3": {
        "main": [
          [
            {
              "node": "Split Out4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Split Out2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out4": {
        "main": [
          [
            {
              "node": "Registra Reporte",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge2": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Obtiene Google Sheets1": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Obtiene Postgres1": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Registra Reporte1": {
        "main": [
          [
            {
              "node": "Loop Over Items14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Reporte1": {
        "main": [
          [
            {
              "node": "Loop Over Items14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out3": {
        "main": [
          [
            {
              "node": "Actualiza Reporte1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript2": {
        "main": [
          [
            {
              "node": "Loop Over Items14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items14": {
        "main": [
          [],
          [
            {
              "node": "Switch4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch4": {
        "main": [
          [
            {
              "node": "Split Out5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Split Out3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out5": {
        "main": [
          [
            {
              "node": "Registra Reporte1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge3": {
        "main": [
          [
            {
              "node": "Code in JavaScript2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Temikia Agency",
    "name": "Version 75ece487",
    "description": "",
    "autosaved": true
  },
  "activeVersionId": "75ece487-e59b-441c-ac23-3db14ebd1b79",
  "connections": {
    "Get Reserv Sheets": {
      "main": [
        [
          {
            "node": "Evalua Hojas",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Limpia Históricos": {
      "main": [
        [
          {
            "node": "Get Historic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Historic": {
      "main": [
        [
          {
            "node": "Update Historic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Revisa Cliente": {
      "main": [
        [
          {
            "node": "No Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registra Cliente": {
      "main": [
        [
          {
            "node": "Ingresa Registro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Reserv Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create sheet": {
      "main": [
        [
          {
            "node": "Get Reserv1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Llena Documento1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Reserv1": {
      "main": [
        [
          {
            "node": "Llena Documento1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Llena Documento1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Historic": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpia Documento": {
      "main": [
        [
          {
            "node": "Get Reserv",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Llena Documento": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Reserv": {
      "main": [
        [
          {
            "node": "Llena Documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Base1": {
      "main": [
        [
          {
            "node": "Restaura Marca de Actualizacion1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Deduplica Fechas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ],
        [
          {
            "node": "Limpia Documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check New": {
      "main": [
        [
          {
            "node": "Datos Completos?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "Actualiza Base1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Revisa Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Hubo Nuevos?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Fechas Reservas": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Restaura Marca de Actualizacion": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registro Nuevo?": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Restaura Marca de Actualizacion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ingresa Registro": {
      "main": [
        [
          {
            "node": "Registro Nuevo?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Existe?": {
      "main": [
        [
          {
            "node": "Registra Cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ingresa Registro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Restaura Marca de Actualizacion1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hubo Nuevos?": {
      "main": [
        [
          {
            "node": "Limpia Hoja de Nuevos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deduplica Fechas": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create sheet1": {
      "main": [
        [
          {
            "node": "Get Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cada 10 min": {
      "main": [
        [
          {
            "node": "Calcula Fecha y Hora Actual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Historial a Borrar": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respalda Conversación": {
      "main": [
        [
          {
            "node": "Limpiando Historial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [],
        [
          {
            "node": "Respalda Conversación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpiando Historial": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Atencion IA ": {
      "main": [
        [
          {
            "node": "ACtualiza Intentos Negativos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create sheet2": {
      "main": [
        [
          {
            "node": "Execute a SQL query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query": {
      "main": [
        [
          {
            "node": "Append row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet1": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpia Hoja de Nuevos": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items5": {
      "main": [
        [],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete sheet1": {
      "main": [
        [
          {
            "node": "Loop Over Items5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Create sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos Completos?": {
      "main": [
        [
          {
            "node": "Create sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Delete sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calcula Fecha y Hora Actual": {
      "main": [
        [
          {
            "node": "Check New",
            "type": "main",
            "index": 0
          },
          {
            "node": "Obtiene Fechas Reservas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Estado Reserv Realizada": {
      "main": [
        [
          {
            "node": "Limpia Históricos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Initial Data": {
      "main": [
        [
          {
            "node": "Obtiene Historial a Borrar Deli Calle 9",
            "type": "main",
            "index": 0
          },
          {
            "node": "Actualiza Estado Reserv Realizada",
            "type": "main",
            "index": 0
          },
          {
            "node": "Actualiza Atencion IA ",
            "type": "main",
            "index": 0
          },
          {
            "node": "Limpia Hoja Clientes Calle 47",
            "type": "main",
            "index": 0
          },
          {
            "node": "Limpia Hoja Clientes Calle 9",
            "type": "main",
            "index": 0
          },
          {
            "node": "Obtiene Historial a Borrar Deli Calle 47",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ACtualiza Intentos Negativos": {
      "main": [
        [
          {
            "node": "Obtiene Historial a Borrar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items8": {
      "main": [
        [],
        [
          {
            "node": "Respalda Conversación Deli 47",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 am": {
      "main": [
        [
          {
            "node": "Get Initial Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items11": {
      "main": [
        [],
        [
          {
            "node": "Respalda Conversación Deli 9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpia Hoja Clientes Calle 47": {
      "main": [
        [
          {
            "node": "Limpia Hoja Reportes Calle 47",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpia Hoja Clientes Calle 9": {
      "main": [
        [
          {
            "node": "Limpia Hoja Reportes Calle  9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Historial a Borrar Deli Calle 47": {
      "main": [
        [
          {
            "node": "Loop Over Items8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Historial a Borrar Deli Calle 9": {
      "main": [
        [
          {
            "node": "Loop Over Items11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respalda Conversación Deli 47": {
      "main": [
        [
          {
            "node": "Limpiando Historial Deli 47",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respalda Conversación Deli 9": {
      "main": [
        [
          {
            "node": "Limpiando Historial Deli 9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpiando Historial Deli 47": {
      "main": [
        [
          {
            "node": "Loop Over Items8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limpiando Historial Deli 9": {
      "main": [
        [
          {
            "node": "Loop Over Items11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cada 1 Min": {
      "main": [
        [
          {
            "node": "Obtiene Datos Iniciales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items12": {
      "main": [
        [],
        [
          {
            "node": "If11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table2": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "Insert rows in a table4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table4": {
      "main": [
        [
          {
            "node": "Update row in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get BlackList3": {
      "main": [
        [
          {
            "node": "Reverse 47",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table5": {
      "main": [
        [
          {
            "node": "Update row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet2": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete table or rows2": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet2": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If11": {
      "main": [
        [
          {
            "node": "Select rows from a table2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If12": {
      "main": [
        [
          {
            "node": "Update rows in a table3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Datos Iniciales": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Insert rows in a table5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete table or rows2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Variables 47",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Clientes Sheet2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Obtiene Postgres",
            "type": "main",
            "index": 0
          },
          {
            "node": "Obtiene Google Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Clientes Sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "Variables 9",
            "type": "main",
            "index": 0
          },
          {
            "node": "Obtiene Postgres1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Obtiene Google Sheets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Variables 47": {
      "main": [
        [
          {
            "node": "Get BlackList3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get BlackList": {
      "main": [
        [
          {
            "node": "Reverse 9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete table or rows": {
      "main": [
        [
          {
            "node": "Delete rows or columns from sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete rows or columns from sheet": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Variables 9": {
      "main": [
        [
          {
            "node": "Get BlackList",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reverse 9": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reverse 47": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items13": {
      "main": [
        [],
        [
          {
            "node": "If14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table": {
      "main": [
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "If16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert rows in a table6": {
      "main": [
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If14": {
      "main": [
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If15": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Clientes Sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table3": {
      "main": [
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items6": {
      "main": [
        [],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Insert rows in a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete table or rows",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items7": {
      "main": [
        [],
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Loop Over Items6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If16": {
      "main": [
        [
          {
            "node": "Insert rows in a table6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Clientes Sheet2": {
      "main": [
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        []
      ]
    },
    "Update row in sheet3": {
      "main": [
        [
          {
            "node": "Loop Over Items12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete sheet2": {
      "main": [
        [
          {
            "node": "Create sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evalua Hojas": {
      "main": [
        [
          {
            "node": "Delete sheet2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Todas Fechas": {
      "main": [
        [
          {
            "node": "Loop Over Items9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items9": {
      "main": [
        [],
        [
          {
            "node": "Delete sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Obtiene Todas Fechas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Google Sheets": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Obtiene Postgres": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registra Reporte": {
      "main": [
        [
          {
            "node": "Loop Over Items10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Reporte": {
      "main": [
        [
          {
            "node": "Loop Over Items10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Actualiza Reporte",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Loop Over Items10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items10": {
      "main": [
        [],
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Split Out4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out4": {
      "main": [
        [
          {
            "node": "Registra Reporte",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Google Sheets1": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Obtiene Postgres1": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registra Reporte1": {
      "main": [
        [
          {
            "node": "Loop Over Items14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Reporte1": {
      "main": [
        [
          {
            "node": "Loop Over Items14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out3": {
      "main": [
        [
          {
            "node": "Actualiza Reporte1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Loop Over Items14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items14": {
      "main": [
        [],
        [
          {
            "node": "Switch4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch4": {
      "main": [
        [
          {
            "node": "Split Out5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split Out3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out5": {
      "main": [
        [
          {
            "node": "Registra Reporte1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-11T17:49:55.779Z",
  "id": "VLP59OWZ9ExHBRXx",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Osaki- Cronograma",
  "nodes": [
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
          "mode": "name"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1056,
        832
      ],
      "id": "7b1d7e3c-0718-48b8-91c5-546b3c654a72",
      "name": "Get Reserv Sheets",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1453691080,
          "mode": "list",
          "cachedResultName": "Historicos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1453691080"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1616,
        1648
      ],
      "id": "58d96e47-f110-4a4e-8d1c-594fcb18cf23",
      "name": "Limpia Históricos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Get Initial Data').first().json.schema }}.reservaciones \n  WHERE fecha_reservacion >= '{{ $('Get Initial Data').first().json.fecha_hoy }}'::date - INTERVAL '3 months'\nAND fecha_reservacion < '{{ $('Get Initial Data').first().json.fecha_hoy }}'\n    order by fecha_reservacion ASC;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1392,
        1648
      ],
      "id": "2d53ed3d-4a62-45df-8b03-59a72b0adac5",
      "name": "Get Historic",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1453691080,
          "mode": "list",
          "cachedResultName": "Historicos",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1453691080"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1168,
        1648
      ],
      "id": "34eb8f13-e082-4c36-ab58-0b6dee1093e0",
      "name": "Update Historic",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes_reserva",
          "mode": "list",
          "cachedResultName": "clientes_reserva"
        },
        "where": {
          "values": [
            {
              "column": "nombre_completo",
              "value": "={{ $json.cliente }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        80,
        0
      ],
      "id": "83d721aa-03f0-480b-ab85-9910c76c7b1c",
      "name": "Revisa Cliente",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes_reserva",
          "mode": "list",
          "cachedResultName": "clientes_reserva"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "nombre_completo": "={{ $('Loop Over Items3').item.json.cliente }}",
            "email": "={{ $('Loop Over Items3').item.json.email_contacto }}",
            "telefono_contacto": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
            "total_reservaciones": 1,
            "ultima_fecha_reservacion": "={{ new Date( $('Loop Over Items3').item.json.fecha_reservacion) }}",
            "ultima_hora_reservacion": "={{ $('Loop Over Items3').item.json.hora_reservacion }}",
            "created_at": "={{ $now }}",
            "updated_at": "={{ $now }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre_completo",
              "displayName": "nombre_completo",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "clasificacion_cliente",
              "displayName": "clasificacion_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "ultima_fecha_reservacion",
              "displayName": "ultima_fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "ultima_hora_reservacion",
              "displayName": "ultima_hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        608,
        -96
      ],
      "id": "b16d93ab-e572-48f0-8e13-5e97205af854",
      "name": "Registra Cliente",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1296,
        816
      ],
      "id": "19163e0d-961f-4f35-8ab2-998c5aa92706",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "operation": "create",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "title": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        832
      ],
      "id": "00f20ac6-a210-4c58-96cf-511c58ce91dd",
      "name": "Create sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE fecha_reservacion = '{{ $('Loop Over Items1').item.json.fecha_reservacion }}'  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -304,
        832
      ],
      "id": "4c069244-2194-4eae-99b0-552d69cb322d",
      "name": "Get Reserv1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -144,
        832
      ],
      "id": "bab9f449-b1c8-4390-ac49-e56d6bddbe96",
      "name": "Llena Documento1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "remove",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.fecha_reservacion }}",
          "mode": "name"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -336,
        1664
      ],
      "id": "d24f3728-5957-4013-a38a-fd3fc75ae0d4",
      "name": "Delete sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.fecha_reservacion }}",
          "mode": "name"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        640
      ],
      "id": "23bd5028-3d08-409d-95ec-877a3b4774b3",
      "name": "Limpia Documento",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.fecha_reservacion }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "actualiza_base",
              "displayName": "actualiza_base",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1520,
        640
      ],
      "id": "6523e24b-239d-4a97-915d-c5dc9d97b892",
      "name": "Llena Documento",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE fecha_reservacion = '{{ $json.fecha_reservacion }}'  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1296,
        640
      ],
      "id": "1f1b96ee-1584-4f06-83f4-501b7255afd7",
      "name": "Get Reserv",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "cliente": "={{ $json.cliente }}",
            "fecha_reservacion": "={{ $json.fecha_reservacion }}",
            "hora_reservacion": "={{ $json.hora_reservacion }}",
            "numero_personas": "={{ $json.numero_personas }}",
            "estado": "={{ $json.estado }}",
            "dia_semana": "={{ $json.dia_semana }}",
            "email_contacto": "={{ $json.email_contacto }}",
            "telefono_contacto": "={{ $json.telefono_contacto }}",
            "notas": "={{ $json.notas }}",
            "zona": "={{ $json.zona }}",
            "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "codigo_reserva": "={{ $json.codigo_reserva }}",
            "mesas_reserva": "={{\n  (function() {\n    const p = $json.numero_personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}"
          },
          "matchingColumns": [
            "codigo_reserva"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ubicacion",
              "displayName": "ubicacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_solicitante",
              "displayName": "telefono_solicitante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mesas_reserva",
              "displayName": "mesas_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -32,
        368
      ],
      "id": "56e0858b-df07-48fa-830a-4b7672394d3c",
      "name": "Actualiza Base1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f153c500-16e3-4382-b59f-1a0c21933cba",
                    "leftValue": "={{ ($json.codigo_reserva.isEmpty() && $json.actualiza_base == 'Sí' ) }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nueva Reserva"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.actualiza_base.replace(/í/g, 'i').toLowerCase().replace(/\\s/g, '') }}",
                    "rightValue": "si",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "3a41c2e6-eff1-435c-aa27-9b4291c75e3e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Actualiza Base"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -816,
        576
      ],
      "id": "cf15d1f5-c84e-44ec-83d2-e4b670f075da",
      "name": "Switch"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "fecha_reservacion"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        176,
        624
      ],
      "id": "cceb2ed7-9513-4d64-8e24-17ba307db4eb",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "fieldToSplitOut": "fecha_reservacion",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        592,
        624
      ],
      "id": "29bdac86-586a-409e-8f27-5b2cf9fd2a8f",
      "name": "Split Out"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        800,
        624
      ],
      "id": "56fc304d-f752-46b6-b504-6eb914ccd00a",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1429491814,
          "mode": "list",
          "cachedResultName": "Reservas Nuevas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1429491814"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "specifyRange",
              "headerRow": 2,
              "firstDataRow": 3
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1696,
        16
      ],
      "id": "ee321f4b-bc54-4af3-a5b5-9adff82c3572",
      "name": "Check New",
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// 1. Obtener todos los items del nodo \"Check New\".\n// $items() ya devuelve el array, no se necesita .all()\nconst items = $items(\"Datos Completos?\");\n\n// 4. Devolver los items modificados\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -416,
        -16
      ],
      "id": "cd6061e3-cd4d-4008-bf3b-86478a5c093f",
      "name": "Get Data"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -224,
        352
      ],
      "id": "36f6a34a-29fa-433c-a99d-58da07fa511a",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -192,
        -16
      ],
      "id": "f5ac0b77-39d5-43c5-a434-3ce943a53279",
      "name": "Loop Over Items3"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1584,
        320
      ],
      "id": "21bab4e9-57c3-4b01-834e-b9273799bcb1",
      "name": "Merge"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1808,
        336
      ],
      "id": "92f46abb-8e4a-42b8-a072-29a08a3d8bcf",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\nSELECT \n    TO_CHAR(fecha_reservacion,'YYYY-MM-DD')::text as fecha_reservacion , count(*)\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE fecha_reservacion >= '{{ $('Calcula Fecha y Hora Actual').item.json.fecha_hoy }}'\n  group by fecha_reservacion\n    order by fecha_reservacion;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1744,
        1024
      ],
      "id": "5f7e5d98-a467-4ffd-9eea-a3e9e94fc110",
      "name": "Obtiene Fechas Reservas",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "content": "## Nuevas Reservaciones Manuales\n\n- Se Analiza la hoja llamada \"Nuevos\"\n- Si hay registros nuevos extrae aquellos",
        "height": 336,
        "width": 496
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1792,
        -128
      ],
      "typeVersion": 1,
      "id": "e28748bb-3af1-4bba-86d3-2816fed1bb3a",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Inserta Nuevos Registros\n\n- Aquellos registros que existan en Excel y no existan en la base de datos\n- Se insertan en la base de datos\n- Si el cliente no existe se da de alta",
        "height": 80,
        "width": 2160,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -304,
        176
      ],
      "typeVersion": 1,
      "id": "f1ae3452-c71a-4631-a918-8d672ac7334b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Loop Over Items3').item.json.fecha_reservacion }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.codigo_reserva }}",
            "actualiza_base": "No",
            "cliente": "={{ $json.cliente }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actualiza_base",
              "displayName": "actualiza_base",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1248,
        64
      ],
      "id": "5b21e725-2b74-4aee-96cc-e6facc271c7a",
      "name": "Restaura Marca de Actualizacion",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5ea1bd40-00d3-45ae-b9a6-9370f82a09c4",
              "leftValue": "={{ $if($('Check New').isExecuted,'Nuevo') }}",
              "rightValue": "Nuevo",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1040,
        16
      ],
      "id": "3e308ad4-ccd7-48fe-83f4-40fdcf18cae0",
      "name": "Registro Nuevo?"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Calcula Fecha y Hora Actual').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "cliente": "={{ $('Loop Over Items3').item.json.cliente }}",
            "fecha_reservacion": "={{  $('Loop Over Items3').item.json.fecha_reservacion.toDateTime() }}",
            "hora_reservacion": "={{  $('Loop Over Items3').item.json.hora_reservacion }}",
            "numero_personas": "={{ parseInt($('Loop Over Items3').item.json.numero_personas, 10) }}",
            "estado": "={{ $('Loop Over Items3').item.json.estado }}",
            "dia_semana": "={{ $('Loop Over Items3').item.json.dia_semana }}",
            "email_contacto": "={{ $('Loop Over Items3').item.json.email_contacto }}",
            "telefono_contacto": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
            "notas": "={{ $('Loop Over Items3').item.json.notas }}",
            "zona": "={{ $('Loop Over Items3').item.json.zona }}",
            "ubicacion": "Osaki Sushi - Restó (Calle 47 N°717, La Plata)",
            "telefono_solicitante": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
            "created_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "codigo_reserva": "={{ `OSK-${$now.setZone('America/Argentina/Buenos_Aires').toFormat('yyMMdd')}-${Array.from({length: 4}, () => String.fromCharCode(65 + Math.floor(Math.random() * 26))).join('')}` }}",
            "mesas_reserva": "={{\n  (function() {\n    const p = $('Loop Over Items3').item.json.numero_personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
            "Canal": "Google Sheets"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ubicacion",
              "displayName": "ubicacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_solicitante",
              "displayName": "telefono_solicitante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mesas_reserva",
              "displayName": "mesas_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "intento_confirmacion",
              "displayName": "intento_confirmacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Canal",
              "displayName": "Canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        832,
        16
      ],
      "id": "1cb16ccb-bfdd-47e6-923a-155b24552e33",
      "name": "Ingresa Registro",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bf90ef92-dc44-4f31-95f6-78a482ec864f",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        320,
        0
      ],
      "id": "5c3691c4-be1d-487c-b7f6-136bb532f1b7",
      "name": "No Existe?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "actualiza_base": "No",
            "codigo_reserva": "={{ $json.codigo_reserva }}"
          },
          "matchingColumns": [
            "codigo_reserva"
          ],
          "schema": [
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actualiza_base",
              "displayName": "actualiza_base",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        160,
        368
      ],
      "id": "b396e209-f6f6-4ddf-9861-fa8c2c258081",
      "name": "Restaura Marca de Actualizacion1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1429491814,
          "mode": "list",
          "cachedResultName": "Reservas Nuevas",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1429491814"
        },
        "clear": "specificRows",
        "startIndex": 3,
        "rowsToDelete": 50
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2448,
        320
      ],
      "id": "21962dd0-9596-4373-8649-cdadaf1faba0",
      "name": "Limpia Hoja de Nuevos",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5ea1bd40-00d3-45ae-b9a6-9370f82a09c4",
              "leftValue": "={{ $if($('Check New').isExecuted,'Nuevo') }}",
              "rightValue": "Nuevo",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2032,
        336
      ],
      "id": "576988e2-7ab9-4a0e-8321-79f934fe5c20",
      "name": "Hubo Nuevos?"
    },
    {
      "parameters": {
        "jsCode": "const inputData = $input.first().json;\nconst fechasUnicas = [...new Set(inputData.fecha_reservacion)];\n\nreturn [\n  {\n    json: {\n      fecha_reservacion: fechasUnicas.sort((a, b) => new Date(a) - new Date(b))\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        624
      ],
      "id": "825f5bdb-75c0-49d7-98d8-760a7400b157",
      "name": "Deduplica Fechas"
    },
    {
      "parameters": {
        "content": "## Acxtualiza Existentes\n- Toma los registros marcados como Sí en actualización de base\n- Actualiza todo el registro en la base",
        "height": 256,
        "width": 704,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        272
      ],
      "typeVersion": 1,
      "id": "c0e06f31-9db4-4b18-a3fb-f8eaafc855ec",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Crea Espejo de Postgres\n- Limpia la hoja por fecha\n- Toma todos los registros existentes de dicha fecha de la base\n- Reinserta esos registros en la hoja de excel",
        "height": 288,
        "width": 1808,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        96,
        544
      ],
      "typeVersion": 1,
      "id": "f7690604-e4db-41d6-9ae4-488e364dd4bb",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Nuevas Fechas NO existen en Excel\n\n- Si hay reservaciones en cierta fecha y no existe su hoja en excel la crea\n- Pobla todos los datos de dicha fecha en el excel",
        "height": 304,
        "width": 1360,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1312,
        752
      ],
      "typeVersion": 1,
      "id": "34978953-4660-4f1a-b477-99cc8ef33d95",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Rellena Reservaciones Históricas\n\n- Toma todos los registros antiguos\n- Limpia el historial en excel\n. Rellena los registros en excel",
        "height": 336,
        "width": 1744,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1904,
        1520
      ],
      "typeVersion": 1,
      "id": "9b300582-f487-455f-9cfb-3f7d872086d1",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "operation": "create",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "title": "={{ $json.fecha_reservacion }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1168,
        -16
      ],
      "id": "34e5a15c-e566-4681-8779-cf2cb26b651e",
      "name": "Create sheet1",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.fecha_reservacion }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "id": "={{ $json.id }}",
            "cliente": "={{ $json.cliente }}",
            "fecha_reservacion": "={{ $json.hora_reservacion }}",
            "numero_personas": "={{ $json.numero_personas }}",
            "hora_reservacion": "={{ $json.hora_reservacion }}",
            "dia_semana": "={{ $json.dia_semana }}",
            "zona": "={{ $json.zona }}",
            "email_contacto": "={{ $json.email_contacto }}",
            "estado": "={{ $json.estado }}",
            "notas": "={{ $json.notas }}",
            "telefono_contacto": "={{ $json.telefono_contacto }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "actualiza_base",
              "displayName": "actualiza_base",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1696,
        0
      ],
      "id": "82a5744a-87af-428e-b8ff-6848a7e5e022",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fc8344fa-5d2e-45e5-94b4-9e6feaa4041e",
              "name": "codigo_reserva",
              "value": "={{ $json.codigo_reserva }}",
              "type": "string"
            },
            {
              "id": "97bb94de-dbb0-4b92-8045-9e342e8056e3",
              "name": "cliente",
              "value": "={{ $('Loop Over Items3').item.json.cliente }}",
              "type": "string"
            },
            {
              "id": "c0c43f6f-fcce-4bc0-aaeb-70a9b3f1b11c",
              "name": "fecha_reservacion",
              "value": "={{ $('Loop Over Items3').item.json.fecha_reservacion }}",
              "type": "string"
            },
            {
              "id": "5d95b4ee-07a0-405f-a6cd-7306aa278baa",
              "name": "hora_reservacion",
              "value": "={{ $('Loop Over Items3').item.json.hora_reservacion }}",
              "type": "string"
            },
            {
              "id": "ee496e22-4961-4cba-9266-ce200d0525ff",
              "name": "dia_semana",
              "value": "={{ $('Loop Over Items3').item.json.dia_semana }}",
              "type": "string"
            },
            {
              "id": "04d36865-48f8-49f6-bf11-fa33472d4e42",
              "name": "numero_personas",
              "value": "={{ $('Loop Over Items3').item.json.numero_personas }}",
              "type": "number"
            },
            {
              "id": "bf14f55b-09c7-4056-b6a2-bbc5a83e7151",
              "name": "mesas_sugeridas",
              "value": "={{\n  (function() {\n    const p = $('Loop Over Items3').item.json.numero_personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
              "type": "string"
            },
            {
              "id": "c3f5c68d-dc5d-43eb-b0b8-de782c6f1410",
              "name": "zona",
              "value": "={{ $('Loop Over Items3').item.json.zona }}",
              "type": "string"
            },
            {
              "id": "541e812c-8f33-4983-8752-6958b05c7f65",
              "name": "email_contacto",
              "value": "={{ $('Loop Over Items3').item.json.email_contacto }}",
              "type": "string"
            },
            {
              "id": "8bc40567-83eb-43fe-b595-9956115ee769",
              "name": "telefono_contacto",
              "value": "={{ $('Loop Over Items3').item.json.telefono_contacto }}",
              "type": "string"
            },
            {
              "id": "8a10b2fa-b10b-4ba2-b46a-ee2c550b67b4",
              "name": "estado",
              "value": "={{ $('Loop Over Items3').item.json.estado }}",
              "type": "string"
            },
            {
              "id": "8c7c05cc-6bc8-4cf4-88e3-fc4e7a8389e8",
              "name": "notas",
              "value": "={{ $('Loop Over Items3').item.json.notas }}",
              "type": "string"
            },
            {
              "id": "cff06e47-803c-4dd0-abb6-849d430064f9",
              "name": "actualiza_base",
              "value": "No",
              "type": "string"
            },
            {
              "id": "9f79241f-a18f-4ea5-8a0c-97a64c85a80d",
              "name": "created_at",
              "value": "={{ $now.format('yyyy-MM-dd') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1456,
        0
      ],
      "id": "788bdc2a-ef75-4c6d-a43c-0e0144195eaa",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1744,
        640
      ],
      "id": "74101a03-2172-4633-b217-80eff92b71a6",
      "name": "Wait",
      "webhookId": "85600c23-88ca-4c42-a276-c8139577c939"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 */10 10-23 * * *"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -2640,
        480
      ],
      "id": "f1855aba-ea0d-402f-97ba-90fdddac021d",
      "name": "Cada 10 min"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE {{ $('Get Initial Data').first().json.schema }}.clientes\nSET tipo_atencion = 'IA', intencion='Información'\nWHERE (tipo_atencion != 'IA' or intencion !='Información')\nAND id != 1\n;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1840,
        2032
      ],
      "id": "2beeb72f-bca0-4ee1-bae7-8fae74179a32",
      "name": "Actualiza Atencion IA ",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *\nFROM osaki_main.n8n_chat_histories\nWHERE fec_registro < NOW() - INTERVAL '4 days'\nORDER BY session_id asc, id asc;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1376,
        2032
      ],
      "id": "85668325-9d92-4e34-8c04-543be3ece051",
      "name": "Obtiene Historial a Borrar",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "  INSERT INTO {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_bkup\n  (session_id,message, old_id, fec_registro)\n  select session_id,message, id , fec_registro\n  from {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories\n  WHERE session_id='{{ $json.session_id }}'\n  and id ={{ $json.id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -912,
        2048
      ],
      "id": "eae2befd-1f96-4021-a144-f768e2e95aa7",
      "name": "Respalda Conversación",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Initial Data').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "session_id",
              "value": "={{ $('Loop Over Items4').item.json.session_id }}"
            },
            {
              "column": "id",
              "value": "={{ $('Loop Over Items4').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -688,
        2048
      ],
      "id": "c6c7e0ab-43bb-4dcd-ab19-c0c68526e0fd",
      "name": "Limpiando Historial",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1120,
        2032
      ],
      "id": "daaf6e30-3ae3-4a50-8967-36dabc9a1ec1",
      "name": "Loop Over Items4"
    },
    {
      "parameters": {
        "content": "## Respaldo y limpieza de converaciones\n* Migra las conversaciones de más de 3 días hacía un backup\n* Elimina de productivo todas las conversaciones de más de 3 días\n* Restaura la atención de todas las conversaciones a IA",
        "height": 784,
        "width": 1376
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1456,
        1872
      ],
      "typeVersion": 1,
      "id": "fd0468ce-883a-4e96-abb6-3e709ec7b2a3",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a8614567-2157-4cc1-b4e9-4125a3b00762",
              "leftValue": "={{ $json.error }}",
              "rightValue": "=not found",
              "operator": {
                "type": "string",
                "operation": "endsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        368,
        368
      ],
      "id": "a72d5a60-6bc3-4be3-9fa1-192737094a37",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "create",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "title": "={{ $json.fecha_reservacion }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        944,
        352
      ],
      "id": "d86d91cc-d6ca-4bc7-9889-6decb77e8d0a",
      "name": "Create sheet2",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.title }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1360,
        352
      ],
      "id": "b1e2f577-cee3-4dd4-8bd5-5016963c2683",
      "name": "Append row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas,\n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Calcula Fecha y Hora Actual').first().json.schema }}.reservaciones \nWHERE id = $1  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
        "options": {
          "queryReplacement": "={{ $('Actualiza Base1').item.json.id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1152,
        352
      ],
      "id": "f77cf367-093b-48e8-8b5e-ac6dcc03b70e",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/*\n * Este es un nodo de Código (Code) en n8n.\n * Asume que los datos de entrada (items) son un array de objetos,\n * donde cada objeto tiene una propiedad `json` con `fecha_reservacion`.\n *\n * Ejemplo de entrada (un item):\n * {\n * \"json\": {\n * \"fecha_reservacion\": \"2025-11-12\",\n * \"count\": \"3\"\n * }\n * }\n *\n * El nodo recibirá MÚLTIPLES items de este tipo.\n */\n\n// --- Helper Function ---\n/**\n * Convierte un objeto Date a un string en formato YYYY-MM-DD.\n * @param {Date} d - El objeto Date a formatear.\n * @returns {string} - La fecha en formato YYYY-MM-DD.\n */\nconst toYYYYMMDD = (d) => {\n  const year = d.getFullYear();\n  // getMonth() es 0-indexado (0=Enero), por eso +1\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n// --- Main Logic ---\n\n// 1. Obtener la fecha de hoy, normalizada a medianoche (hora local)\nconst today = new Date();\ntoday.setHours(0, 0, 0, 0);\n\n// 2. Procesar todos los items de entrada\nconst existingDates = new Set();\nlet maxDate = null;\n\nfor (const item of items) {\n  const dateStr = item.json.fecha_reservacion;\n  if (!dateStr) {\n    continue; // Ignorar items sin fecha\n  }\n\n  // Añadir el string de la fecha al Set para búsqueda rápida\n  existingDates.add(dateStr);\n\n  // Encontrar la fecha máxima\n  // Parsear la fecha como local. new Date(Y, M-1, D) es lo más seguro.\n  const [year, month, day] = dateStr.split('-').map(Number);\n  const currentDate = new Date(year, month - 1, day);\n\n  if (!maxDate || currentDate > maxDate) {\n    maxDate = currentDate;\n  }\n}\n\n// 3. Verificar si tenemos una fecha máxima válida\nif (!maxDate) {\n  // No se encontraron fechas en la entrada\n  return [];\n}\n\n// 4. Si la fecha máxima es anterior a hoy, no hay rango para verificar\nif (maxDate < today) {\n  return [];\n}\n\n// 5. Iterar desde \"hoy\" hasta \"maxDate\" (inclusive)\nconst missingDates = [];\n// Clonamos 'today' para usarlo como nuestro iterador\nconst loopDate = new Date(today.getTime());\n\nwhile (loopDate <= maxDate) {\n  // Convertir la fecha del bucle a string YYYY-MM-DD\n  const loopDateStr = toYYYYMMDD(loopDate);\n\n  // Comprobar si esta fecha NO está en nuestra lista de entrada\n  if (!existingDates.has(loopDateStr)) {\n    // Si no está, la añadimos al resultado\n    missingDates.push({\n      json: {\n        fecha_faltante: loopDateStr\n      }\n    });\n  }\n\n  // Avanzar al siguiente día\n  loopDate.setDate(loopDate.getDate() + 1);\n}\n\n// 7. Devolver el array de objetos con las fechas faltantes\nreturn missingDates;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2176,
        1024
      ],
      "id": "0ef1f385-66c3-407e-963a-ef05cbc2fcc4",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "mode": "chooseBranch",
        "useDataOfInput": 2
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2880,
        1008
      ],
      "id": "6da25126-8094-4e57-b30d-9543f6a4fdc3",
      "name": "Merge1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        3104,
        1008
      ],
      "id": "35ab282b-12b2-4027-93b3-3fcc29e18f71",
      "name": "Loop Over Items5"
    },
    {
      "parameters": {
        "operation": "remove",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.fecha_faltante }}",
          "mode": "name"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3600,
        1024
      ],
      "id": "42832200-a8e2-42bf-9f44-c7f0c23e4a3b",
      "name": "Delete sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1efa10e6-ab32-496b-b0c2-7fd972f57600",
              "name": "fecha_reservacion",
              "value": "={{ $('Actualiza Base1').item.json.fecha_reservacion.substring(0,10) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        640,
        352
      ],
      "id": "9c3d3411-ec07-4f3e-87b5-19c26b0777c1",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "cd2d4c20-a520-4a27-bfb5-82a50873546a",
              "leftValue": "={{ $json.estado.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1456,
        0
      ],
      "id": "fef81c9a-34aa-44bd-a0f4-5cabb7e111ba",
      "name": "Datos Completos?"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3392,
        1024
      ],
      "id": "f01f6d34-923f-4d21-9655-ecbe8aab050a",
      "name": "Wait1",
      "webhookId": "ecff492e-3f22-44db-83fd-588be9831033"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "77d1c36a-901f-46ce-bb1b-36ed256548f9",
              "name": "fecha_hoy",
              "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
              "type": "string"
            },
            {
              "id": "4c0d264c-a98f-418c-b424-81ce227f92d8",
              "name": "=hora_ahora",
              "value": "={{ new Date().toLocaleString('en-GB', { timeZone: 'America/Argentina/Buenos_Aires', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) }}",
              "type": "string"
            },
            {
              "id": "5beed38e-1087-4ec6-8ffb-c77119e18396",
              "name": "schema",
              "value": "osaki_main",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2432,
        480
      ],
      "id": "5b377084-d4b4-4e72-9eda-4d08a1047ced",
      "name": "Calcula Fecha y Hora Actual"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "  UPDATE {{ $('Get Initial Data').item.json.schema }}.reservaciones a\n  SET ESTADO='Realizada Sin Confirmar'\n  -- select * from osaki_main.reservaciones a\n  where estado ='Pendiente'\n  and (a.fecha_reservacion::date + a.hora_reservacion::time) < current_date",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1840,
        1648
      ],
      "id": "19180504-6c4d-496f-9d59-f3477e44ffd0",
      "name": "Actualiza Estado Reserv Realizada",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "77d1c36a-901f-46ce-bb1b-36ed256548f9",
              "name": "fecha_hoy",
              "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
              "type": "string"
            },
            {
              "id": "4c0d264c-a98f-418c-b424-81ce227f92d8",
              "name": "=hora_ahora",
              "value": "={{ new Date().toLocaleString('en-GB', { timeZone: 'America/Argentina/Buenos_Aires', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) }}",
              "type": "string"
            },
            {
              "id": "5beed38e-1087-4ec6-8ffb-c77119e18396",
              "name": "schema",
              "value": "osaki_main",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2736,
        1888
      ],
      "id": "212c95a6-d71c-411e-b344-35baa905b2f8",
      "name": "Get Initial Data"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE {{ $('Get Initial Data').first().json.schema }}.clientes\nSET negativos_intentos=0\nWHERE negativos_intentos != 0\n;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1632,
        2032
      ],
      "id": "5c3b4ad8-7470-478d-a028-177f38c0e6aa",
      "name": "ACtualiza Intentos Negativos",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1104,
        2240
      ],
      "id": "0ebc1a6a-b52e-4937-be85-3467923fc564",
      "name": "Loop Over Items8"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 0 1 * * *"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -2944,
        1888
      ],
      "id": "365a7b76-dffd-4ef4-b2cf-06fef1541fd2",
      "name": "1 am",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
          "mode": "list",
          "cachedResultName": "Control Calle 9",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1312669213,
          "mode": "list",
          "cachedResultName": "Clientes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1312669213"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1376,
        2816
      ],
      "id": "50999627-a25e-4b6b-a513-064bd41e7a74",
      "name": "Limpia Hoja Clientes Calle 9",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Clientes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=0"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1376,
        2640
      ],
      "id": "defddf62-2566-4cbf-b297-ec78c396d070",
      "name": "Limpia Hoja Clientes Calle 47",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1120,
        2448
      ],
      "id": "24d1b399-43ae-4bd3-88ae-3ace0a5ad9c0",
      "name": "Loop Over Items11"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *\nFROM osaki_main.n8n_chat_histories_delivery_calle_47\nWHERE fec_registro < NOW() - INTERVAL '4 days'\nORDER BY session_id asc, id asc;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1376,
        2240
      ],
      "id": "79c700e8-50f6-483e-a61a-eb8cc800077c",
      "name": "Obtiene Historial a Borrar Deli Calle 47",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT *\nFROM osaki_main.n8n_chat_histories_delivery_calle_9\nWHERE fec_registro < NOW() - INTERVAL '4 days'\nORDER BY session_id asc, id asc;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1376,
        2448
      ],
      "id": "4fba3c46-730c-4e37-be2b-65fb471e65f3",
      "name": "Obtiene Historial a Borrar Deli Calle 9",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "  INSERT INTO {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_47_bkup\n  (session_id,message, old_id, fec_registro)\n  select session_id,message, id, fec_registro\n  from {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_47\n  WHERE session_id='{{ $json.session_id }}'\n  and id ={{ $json.id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -896,
        2256
      ],
      "id": "abf450af-70b1-4b75-8983-5338fd085b5c",
      "name": "Respalda Conversación Deli 47",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "  INSERT INTO {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_9_bkup\n  (session_id,message, old_id, fec_registro)\n  select session_id,message, id, fec_registro\n  from {{ $('Get Initial Data').first().json.schema }}.n8n_chat_histories_delivery_calle_9\n  WHERE session_id='{{ $json.session_id }}'\n  and id ={{ $json.id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -912,
        2464
      ],
      "id": "e7ec0a6e-1f99-415e-b275-335ea51a6d13",
      "name": "Respalda Conversación Deli 9",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Initial Data').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories_delivery_calle_47",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories_delivery_calle_47"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "session_id",
              "value": "={{ $('Loop Over Items8').item.json.session_id }}"
            },
            {
              "column": "id",
              "value": "={{ $('Loop Over Items8').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -672,
        2256
      ],
      "id": "8046796f-f66c-45ff-813e-b5944fc7dbe4",
      "name": "Limpiando Historial Deli 47",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Initial Data').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories_delivery_calle_9",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories_delivery_calle_9"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "session_id",
              "value": "={{ $('Loop Over Items11').item.json.session_id }}"
            },
            {
              "column": "id",
              "value": "={{ $('Loop Over Items11').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -688,
        2464
      ],
      "id": "d82ea3f4-d056-44e5-914c-e2816e242b30",
      "name": "Limpiando Historial Deli 9",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 * 10-23 * * *"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -3344,
        4000
      ],
      "id": "13159c0b-54eb-4b8d-be3b-37a2638f83c3",
      "name": "Cada 1 Min"
    },
    {
      "parameters": {
        "fieldToSplitOut": "sheets",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2912,
        4000
      ],
      "id": "0df71b31-b8e9-4576-848e-c35d0b7bc284",
      "name": "Split Out1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1648,
        3168
      ],
      "id": "ece6cf16-6ae9-45ba-a688-e98f2fbc86c3",
      "name": "Loop Over Items12"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $json.Telefono.toString().replace(/[^\\d]/g, '') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1200,
        3168
      ],
      "id": "260b8a51-c027-4ff3-9352-64c7da9b0861",
      "name": "Select rows from a table2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c8eefa99-e4dc-4ddf-9dd5-0eb745e2eef9",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -976,
        3168
      ],
      "id": "e64bb761-ac71-48b1-a15f-cef8b8d0235e",
      "name": "If10"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha_registro": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "canal": "Google Sheets",
            "telefono": "={{ $('Loop Over Items12').item.json.Telefono.toString().replace(/\\D/g, '').slice(-10) }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "tipo_atencion": "={{ $('Loop Over Items12').item.json['TipoAtención'] }}",
            "notas": "Registro creado desde Google Sheets",
            "intencion": "Información",
            "num_mensaje_largo": 0,
            "actitud": 1,
            "negativos_intentos": 0,
            "total_reservaciones": 0,
            "pregunta_verifica_reserva": "={{ false }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -544,
        3152
      ],
      "id": "1794c484-5f94-4039-8685-6e1e9ea8c237",
      "name": "Insert rows in a table4",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 624839784,
          "mode": "list",
          "cachedResultName": "Blacklist",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=624839784"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1664,
        3456
      ],
      "id": "4499a663-a386-4a71-81c2-3bacd3b161ef",
      "name": "Get BlackList3",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Variables 47').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "=blacklist_phones_{{ $('Variables 47').first().json.sheets.sucursal }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "phone": "={{ $json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "descripcion",
              "displayName": "descripcion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_id",
              "displayName": "sucursal_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fec_registro",
              "displayName": "fec_registro",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -640,
        3440
      ],
      "id": "94cf1a06-cfee-4fa2-b0ae-5fa038193092",
      "name": "Insert rows in a table5",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Variables 47').first().json.sheets.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Blacklist",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Teléfono": "={{ $('Loop Over Items6').item.json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}",
            "Estado": "Agregado",
            "row_number": "={{ $('Loop Over Items6').item.json.row_number }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
              "displayName": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
              "displayName": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Esta es una lista PERMANENTE. El agente nunca responderá a los números aquí registrados",
              "displayName": "Esta es una lista PERMANENTE. El agente nunca responderá a los números aquí registrados",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -416,
        3440
      ],
      "id": "552d5f0d-3309-47b5-8d93-12bc105a08b4",
      "name": "Update row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "={{ $('Variables 47').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "=blacklist_phones_{{ $('Variables 47').first().json.sheets.sucursal }}",
          "mode": "name"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "phone",
              "value": "={{ $json['Teléfono'] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -640,
        3600
      ],
      "id": "08a0ce4d-269d-4809-80cd-b54da75455b0",
      "name": "Delete table or rows2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Variables 47').first().json.sheets.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Blacklist",
          "mode": "name"
        },
        "startIndex": "={{ $('Switch1').item.json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -416,
        3600
      ],
      "id": "84bcc25a-616d-4471-af88-f3fa1793892e",
      "name": "Delete rows or columns from sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f6d51aee-383f-498d-95df-f11e34c263c2",
              "leftValue": "={{ $json['TipoAtención'].isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "68852586-24e2-49c2-9e95-6b502c35b4b2",
              "leftValue": "={{ $json.Telefono.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1440,
        3184
      ],
      "id": "bd196d31-f057-40d3-99f2-e5e3160bd085",
      "name": "If11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7e487e61-aef8-4874-b972-019cfeba6c0d",
              "leftValue": "={{ $('Loop Over Items12').item.json['TipoAtención'] }}",
              "rightValue": "={{ $json.tipo_atencion }}",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -768,
        3216
      ],
      "id": "ba2637d9-fbca-480f-95e9-3c608dedcfd5",
      "name": "If12"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "06cb9b12-57dd-43b3-b321-4a700bb2ed51",
              "name": "sheets",
              "value": "[  { \"sucursal\":\"calle_47\", \"id\": \"16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0\"},    { \"sucursal\":\"calle_9\",\"id\": \"15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g\"}]   ",
              "type": "array"
            },
            {
              "id": "a5334687-67f0-462f-b4ed-4280f95f783d",
              "name": "schema",
              "value": "osaki_main",
              "type": "string"
            },
            {
              "id": "9e13ba25-fbac-499a-bf25-ab9764f99541",
              "name": "fecha_hoy",
              "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3136,
        4000
      ],
      "id": "752a7c6a-5ba6-4499-8440-7a1c1008395d",
      "name": "Obtiene Datos Iniciales"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.Estado }}",
                    "rightValue": "Nuevo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "30fb3e4f-55ac-4673-9c06-ae2708bd3865"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nuevo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "eb0ac507-aeef-4546-bef2-84456d4dc0a6",
                    "leftValue": "={{ $json.Estado }}",
                    "rightValue": "Eliminar",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Eliminar"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Otro"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -976,
        3456
      ],
      "id": "22ac6e9b-a6e1-4bae-8bcd-9f70f96bcf12",
      "name": "Switch1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d5ffa888-9090-46a3-9f1d-2b0bd27331ae",
              "leftValue": "={{ $json.sheets.sucursal }}",
              "rightValue": "calle_47",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -2704,
        4000
      ],
      "id": "7cf9bc46-3af9-472b-a61c-c33d3e8a87f8",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1872,
        3456
      ],
      "id": "cf57971c-fb42-4402-b5c2-18ef7ad6c5c2",
      "name": "Variables 47"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
          "mode": "list",
          "cachedResultName": "Control Calle 9",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1317093169,
          "mode": "list",
          "cachedResultName": "Blacklist",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1317093169"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1632,
        4880
      ],
      "id": "f9d3917b-7bf4-4c06-a77c-2b9019ac5171",
      "name": "Get BlackList",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Variables 9').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "=blacklist_phones_{{ $('Variables 9').first().json.sheets.sucursal }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "phone": "={{ $json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "descripcion",
              "displayName": "descripcion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_id",
              "displayName": "sucursal_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fec_registro",
              "displayName": "fec_registro",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -624,
        4864
      ],
      "id": "39f4a6c2-7273-462c-96f2-15aaf39635d1",
      "name": "Insert rows in a table",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Variables 9').item.json.sheets.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Blacklist",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Teléfono": "={{ $('Loop Over Items7').item.json['Teléfono'].toString().replace(/\\D/g, '').slice(-10) }}",
            "Estado": "Agregado",
            "row_number": "={{ $('Loop Over Items7').item.json.row_number }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
              "displayName": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
              "displayName": "Estado: Situación dentro del sistema\n\nAgregado: Actualmente incluido dentro del sistema\nNuevo: Se requiere ingresarlo al sistema\nEliminar: Retirar de la lista del sistema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "En esta lista se incluyen todo aquellos números de teléfono (10 dígitos) que serán excluídos de la atención que realiza el agente IA de manera PERMANENTE, es decir, si alguno de estos números se comunica con el agente, este NO responderá.",
              "displayName": "En esta lista se incluyen todo aquellos números de teléfono (10 dígitos) que serán excluídos de la atención que realiza el agente IA de manera PERMANENTE, es decir, si alguno de estos números se comunica con el agente, este NO responderá.",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -400,
        4864
      ],
      "id": "3fbcc3f3-04c2-499c-aa56-f3470b05d2f7",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "={{ $('Variables 9').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "=blacklist_phones_{{ $('Variables 9').first().json.sheets.sucursal }}",
          "mode": "name"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "phone",
              "value": "={{ $json['Teléfono'] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -624,
        5024
      ],
      "id": "5a839245-411b-4b2d-b581-281c6f2e6aa8",
      "name": "Delete table or rows",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Variables 9').first().json.sheets.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 1317093169,
          "mode": "list",
          "cachedResultName": "Blacklist",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1317093169"
        },
        "startIndex": "={{ $('Switch2').item.json.row_number }}"
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -400,
        5024
      ],
      "id": "49fdf290-6a71-4fcb-a001-9da816583ae1",
      "name": "Delete rows or columns from sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1840,
        4880
      ],
      "id": "599f46ee-696d-47ef-9575-ddce1c3e1548",
      "name": "Variables 9"
    },
    {
      "parameters": {
        "jsCode": "return $input.all().reverse();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1424,
        4880
      ],
      "id": "e03c8dda-c60f-41f3-8ad3-6fafeb735238",
      "name": "Reverse 9"
    },
    {
      "parameters": {
        "jsCode": "return $input.all().reverse();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1456,
        3456
      ],
      "id": "282b1395-01ef-42dc-96f4-529f56f002be",
      "name": "Reverse 47"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1632,
        4592
      ],
      "id": "a2d06fae-ef8d-4b29-90a9-c729870b24fd",
      "name": "Loop Over Items13"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telefono": "={{ $('Select rows from a table').item.json.telefono }}",
            "tipo_atencion": "={{ $('Loop Over Items13').item.json['TipoAtención'] }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -208,
        4624
      ],
      "id": "661265d9-3169-4ab0-8bc1-059b9c9bc6c3",
      "name": "Update rows in a table",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $json.Telefono.toString().replace(/[^\\d]/g, '').slice(-10) }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1184,
        4592
      ],
      "id": "94a0ca8b-668a-4a58-922d-c557bce70be9",
      "name": "Select rows from a table",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha_registro": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "canal": "Google Sheets",
            "telefono": "={{ $('Loop Over Items13').item.json.Telefono.toString().replace(/\\D/g, '').slice(-10) }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "tipo_atencion": "={{ $('Loop Over Items13').item.json['TipoAtención'] }}",
            "notas": "Registro creado desde Google Sheets",
            "intencion": "Información",
            "num_mensaje_largo": 0,
            "actitud": 1,
            "negativos_intentos": 0,
            "total_reservaciones": 0,
            "pregunta_verifica_reserva": "={{ false }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -448,
        4576
      ],
      "id": "2a4ca1da-6d7d-4fef-a180-5f729eb6380d",
      "name": "Insert rows in a table6",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f6d51aee-383f-498d-95df-f11e34c263c2",
              "leftValue": "={{ $json['TipoAtención'].isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "68852586-24e2-49c2-9e95-6b502c35b4b2",
              "leftValue": "={{ $json.Telefono.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1424,
        4608
      ],
      "id": "869eae78-de12-4ff5-a197-fb5bd005ff52",
      "name": "If14"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7e487e61-aef8-4874-b972-019cfeba6c0d",
              "leftValue": "={{ $('Loop Over Items13').item.json['TipoAtención'] }}",
              "rightValue": "={{ $json.tipo_atencion }}",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -752,
        4640
      ],
      "id": "d00014aa-0d3c-4eb2-8844-b369a16862ce",
      "name": "If15"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
          "mode": "list",
          "cachedResultName": "Control Calle 9",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1312669213,
          "mode": "list",
          "cachedResultName": "Clientes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1312669213"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1856,
        4592
      ],
      "id": "348c0182-0564-46df-b3b4-36ee2e100394",
      "name": "Get Clientes Sheet",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Obtiene Datos Iniciales').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "telefono": "={{ $('Select rows from a table2').item.json.telefono }}",
            "tipo_atencion": "={{ $('Loop Over Items12').item.json['TipoAtención'] }}"
          },
          "matchingColumns": [
            "telefono"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        48,
        3200
      ],
      "id": "908d06ca-8a89-450a-a878-036213c42a2d",
      "name": "Update rows in a table3",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1200,
        3456
      ],
      "id": "88d410af-ff4c-4ea2-b8c7-5fed7da1b62b",
      "name": "Loop Over Items6"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.Estado }}",
                    "rightValue": "Nuevo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "30fb3e4f-55ac-4673-9c06-ae2708bd3865"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nuevo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "eb0ac507-aeef-4546-bef2-84456d4dc0a6",
                    "leftValue": "={{ $json.Estado }}",
                    "rightValue": "Eliminar",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Eliminar"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Otro"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -960,
        4880
      ],
      "id": "3c5e8606-23b7-4cb0-8972-ed48eee0a733",
      "name": "Switch2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1184,
        4880
      ],
      "id": "516c3f61-1d40-4aef-b620-2d4da2730b1f",
      "name": "Loop Over Items7"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -208,
        3600
      ],
      "id": "7d8a1863-0ffd-4d72-aa71-543a0974b59e",
      "name": "Wait2",
      "webhookId": "c8017ecc-bb42-4c4e-985d-b0ef8e72d48f"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -176,
        5024
      ],
      "id": "b546b867-f22a-43cd-aa6d-4bf547cb8c0b",
      "name": "Wait3",
      "webhookId": "c8017ecc-bb42-4c4e-985d-b0ef8e72d48f"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c8eefa99-e4dc-4ddf-9dd5-0eb745e2eef9",
              "leftValue": "={{ $json.isEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -960,
        4592
      ],
      "id": "b8b823f5-3e9c-4c25-a732-e6cc3ee6c450",
      "name": "If16"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Clientes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1872,
        3168
      ],
      "id": "cee1c9a3-41fe-434e-b0dd-6c8495ed583f",
      "name": "Get Clientes Sheet2",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1024,
        1232
      ],
      "id": "9fd9e270-ead8-4241-8337-816e17500724",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Clientes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $('Loop Over Items12').item.json.row_number}}",
            "Telefono": "={{ $('Loop Over Items12').item.json.Telefono.toString().replace(/\\D/g, '').slice(-10) }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Telefono",
              "displayName": "Telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TipoAtención",
              "displayName": "TipoAtención",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
              "displayName": "Teléfono: A 10 dígitos, solo números, sin espacio o símbolos\n\nIncorrecto: 22 1234-9876\nCorrecto: 2212349876",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "TipoAtención: ¿Quién atenderá al número?\n\n\"IA\" o \"Humano\"",
              "displayName": "TipoAtención: ¿Quién atenderá al número?\n\n\"IA\" o \"Humano\"",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Esta es una lista TEMPORAL. Al finalizar el día se limpia",
              "displayName": "Esta es una lista TEMPORAL. Al finalizar el día se limpia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -256,
        3152
      ],
      "id": "a19957f6-535e-4c81-ba1a-b6bc1acb42a6",
      "name": "Update row in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "remove",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "={{ $('Loop Over Items1').item.json.fecha_reservacion }}"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -640,
        736
      ],
      "id": "edd38fad-39ad-47b2-a4cb-795abab7b14a",
      "name": "Delete sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.keys().length }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "cbdc5593-7972-48b5-841e-974f43b18529"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Hoja Vacía"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "bfe69bdd-73cf-4738-9352-b51bdf0494e4",
                    "leftValue": "={{ $json.error }}",
                    "rightValue": "=Sheet with name {{ $('Loop Over Items1').item.json.fecha_reservacion }} not found",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Hoja Inexistente"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -848,
        816
      ],
      "id": "34235d61-5a38-463c-9dc0-9e7d7c2ef367",
      "name": "Evalua Hojas"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "  \nSELECT distinct TO_CHAR(fecha_reservacion, 'YYYY-MM-DD') as fecha_reservacion\n  FROM {{ $('Get Initial Data').first().json.schema }}.reservaciones \n    WHERE fecha_reservacion >= '{{ $('Get Initial Data').first().json.fecha_hoy }}'::date - INTERVAL '1 months'\n  AND fecha_reservacion < '{{ $('Get Initial Data').first().json.fecha_hoy }}'\n  order by fecha_reservacion asc;\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -768,
        1648
      ],
      "id": "23a6bb5c-462d-4cb8-8f70-57e1bcef05b3",
      "name": "Obtiene Todas Fechas",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -544,
        1648
      ],
      "id": "ed939b67-c701-4124-aecf-8ddfed766a87",
      "name": "Loop Over Items9"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -960,
        1648
      ],
      "id": "0e53a899-b381-414a-99a8-f48a1010c6c7",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1807951179,
          "mode": "list",
          "cachedResultName": "Reportes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1807951179"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1840,
        3984
      ],
      "id": "07dbb707-443d-4b7c-9c5e-801f8258aa9c",
      "name": "Obtiene Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT  id, TO_CHAR(fecha_reporte, 'YYYY-MM-DD HH24:MI')  as fecha_reporte,num_telefono, resumen_intencion, notas_tono_sentimiento, notas_urgencia, sucursal, resumen_datos_clave, estado_seguimiento\nFROM {{ $('Obtiene Datos Iniciales').first().json.schema }}.seguimiento_reportes\nWHERE fecha_reporte >= '{{ $('Obtiene Datos Iniciales').first().json.fecha_hoy }}'::date - INTERVAL '1 DAY'\n  and sucursal !='Delivery-Calle 9'\norder by fecha_reporte asc, num_telefono asc;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1840,
        3792
      ],
      "id": "87a151be-d7bc-42f4-9916-12bf7f7223af",
      "name": "Obtiene Postgres",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1807951179,
          "mode": "list",
          "cachedResultName": "Reportes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1807951179"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "num_telefono": "={{ $json.num_telefono }}",
            "fecha_reporte": "={{ $json.fecha_reporte }}",
            "resumen_intencion": "={{ $json.resumen_intencion }}",
            "notas_tono_sentimiento": "={{ $json.notas_tono_sentimiento}}",
            "notas_urgencia": "={{ $json.notas_urgencia}}",
            "sucursal": "={{ $json.sucursal}}",
            "resumen_datos_clave": "={{ $json.resumen_datos_clave}}",
            "estado_seguimiento": "={{ $json.estado_seguimiento}}"
          },
          "matchingColumns": [
            "num_telefono"
          ],
          "schema": [
            {
              "id": "fecha_reporte",
              "displayName": "fecha_reporte",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "num_telefono",
              "displayName": "num_telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "resumen_intencion",
              "displayName": "resumen_intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas_tono_sentimiento",
              "displayName": "notas_tono_sentimiento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas_urgencia",
              "displayName": "notas_urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal",
              "displayName": "sucursal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "resumen_datos_clave",
              "displayName": "resumen_datos_clave",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado_seguimiento",
              "displayName": "estado_seguimiento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -384,
        3856
      ],
      "id": "132d3194-977e-4476-8bf7-87d4f5c89115",
      "name": "Registra Reporte",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE osaki_main.seguimiento_reportes\nSET estado_seguimiento = '{{ $json.nuevo_estado }}'\nWHERE num_telefono = '{{ $json.num_telefono }}'\nAND id={{ $json.id }};",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -384,
        4032
      ],
      "id": "a5c1acb6-234d-45ca-8b4c-19a5a8e8d693",
      "name": "Actualiza Reporte",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "items",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -544,
        4032
      ],
      "id": "3e5931aa-c6db-450c-a08d-a30c8e49e36b",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "jsCode": "// 1. Obtenemos los datos de los nodos de entrada\nconst postgresItems = $(\"Obtiene Postgres\").all().map(i => i.json);\nconst googleSheetsItems = $(\"Obtiene Google Sheets\").all().map(i => i.json);\n\n// Función para generar la llave única de comparación\nconst createKey = (item) => {\n  const tel = item.num_telefono ? item.num_telefono.toString() : '';\n  return `${item.fecha_reporte}|${tel}|${item.resumen_intencion}|${item.sucursal}|${item.resumen_datos_clave}`;\n};\n\n// 2. Mapeamos Google Sheets para búsqueda eficiente\nconst gsMap = new Map();\ngoogleSheetsItems.forEach(item => {\n  gsMap.set(createKey(item), item);\n});\n\nconst nuevos = [];\nconst actualizaciones = [];\n\n// 3. Comparación lógica\npostgresItems.forEach(pg => {\n  const key = createKey(pg);\n  const gsMatch = gsMap.get(key);\n\n  if (!gsMatch) {\n    // Es nuevo: está en Postgres pero no en Sheets\n    nuevos.push({\n      ...pg\n    });\n  } else if (pg.estado_seguimiento !== gsMatch.estado_seguimiento) {\n    // Es actualización: el estado en Sheets es distinto al de Postgres\n    actualizaciones.push({\n      id: pg.id,\n      num_telefono: pg.num_telefono.toString(),\n      fecha_reporte: pg.fecha_reporte,\n      nuevo_estado: gsMatch.estado_seguimiento,\n      row_number: gsMatch.row_number,\n      estado_pg: pg.estado_seguimiento\n    });\n  }\n});\n\n// 4. Construimos el resultado final condicionalmente\nconst resultado = [];\n\nif (nuevos.length > 0) {\n  resultado.push({\n    tipo: \"nuevo\",\n    items: nuevos\n  });\n}\n\nif (actualizaciones.length > 0) {\n  resultado.push({\n    tipo: \"actualizacion\",\n    items: actualizaciones\n  });\n}\n\nreturn resultado;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1392,
        3920
      ],
      "id": "8b977796-b3f2-484a-b9b4-dfe322a0ba10",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1184,
        3920
      ],
      "id": "5d1a2396-7c3c-4789-8b60-aa77048fa235",
      "name": "Loop Over Items10"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "nuevo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "68532fa8-5992-4b78-b130-eaccfad4ae33"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nuevo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e0586bac-ebef-4869-ad1f-11643c7c9137",
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "actualizacion",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Actualización"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -864,
        3936
      ],
      "id": "8c394d39-81fb-478e-8549-7f63c7009019",
      "name": "Switch3"
    },
    {
      "parameters": {
        "fieldToSplitOut": "items",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -544,
        3856
      ],
      "id": "f9d64884-9e8f-4a2f-ab11-1c8ee13d592a",
      "name": "Split Out4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1584,
        3920
      ],
      "id": "9a29a219-a208-4078-a887-e2b514f1adb4",
      "name": "Merge2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
          "mode": "list",
          "cachedResultName": "Control Calle 9",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1032791827,
          "mode": "list",
          "cachedResultName": "Reportes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1032791827"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1728,
        5568
      ],
      "id": "1f23f132-a1cc-485b-adeb-46dd1645bfd7",
      "name": "Obtiene Google Sheets1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT  id, TO_CHAR(fecha_reporte, 'YYYY-MM-DD HH24:MI')  as fecha_reporte,num_telefono, resumen_intencion, notas_tono_sentimiento, notas_urgencia, sucursal, resumen_datos_clave, estado_seguimiento\nFROM {{ $('Obtiene Datos Iniciales').first().json.schema }}.seguimiento_reportes\nWHERE fecha_reporte >= '{{ $('Obtiene Datos Iniciales').first().json.fecha_hoy }}'::date - INTERVAL '1 DAY'\n  and sucursal ='Delivery-Calle 9'\norder by fecha_reporte asc, num_telefono asc;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1728,
        5376
      ],
      "id": "333941d8-5cbc-49f0-9182-092f850c0e13",
      "name": "Obtiene Postgres1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
          "mode": "list",
          "cachedResultName": "Control Calle 9",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1032791827,
          "mode": "list",
          "cachedResultName": "Reportes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1032791827"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "num_telefono": "={{ $json.num_telefono }}",
            "fecha_reporte": "={{ $json.fecha_reporte }}",
            "resumen_intencion": "={{ $json.resumen_intencion }}",
            "notas_tono_sentimiento": "={{ $json.notas_tono_sentimiento}}",
            "notas_urgencia": "={{ $json.notas_urgencia}}",
            "sucursal": "={{ $json.sucursal}}",
            "resumen_datos_clave": "={{ $json.resumen_datos_clave}}",
            "estado_seguimiento": "={{ $json.estado_seguimiento}}"
          },
          "matchingColumns": [
            "num_telefono"
          ],
          "schema": [
            {
              "id": "fecha_reporte",
              "displayName": "fecha_reporte",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "num_telefono",
              "displayName": "num_telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "resumen_intencion",
              "displayName": "resumen_intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas_tono_sentimiento",
              "displayName": "notas_tono_sentimiento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas_urgencia",
              "displayName": "notas_urgencia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal",
              "displayName": "sucursal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "resumen_datos_clave",
              "displayName": "resumen_datos_clave",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado_seguimiento",
              "displayName": "estado_seguimiento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -272,
        5440
      ],
      "id": "abb67c63-1e2a-42d6-be83-ec6927ac86ae",
      "name": "Registra Reporte1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE osaki_main.seguimiento_reportes\nSET estado_seguimiento = '{{ $json.nuevo_estado }}'\nWHERE num_telefono = '{{ $json.num_telefono }}'\nAND id={{ $json.id }};",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -272,
        5616
      ],
      "id": "daf81487-ef07-4d45-83ea-764e5cdbbf01",
      "name": "Actualiza Reporte1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "items",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -432,
        5616
      ],
      "id": "1baad8ba-16cc-417f-8f32-65ad03b78bee",
      "name": "Split Out3",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// 1. Obtenemos los datos de los nodos de entrada\nconst postgresItems = $(\"Obtiene Postgres1\").all().map(i => i.json);\nconst googleSheetsItems = $(\"Obtiene Google Sheets1\").all().map(i => i.json);\n\n// Función para generar la llave única de comparación\nconst createKey = (item) => {\n  const tel = item.num_telefono ? item.num_telefono.toString() : '';\n  return `${item.fecha_reporte}|${tel}|${item.resumen_intencion}|${item.sucursal}|${item.resumen_datos_clave}`;\n};\n\n// 2. Mapeamos Google Sheets para búsqueda eficiente\nconst gsMap = new Map();\ngoogleSheetsItems.forEach(item => {\n  gsMap.set(createKey(item), item);\n});\n\nconst nuevos = [];\nconst actualizaciones = [];\n\n// 3. Comparación lógica\npostgresItems.forEach(pg => {\n  const key = createKey(pg);\n  const gsMatch = gsMap.get(key);\n\n  if (!gsMatch) {\n    // Es nuevo: está en Postgres pero no en Sheets\n    nuevos.push({\n      ...pg\n    });\n  } else if (pg.estado_seguimiento !== gsMatch.estado_seguimiento) {\n    // Es actualización: el estado en Sheets es distinto al de Postgres\n    actualizaciones.push({\n      id: pg.id,\n      num_telefono: pg.num_telefono.toString(),\n      fecha_reporte: pg.fecha_reporte,\n      nuevo_estado: gsMatch.estado_seguimiento,\n      row_number: gsMatch.row_number,\n      estado_pg: pg.estado_seguimiento\n    });\n  }\n});\n\n// 4. Construimos el resultado final condicionalmente\nconst resultado = [];\n\nif (nuevos.length > 0) {\n  resultado.push({\n    tipo: \"nuevo\",\n    items: nuevos\n  });\n}\n\nif (actualizaciones.length > 0) {\n  resultado.push({\n    tipo: \"actualizacion\",\n    items: actualizaciones\n  });\n}\n\nreturn resultado;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1280,
        5504
      ],
      "id": "a018be5e-c1fa-41ca-a86a-0681451c7b13",
      "name": "Code in JavaScript2",
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1072,
        5504
      ],
      "id": "27aae7e8-63d3-4bdf-ad5b-14ae8b0ae431",
      "name": "Loop Over Items14",
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "nuevo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "68532fa8-5992-4b78-b130-eaccfad4ae33"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nuevo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "e0586bac-ebef-4869-ad1f-11643c7c9137",
                    "leftValue": "={{ $json.tipo }}",
                    "rightValue": "actualizacion",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Actualización"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -752,
        5520
      ],
      "id": "d97f4065-51bd-4aa9-a078-b00ad312b758",
      "name": "Switch4",
      "disabled": true
    },
    {
      "parameters": {
        "fieldToSplitOut": "items",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -432,
        5440
      ],
      "id": "e6139ec1-59a0-4181-8875-5431b3f69b59",
      "name": "Split Out5",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1472,
        5504
      ],
      "id": "2e43d6c8-e56c-423c-9475-7d215d8256ea",
      "name": "Merge3",
      "disabled": true
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1807951179,
          "mode": "list",
          "cachedResultName": "Reportes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit#gid=1807951179"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1168,
        2640
      ],
      "id": "d1c7f79e-8157-462a-903f-284733bdf4fb",
      "name": "Limpia Hoja Reportes Calle 47",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "clear",
        "documentId": {
          "__rl": true,
          "value": "15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g",
          "mode": "list",
          "cachedResultName": "Control Calle 9",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1032791827,
          "mode": "list",
          "cachedResultName": "Reportes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/15TzDefkI5k5T6AQt8AwVZ0BUfdSkgTUtxuxvq4wFP-g/edit#gid=1032791827"
        },
        "keepFirstRow": true
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -1168,
        2816
      ],
      "id": "086f714e-6b65-46a4-95e8-a0d08399ebf5",
      "name": "Limpia Hoja Reportes Calle  9",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    }
  ],
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "timezone": "America/Argentina/Buenos_Aires",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "ZpYgShc1li13uf3h"
  },
  "shared": [
    {
      "updatedAt": "2025-12-11T17:49:55.790Z",
      "createdAt": "2025-12-11T17:49:55.790Z",
      "role": "workflow:owner",
      "workflowId": "VLP59OWZ9ExHBRXx",
      "projectId": "ROVo9T66IPW6MHN4"
    }
  ],
  "staticData": {
    "node:Cada 10 min": {
      "recurrenceRules": []
    },
    "node:Cada 1 Min": {
      "recurrenceRules": []
    },
    "node:Schedule Trigger": {
      "recurrenceRules": []
    },
    "node:1 am": {
      "recurrenceRules": []
    }
  },
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2026-02-24T17:49:32.068Z",
  "versionId": "75ece487-e59b-441c-ac23-3db14ebd1b79"
}