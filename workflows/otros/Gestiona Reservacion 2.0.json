{
  "active": true,
  "activeVersion": {
    "updatedAt": "2026-02-23T19:50:36.000Z",
    "createdAt": "2026-02-23T16:38:59.466Z",
    "versionId": "c4f5d3ab-e897-453e-af4f-caf7e6688968",
    "workflowId": "su5pBZNPEHVtuYnB",
    "nodes": [
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "reservacion"
              },
              {
                "name": "telefono_solicita"
              },
              {
                "name": "schema"
              },
              {
                "name": "cliente_id",
                "type": "number"
              }
            ]
          }
        },
        "id": "8dc27517-df6a-4780-ad1a-dcc3bcc89108",
        "typeVersion": 1.1,
        "name": "Agente Principal",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "position": [
          -1632,
          1360
        ]
      },
      {
        "parameters": {
          "jsCode": "const resultados = [];\n\nfor (const item of items) {\n  let resultadoFinal = null;\n  let errorLog = null;\n\n  // Obtenemos el valor crudo\n  const raw = item.json?.reservacion; \n\n  // CASO 0: Si es null o undefined, saltamos\n  if (!raw) {\n    resultados.push({ json: { error: \"Input vacío\" } });\n    continue;\n  }\n\n  // CASO 1: Si n8n ya lo detectó como Objeto, lo usamos directo\n  if (typeof raw === 'object') {\n    resultadoFinal = raw;\n  } else {\n    // Limpieza básica universal (Markdown y espacios)\n    const clean = String(raw).replace(/```json|```/g, '').trim();\n\n    try {\n      // --- INTENTO 1: Parseo Estándar ---\n      resultadoFinal = JSON.parse(clean);\n    } catch (e1) {\n      try {\n        // --- INTENTO 2: Parseo con Sanitize ---\n        const sanitized = clean\n          .replace(/\\n/g, \"\\\\n\")\n          .replace(/\\r/g, \"\\\\r\")\n          .replace(/\\t/g, \"\\\\t\");\n        \n        resultadoFinal = JSON.parse(sanitized);\n      } catch (e2) {\n        errorLog = e1.message;\n      }\n    }\n  }\n\n  // VALIDACIÓN Y NORMALIZACIÓN DE PERSONAS\n  if (resultadoFinal) {\n    // Normalizamos el campo personas\n    if (resultadoFinal.hasOwnProperty('personas')) {\n      resultadoFinal.personas = normalizarNumeroPersonas(resultadoFinal.personas);\n    }\n    \n    // También verificamos campos similares comunes\n    const camposPersonas = ['numero_personas', 'cantidad_personas', 'personas', 'pax', 'guests'];\n    for (const campo of camposPersonas) {\n      if (resultadoFinal.hasOwnProperty(campo)) {\n        resultadoFinal[campo] = normalizarNumeroPersonas(resultadoFinal[campo]);\n        break; // Solo normalizamos el primer campo que encontremos\n      }\n    }\n    \n    resultados.push({ json: resultadoFinal });\n  } else {\n    resultados.push({ \n      json: { \n        error: \"No se pudo parsear el JSON\",\n        detalles: errorLog,\n        input_recibido: raw \n      } \n    });\n  }\n}\n\n// Función auxiliar para normalizar el número de personas\nfunction normalizarNumeroPersonas(valor) {\n  if (valor === null || valor === undefined) return 1;\n  \n  // Convertimos a número\n  let numero;\n  if (typeof valor === 'number') {\n    numero = valor;\n  } else if (typeof valor === 'string') {\n    // Limpiamos la cadena y convertimos\n    const limpio = valor.toString().replace(/[^\\d.,]/g, '').replace(',', '.');\n    numero = parseFloat(limpio);\n  } else {\n    numero = Number(valor);\n  }\n  \n  // Validamos que sea un número válido y positivo\n  if (isNaN(numero) || !isFinite(numero) || numero <= 0) {\n    return 1; // Valor por defecto\n  }\n  \n  // Redondeamos al entero más cercano\n  return Math.max(1, Math.round(numero));\n}\n\nreturn resultados;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1424,
          1360
        ],
        "id": "626ac3ba-7354-4f64-b70b-82d38d08831d",
        "name": "Normaliza Datos"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "8c5d8ee6-3764-4faa-9219-41cf43cfdb5a",
                "name": "fecha",
                "value": "={{ $('Normaliza Datos').first().json.fecha }}",
                "type": "string"
              },
              {
                "id": "27e2aa1e-c162-40dc-b215-386d42c2a8b7",
                "name": "hora",
                "value": "={{ $('Crea Reserva Postgres').item.json.hora_reservacion }}",
                "type": "string"
              },
              {
                "id": "9c90660d-d6a0-4799-a7f4-3d16ee9e48fa",
                "name": "cliente",
                "value": "={{ $('Crea Reserva Postgres').item.json.cliente }}",
                "type": "string"
              },
              {
                "id": "98595a48-1f1c-4555-8301-3b284a1a140e",
                "name": "personas",
                "value": "={{ $('Crea Reserva Postgres').item.json.numero_personas }}",
                "type": "number"
              },
              {
                "id": "4d77d7ef-814e-42e0-883e-2701a6cef655",
                "name": "notas",
                "value": "={{ $('Crea Reserva Postgres').item.json.notas }}",
                "type": "string"
              },
              {
                "id": "615e1ded-ca87-4479-a87f-84db2eccd7b4",
                "name": "estado",
                "value": "={{ $('Crea Reserva Postgres').item.json.estado }}",
                "type": "string"
              },
              {
                "id": "d92abef2-e128-423a-9573-a36a45656146",
                "name": "correo",
                "value": "={{ $('Crea Reserva Postgres').item.json.correo || 'No proporcionado' }}",
                "type": "string"
              },
              {
                "id": "f0054bbd-48bb-43d6-b48a-e35d5818e11f",
                "name": "=zona",
                "value": "={{ $('Crea Reserva Postgres').item.json.zona }}",
                "type": "string"
              },
              {
                "id": "d27a110c-36b2-468a-ad9c-821c0034fdb8",
                "name": "codigo_reserva",
                "value": "={{ $('Crea Reserva Postgres').item.json.codigo_reserva }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2032,
          1152
        ],
        "id": "7dfe75e0-04b8-4955-947e-b9d6c2cf31a0",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "html": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Confirmación de Reserva en Osaki</title>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n    <style>\n        /* Estilos generales */\n        body {\n            margin: 0;\n            padding: 0;\n            -webkit-text-size-adjust: 100%;\n            -ms-text-size-adjust: 100%;\n            background-color: #1a1a1a;\n            font-family: 'Montserrat', Arial, sans-serif;\n        }\n\n        table {\n            border-spacing: 0;\n        }\n\n        td {\n            padding: 0;\n        }\n\n        img {\n            border: 0;\n        }\n\n        /* Contenedor principal */\n        .wrapper {\n            width: 100%;\n            table-layout: fixed;\n            background-color: #1a1a1a;\n            padding: 40px 0;\n        }\n\n        .main {\n            background-color: #000000;\n            margin: 0 auto;\n            width: 100%;\n            max-width: 600px;\n            border-spacing: 0;\n            font-family: 'Montserrat', Arial, sans-serif;\n            color: #cccccc;\n            border-radius: 8px;\n            overflow: hidden;\n        }\n        \n        /* Encabezado */\n        .header {\n            background-color: #000000;\n            padding: 30px 0;\n            text-align: center;\n        }\n\n        .logo {\n            width: 120px;\n            max-width: 100%;\n        }\n        \n        /* Contenido */\n        .content {\n            padding: 40px 30px;\n            text-align: left;\n        }\n        \n        h1 {\n            font-size: 24px;\n            margin-top: 0;\n            margin-bottom: 20px;\n            color: #ffffff;\n            font-weight: 700;\n        }\n        \n        p {\n            margin-top: 0;\n            margin-bottom: 16px;\n            line-height: 1.7;\n            font-size: 16px;\n            color: #cccccc;\n        }\n\n        /* Detalles de la reservación */\n        .reservation-details {\n            width: 100%;\n            margin: 30px 0;\n            border-collapse: collapse;\n        }\n\n        .reservation-details td {\n            padding: 15px 0;\n            font-size: 16px;\n            border-bottom: 1px solid #333333;\n        }\n        \n        .reservation-details tr:last-child td {\n            border-bottom: none;\n        }\n\n        .reservation-details strong {\n            color: #ffffff;\n            font-weight: 700;\n        }\n        \n        /* Botón de acción */\n        .button {\n            background-color: #DA291C; /* Rojo corporativo de Osaki */\n            color: #ffffff;\n            padding: 14px 28px;\n            text-decoration: none;\n            border-radius: 5px;\n            font-weight: 700;\n            display: inline-block;\n            font-size: 16px;\n        }\n\n        /* Pie de página */\n        .footer {\n            background-color: #000000;\n            padding: 30px;\n            text-align: center;\n            border-top: 1px solid #333333;\n        }\n\n        .footer p {\n            font-size: 12px;\n            margin-bottom: 8px;\n            color: #888888;\n        }\n\n        .footer a {\n            color: #DA291C;\n            text-decoration: none;\n        }\n\n    </style>\n</head>\n<body>\n    <center class=\"wrapper\">\n        <table class=\"main\" width=\"100%\">\n            <!-- ====== ENCABEZADO CON LOGO ====== -->\n            <tr>\n                <td>\n                    <table width=\"100%\">\n                        <tr>\n                            <td class=\"header\">\n                                <a href=\"https://osakisushi.com/\" target=\"_blank\">\n                                    <img src=\"https://osakisushi.com/wp-content/uploads/2023/12/logo-osaki.png\" alt=\"Logo Osaki Sushi\" class=\"logo\">\n                                </a>\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n\n            <!-- ====== CONTENIDO PRINCIPAL ====== -->\n            <tr>\n                <td class=\"content\">\n                    <h1>Tu reserva está casi lista</h1>\n                    \n                    <!-- n8n usará esta expresión para obtener el nombre del cliente -->\n                    <p>Hola, <strong>{{$json.cliente}}</strong>,</p>\n                    \n                    <p>Hemos recibido tu solicitud de reserva en Osaki. A continuación, te mostramos los detalles. Tené en cuenta que el estado actual es <strong>'Pendiente'</strong>. Recibirás la confirmación final entre 2 y 3 horas antes del horario programado.</p>\n\n                    <!-- ====== TABLA DE DETALLES ====== -->\n                    <table class=\"reservation-details\">\n                        <tr>\n                            <td><strong>Fecha:</strong></td>\n                            <!-- Expresión para la fecha -->\n                            <td align=\"right\">{{$json.fecha}}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Hora:</strong></td>\n                            <!-- Expresión para la hora -->\n                            <td align=\"right\">{{$json.hora}}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Personas:</strong></td>\n                            <!-- Expresión para el número de personas -->\n                            <td align=\"right\">{{$json.personas}}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Zona:</strong></td>\n                             <!-- Expresión para las notas -->\n                            <td align=\"right\">{{$json.zona}}</td>\n                        </tr>\n                         <tr>\n                            <td><strong>Estado:</strong></td>\n                             <!-- Expresión para el estado -->\n                            <td align=\"right\"><strong>{{$json.estado}}</strong></td>\n                        </tr>\n                    </table>\n\n                    <p>Si necesitás hacer algún cambio o cancelar, por favor contactanos lo antes posible.</p>\n                    <p>Te esperamos.</p>\n\n                    <!-- ====== BOTÓN DE ACCIÓN ====== -->\n                    <table width=\"100%\" style=\"margin-top: 30px;\">\n                        <tr>\n                            <td style=\"text-align: center;\">\n                                <a href=\"https://osakisushi.com/menu/\" target=\"_blank\" class=\"button\">Conocé nuestro menú</a>\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n\n            <!-- ====== PIE DE PÁGINA ====== -->\n            <tr>\n                <td class=\"footer\">\n                    <p><strong>Nuestras sucursales</strong></p>\n                    <p>La Plata: Calle 47 N°717 | Palermo: Gorriti 4977</p>\n                    <p>\n                        © 2024 Osaki. Todos los derechos reservados.\n                        <br>\n                        <a href=\"https://osakisushi.com/sucursales/\" target=\"_blank\">Ver todas las sucursales</a>\n                    </p>\n                </td>\n            </tr>\n        </table>\n    </center>\n</body>\n</html>\n\n"
        },
        "type": "n8n-nodes-base.html",
        "typeVersion": 1.2,
        "position": [
          2704,
          1216
        ],
        "id": "3bfa52be-7ea4-4bdd-8529-61ecfb44ef2c",
        "name": "HTML",
        "disabled": true
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c7a7b722-1cdc-4606-8482-c5271a7e8714",
                "leftValue": "={{ $('Normaliza Datos').first().json.correo.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              },
              {
                "id": "ab2015dd-ec4c-4a1e-ba74-90489d2927fb",
                "leftValue": "={{ $('Normaliza Datos').first().json.correo }}",
                "rightValue": "No proporcionado",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          2448,
          1328
        ],
        "id": "2a97e46d-d26a-4e5d-9ad5-349d06ea0702",
        "name": "If1"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Normaliza Datos').item.json.correo || $('All Fields').item.json.correo }}",
          "subject": "=[Osaki Sushi] {{ $('Normaliza Datos').item.json.tipo }} de Cita - {{ $('All Fields').item.json.cliente }} ",
          "message": "={{ $json.html }}",
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          2880,
          1216
        ],
        "id": "b5610df6-f81c-4687-b34c-6b8e3d43fad6",
        "name": "Send a message",
        "webhookId": "d2e63633-f754-426c-a943-c723a3226bc7",
        "disabled": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "7931de9a-83e9-4c31-81a6-58834edb9200",
                "name": "Response",
                "value": "={{\n  $('Normaliza Datos').first().json.tipo\n + \": OK\" +\n\n\"\\nNombre: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.cliente,\n  $('Get Reserv Info').item.json.cliente\n) +\n\n\"\\nReserva: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.fecha ?.slice(0,10),\n  $('Get Reserv Info').item.json.fecha_reservacion?.slice(0,10)\n)\n+ \" \"\n+ $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.hora,\n  $('Get Reserv Info').item.json.hora_reservacion\n) +\n\n\"\\nPersonas: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.personas,\n  $('Get Reserv Info').item.json.numero_personas\n) +\n\n\"\\nZona: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.zona,\n  $('Get Reserv Info').item.json.zona\n) +\n\n\"\\nCódigo: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.codigo_reserva,\n  $('Get Reserv Info').item.json.codigo_reserva\n) +\n\n\"\\n\\nImportante: Proporcionar el código al usuario para el seguimiento de su reservación.\"\n}}\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4656,
          1760
        ],
        "id": "13368b8c-bf1b-4291-8a78-ef4919e31ce6",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "bb9644e3-019c-4cde-b54d-9373d31bb0b0",
                "leftValue": "={{ $('Normaliza Datos').first().json.tipo }}",
                "rightValue": "creacion",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "53b6b373-3544-427b-ac59-8ed0701ee7ea",
                "leftValue": "={{ $json.total_reservas }}",
                "rightValue": 0,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              },
              {
                "id": "daee3ffd-d29f-4d40-a2ee-5ca8f4faf32c",
                "leftValue": "={{ $('Normaliza Datos').first().json.modo }}",
                "rightValue": "=Forzada",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              },
              {
                "id": "9e2993e6-ae9c-4ed0-aef5-56321c91fed8",
                "leftValue": "={{ $('Normaliza Datos').first().json.nombre_completo }}",
                "rightValue": "Invitado Osaki",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          2144,
          864
        ],
        "id": "fe686c88-ec4c-4095-9db0-3e920f8bac81",
        "name": "If2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c822e4f8-2713-4f24-943a-cce25ee3761b",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nEl cliente ({{ $('Normaliza Datos').first().json.nombre_completo }}) ya cuenta con al menos una futura activa -> Verificar con el usuario.\nReservaciones encontradas:\n{{ $('Resume Encontradas').item.json.lista_reservaciones.toJsonString()}}\nSi se desea una nueva para el mismo cliente llama de nuevo a la herramienta cambiando el `modo` a \"Forzada\" (uso interno del sistema).",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2336,
          624
        ],
        "id": "91d88b5f-b73a-4ba6-b4e3-5d4a831d55b3",
        "name": "Edit Fields3"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '') == 'creacion' || $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '') == 'modificacion' }}",
                      "rightValue": "creacion",
                      "operator": {
                        "type": "boolean",
                        "operation": "true",
                        "singleValue": true
                      },
                      "id": "3acfaed1-14b0-4f19-a367-cf57fb0dc090"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Creación O Modificación"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8ceae83e-dffc-459c-9703-52f8ee55a2e5",
                      "leftValue": "={{ $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '')  }}",
                      "rightValue": "cancelacion",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cancelación"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "fa79b9b7-a498-41f2-ae82-96dc2bcd8924",
                      "leftValue": "={{ $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '')  }}",
                      "rightValue": "confirmacion",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Confirmación"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Otro"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -1248,
          1328
        ],
        "id": "3d762660-1211-4e46-a85f-9e19cfbc4f42",
        "name": "Switch"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "6a683569-77af-4513-838f-1090e69a084b",
                "leftValue": "={{ $json.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1088,
          1488
        ],
        "id": "075e14f7-a211-450f-80e3-074ed65eb3e1",
        "name": "If3"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "e67be385-8e0f-484f-ae64-daa7292020f1",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nNo se encontró ninguna reservación con el código ingresado ({{ $('Normaliza Datos').first().json.codigo_reserva }}). Favor de proporcionar un código válido. {{ $json.data[1].error ?? 'Sin errores detectados'  }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1680,
          1744
        ],
        "id": "f2df318e-84d4-44b7-9e72-6df84b46de35",
        "name": "Edit Fields4"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1312,
          1744
        ],
        "id": "0dc6e65b-9c43-4396-8528-e6bcc89aee85",
        "name": "Merge1"
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          1504,
          1744
        ],
        "id": "004336bb-393a-4ea0-b0b7-449d2f7c354d",
        "name": "Aggregate"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "1b870dee-b24c-4c69-a80e-640569eb59e9",
                "leftValue": "={{ $json[\"Estado de Reservación\"] }}",
                "rightValue": "Cancelada",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1312,
          1472
        ],
        "id": "f3562853-adb6-4ae0-9372-c8704aacf3bf",
        "name": "If4"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "25292be3-bf74-44c2-b93d-0ce1ba6e5469",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nLa reservación ya se encontraba Cancelada, nada que hacer",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1680,
          1456
        ],
        "id": "1ca294e4-e8c9-42b5-875f-17eb30fd567f",
        "name": "Edit Fields5"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "6a683569-77af-4513-838f-1090e69a084b",
                "leftValue": "={{ $json.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1072,
          1232
        ],
        "id": "2fa0cf00-5bf0-4b48-9a4d-3ad07547dd96",
        "name": "If5"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "e67be385-8e0f-484f-ae64-daa7292020f1",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nNo se encontró ninguna reservación con el id ingresado ({{ $('Normaliza Datos').first().json.codigo_reserva }}). Favor de proporcionar un código válido. {{ $json.data[1].error ?? 'Sin errores detectados'  }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1680,
          1312
        ],
        "id": "34729c1e-67e8-4b5b-b400-52bd24d7f938",
        "name": "Edit Fields7"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1296,
          1312
        ],
        "id": "8876c42d-e981-464b-922d-62d90aac0a89",
        "name": "Merge2"
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          1488,
          1312
        ],
        "id": "60f79ca7-69a0-4074-a1f3-94c0f1743a52",
        "name": "Aggregate1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2878d7bf-f508-4cba-b708-6fb6ff4f781d",
                "name": "fecha",
                "value": "={{ $json.fecha }}",
                "type": "string"
              },
              {
                "id": "f3f3779f-5437-4b22-830b-1fe7c4c9a705",
                "name": "hora",
                "value": "={{ $json.hora }}",
                "type": "string"
              },
              {
                "id": "0e428a9f-a2da-4f01-8164-e05f48d16576",
                "name": "cliente",
                "value": "={{ $json.cliente }}",
                "type": "string"
              },
              {
                "id": "bc9589e1-19ba-40a9-be4b-4930e2a837f1",
                "name": "personas",
                "value": "={{ $json.personas }}",
                "type": "number"
              },
              {
                "id": "a25d44c9-8c7c-4815-81b7-e6a6d92332ed",
                "name": "notas",
                "value": "={{ $json.notas }}",
                "type": "string"
              },
              {
                "id": "a31e3b72-a46c-4773-881d-c70fe4582217",
                "name": "estado",
                "value": "={{ $json.estado }}",
                "type": "string"
              },
              {
                "id": "fea67368-b880-4f6b-bd2e-832be4c86c3e",
                "name": "correo",
                "value": "={{ $json.correo }}",
                "type": "string"
              },
              {
                "id": "d745d432-6945-4edc-8827-a2c3872b552e",
                "name": "zona",
                "value": "={{ $json.zona }}",
                "type": "string"
              },
              {
                "id": "fa11193f-9906-4876-a43b-4460e43747b2",
                "name": "codigo_reserva",
                "value": "={{ $json.codigo_reserva }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2240,
          1328
        ],
        "id": "c5ce685a-d46b-4857-b76a-db557794a40d",
        "name": "All Fields"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT * FROM {{ $('Agente Principal').first().json.schema }}.reservaciones\nWHERE cliente = '{{ $('Normaliza Datos').first().json.nombre_completo }}'\nAND fecha_reservacion >= '{{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}'\nAND estado != 'Cancelada'",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          1728,
          864
        ],
        "id": "804d2516-a27a-4a6d-ab70-0068ed2b119d",
        "name": "Busca Reserva",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $('Get Client Data').item.json.id }}",
              "total_reservaciones": "={{  $('Get Client Data').item.json.total_reservaciones + 1 }}",
              "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "ult_reservacion": "={{ $('Normaliza Datos').item.json.fecha }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_bloqueo",
                "displayName": "sucursal_bloqueo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "object",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          3216,
          928
        ],
        "id": "fdef9b47-d575-44c4-a978-c7a1dd675e79",
        "name": "Update rows in a table",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "where": {
            "values": [
              {
                "column": "codigo_reserva",
                "value": "={{ $('Normaliza Datos').first().json.codigo_reserva.replaceAll(' ','').trim() }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          752,
          1312
        ],
        "id": "393a490d-2af4-4660-b0ab-5ea5ec85cd66",
        "name": "Busca reservaciones1",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "hora_reservacion": "={{ $('Normaliza Datos').first().json.hora }}",
              "fecha_reservacion": "={{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}",
              "estado": "Pendiente",
              "dia_semana": "={{ new Date($('Normaliza Datos').first().json.fecha).getDay() }}",
              "notas": "={{ $('Normaliza Datos').first().json.notas }}",
              "zona": "={{ $('Normaliza Datos').first().json.zona }}",
              "ubicacion": "={{ $('Normaliza Datos').first().json.ubicacion }}",
              "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "codigo_reserva": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}",
              "mesas_reserva": "={{\n  (function() {\n    const p = $('Normaliza Datos').first().json.personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
              "numero_personas": "={{ $('Normaliza Datos').first().json.personas }}"
            },
            "matchingColumns": [
              "codigo_reserva"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "ubicacion",
                "displayName": "ubicacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_solicitante",
                "displayName": "telefono_solicitante",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "mesas_reserva",
                "displayName": "mesas_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "intento_confirmacion",
                "displayName": "intento_confirmacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Canal",
                "displayName": "Canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          1296,
          1152
        ],
        "id": "db8d88f9-8494-430d-bd58-0e34148649dc",
        "name": "Actualiza Reserva",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "where": {
            "values": [
              {
                "column": "codigo_reserva",
                "value": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          896,
          1744
        ],
        "id": "3f3a01fe-349e-4427-894e-a6fa8973239d",
        "name": "Busca reservaciones",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "8c5d8ee6-3764-4faa-9219-41cf43cfdb5a",
                "name": "fecha",
                "value": "={{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}",
                "type": "string"
              },
              {
                "id": "27e2aa1e-c162-40dc-b215-386d42c2a8b7",
                "name": "hora",
                "value": "={{ $('Actualiza Reserva').first().json.hora_reservacion }}",
                "type": "string"
              },
              {
                "id": "9c90660d-d6a0-4799-a7f4-3d16ee9e48fa",
                "name": "cliente",
                "value": "={{ $('Actualiza Reserva').first().json.cliente }}",
                "type": "string"
              },
              {
                "id": "98595a48-1f1c-4555-8301-3b284a1a140e",
                "name": "personas",
                "value": "={{ $('Actualiza Reserva').first().json.numero_personas }}",
                "type": "number"
              },
              {
                "id": "4d77d7ef-814e-42e0-883e-2701a6cef655",
                "name": "notas",
                "value": "={{ $('Actualiza Reserva').first().json.notas }}",
                "type": "string"
              },
              {
                "id": "615e1ded-ca87-4479-a87f-84db2eccd7b4",
                "name": "estado",
                "value": "={{ $('Actualiza Reserva').first().json.estado }}",
                "type": "string"
              },
              {
                "id": "d92abef2-e128-423a-9573-a36a45656146",
                "name": "correo",
                "value": "={{ $('Actualiza Reserva').first().json.correo || 'No proporcionado' }}",
                "type": "string"
              },
              {
                "id": "f0054bbd-48bb-43d6-b48a-e35d5818e11f",
                "name": "=zona",
                "value": "={{ $('Actualiza Reserva').first().json.zona }}",
                "type": "string"
              },
              {
                "id": "7e1e05b9-4696-455f-87fa-699857595436",
                "name": "codigo_reserva",
                "value": "={{ $('Actualiza Reserva').first().json.codigo_reserva }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1680,
          1152
        ],
        "id": "ee54f73b-98a9-4914-8381-96986f6c0e3f",
        "name": "Edit Fields8"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "25085d83-dbca-42c1-926e-ee68ed19cc8a",
                "name": "Response",
                "value": "Discúlpate con el usuario, te equivocaste; Informa al usuario que las reservas de 7 o más personas requiere VIP, canaliza con equipo del restaurante.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -608,
          992
        ],
        "id": "3dc8a1e6-a48e-4e5b-b05f-d65eeb183e90",
        "name": "Edit Fields9"
      },
      {
        "parameters": {
          "jsCode": "// n8n Code node (JavaScript)\n\n// Reglas de salida única (prioridad):\n// 1) CIERRE: Lunes (\"Día\") o Ventana (\"Horario\") -> { mensaje: \"Cerrado\", motivo: \"...\", ahora: \"...\" }\n// 2) FORMATO HORA: Solo bloques de :00 o :30 -> { mensaje: \"FormatoHora\", detalle: \"Solo bloques de 30 min\", ahora: \"...\" }\n// 3) Pasado/ahora: fecha/hora <= ahora -> { mensaje: \"Pasado\", ahora: \"<...>\" }\n// 4) Futura: fecha/hora > ahora + 3 meses -> { mensaje: \"Futuro\", ahora: \"<...>\" }\n// 5) Muy próxima: (ahora, ahora + 60 min) -> { mensaje: \"Cercano\", ahora: \"<...>\" }\n// 6) Válida: devolver input original + NUEVO CAMPO 'dia_semana'.\n\nconst OFFSET_TZ_MIN = 3 * 60;    // Argentina UTC-3\nconst WINDOW_MIN = 60;           // \"Muy próxima\" = 60 minutos\nconst MAX_FUTURE_MONTHS = 3;     // Límite de meses en el futuro\n\nconst DIAS_SEMANA = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];\n\nconst CLOSED_WINDOWS = [\n  { startMin: 16 * 60,        endMin: 18 * 60 },       // 16:00–18:00\n  { startMin: 0,              endMin: 10 * 60 + 30 },  // 00:00–10:30\n];\n\n// --- FUNCIONES HELPER ---\n\nfunction parseDateParts(fechaStr) {\n  const clean = String(fechaStr || '').trim().replace(/-/g, '/');\n  const [y, m, d] = clean.split('/').map(n => parseInt(n, 10));\n  if (![y, m, d].every(Number.isFinite)) return null;\n  return { y, m, d };\n}\n\nfunction parseTimeParts(horaStr) {\n  const parts = String(horaStr || '').trim().split(':');\n  const hh = parseInt(parts[0], 10);\n  const mm = parseInt(parts[1] ?? '0', 10);\n  if (![hh, mm].every(Number.isFinite)) return null;\n  return { hh, mm };\n}\n\n// [NUEVO] Valida si los minutos son 00 o 30\nfunction isValidMinuteBlock(horaStr) {\n  const t = parseTimeParts(horaStr);\n  if (!t) return false;\n  return t.mm === 0 || t.mm === 30;\n}\n\nfunction toUtcMsFromARG(fechaStr, horaStr) {\n  const d = parseDateParts(fechaStr);\n  const t = parseTimeParts(horaStr);\n  if (!d || !t) return NaN;\n  return Date.UTC(d.y, d.m - 1, d.d, t.hh + Math.floor(OFFSET_TZ_MIN / 60), t.mm, 0, 0);\n}\n\nfunction getDiaSemanaNombre(fechaStr) {\n  const d = parseDateParts(fechaStr);\n  if (!d) return null;\n  const dow = new Date(Date.UTC(d.y, d.m - 1, d.d)).getUTCDay(); \n  return DIAS_SEMANA[dow];\n}\n\nfunction isWithinClosedWindow(horaStr) {\n  const mins = (t => t ? t.hh * 60 + t.mm : null)(parseTimeParts(horaStr));\n  if (mins == null) return false;\n  return CLOSED_WINDOWS.some(w => mins >= w.startMin && mins < w.endMin);\n}\n\nfunction pad2(n){ return n < 10 ? '0' + n : '' + n; }\n\nfunction nowARGString() {\n  const d = new Date(Date.now() - OFFSET_TZ_MIN * 60 * 1000);\n  return `${d.getUTCFullYear()}-${pad2(d.getUTCMonth() + 1)}-${pad2(d.getUTCDate())} ${pad2(d.getUTCHours())}:${pad2(d.getUTCMinutes())}`;\n}\n\n// --- LÓGICA PRINCIPAL ---\n\nconst items = await $input.all();\nconst nowUtcMs = Date.now();\nconst soonLimitUtcMs = nowUtcMs + WINDOW_MIN * 60 * 1000;\nconst ahora = nowARGString();\n\nconst futureLimitDate = new Date();\nfutureLimitDate.setMonth(futureLimitDate.getMonth() + MAX_FUTURE_MONTHS);\nconst futureLimitUtcMs = futureLimitDate.getTime();\n\nlet motivoCierre = null; \nlet hasInvalidBlock = false;\nlet hasPastOrNow = false;\nlet hasFuture = false;\nlet hasSoon = false;\n\nfor (const item of items) {\n  const { fecha, hora } = item.json || {};\n  const nombreDia = getDiaSemanaNombre(fecha);\n  \n  if (item.json) item.json.dia_semana = nombreDia;\n\n  // Regla 1: CIERRE\n  if (nombreDia === 'Lunes') { motivoCierre = 'Lunes'; break; }\n  if (isWithinClosedWindow(hora)) { motivoCierre = 'Horario'; break; }\n\n  // Regla 2: [NUEVA] Validación de bloques de 30 min\n  if (!isValidMinuteBlock(hora)) {\n    hasInvalidBlock = true;\n    break;\n  }\n\n  const targetUtcMs = toUtcMsFromARG(fecha, hora);\n\n  // Regla 3: Pasado\n  if (!Number.isFinite(targetUtcMs) || targetUtcMs <= nowUtcMs) { hasPastOrNow = true; break; }\n\n  // Regla 4: Futura\n  if (targetUtcMs > futureLimitUtcMs) { hasFuture = true; break; }\n\n  // Regla 5: Muy próxima\n  if (targetUtcMs < soonLimitUtcMs) { hasSoon = true; }\n}\n\n// Retornos por prioridad\nif (motivoCierre) return [{ json: { mensaje: 'Cerrado', motivo: motivoCierre, ahora } }];\nif (hasInvalidBlock) return [{ json: { mensaje: 'FormatoHora', detalle: 'Solo se aceptan bloques de 00 o 30 minutos', ahora } }];\nif (hasPastOrNow) return [{ json: { mensaje: 'Pasado', ahora } }];\nif (hasFuture) return [{ json: { mensaje: 'Futuro', ahora } }];\nif (hasSoon) return [{ json: { mensaje: 'Cercano', ahora } }];\n\nreturn items;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -608,
          768
        ],
        "id": "4c8126ab-01a3-43ad-bd30-e92b31293e3e",
        "name": "Revisa Horarios"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.mensaje }}",
                      "rightValue": "=Cercano",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "3668be81-2050-40ba-983a-a1691781e241"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cercano"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "2b3c51f2-6658-49d8-b10c-fdf9fe863332",
                      "leftValue": "={{ $json.mensaje }}",
                      "rightValue": "Pasado",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Pasado"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "565499bf-bb35-4ed0-9b71-699f5eec818f",
                      "leftValue": "={{ $json.mensaje }}",
                      "rightValue": "Cerrado",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cerrado"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "1ede6c35-793e-4269-878a-325791500ea1",
                      "leftValue": "={{ $json.mensaje }}",
                      "rightValue": "Futuro",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Futuro"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "a8e5178e-b0e4-4276-afa8-502624efcab7",
                      "leftValue": "={{ $json.mensaje }}",
                      "rightValue": "FormatoHora",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Formato Hora"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "OK"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          -416,
          720
        ],
        "id": "2e16a090-e464-41dc-84ea-08be1578518a",
        "name": "Switch1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT \n    v.zona_obj as zona,\n    coalesce(SUM(r.mesas_reserva),0) as num_mesas,        -- Cuenta coincidencias reales\n    COALESCE(SUM(r.numero_personas), 0) as num_personas -- Pone 0 si es NULL\nFROM (VALUES ('Salón'), ('Barra')) AS v(zona_obj)  -- 1. Definimos las zonas obligatorias\nLEFT JOIN {{ $('Agente Principal').first().json.schema }}.reservaciones r \n    ON v.zona_obj = r.zona \n    AND r.fecha_reservacion = $1         -- 2. El filtro de fecha va AQUÍ, no en el WHERE\n    AND EXTRACT(HOUR FROM hora_reservacion) = $2  \n    AND r.estado != 'Cancelada'\nGROUP BY v.zona_obj;",
          "options": {
            "queryReplacement": "={{ $json.fecha }},{{ $json.hora.split(\":\")[0] }}"
          }
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          752,
          864
        ],
        "id": "b5006741-230a-48d8-a0e3-53ee52005f58",
        "name": "Calcula Ocupación",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c0cb9b0f-8e5c-441d-9163-633c69645a35",
                "leftValue": "={{ ($('Normaliza Datos').first().json.zona == \"Salón\" && ($json[\"Salón\"].num_mesas) >= 12 ) ||  ($('Normaliza Datos').first().json.zona == \"Barra\" && ($json[\"Barra\"].num_personas) >= 12 ) }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1216,
          864
        ],
        "id": "87b4fb03-0146-4478-874e-bb07b4487a6e",
        "name": "Lleno?"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nOcupaciones llenas en \"{{ $('Normaliza Datos').first().json.zona }}\" para reservaciones a las {{ $('Normaliza Datos').first().json.hora }}. Sugiere otra zona, fecha u horario. Si es día de evento ofrece otra fecha para la siguiente semana u otro día, revisa horarios de las promociones/eventos. \nOcupación Actual:\nBarra: {{ $json.Barra.num_personas }}/12 (personas)\nSalón: {{ $json[\"Salón\"].num_mesas }}/12 (mesas)\n\n\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1504,
          720
        ],
        "id": "569e9410-ba85-47ba-bea2-1e62559b39c7",
        "name": "Response Lleno"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "3c42f423-efec-448c-989c-86a47f11bda7",
                "leftValue": "={{ /^OSK-\\d{6}-[A-Z]{4}$/.test($('Normaliza Datos').first().json.codigo_reserva) }}",
                "rightValue": "=",
                "operator": {
                  "type": "boolean",
                  "operation": "false",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          416,
          1664
        ],
        "id": "b92ddc8f-0ab9-4dff-ab48-99236519e73e",
        "name": "If8"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "cc33b4df-2fae-4854-9644-7eb8df6236b2",
                "name": "Response",
                "value": "No proporcionaste un código válido, p. ej. \"OSK-YYMMDD-XXXX\". Corrige y vuelve a llamar a la herramienta.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          768,
          1552
        ],
        "id": "d4594a69-6556-4f75-af2d-e152df6eab9c",
        "name": "Edit Fields10"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "166d3778-c7a9-4e0d-8e5d-9c9a2f6da6b4",
                "leftValue": "={{ $json.personas }}",
                "rightValue": 6,
                "operator": {
                  "type": "number",
                  "operation": "lte"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -1296,
          768
        ],
        "id": "0104a6ee-e95f-40de-adb1-ac4e1c24639b",
        "name": "Menos de 7?"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "145a515a-382f-44a6-a14c-e0e33bf22e1f",
                "leftValue": "={{ ['barra', 'salon'].includes(\n    $('Normaliza Datos').item.json.zona\n        .toLowerCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/[^a-z]/g, '')\n)}}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "false",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -80,
          832
        ],
        "id": "8763c37c-4e04-461e-889f-dde9779347bd",
        "name": "If6"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Elegiste una zona que no existe. Las únicas disponibles son \"Salón\" y \"Barra\". Si son más de 6 se habilita una zona \"VIP\" por medio de gestión con el equipo  del restaurante.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          432,
          480
        ],
        "id": "bfd2c4c4-0a98-4756-9ea1-4ebc7c631918",
        "name": "Response No Zona"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Elegiste un {{ $json.motivo }} en el que el local está cerrado. Hora actual es {{ $('Revisa Horarios').item.json.ahora }}. Sugiere otra fecha u horario.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          224,
          -16
        ],
        "id": "a48dbdd6-933e-4b28-b07a-9f159a05a91e",
        "name": "Response Local Cerrado"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones no se pueden hacer hacía el pasado. Hora actual es {{ $json.ahora }}. Sugiere otra fecha u horario.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          112,
          -128
        ],
        "id": "cbeba0dc-0c22-4331-9c65-1521bf0a674d",
        "name": "Response Fecha Pasada"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones mínimas hacen para dentro de 1 hora hacía delante. Hora actual es {{ $('Revisa Horarios').item.json.ahora }}. Sugiere otra fecha u horario. Procura usar horas cerradas. Revisa horarios de atención.",
                "type": "string"
              },
              {
                "id": "35ddc4c7-c99f-4794-82b9-937a19825c22",
                "name": "ahora",
                "value": "=",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          0,
          -240
        ],
        "id": "e8409aaf-28a2-46dd-b51b-c88ad2ca5afa",
        "name": "Response Fecha Cercana"
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $('Agente Principal').first().json.cliente_id }}",
              "intencion": "Información",
              "ult_reservacion": "={{ $('All Fields').item.json.fecha }}",
              "pregunta_verifica_reserva": false
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          3136,
          1520
        ],
        "id": "30c65a1c-63e8-4444-9f89-7a2826577456",
        "name": "Actualiza Cliente a Info",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones no se pueden hacer más de 3 meses en el futuro. Hora actual es {{ $json.ahora }}. Sugiere otra fecha y horario.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          336,
          112
        ],
        "id": "af6d0f97-6c5c-45c5-9482-41ba311c02c0",
        "name": "Response Nombre Incompleto"
      },
      {
        "parameters": {
          "operation": "remove",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $('Normaliza Datos').first().json.fecha ||  $('Get Reserv Info').item.json.fecha_formateada }}",
            "mode": "name"
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          3456,
          1760
        ],
        "id": "5a2a5dde-fe72-4876-930c-fabf7ed72474",
        "name": "Delete sheet",
        "alwaysOutputData": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        },
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "3c42f423-efec-448c-989c-86a47f11bda7",
                "leftValue": "={{ /^OSK-\\d{6}-[A-Z]{4}$/.test($('Normaliza Datos').first().json.codigo_reserva) }}",
                "rightValue": "=",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          432,
          1328
        ],
        "id": "bf85ee51-f22a-4efd-bf7d-1424483b7038",
        "name": "Codigo Reserva Valido?"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "b1b8ede7-4405-458b-9fbc-2389cc05040a",
                "leftValue": "={{ $('Normaliza Datos').first().json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '') == 'creacion' }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1440,
          880
        ],
        "id": "df589cd6-42ff-4e50-a2a1-2e38707ed765",
        "name": "Es Creación?"
      },
      {
        "parameters": {
          "jsCode": "// 1. Inicializamos el objeto vacío donde guardaremos los resultados\nconst resultado = {};\n\n// 2. Iteramos sobre todos los items que llegaron del nodo anterior\nfor (const item of $input.all()) {\n  const data = item.json;\n  \n  // Verificamos que la zona exista para evitar errores\n  if (data.zona) {\n    // 3. Asignamos la zona como clave (ej: \"Salón\" o \"Barra\")\n    resultado[data.zona] = {\n      num_mesas: data.num_mesas,\n      num_personas: data.num_personas\n    };\n  }\n}\n\n// 4. Retornamos el resultado en el formato estándar de n8n\nreturn [ { json: resultado } ];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          992,
          864
        ],
        "id": "166e2390-72c4-4b28-b74a-4ae6c0fbcaae",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT \n    v.zona_obj as zona,\n    coalesce(SUM(r.mesas_reserva),0) as num_mesas,        -- Cuenta coincidencias reales\n    COALESCE(SUM(r.numero_personas), 0) as num_personas -- Pone 0 si es NULL\nFROM (VALUES ('Salón'), ('Barra')) AS v(zona_obj)  -- 1. Definimos las zonas obligatorias\nLEFT JOIN {{ $('Agente Principal').first().json.schema }}.reservaciones r \n    ON v.zona_obj = r.zona \n    AND r.fecha_reservacion = $1         -- 2. El filtro de fecha va AQUÍ, no en el WHERE\n    AND EXTRACT(HOUR FROM hora_reservacion) >=21  \n    AND r.estado != 'Cancelada'\nGROUP BY v.zona_obj;",
          "options": {
            "queryReplacement": "={{ $json.fecha }}"
          }
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          752,
          672
        ],
        "id": "aea2588c-57ac-4fea-9b75-88982259d032",
        "name": "Calcula Ocupación1",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// 1. Inicializamos el objeto vacío donde guardaremos los resultados\nconst resultado = {};\n\n// 2. Iteramos sobre todos los items que llegaron del nodo anterior\nfor (const item of $input.all()) {\n  const data = item.json;\n  \n  // Verificamos que la zona exista para evitar errores\n  if (data.zona) {\n    // 3. Asignamos la zona como clave (ej: \"Salón\" o \"Barra\")\n    resultado[data.zona] = {\n      num_mesas: data.num_mesas,\n      num_personas: data.num_personas\n    };\n  }\n}\n\n// 4. Retornamos el resultado en el formato estándar de n8n\nreturn [ { json: resultado } ];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          992,
          672
        ],
        "id": "2f3769f5-4b77-4cd4-9fd3-11993d29f275",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "c0cb9b0f-8e5c-441d-9163-633c69645a35",
                "leftValue": "={{ ($('Normaliza Datos').first().json.zona == \"Salón\" && ($json[\"Salón\"].num_mesas) >= 12 ) ||  ($('Normaliza Datos').first().json.zona == \"Barra\" && ($json[\"Barra\"].num_personas) >= 12 ) }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1216,
          672
        ],
        "id": "1241348a-8cb6-47a4-9000-69802a0655df",
        "name": "Lleno?1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nOcupaciones llenas en \"{{ $('Normaliza Datos').first().json.zona }}\" para el evento. Ofrece otra fecha o zona si hay disponible, revisa horarios y fechas de las promociones/eventos. \nOcupación Actual:\nBarra: {{ $json.Barra.num_personas }}/16 (personas)\nSalón: {{ $json[\"Salón\"].num_mesas }}/12 (mesas)\n\n\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1504,
          528
        ],
        "id": "6f732ef2-29ae-4104-b893-e0f4a019cf56",
        "name": "Response Lleno1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "59ed34f2-56f2-4d29-8469-866100e4b4e2",
                "name": "Response",
                "value": "=Cambia la intención a \"Reservación\" y confirma los datos para la reservación de nuevo. Revisa el llamado a esta herramienta. Mensaje Interno: {{ $json.detalles }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -128,
          2256
        ],
        "id": "4244a5f3-fc21-4afe-bb84-731edad1a816",
        "name": "Edit Fields11"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "4c00a43b-e339-45c6-bcbe-7bba4aa6e8f8",
                "leftValue": "={{ $json.hora.split(\":\")[0].toNumber() }}",
                "rightValue": 21,
                "operator": {
                  "type": "number",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          432,
          656
        ],
        "id": "cec68618-696b-42b2-8daa-e94c7554afc7",
        "name": "If9"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. El evento Sushi Libre solo admite reservaciones a las 21 hrs con hasta 15 min de tolerancia.\nOcupación Actual:\nBarra: {{ $json.Barra.num_personas }}/12 (personas)\nSalón: {{ $json[\"Salón\"].num_mesas }}/12 (mesas)\n\n\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1200,
          448
        ],
        "id": "a2609503-d7f0-45e0-8808-e3111c4f2c12",
        "name": "Response No Zona1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "a5a8173a-0304-48f7-9dfb-2f17d6b6ed17",
                "leftValue": "={{ $json.evento }}",
                "rightValue": "Sushi Libre",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "8532c9e3-c169-491a-bf94-7013d4d2e85e",
                "leftValue": "={{ $json.dia_semana =='Miércoles' && ( $json.hora.split(\":\")[0].toNumber()>=21  || ( $json.hora.split(\":\")[0].toNumber()>=20 &&  $json.hora.split(\":\")[1].toNumber()>=30) )  }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          208,
          848
        ],
        "id": "0cc2cbed-4812-46f8-8eb7-52cef799804e",
        "name": "Sushi Libre?"
      },
      {
        "parameters": {
          "operation": "create",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "title": "={{ $('Normaliza Datos').first().json.fecha ||  $('Get Reserv Info').item.json.fecha_formateada }}",
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          3696,
          1760
        ],
        "id": "5298d9d7-4462-4911-adac-f24889425a68",
        "name": "Create sheet1",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Agente Principal').first().json.schema }}.reservaciones \n  WHERE fecha_reservacion = '{{ $('Normaliza Datos').first().json.fecha || $('Get Reserv Info').item.json.fecha_formateada}}'  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          3952,
          1760
        ],
        "id": "f3bcab91-8a11-4dcc-b25b-d5c16f1822f6",
        "name": "Get Reserv",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $('Normaliza Datos').first().json.fecha || $('Get Reserv Info').item.json.fecha_formateada }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "mesas_sugeridas",
                "displayName": "mesas_sugeridas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "actualiza_base",
                "displayName": "actualiza_base",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          4224,
          1760
        ],
        "id": "fef7b5aa-9583-4f6f-b945-1d6d71c7274d",
        "name": "Llena Documento",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "OnTQvkOeBX8Kq3DU",
            "name": "Google Sheets Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          4432,
          1760
        ],
        "id": "5dd671c2-2d90-4935-b565-ab940dfd18b9",
        "name": "Aggregate2"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT \n    v.zona_obj as zona,\n    coalesce(SUM(r.mesas_reserva),0) as num_mesas,        -- Cuenta coincidencias reales\n    COALESCE(SUM(r.numero_personas), 0) as num_personas -- Pone 0 si es NULL\nFROM (VALUES ('Salón'), ('Barra')) AS v(zona_obj)  -- 1. Definimos las zonas obligatorias\nLEFT JOIN {{ $('Agente Principal').first().json.schema }}.reservaciones r \n    ON v.zona_obj = r.zona \n    AND r.fecha_reservacion = $1         -- 2. El filtro de fecha va AQUÍ, no en el WHERE\n    AND EXTRACT(HOUR FROM hora_reservacion) >=21\nGROUP BY v.zona_obj;",
          "options": {
            "queryReplacement": "={{ $json.fecha }}"
          }
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          800,
          448
        ],
        "id": "94979a92-3aac-4c31-a47c-04a67f114bf9",
        "name": "Calcula Ocupación2",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// 1. Inicializamos el objeto vacío donde guardaremos los resultados\nconst resultado = {};\n\n// 2. Iteramos sobre todos los items que llegaron del nodo anterior\nfor (const item of $input.all()) {\n  const data = item.json;\n  \n  // Verificamos que la zona exista para evitar errores\n  if (data.zona) {\n    // 3. Asignamos la zona como clave (ej: \"Salón\" o \"Barra\")\n    resultado[data.zona] = {\n      num_mesas: data.num_mesas,\n      num_personas: data.num_personas\n    };\n  }\n}\n\n// 4. Retornamos el resultado en el formato estándar de n8n\nreturn [ { json: resultado } ];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          992,
          448
        ],
        "id": "3ab5edc6-3b97-432b-bcc3-65e6fc4ccc3e",
        "name": "Code in JavaScript2"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "3c42f423-efec-448c-989c-86a47f11bda7",
                "leftValue": "={{ /^OSK-\\d{6}-[A-Z]{4}$/.test($('Normaliza Datos').first().json.codigo_reserva) }}",
                "rightValue": "=",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          336,
          2032
        ],
        "id": "f2e74331-dffa-4fc2-83f5-9b1efc61ae65",
        "name": "Codigo Reserva Valido?1"
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "where": {
            "values": [
              {
                "column": "codigo_reserva",
                "value": "={{ $('Normaliza Datos').first().json.codigo_reserva.replaceAll(' ','').trim() }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          752,
          2304
        ],
        "id": "1f7c1639-042c-4a7c-b01c-f34e0f98c1f3",
        "name": "Busca reservaciones2",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "6a683569-77af-4513-838f-1090e69a084b",
                "leftValue": "={{ $json.isNotEmpty() }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          976,
          2176
        ],
        "id": "580e5837-3075-45d7-9e24-ae59faaa3b6a",
        "name": "If10"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "e67be385-8e0f-484f-ae64-daa7292020f1",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nNo se encontró ninguna reservación con el código ingresado ({{ $('Normaliza Datos').first().json.codigo_reserva }}). Favor de proporcionar un id válido. {{ $json.data[1].error ?? 'Sin errores detectados'  }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1632,
          2304
        ],
        "id": "7bbd2b42-bbb2-4ebd-8a09-f64150ee690b",
        "name": "Edit Fields12"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1248,
          2304
        ],
        "id": "af7a189e-7285-4bde-908b-4ee15d9390bc",
        "name": "Merge3"
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          1440,
          2304
        ],
        "id": "2b5855c5-1b78-42c9-b6e2-d4774a8e1a71",
        "name": "Aggregate4"
      },
      {
        "parameters": {
          "jsCode": "// Configuración: Usamos el nombre oficial de la zona horaria (IANA)\n// Esto maneja automáticamente cambios de horario de verano/invierno si ocurren.\nconst timeZone = 'America/Argentina/Buenos_Aires';\n\nfor (const item of $input.all()) {\n\n  const fechaRaw = item.json.fecha_reservacion; // \"2025-12-04T00:00:00...\"\n  const horaRaw = item.json.hora_reservacion;   // \"22:00:00\"\n\n  if (fechaRaw && horaRaw) {\n    // -----------------------------------------------------------\n    // PASO 1: Normalizar la Fecha Objetivo (Reserva)\n    // -----------------------------------------------------------\n    // Extraemos YYYY-MM-DD\n    const fechaSolo = fechaRaw.split('T')[0];\n    \n    // Creamos una fecha \"ficticia\" en UTC con los datos de la reserva\n    // Le agregamos la 'Z' para forzar a JS a creer que es UTC.\n    // Hacemos esto para tener un punto de comparación matemático neutro.\n    const targetDateISO = `${fechaSolo}T${horaRaw}Z`; \n    const targetDate = new Date(targetDateISO);\n\n    // -----------------------------------------------------------\n    // PASO 2: Obtener la Hora Actual en Argentina Dinámicamente\n    // -----------------------------------------------------------\n    const now = new Date();\n\n    // Usamos Intl para descomponer la hora actual según la zona horaria de Argentina\n    const formatter = new Intl.DateTimeFormat('en-US', {\n      timeZone: timeZone,\n      year: 'numeric', month: '2-digit', day: '2-digit',\n      hour: '2-digit', minute: '2-digit', second: '2-digit',\n      hour12: false\n    });\n\n    // Extraemos las partes (año, mes, dia, hora...) de la hora actual argentina\n    const parts = formatter.formatToParts(now);\n    const mapping = {};\n    parts.forEach(p => mapping[p.type] = p.value);\n\n    // Reconstruimos la fecha actual de Argentina como si fuera UTC (para que coincida con el Paso 1)\n    // Formato: YYYY-MM-DDTHH:mm:ssZ\n    const nowArgISO = `${mapping.year}-${mapping.month}-${mapping.day}T${mapping.hour}:${mapping.minute}:${mapping.second}Z`;\n    const nowArgDate = new Date(nowArgISO);\n\n    // -----------------------------------------------------------\n    // PASO 3: Calcular Diferencia\n    // -----------------------------------------------------------\n    // Al restar dos objetos Date, obtenemos milisegundos\n    const diffMs = targetDate - nowArgDate;\n    const diferenciaHoras = diffMs / (1000 * 60 * 60);\n\n    // -----------------------------------------------------------\n    // PASO 4: Tu Lógica de Negocio\n    // -----------------------------------------------------------\n    \n    // Si la diferencia es positiva (futuro) Y es menor a 1 hora\n    if (diferenciaHoras > 0 && diferenciaHoras < 1) {\n      item.json.mensaje_validacion = \"Todo es correcto (Menor a 1h)\";\n      item.json.procede_actualizacion = \"Sí\";\n    \n    } else if (diferenciaHoras <= 0) {\n      item.json.mensaje_validacion = \"No es posible de confirmar (La reservación ya pasó: \"+targetDateISO+\")\";\n      item.json.procede_actualizacion = \"No\";\n      \n    } else {\n      item.json.mensaje_validacion = \"Informa al usuario que la reserva está asegurada pero la confirmación aún no es posible (Falta más de 1h).\";\n      item.json.procede_actualizacion = \"No\";\n    }\n\n    // Debug (opcional)\n    item.json.debug_target = targetDateISO;\n    item.json.debug_now_arg = nowArgISO;\n    item.json.debug_diff = diferenciaHoras;\n\n  } else {\n    item.json.mensaje_validacion = \"Error: Faltan datos\";\n    item.json.procede_actualizacion = \"No\";\n  }\n}\n\nreturn $input.all();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1248,
          2032
        ],
        "id": "ac51b551-71c4-47c1-880d-260aca0cac91",
        "name": "Code in JavaScript3"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "2b6afc51-55ff-4eb3-ba94-db89d55b8170",
                "leftValue": "={{ $json.procede_actualizacion }}",
                "rightValue": "Sí",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1456,
          2032
        ],
        "id": "2473e5af-5678-4b27-b1dc-2574d13cb70e",
        "name": "If7"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "8c5d8ee6-3764-4faa-9219-41cf43cfdb5a",
                "name": "Response",
                "value": "={{ $json.mensaje_validacion }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1696,
          2128
        ],
        "id": "83484619-c57d-4958-b69a-50f08b2c5ff1",
        "name": "Edit Fields14"
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "id": "={{ $('Agente Principal').first().json.cliente_id }}",
              "intencion": "Información",
              "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "fecha_registro",
                "displayName": "fecha_registro",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "canal",
                "displayName": "canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "nombre",
                "displayName": "nombre",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono",
                "displayName": "telefono",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "correo",
                "displayName": "correo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "servicio",
                "displayName": "servicio",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_modificacion",
                "displayName": "fecha_modificacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "tipo_atencion",
                "displayName": "tipo_atencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "post_cita",
                "displayName": "post_cita",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "status",
                "displayName": "status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intencion",
                "displayName": "intencion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "num_mensaje_largo",
                "displayName": "num_mensaje_largo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "actitud",
                "displayName": "actitud",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "negativos_intentos",
                "displayName": "negativos_intentos",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "preferencias_alimentarias",
                "displayName": "preferencias_alimentarias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "total_reservaciones",
                "displayName": "total_reservaciones",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ult_reservacion",
                "displayName": "ult_reservacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "tipo_cliente",
                "displayName": "tipo_cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "alergias",
                "displayName": "alergias",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "pregunta_verifica_reserva",
                "displayName": "pregunta_verifica_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "chatid",
                "displayName": "chatid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "sucursal_bloqueo",
                "displayName": "sucursal_bloqueo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "object",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          3136,
          1760
        ],
        "id": "477dcbea-af8e-458e-b382-7cd026f9a392",
        "name": "Actualiza Cliente a Info2",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "for (const item of $input.all()) {\n  const fechaOriginal = item.json.fecha_reservacion;\n\n  // Convertir a YYYY-MM-DD\n  const fechaFormateada = new Date(fechaOriginal).toISOString().slice(0, 10);\n\n  item.json.fecha_formateada = fechaFormateada;\n}\n\nreturn $input.all();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2528,
          1760
        ],
        "id": "e78ef911-7ce1-4164-b35e-07a097fe7d91",
        "name": "Get Reserv Info"
      },
      {
        "parameters": {
          "jsCode": "// Obtiene todos los items\nconst items = $input.all();\n\n// --- CORRECCIÓN AQUÍ ---\n// Filtramos para quedarnos solo con los items que tengan datos reales (por ejemplo, que tengan \"id\")\nconst itemsReales = items.filter(item => item.json.id);\n\n// 1. Calcular la cantidad basándonos en los items REALES\nconst cantidad = itemsReales.length;\n\n// 2. Crear la lista y formatear la fecha usando solo los items reales\nconst listaDetalles = itemsReales.map(item => {\n  const fechaRaw = item.json.fecha_reservacion;\n  // Cortamos el string en la 'T' para obtener YYYY-MM-DD\n  const fechaFormateada = fechaRaw ? fechaRaw.split('T')[0] : null;\n  // const codigo = item.json.codigo_reserva;\n\n  return {\n    fecha: fechaFormateada, \n    hora: item.json.hora_reservacion,\n    codigo: item.json.codigo_reserva\n  };\n});\n\n// 3. Devolver resultado\nreturn [\n  {\n    json: {\n      total_reservas: cantidad,\n      lista_reservaciones: listaDetalles\n    }\n  }\n];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1936,
          864
        ],
        "id": "cc268b70-d6ee-4535-adc1-637a1b4b66cb",
        "name": "Resume Encontradas"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.personas }}",
                      "rightValue": 6,
                      "operator": {
                        "type": "number",
                        "operation": "lte"
                      },
                      "id": "d24457f4-836e-4ed0-baea-22e7341dffea"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Menos 6"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "eb7032c9-ba2f-458d-aa8a-a0dbe4ead1dd",
                      "leftValue": "={{ $json.personas }}",
                      "rightValue": 6,
                      "operator": {
                        "type": "number",
                        "operation": "gt"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "VIP"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Otro"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -1040,
          976
        ],
        "id": "de34f8a5-fed9-45c8-9025-a84770775ed2",
        "name": "Switch2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "25085d83-dbca-42c1-926e-ee68ed19cc8a",
                "name": "Response",
                "value": "No se proporcionaron todos los datos que usa la herramienta, corrige y llámala de nuevo.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -608,
          1184
        ],
        "id": "7570b9fa-2635-4b6e-b0c8-1b2e8ee9966b",
        "name": "Edit Fields13"
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "value": "osaki_main",
            "mode": "list",
            "cachedResultName": "osaki_main"
          },
          "table": {
            "__rl": true,
            "value": "clientes",
            "mode": "list",
            "cachedResultName": "clientes"
          },
          "where": {
            "values": [
              {
                "column": "id",
                "value": "={{ $('Agente Principal').first().json.cliente_id }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          2672,
          928
        ],
        "id": "14905efc-d44b-466f-8174-51ae1f207e5b",
        "name": "Get Client Data",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "hora_reservacion": "={{ $('Normaliza Datos').first().json.hora }}",
              "fecha_reservacion": "={{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}",
              "cliente": "={{ $('Normaliza Datos').first().json.nombre_completo }}",
              "numero_personas": "={{ $('Normaliza Datos').first().json.personas }}",
              "estado": "Pendiente",
              "dia_semana": "={{ new Date($('Normaliza Datos').first().json.fecha).getDay() }}",
              "email_contacto": "={{ $('Normaliza Datos').first().json.correo}}",
              "telefono_contacto": "={{ $('Normaliza Datos').first().json.telefono}}",
              "notas": "={{ $('Normaliza Datos').first().json.notas || 'Ninguna' }}",
              "zona": "={{ $('Normaliza Datos').first().json.zona  }}",
              "ubicacion": "={{ $('Normaliza Datos').first().json.ubicacion  }}",
              "telefono_solicitante": "={{ $('Agente Principal').first().json.telefono_solicita  }}",
              "created_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "codigo_reserva": "={{ `OSK-${new Date().toLocaleDateString('sv-SE', { timeZone: 'America/Argentina/Buenos_Aires' }).slice(2).replace(/-/g, '')}-${Array.from({length: 4}, () => String.fromCharCode(65 + Math.floor(Math.random() * 26))).join('')}` }}",
              "mesas_reserva": "={{\n  (function() {\n    const p = $('Normaliza Datos').first().json.personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
              "Canal": "WhatsApp"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "ubicacion",
                "displayName": "ubicacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "telefono_solicitante",
                "displayName": "telefono_solicitante",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "mesas_reserva",
                "displayName": "mesas_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "intento_confirmacion",
                "displayName": "intento_confirmacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Canal",
                "displayName": "Canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          2448,
          928
        ],
        "id": "88545167-067e-44ea-9bf2-7ed3ee6ae73c",
        "name": "Crea Reserva Postgres",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "create",
          "base": {
            "__rl": true,
            "value": "apprK9MtBIY9lyLQT",
            "mode": "list",
            "cachedResultName": "Sistema Osaki",
            "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT"
          },
          "table": {
            "__rl": true,
            "value": "tbls1xSwHHWBarhDd",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT/tbls1xSwHHWBarhDd"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Código": "={{ $('Crea Reserva Postgres').item.json.codigo_reserva }}",
              "Nombre": "={{ $('Normaliza Datos').first().json.nombre_completo }}",
              "Fecha": "={{ $('Crea Reserva Postgres').item.json.fecha_reservacion }}",
              "Hora": "={{ $('Normaliza Datos').first().json.hora }}",
              "Personas": "={{ $('Normaliza Datos').first().json.personas }}",
              "Zona": "={{ $('Normaliza Datos').first().json.zona }}",
              "Teléfono": "={{ $('Normaliza Datos').item.json.telefono.toNumber() }}",
              "Estado": "Pendiente",
              "Notas": "={{ $('Normaliza Datos').item.json.notas }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Código",
                "displayName": "Código",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Fecha",
                "displayName": "Fecha",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "dateTime",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Hora",
                "displayName": "Hora",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "11:00",
                    "value": "11:00"
                  },
                  {
                    "name": "11:30",
                    "value": "11:30"
                  },
                  {
                    "name": "12:00",
                    "value": "12:00"
                  },
                  {
                    "name": "12:30",
                    "value": "12:30"
                  },
                  {
                    "name": "13:00",
                    "value": "13:00"
                  },
                  {
                    "name": "13:30",
                    "value": "13:30"
                  },
                  {
                    "name": "14:00",
                    "value": "14:00"
                  },
                  {
                    "name": "14:30",
                    "value": "14:30"
                  },
                  {
                    "name": "15:00",
                    "value": "15:00"
                  },
                  {
                    "name": "18:00",
                    "value": "18:00"
                  },
                  {
                    "name": "18:30",
                    "value": "18:30"
                  },
                  {
                    "name": "19:00",
                    "value": "19:00"
                  },
                  {
                    "name": "19:30",
                    "value": "19:30"
                  },
                  {
                    "name": "20:00",
                    "value": "20:00"
                  },
                  {
                    "name": "20:30",
                    "value": "20:30"
                  },
                  {
                    "name": "21:00",
                    "value": "21:00"
                  },
                  {
                    "name": "21:30",
                    "value": "21:30"
                  },
                  {
                    "name": "22:00",
                    "value": "22:00"
                  },
                  {
                    "name": "22:30",
                    "value": "22:30"
                  },
                  {
                    "name": "Hora",
                    "value": "Hora"
                  },
                  {
                    "name": "21:15",
                    "value": "21:15"
                  },
                  {
                    "name": "22:15",
                    "value": "22:15"
                  },
                  {
                    "name": "21:45",
                    "value": "21:45"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Personas",
                "displayName": "Personas",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Zona",
                "displayName": "Zona",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Barra",
                    "value": "Barra"
                  },
                  {
                    "name": "Salón",
                    "value": "Salón"
                  },
                  {
                    "name": "VIP",
                    "value": "VIP"
                  },
                  {
                    "name": "null",
                    "value": "null"
                  },
                  {
                    "name": "2216140642",
                    "value": "2216140642"
                  },
                  {
                    "name": "2215646765",
                    "value": "2215646765"
                  },
                  {
                    "name": "2216806616",
                    "value": "2216806616"
                  },
                  {
                    "name": "2212201826",
                    "value": "2212201826"
                  },
                  {
                    "name": "2314463724",
                    "value": "2314463724"
                  },
                  {
                    "name": "1131492908",
                    "value": "1131492908"
                  },
                  {
                    "name": "1126883023",
                    "value": "1126883023"
                  },
                  {
                    "name": "2215055545",
                    "value": "2215055545"
                  },
                  {
                    "name": "2215526719",
                    "value": "2215526719"
                  },
                  {
                    "name": "2216524170",
                    "value": "2216524170"
                  },
                  {
                    "name": "1155166182",
                    "value": "1155166182"
                  },
                  {
                    "name": "2215593494",
                    "value": "2215593494"
                  },
                  {
                    "name": "2214350124",
                    "value": "2214350124"
                  },
                  {
                    "name": "2216378878",
                    "value": "2216378878"
                  },
                  {
                    "name": "2216412836",
                    "value": "2216412836"
                  },
                  {
                    "name": "2213608320",
                    "value": "2213608320"
                  },
                  {
                    "name": "2344401322",
                    "value": "2344401322"
                  },
                  {
                    "name": "2216126708",
                    "value": "2216126708"
                  },
                  {
                    "name": "2214948349",
                    "value": "2214948349"
                  },
                  {
                    "name": "1164591361",
                    "value": "1164591361"
                  },
                  {
                    "name": "2215313060",
                    "value": "2215313060"
                  },
                  {
                    "name": "2215959952",
                    "value": "2215959952"
                  },
                  {
                    "name": "2216696898",
                    "value": "2216696898"
                  },
                  {
                    "name": "2216258936",
                    "value": "2216258936"
                  },
                  {
                    "name": "1168792748",
                    "value": "1168792748"
                  },
                  {
                    "name": "2216428480",
                    "value": "2216428480"
                  },
                  {
                    "name": "2213108644",
                    "value": "2213108644"
                  },
                  {
                    "name": "2213075571",
                    "value": "2213075571"
                  },
                  {
                    "name": "2215664069",
                    "value": "2215664069"
                  },
                  {
                    "name": "2214548178",
                    "value": "2214548178"
                  },
                  {
                    "name": "2216266796",
                    "value": "2216266796"
                  },
                  {
                    "name": "2215937739",
                    "value": "2215937739"
                  },
                  {
                    "name": "2213080522",
                    "value": "2213080522"
                  },
                  {
                    "name": "2392401325",
                    "value": "2392401325"
                  },
                  {
                    "name": "3756545164",
                    "value": "3756545164"
                  },
                  {
                    "name": "2216549954",
                    "value": "2216549954"
                  },
                  {
                    "name": "2215406010",
                    "value": "2215406010"
                  },
                  {
                    "name": "2213540035",
                    "value": "2213540035"
                  },
                  {
                    "name": "1135597890",
                    "value": "1135597890"
                  },
                  {
                    "name": "2214954681",
                    "value": "2214954681"
                  },
                  {
                    "name": "2944903818",
                    "value": "2944903818"
                  },
                  {
                    "name": "2216270600",
                    "value": "2216270600"
                  },
                  {
                    "name": "2216074100",
                    "value": "2216074100"
                  },
                  {
                    "name": "2216226714",
                    "value": "2216226714"
                  },
                  {
                    "name": "2216568150",
                    "value": "2216568150"
                  },
                  {
                    "name": "2216726770",
                    "value": "2216726770"
                  },
                  {
                    "name": "2975148882",
                    "value": "2975148882"
                  },
                  {
                    "name": "2216752797",
                    "value": "2216752797"
                  },
                  {
                    "name": "2216814576",
                    "value": "2216814576"
                  },
                  {
                    "name": "2214887141",
                    "value": "2214887141"
                  },
                  {
                    "name": "2215766675",
                    "value": "2215766675"
                  },
                  {
                    "name": "3043718553",
                    "value": "3043718553"
                  },
                  {
                    "name": "2215240636",
                    "value": "2215240636"
                  },
                  {
                    "name": "2235361579",
                    "value": "2235361579"
                  },
                  {
                    "name": "2216551842",
                    "value": "2216551842"
                  },
                  {
                    "name": "2236019323",
                    "value": "2236019323"
                  },
                  {
                    "name": "2216024661",
                    "value": "2216024661"
                  },
                  {
                    "name": "1136403440",
                    "value": "1136403440"
                  },
                  {
                    "name": "2216757175",
                    "value": "2216757175"
                  },
                  {
                    "name": "2216153529",
                    "value": "2216153529"
                  },
                  {
                    "name": "2215400230",
                    "value": "2215400230"
                  },
                  {
                    "name": "2214767425",
                    "value": "2214767425"
                  },
                  {
                    "name": "2213593336",
                    "value": "2213593336"
                  },
                  {
                    "name": "2216390277",
                    "value": "2216390277"
                  },
                  {
                    "name": "2215957295",
                    "value": "2215957295"
                  },
                  {
                    "name": "2213515573",
                    "value": "2213515573"
                  },
                  {
                    "name": "2216033098",
                    "value": "2216033098"
                  },
                  {
                    "name": "2215772403",
                    "value": "2215772403"
                  },
                  {
                    "name": "2216900017",
                    "value": "2216900017"
                  },
                  {
                    "name": "2216216166",
                    "value": "2216216166"
                  },
                  {
                    "name": "2215919777",
                    "value": "2215919777"
                  },
                  {
                    "name": "2215919064",
                    "value": "2215919064"
                  },
                  {
                    "name": "2215347235",
                    "value": "2215347235"
                  },
                  {
                    "name": "2214092192",
                    "value": "2214092192"
                  },
                  {
                    "name": "2214597031",
                    "value": "2214597031"
                  },
                  {
                    "name": "2215568094",
                    "value": "2215568094"
                  },
                  {
                    "name": "2216212109",
                    "value": "2216212109"
                  },
                  {
                    "name": "2216153703",
                    "value": "2216153703"
                  },
                  {
                    "name": "2216031183",
                    "value": "2216031183"
                  },
                  {
                    "name": "1123897569",
                    "value": "1123897569"
                  },
                  {
                    "name": "2216162252",
                    "value": "2216162252"
                  },
                  {
                    "name": "2215697000",
                    "value": "2215697000"
                  },
                  {
                    "name": "2213628246",
                    "value": "2213628246"
                  },
                  {
                    "name": "2215916549",
                    "value": "2215916549"
                  },
                  {
                    "name": "2213102195",
                    "value": "2213102195"
                  },
                  {
                    "name": "1136174103",
                    "value": "1136174103"
                  },
                  {
                    "name": "2216689325",
                    "value": "2216689325"
                  },
                  {
                    "name": "2216000361",
                    "value": "2216000361"
                  },
                  {
                    "name": "2213558536",
                    "value": "2213558536"
                  },
                  {
                    "name": "2213549622",
                    "value": "2213549622"
                  },
                  {
                    "name": "1122919409",
                    "value": "1122919409"
                  },
                  {
                    "name": "2215529583",
                    "value": "2215529583"
                  },
                  {
                    "name": "2215573420",
                    "value": "2215573420"
                  },
                  {
                    "name": "2215402228",
                    "value": "2215402228"
                  },
                  {
                    "name": "2215700223",
                    "value": "2215700223"
                  },
                  {
                    "name": "2216228790",
                    "value": "2216228790"
                  },
                  {
                    "name": "2226689383",
                    "value": "2226689383"
                  },
                  {
                    "name": "2216332608",
                    "value": "2216332608"
                  },
                  {
                    "name": "2214194477",
                    "value": "2214194477"
                  },
                  {
                    "name": "2214356945",
                    "value": "2214356945"
                  },
                  {
                    "name": "2215968131",
                    "value": "2215968131"
                  },
                  {
                    "name": "2314627271",
                    "value": "2314627271"
                  },
                  {
                    "name": "2364459358",
                    "value": "2364459358"
                  },
                  {
                    "name": "2215722824",
                    "value": "2215722824"
                  },
                  {
                    "name": "2213605390",
                    "value": "2213605390"
                  },
                  {
                    "name": "2214181282",
                    "value": "2214181282"
                  },
                  {
                    "name": "2215756403",
                    "value": "2215756403"
                  },
                  {
                    "name": "2213041088",
                    "value": "2213041088"
                  },
                  {
                    "name": "2215712186",
                    "value": "2215712186"
                  },
                  {
                    "name": "2215466428",
                    "value": "2215466428"
                  },
                  {
                    "name": "2216692308",
                    "value": "2216692308"
                  },
                  {
                    "name": "2213100256",
                    "value": "2213100256"
                  },
                  {
                    "name": "2214088384",
                    "value": "2214088384"
                  },
                  {
                    "name": "2215749872",
                    "value": "2215749872"
                  },
                  {
                    "name": "2216062121",
                    "value": "2216062121"
                  },
                  {
                    "name": "2216833841",
                    "value": "2216833841"
                  },
                  {
                    "name": "2216719272",
                    "value": "2216719272"
                  },
                  {
                    "name": "1161553955",
                    "value": "1161553955"
                  },
                  {
                    "name": "2214090607",
                    "value": "2214090607"
                  },
                  {
                    "name": "2213588936",
                    "value": "2213588936"
                  },
                  {
                    "name": "2216210491",
                    "value": "2216210491"
                  },
                  {
                    "name": "2215030824",
                    "value": "2215030824"
                  },
                  {
                    "name": "2216682407",
                    "value": "2216682407"
                  },
                  {
                    "name": "2213625690",
                    "value": "2213625690"
                  },
                  {
                    "name": "2214816881",
                    "value": "2214816881"
                  },
                  {
                    "name": "2215471225",
                    "value": "2215471225"
                  },
                  {
                    "name": "2216314478",
                    "value": "2216314478"
                  },
                  {
                    "name": "2215456346",
                    "value": "2215456346"
                  },
                  {
                    "name": "2216071635",
                    "value": "2216071635"
                  },
                  {
                    "name": "2216569399",
                    "value": "2216569399"
                  },
                  {
                    "name": "2214208586",
                    "value": "2214208586"
                  },
                  {
                    "name": "2215963401",
                    "value": "2215963401"
                  },
                  {
                    "name": "2215521737",
                    "value": "2215521737"
                  },
                  {
                    "name": "2215557753",
                    "value": "2215557753"
                  },
                  {
                    "name": "2216427231",
                    "value": "2216427231"
                  },
                  {
                    "name": "2612436563",
                    "value": "2612436563"
                  },
                  {
                    "name": "2216228125",
                    "value": "2216228125"
                  },
                  {
                    "name": "2214982360",
                    "value": "2214982360"
                  },
                  {
                    "name": "2215928862",
                    "value": "2215928862"
                  },
                  {
                    "name": "2966311016",
                    "value": "2966311016"
                  },
                  {
                    "name": "2216126051",
                    "value": "2216126051"
                  },
                  {
                    "name": "2215037016",
                    "value": "2215037016"
                  },
                  {
                    "name": "2215997976",
                    "value": "2215997976"
                  },
                  {
                    "name": "1157712638",
                    "value": "1157712638"
                  },
                  {
                    "name": "2215617561",
                    "value": "2215617561"
                  },
                  {
                    "name": "2213640059",
                    "value": "2213640059"
                  },
                  {
                    "name": "2215012144",
                    "value": "2215012144"
                  },
                  {
                    "name": "2215485299",
                    "value": "2215485299"
                  },
                  {
                    "name": "2215651077",
                    "value": "2215651077"
                  },
                  {
                    "name": "2215453850",
                    "value": "2215453850"
                  },
                  {
                    "name": "2215921525",
                    "value": "2215921525"
                  },
                  {
                    "name": "2216423783",
                    "value": "2216423783"
                  },
                  {
                    "name": "2215561941",
                    "value": "2215561941"
                  },
                  {
                    "name": "2216036831",
                    "value": "2216036831"
                  },
                  {
                    "name": "2215769235",
                    "value": "2215769235"
                  },
                  {
                    "name": "3516576698",
                    "value": "3516576698"
                  },
                  {
                    "name": "2215413212",
                    "value": "2215413212"
                  },
                  {
                    "name": "2983653361",
                    "value": "2983653361"
                  },
                  {
                    "name": "2215025788",
                    "value": "2215025788"
                  },
                  {
                    "name": "2216219581",
                    "value": "2216219581"
                  },
                  {
                    "name": "2214955532",
                    "value": "2214955532"
                  },
                  {
                    "name": "1154215427",
                    "value": "1154215427"
                  },
                  {
                    "name": "2214403780",
                    "value": "2214403780"
                  },
                  {
                    "name": "2214403865",
                    "value": "2214403865"
                  },
                  {
                    "name": "4605693860",
                    "value": "4605693860"
                  },
                  {
                    "name": "2215613155",
                    "value": "2215613155"
                  },
                  {
                    "name": "2215726855",
                    "value": "2215726855"
                  },
                  {
                    "name": "2213195864",
                    "value": "2213195864"
                  },
                  {
                    "name": "2214811299",
                    "value": "2214811299"
                  },
                  {
                    "name": "2215701178",
                    "value": "2215701178"
                  },
                  {
                    "name": "2215989780",
                    "value": "2215989780"
                  },
                  {
                    "name": "2215639907",
                    "value": "2215639907"
                  },
                  {
                    "name": "2215791741",
                    "value": "2215791741"
                  },
                  {
                    "name": "2214944202",
                    "value": "2214944202"
                  },
                  {
                    "name": "2214633857",
                    "value": "2214633857"
                  },
                  {
                    "name": "2213540993",
                    "value": "2213540993"
                  },
                  {
                    "name": "2215775064",
                    "value": "2215775064"
                  },
                  {
                    "name": "2215990538",
                    "value": "2215990538"
                  },
                  {
                    "name": "2213571603",
                    "value": "2213571603"
                  },
                  {
                    "name": "2216249079",
                    "value": "2216249079"
                  },
                  {
                    "name": "2215073100",
                    "value": "2215073100"
                  },
                  {
                    "name": "2215479735",
                    "value": "2215479735"
                  },
                  {
                    "name": "2214005410",
                    "value": "2214005410"
                  },
                  {
                    "name": "2216044335",
                    "value": "2216044335"
                  },
                  {
                    "name": "1168936347",
                    "value": "1168936347"
                  },
                  {
                    "name": "2215037860",
                    "value": "2215037860"
                  },
                  {
                    "name": "2974396622",
                    "value": "2974396622"
                  },
                  {
                    "name": "2215577059",
                    "value": "2215577059"
                  },
                  {
                    "name": "2221411063",
                    "value": "2221411063"
                  },
                  {
                    "name": "2215892818",
                    "value": "2215892818"
                  },
                  {
                    "name": "2215658172",
                    "value": "2215658172"
                  },
                  {
                    "name": "2213145507",
                    "value": "2213145507"
                  },
                  {
                    "name": "2215948276",
                    "value": "2215948276"
                  },
                  {
                    "name": "2215564604",
                    "value": "2215564604"
                  },
                  {
                    "name": "2215619061",
                    "value": "2215619061"
                  },
                  {
                    "name": "2215935530",
                    "value": "2215935530"
                  },
                  {
                    "name": "2216261406",
                    "value": "2216261406"
                  },
                  {
                    "name": "2215613221",
                    "value": "2215613221"
                  },
                  {
                    "name": "2216721500",
                    "value": "2216721500"
                  },
                  {
                    "name": "2216244133",
                    "value": "2216244133"
                  },
                  {
                    "name": "2215402627",
                    "value": "2215402627"
                  },
                  {
                    "name": "2215776198",
                    "value": "2215776198"
                  },
                  {
                    "name": "1138468955",
                    "value": "1138468955"
                  },
                  {
                    "name": "2995336464",
                    "value": "2995336464"
                  },
                  {
                    "name": "2216149072",
                    "value": "2216149072"
                  },
                  {
                    "name": "2216411859",
                    "value": "2216411859"
                  },
                  {
                    "name": "2215861876",
                    "value": "2215861876"
                  },
                  {
                    "name": "2214089591",
                    "value": "2214089591"
                  },
                  {
                    "name": "2216275090",
                    "value": "2216275090"
                  },
                  {
                    "name": "2215718864",
                    "value": "2215718864"
                  },
                  {
                    "name": "2223465233",
                    "value": "2223465233"
                  },
                  {
                    "name": "2215347022",
                    "value": "2215347022"
                  },
                  {
                    "name": "2215255527",
                    "value": "2215255527"
                  },
                  {
                    "name": "2213088215",
                    "value": "2213088215"
                  },
                  {
                    "name": "2215574577",
                    "value": "2215574577"
                  },
                  {
                    "name": "2213649645",
                    "value": "2213649645"
                  },
                  {
                    "name": "1133138797",
                    "value": "1133138797"
                  },
                  {
                    "name": "2216157827",
                    "value": "2216157827"
                  },
                  {
                    "name": "2215347977",
                    "value": "2215347977"
                  },
                  {
                    "name": "2216028707",
                    "value": "2216028707"
                  },
                  {
                    "name": "1111111111",
                    "value": "1111111111"
                  },
                  {
                    "name": "2214540991",
                    "value": "2214540991"
                  },
                  {
                    "name": "2216723755",
                    "value": "2216723755"
                  },
                  {
                    "name": "2213992518",
                    "value": "2213992518"
                  },
                  {
                    "name": "2214359692",
                    "value": "2214359692"
                  },
                  {
                    "name": "2494028748",
                    "value": "2494028748"
                  },
                  {
                    "name": "2214810989",
                    "value": "2214810989"
                  },
                  {
                    "name": "1159338072",
                    "value": "1159338072"
                  },
                  {
                    "name": "2215682867",
                    "value": "2215682867"
                  },
                  {
                    "name": "2213536603",
                    "value": "2213536603"
                  },
                  {
                    "name": "2216383856",
                    "value": "2216383856"
                  },
                  {
                    "name": "1138173922",
                    "value": "1138173922"
                  },
                  {
                    "name": "2216198563",
                    "value": "2216198563"
                  },
                  {
                    "name": "2215439732",
                    "value": "2215439732"
                  },
                  {
                    "name": "2215484026",
                    "value": "2215484026"
                  },
                  {
                    "name": "1157333754",
                    "value": "1157333754"
                  },
                  {
                    "name": "2216340163",
                    "value": "2216340163"
                  },
                  {
                    "name": "1128936639",
                    "value": "1128936639"
                  },
                  {
                    "name": "111111111",
                    "value": "111111111"
                  },
                  {
                    "name": "2216713382",
                    "value": "2216713382"
                  },
                  {
                    "name": "2215382762",
                    "value": "2215382762"
                  },
                  {
                    "name": "2214545822",
                    "value": "2214545822"
                  },
                  {
                    "name": "2216036907",
                    "value": "2216036907"
                  },
                  {
                    "name": "2216413861",
                    "value": "2216413861"
                  },
                  {
                    "name": "2216414146",
                    "value": "2216414146"
                  },
                  {
                    "name": "1161892106",
                    "value": "1161892106"
                  },
                  {
                    "name": "1135602838",
                    "value": "1135602838"
                  },
                  {
                    "name": "2213142179",
                    "value": "2213142179"
                  },
                  {
                    "name": "2213599122",
                    "value": "2213599122"
                  },
                  {
                    "name": "2215313424",
                    "value": "2215313424"
                  },
                  {
                    "name": "2216292006",
                    "value": "2216292006"
                  },
                  {
                    "name": "2216315233",
                    "value": "2216315233"
                  },
                  {
                    "name": "1124089809",
                    "value": "1124089809"
                  },
                  {
                    "name": "2215571463",
                    "value": "2215571463"
                  },
                  {
                    "name": "2213543194",
                    "value": "2213543194"
                  },
                  {
                    "name": "2215466706",
                    "value": "2215466706"
                  },
                  {
                    "name": "2215907171",
                    "value": "2215907171"
                  },
                  {
                    "name": "2216165527",
                    "value": "2216165527"
                  },
                  {
                    "name": "2213549245",
                    "value": "2213549245"
                  },
                  {
                    "name": "2215401210",
                    "value": "2215401210"
                  },
                  {
                    "name": "2215448548",
                    "value": "2215448548"
                  },
                  {
                    "name": "2215451576",
                    "value": "2215451576"
                  },
                  {
                    "name": "2213563630",
                    "value": "2213563630"
                  },
                  {
                    "name": "2213505683",
                    "value": "2213505683"
                  },
                  {
                    "name": "2352416350",
                    "value": "2352416350"
                  },
                  {
                    "name": "2213602705",
                    "value": "2213602705"
                  },
                  {
                    "name": "2216141932",
                    "value": "2216141932"
                  },
                  {
                    "name": "2214201435",
                    "value": "2214201435"
                  },
                  {
                    "name": "2215909585",
                    "value": "2215909585"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Pendiente",
                    "value": "Pendiente"
                  },
                  {
                    "name": "Confirmada",
                    "value": "Confirmada"
                  },
                  {
                    "name": "Cancelada",
                    "value": "Cancelada"
                  },
                  {
                    "name": "Realizada Sin Confirmar",
                    "value": "Realizada Sin Confirmar"
                  },
                  {
                    "name": "cancelada",
                    "value": "cancelada"
                  },
                  {
                    "name": "cancelada ",
                    "value": "cancelada "
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Notas",
                "displayName": "Notas",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Fecha de Creación",
                "displayName": "Fecha de Creación",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              },
              {
                "id": "Última Modificación",
                "displayName": "Última Modificación",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          2912,
          928
        ],
        "id": "7af8ca3a-7910-4ef4-9f5d-e40d3a68a3c9",
        "name": "Crea Reserva AirTable",
        "credentials": {
          "airtableTokenApi": {
            "id": "KlZpJ3cetMbQRAcX",
            "name": "Osaki Tablero"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "base": {
            "__rl": true,
            "value": "apprK9MtBIY9lyLQT",
            "mode": "list",
            "cachedResultName": "Sistema Osaki",
            "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT"
          },
          "table": {
            "__rl": true,
            "value": "tbls1xSwHHWBarhDd",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT/tbls1xSwHHWBarhDd"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Personas": "={{ $('Normaliza Datos').item.json.personas }}",
              "Código": "={{ $('Normaliza Datos').item.json.codigo_reserva }}",
              "Nombre": "={{ $('Normaliza Datos').item.json.nombre_completo }}",
              "Fecha": "={{ $json.fecha_reservacion }}",
              "Hora": "={{ $('Normaliza Datos').first().json.hora }}",
              "Zona": "={{ $('Normaliza Datos').item.json.zona }}",
              "Teléfono": "={{ $('Normaliza Datos').item.json.telefono }}",
              "Estado": "={{ $json.estado }}",
              "Notas": "={{ $('Normaliza Datos').item.json.notas }}"
            },
            "matchingColumns": [
              "Código"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              },
              {
                "id": "Código",
                "displayName": "Código",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Fecha",
                "displayName": "Fecha",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "dateTime",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Hora",
                "displayName": "Hora",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "11:00",
                    "value": "11:00"
                  },
                  {
                    "name": "11:30",
                    "value": "11:30"
                  },
                  {
                    "name": "12:00",
                    "value": "12:00"
                  },
                  {
                    "name": "12:30",
                    "value": "12:30"
                  },
                  {
                    "name": "13:00",
                    "value": "13:00"
                  },
                  {
                    "name": "13:30",
                    "value": "13:30"
                  },
                  {
                    "name": "14:00",
                    "value": "14:00"
                  },
                  {
                    "name": "14:30",
                    "value": "14:30"
                  },
                  {
                    "name": "15:00",
                    "value": "15:00"
                  },
                  {
                    "name": "18:00",
                    "value": "18:00"
                  },
                  {
                    "name": "18:30",
                    "value": "18:30"
                  },
                  {
                    "name": "19:00",
                    "value": "19:00"
                  },
                  {
                    "name": "19:30",
                    "value": "19:30"
                  },
                  {
                    "name": "20:00",
                    "value": "20:00"
                  },
                  {
                    "name": "20:30",
                    "value": "20:30"
                  },
                  {
                    "name": "21:00",
                    "value": "21:00"
                  },
                  {
                    "name": "21:30",
                    "value": "21:30"
                  },
                  {
                    "name": "22:00",
                    "value": "22:00"
                  },
                  {
                    "name": "22:30",
                    "value": "22:30"
                  },
                  {
                    "name": "Hora",
                    "value": "Hora"
                  },
                  {
                    "name": "21:15",
                    "value": "21:15"
                  },
                  {
                    "name": "22:15",
                    "value": "22:15"
                  },
                  {
                    "name": "21:45",
                    "value": "21:45"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Personas",
                "displayName": "Personas",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Zona",
                "displayName": "Zona",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Barra",
                    "value": "Barra"
                  },
                  {
                    "name": "Salón",
                    "value": "Salón"
                  },
                  {
                    "name": "VIP",
                    "value": "VIP"
                  },
                  {
                    "name": "null",
                    "value": "null"
                  },
                  {
                    "name": "2216140642",
                    "value": "2216140642"
                  },
                  {
                    "name": "2215646765",
                    "value": "2215646765"
                  },
                  {
                    "name": "2216806616",
                    "value": "2216806616"
                  },
                  {
                    "name": "2212201826",
                    "value": "2212201826"
                  },
                  {
                    "name": "2314463724",
                    "value": "2314463724"
                  },
                  {
                    "name": "1131492908",
                    "value": "1131492908"
                  },
                  {
                    "name": "1126883023",
                    "value": "1126883023"
                  },
                  {
                    "name": "2215055545",
                    "value": "2215055545"
                  },
                  {
                    "name": "2215526719",
                    "value": "2215526719"
                  },
                  {
                    "name": "2216524170",
                    "value": "2216524170"
                  },
                  {
                    "name": "1155166182",
                    "value": "1155166182"
                  },
                  {
                    "name": "2215593494",
                    "value": "2215593494"
                  },
                  {
                    "name": "2214350124",
                    "value": "2214350124"
                  },
                  {
                    "name": "2216378878",
                    "value": "2216378878"
                  },
                  {
                    "name": "2216412836",
                    "value": "2216412836"
                  },
                  {
                    "name": "2213608320",
                    "value": "2213608320"
                  },
                  {
                    "name": "2344401322",
                    "value": "2344401322"
                  },
                  {
                    "name": "2216126708",
                    "value": "2216126708"
                  },
                  {
                    "name": "2214948349",
                    "value": "2214948349"
                  },
                  {
                    "name": "1164591361",
                    "value": "1164591361"
                  },
                  {
                    "name": "2215313060",
                    "value": "2215313060"
                  },
                  {
                    "name": "2215959952",
                    "value": "2215959952"
                  },
                  {
                    "name": "2216696898",
                    "value": "2216696898"
                  },
                  {
                    "name": "2216258936",
                    "value": "2216258936"
                  },
                  {
                    "name": "1168792748",
                    "value": "1168792748"
                  },
                  {
                    "name": "2216428480",
                    "value": "2216428480"
                  },
                  {
                    "name": "2213108644",
                    "value": "2213108644"
                  },
                  {
                    "name": "2213075571",
                    "value": "2213075571"
                  },
                  {
                    "name": "2215664069",
                    "value": "2215664069"
                  },
                  {
                    "name": "2214548178",
                    "value": "2214548178"
                  },
                  {
                    "name": "2216266796",
                    "value": "2216266796"
                  },
                  {
                    "name": "2215937739",
                    "value": "2215937739"
                  },
                  {
                    "name": "2213080522",
                    "value": "2213080522"
                  },
                  {
                    "name": "2392401325",
                    "value": "2392401325"
                  },
                  {
                    "name": "3756545164",
                    "value": "3756545164"
                  },
                  {
                    "name": "2216549954",
                    "value": "2216549954"
                  },
                  {
                    "name": "2215406010",
                    "value": "2215406010"
                  },
                  {
                    "name": "2213540035",
                    "value": "2213540035"
                  },
                  {
                    "name": "1135597890",
                    "value": "1135597890"
                  },
                  {
                    "name": "2214954681",
                    "value": "2214954681"
                  },
                  {
                    "name": "2944903818",
                    "value": "2944903818"
                  },
                  {
                    "name": "2216270600",
                    "value": "2216270600"
                  },
                  {
                    "name": "2216074100",
                    "value": "2216074100"
                  },
                  {
                    "name": "2216226714",
                    "value": "2216226714"
                  },
                  {
                    "name": "2216568150",
                    "value": "2216568150"
                  },
                  {
                    "name": "2216726770",
                    "value": "2216726770"
                  },
                  {
                    "name": "2975148882",
                    "value": "2975148882"
                  },
                  {
                    "name": "2216752797",
                    "value": "2216752797"
                  },
                  {
                    "name": "2216814576",
                    "value": "2216814576"
                  },
                  {
                    "name": "2214887141",
                    "value": "2214887141"
                  },
                  {
                    "name": "2215766675",
                    "value": "2215766675"
                  },
                  {
                    "name": "3043718553",
                    "value": "3043718553"
                  },
                  {
                    "name": "2215240636",
                    "value": "2215240636"
                  },
                  {
                    "name": "2235361579",
                    "value": "2235361579"
                  },
                  {
                    "name": "2216551842",
                    "value": "2216551842"
                  },
                  {
                    "name": "2236019323",
                    "value": "2236019323"
                  },
                  {
                    "name": "2216024661",
                    "value": "2216024661"
                  },
                  {
                    "name": "1136403440",
                    "value": "1136403440"
                  },
                  {
                    "name": "2216757175",
                    "value": "2216757175"
                  },
                  {
                    "name": "2216153529",
                    "value": "2216153529"
                  },
                  {
                    "name": "2215400230",
                    "value": "2215400230"
                  },
                  {
                    "name": "2214767425",
                    "value": "2214767425"
                  },
                  {
                    "name": "2213593336",
                    "value": "2213593336"
                  },
                  {
                    "name": "2216390277",
                    "value": "2216390277"
                  },
                  {
                    "name": "2215957295",
                    "value": "2215957295"
                  },
                  {
                    "name": "2213515573",
                    "value": "2213515573"
                  },
                  {
                    "name": "2216033098",
                    "value": "2216033098"
                  },
                  {
                    "name": "2215772403",
                    "value": "2215772403"
                  },
                  {
                    "name": "2216900017",
                    "value": "2216900017"
                  },
                  {
                    "name": "2216216166",
                    "value": "2216216166"
                  },
                  {
                    "name": "2215919777",
                    "value": "2215919777"
                  },
                  {
                    "name": "2215919064",
                    "value": "2215919064"
                  },
                  {
                    "name": "2215347235",
                    "value": "2215347235"
                  },
                  {
                    "name": "2214092192",
                    "value": "2214092192"
                  },
                  {
                    "name": "2214597031",
                    "value": "2214597031"
                  },
                  {
                    "name": "2215568094",
                    "value": "2215568094"
                  },
                  {
                    "name": "2216212109",
                    "value": "2216212109"
                  },
                  {
                    "name": "2216153703",
                    "value": "2216153703"
                  },
                  {
                    "name": "2216031183",
                    "value": "2216031183"
                  },
                  {
                    "name": "1123897569",
                    "value": "1123897569"
                  },
                  {
                    "name": "2216162252",
                    "value": "2216162252"
                  },
                  {
                    "name": "2215697000",
                    "value": "2215697000"
                  },
                  {
                    "name": "2213628246",
                    "value": "2213628246"
                  },
                  {
                    "name": "2215916549",
                    "value": "2215916549"
                  },
                  {
                    "name": "2213102195",
                    "value": "2213102195"
                  },
                  {
                    "name": "1136174103",
                    "value": "1136174103"
                  },
                  {
                    "name": "2216689325",
                    "value": "2216689325"
                  },
                  {
                    "name": "2216000361",
                    "value": "2216000361"
                  },
                  {
                    "name": "2213558536",
                    "value": "2213558536"
                  },
                  {
                    "name": "2213549622",
                    "value": "2213549622"
                  },
                  {
                    "name": "1122919409",
                    "value": "1122919409"
                  },
                  {
                    "name": "2215529583",
                    "value": "2215529583"
                  },
                  {
                    "name": "2215573420",
                    "value": "2215573420"
                  },
                  {
                    "name": "2215402228",
                    "value": "2215402228"
                  },
                  {
                    "name": "2215700223",
                    "value": "2215700223"
                  },
                  {
                    "name": "2216228790",
                    "value": "2216228790"
                  },
                  {
                    "name": "2226689383",
                    "value": "2226689383"
                  },
                  {
                    "name": "2216332608",
                    "value": "2216332608"
                  },
                  {
                    "name": "2214194477",
                    "value": "2214194477"
                  },
                  {
                    "name": "2214356945",
                    "value": "2214356945"
                  },
                  {
                    "name": "2215968131",
                    "value": "2215968131"
                  },
                  {
                    "name": "2314627271",
                    "value": "2314627271"
                  },
                  {
                    "name": "2364459358",
                    "value": "2364459358"
                  },
                  {
                    "name": "2215722824",
                    "value": "2215722824"
                  },
                  {
                    "name": "2213605390",
                    "value": "2213605390"
                  },
                  {
                    "name": "2214181282",
                    "value": "2214181282"
                  },
                  {
                    "name": "2215756403",
                    "value": "2215756403"
                  },
                  {
                    "name": "2213041088",
                    "value": "2213041088"
                  },
                  {
                    "name": "2215712186",
                    "value": "2215712186"
                  },
                  {
                    "name": "2215466428",
                    "value": "2215466428"
                  },
                  {
                    "name": "2216692308",
                    "value": "2216692308"
                  },
                  {
                    "name": "2213100256",
                    "value": "2213100256"
                  },
                  {
                    "name": "2214088384",
                    "value": "2214088384"
                  },
                  {
                    "name": "2215749872",
                    "value": "2215749872"
                  },
                  {
                    "name": "2216062121",
                    "value": "2216062121"
                  },
                  {
                    "name": "2216833841",
                    "value": "2216833841"
                  },
                  {
                    "name": "2216719272",
                    "value": "2216719272"
                  },
                  {
                    "name": "1161553955",
                    "value": "1161553955"
                  },
                  {
                    "name": "2214090607",
                    "value": "2214090607"
                  },
                  {
                    "name": "2213588936",
                    "value": "2213588936"
                  },
                  {
                    "name": "2216210491",
                    "value": "2216210491"
                  },
                  {
                    "name": "2215030824",
                    "value": "2215030824"
                  },
                  {
                    "name": "2216682407",
                    "value": "2216682407"
                  },
                  {
                    "name": "2213625690",
                    "value": "2213625690"
                  },
                  {
                    "name": "2214816881",
                    "value": "2214816881"
                  },
                  {
                    "name": "2215471225",
                    "value": "2215471225"
                  },
                  {
                    "name": "2216314478",
                    "value": "2216314478"
                  },
                  {
                    "name": "2215456346",
                    "value": "2215456346"
                  },
                  {
                    "name": "2216071635",
                    "value": "2216071635"
                  },
                  {
                    "name": "2216569399",
                    "value": "2216569399"
                  },
                  {
                    "name": "2214208586",
                    "value": "2214208586"
                  },
                  {
                    "name": "2215963401",
                    "value": "2215963401"
                  },
                  {
                    "name": "2215521737",
                    "value": "2215521737"
                  },
                  {
                    "name": "2215557753",
                    "value": "2215557753"
                  },
                  {
                    "name": "2216427231",
                    "value": "2216427231"
                  },
                  {
                    "name": "2612436563",
                    "value": "2612436563"
                  },
                  {
                    "name": "2216228125",
                    "value": "2216228125"
                  },
                  {
                    "name": "2214982360",
                    "value": "2214982360"
                  },
                  {
                    "name": "2215928862",
                    "value": "2215928862"
                  },
                  {
                    "name": "2966311016",
                    "value": "2966311016"
                  },
                  {
                    "name": "2216126051",
                    "value": "2216126051"
                  },
                  {
                    "name": "2215037016",
                    "value": "2215037016"
                  },
                  {
                    "name": "2215997976",
                    "value": "2215997976"
                  },
                  {
                    "name": "1157712638",
                    "value": "1157712638"
                  },
                  {
                    "name": "2215617561",
                    "value": "2215617561"
                  },
                  {
                    "name": "2213640059",
                    "value": "2213640059"
                  },
                  {
                    "name": "2215012144",
                    "value": "2215012144"
                  },
                  {
                    "name": "2215485299",
                    "value": "2215485299"
                  },
                  {
                    "name": "2215651077",
                    "value": "2215651077"
                  },
                  {
                    "name": "2215453850",
                    "value": "2215453850"
                  },
                  {
                    "name": "2215921525",
                    "value": "2215921525"
                  },
                  {
                    "name": "2216423783",
                    "value": "2216423783"
                  },
                  {
                    "name": "2215561941",
                    "value": "2215561941"
                  },
                  {
                    "name": "2216036831",
                    "value": "2216036831"
                  },
                  {
                    "name": "2215769235",
                    "value": "2215769235"
                  },
                  {
                    "name": "3516576698",
                    "value": "3516576698"
                  },
                  {
                    "name": "2215413212",
                    "value": "2215413212"
                  },
                  {
                    "name": "2983653361",
                    "value": "2983653361"
                  },
                  {
                    "name": "2215025788",
                    "value": "2215025788"
                  },
                  {
                    "name": "2216219581",
                    "value": "2216219581"
                  },
                  {
                    "name": "2214955532",
                    "value": "2214955532"
                  },
                  {
                    "name": "1154215427",
                    "value": "1154215427"
                  },
                  {
                    "name": "2214403780",
                    "value": "2214403780"
                  },
                  {
                    "name": "2214403865",
                    "value": "2214403865"
                  },
                  {
                    "name": "4605693860",
                    "value": "4605693860"
                  },
                  {
                    "name": "2215613155",
                    "value": "2215613155"
                  },
                  {
                    "name": "2215726855",
                    "value": "2215726855"
                  },
                  {
                    "name": "2213195864",
                    "value": "2213195864"
                  },
                  {
                    "name": "2214811299",
                    "value": "2214811299"
                  },
                  {
                    "name": "2215701178",
                    "value": "2215701178"
                  },
                  {
                    "name": "2215989780",
                    "value": "2215989780"
                  },
                  {
                    "name": "2215639907",
                    "value": "2215639907"
                  },
                  {
                    "name": "2215791741",
                    "value": "2215791741"
                  },
                  {
                    "name": "2214944202",
                    "value": "2214944202"
                  },
                  {
                    "name": "2214633857",
                    "value": "2214633857"
                  },
                  {
                    "name": "2213540993",
                    "value": "2213540993"
                  },
                  {
                    "name": "2215775064",
                    "value": "2215775064"
                  },
                  {
                    "name": "2215990538",
                    "value": "2215990538"
                  },
                  {
                    "name": "2213571603",
                    "value": "2213571603"
                  },
                  {
                    "name": "2216249079",
                    "value": "2216249079"
                  },
                  {
                    "name": "2215073100",
                    "value": "2215073100"
                  },
                  {
                    "name": "2215479735",
                    "value": "2215479735"
                  },
                  {
                    "name": "2214005410",
                    "value": "2214005410"
                  },
                  {
                    "name": "2216044335",
                    "value": "2216044335"
                  },
                  {
                    "name": "1168936347",
                    "value": "1168936347"
                  },
                  {
                    "name": "2215037860",
                    "value": "2215037860"
                  },
                  {
                    "name": "2974396622",
                    "value": "2974396622"
                  },
                  {
                    "name": "2215577059",
                    "value": "2215577059"
                  },
                  {
                    "name": "2221411063",
                    "value": "2221411063"
                  },
                  {
                    "name": "2215892818",
                    "value": "2215892818"
                  },
                  {
                    "name": "2215658172",
                    "value": "2215658172"
                  },
                  {
                    "name": "2213145507",
                    "value": "2213145507"
                  },
                  {
                    "name": "2215948276",
                    "value": "2215948276"
                  },
                  {
                    "name": "2215564604",
                    "value": "2215564604"
                  },
                  {
                    "name": "2215619061",
                    "value": "2215619061"
                  },
                  {
                    "name": "2215935530",
                    "value": "2215935530"
                  },
                  {
                    "name": "2216261406",
                    "value": "2216261406"
                  },
                  {
                    "name": "2215613221",
                    "value": "2215613221"
                  },
                  {
                    "name": "2216721500",
                    "value": "2216721500"
                  },
                  {
                    "name": "2216244133",
                    "value": "2216244133"
                  },
                  {
                    "name": "2215402627",
                    "value": "2215402627"
                  },
                  {
                    "name": "2215776198",
                    "value": "2215776198"
                  },
                  {
                    "name": "1138468955",
                    "value": "1138468955"
                  },
                  {
                    "name": "2995336464",
                    "value": "2995336464"
                  },
                  {
                    "name": "2216149072",
                    "value": "2216149072"
                  },
                  {
                    "name": "2216411859",
                    "value": "2216411859"
                  },
                  {
                    "name": "2215861876",
                    "value": "2215861876"
                  },
                  {
                    "name": "2214089591",
                    "value": "2214089591"
                  },
                  {
                    "name": "2216275090",
                    "value": "2216275090"
                  },
                  {
                    "name": "2215718864",
                    "value": "2215718864"
                  },
                  {
                    "name": "2223465233",
                    "value": "2223465233"
                  },
                  {
                    "name": "2215347022",
                    "value": "2215347022"
                  },
                  {
                    "name": "2215255527",
                    "value": "2215255527"
                  },
                  {
                    "name": "2213088215",
                    "value": "2213088215"
                  },
                  {
                    "name": "2215574577",
                    "value": "2215574577"
                  },
                  {
                    "name": "2213649645",
                    "value": "2213649645"
                  },
                  {
                    "name": "1133138797",
                    "value": "1133138797"
                  },
                  {
                    "name": "2216157827",
                    "value": "2216157827"
                  },
                  {
                    "name": "2215347977",
                    "value": "2215347977"
                  },
                  {
                    "name": "2216028707",
                    "value": "2216028707"
                  },
                  {
                    "name": "1111111111",
                    "value": "1111111111"
                  },
                  {
                    "name": "2214540991",
                    "value": "2214540991"
                  },
                  {
                    "name": "2216723755",
                    "value": "2216723755"
                  },
                  {
                    "name": "2213992518",
                    "value": "2213992518"
                  },
                  {
                    "name": "2214359692",
                    "value": "2214359692"
                  },
                  {
                    "name": "2494028748",
                    "value": "2494028748"
                  },
                  {
                    "name": "2214810989",
                    "value": "2214810989"
                  },
                  {
                    "name": "1159338072",
                    "value": "1159338072"
                  },
                  {
                    "name": "2215682867",
                    "value": "2215682867"
                  },
                  {
                    "name": "2213536603",
                    "value": "2213536603"
                  },
                  {
                    "name": "2216383856",
                    "value": "2216383856"
                  },
                  {
                    "name": "1138173922",
                    "value": "1138173922"
                  },
                  {
                    "name": "2216198563",
                    "value": "2216198563"
                  },
                  {
                    "name": "2215439732",
                    "value": "2215439732"
                  },
                  {
                    "name": "2215484026",
                    "value": "2215484026"
                  },
                  {
                    "name": "1157333754",
                    "value": "1157333754"
                  },
                  {
                    "name": "2216340163",
                    "value": "2216340163"
                  },
                  {
                    "name": "1128936639",
                    "value": "1128936639"
                  },
                  {
                    "name": "111111111",
                    "value": "111111111"
                  },
                  {
                    "name": "2216713382",
                    "value": "2216713382"
                  },
                  {
                    "name": "2215382762",
                    "value": "2215382762"
                  },
                  {
                    "name": "2214545822",
                    "value": "2214545822"
                  },
                  {
                    "name": "2216036907",
                    "value": "2216036907"
                  },
                  {
                    "name": "2216413861",
                    "value": "2216413861"
                  },
                  {
                    "name": "2216414146",
                    "value": "2216414146"
                  },
                  {
                    "name": "1161892106",
                    "value": "1161892106"
                  },
                  {
                    "name": "1135602838",
                    "value": "1135602838"
                  },
                  {
                    "name": "2213142179",
                    "value": "2213142179"
                  },
                  {
                    "name": "2213599122",
                    "value": "2213599122"
                  },
                  {
                    "name": "2215313424",
                    "value": "2215313424"
                  },
                  {
                    "name": "2216292006",
                    "value": "2216292006"
                  },
                  {
                    "name": "2216315233",
                    "value": "2216315233"
                  },
                  {
                    "name": "1124089809",
                    "value": "1124089809"
                  },
                  {
                    "name": "2215571463",
                    "value": "2215571463"
                  },
                  {
                    "name": "2213543194",
                    "value": "2213543194"
                  },
                  {
                    "name": "2215466706",
                    "value": "2215466706"
                  },
                  {
                    "name": "2215907171",
                    "value": "2215907171"
                  },
                  {
                    "name": "2216165527",
                    "value": "2216165527"
                  },
                  {
                    "name": "2213549245",
                    "value": "2213549245"
                  },
                  {
                    "name": "2215401210",
                    "value": "2215401210"
                  },
                  {
                    "name": "2215448548",
                    "value": "2215448548"
                  },
                  {
                    "name": "2215451576",
                    "value": "2215451576"
                  },
                  {
                    "name": "2213563630",
                    "value": "2213563630"
                  },
                  {
                    "name": "2213505683",
                    "value": "2213505683"
                  },
                  {
                    "name": "2352416350",
                    "value": "2352416350"
                  },
                  {
                    "name": "2213602705",
                    "value": "2213602705"
                  },
                  {
                    "name": "2216141932",
                    "value": "2216141932"
                  },
                  {
                    "name": "2214201435",
                    "value": "2214201435"
                  },
                  {
                    "name": "2215909585",
                    "value": "2215909585"
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Pendiente",
                    "value": "Pendiente"
                  },
                  {
                    "name": "Confirmada",
                    "value": "Confirmada"
                  },
                  {
                    "name": "Cancelada",
                    "value": "Cancelada"
                  },
                  {
                    "name": "Realizada Sin Confirmar",
                    "value": "Realizada Sin Confirmar"
                  },
                  {
                    "name": "cancelada",
                    "value": "cancelada"
                  },
                  {
                    "name": "cancelada ",
                    "value": "cancelada "
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Notas",
                "displayName": "Notas",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Fecha de Creación",
                "displayName": "Fecha de Creación",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              },
              {
                "id": "Última Modificación",
                "displayName": "Última Modificación",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          1504,
          1152
        ],
        "id": "a09c7b2f-e3f4-446c-9e31-ff5ed5f7163c",
        "name": "Update record",
        "credentials": {
          "airtableTokenApi": {
            "id": "KlZpJ3cetMbQRAcX",
            "name": "Osaki Tablero"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "estado": "Cancelada",
              "notas": "={{ $('Normaliza Datos').first().json.notas }}",
              "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "codigo_reserva": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}",
              "intento_confirmacion": "={{ true }}"
            },
            "matchingColumns": [
              "codigo_reserva"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ubicacion",
                "displayName": "ubicacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_solicitante",
                "displayName": "telefono_solicitante",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "mesas_reserva",
                "displayName": "mesas_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intento_confirmacion",
                "displayName": "intento_confirmacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Canal",
                "displayName": "Canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          2192,
          1616
        ],
        "id": "fdc20643-48c1-49cf-b845-df7ceb1675fe",
        "name": "Cancela Reserva",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "schema": {
            "__rl": true,
            "value": "={{ $('Agente Principal').first().json.schema }}",
            "mode": "name"
          },
          "table": {
            "__rl": true,
            "value": "reservaciones",
            "mode": "list",
            "cachedResultName": "reservaciones"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "estado": "Confirmada",
              "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
              "codigo_reserva": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}",
              "intento_confirmacion": "={{ true }}"
            },
            "matchingColumns": [
              "codigo_reserva"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "cliente",
                "displayName": "cliente",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "fecha_reservacion",
                "displayName": "fecha_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "hora_reservacion",
                "displayName": "hora_reservacion",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "time",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "numero_personas",
                "displayName": "numero_personas",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "estado",
                "displayName": "estado",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "dia_semana",
                "displayName": "dia_semana",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "email_contacto",
                "displayName": "email_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_contacto",
                "displayName": "telefono_contacto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "notas",
                "displayName": "notas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "zona",
                "displayName": "zona",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "ubicacion",
                "displayName": "ubicacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "telefono_solicitante",
                "displayName": "telefono_solicitante",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "created_at",
                "displayName": "created_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "updated_at",
                "displayName": "updated_at",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "dateTime",
                "canBeUsedToMatch": true
              },
              {
                "id": "codigo_reserva",
                "displayName": "codigo_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "mesas_reserva",
                "displayName": "mesas_reserva",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "intento_confirmacion",
                "displayName": "intento_confirmacion",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "boolean",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Canal",
                "displayName": "Canal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          2192,
          1856
        ],
        "id": "caa82849-5d29-450e-a0ce-e5b691bc234f",
        "name": "Confirma Reserva",
        "credentials": {
          "postgres": {
            "id": "sk75eTZ4yDkbl8mt",
            "name": "Postgres Osaki-TemikiaProd01"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "base": {
            "__rl": true,
            "value": "apprK9MtBIY9lyLQT",
            "mode": "list",
            "cachedResultName": "Sistema Osaki",
            "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT"
          },
          "table": {
            "__rl": true,
            "value": "tbls1xSwHHWBarhDd",
            "mode": "list",
            "cachedResultName": "Reservaciones",
            "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT/tbls1xSwHHWBarhDd"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Código": "={{ $json.codigo_reserva }}",
              "Estado": "={{ $json.estado }}",
              "Notas": "={{ $json.notas }}"
            },
            "matchingColumns": [
              "Código"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              },
              {
                "id": "Código",
                "displayName": "Código",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Nombre",
                "displayName": "Nombre",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "Fecha",
                "displayName": "Fecha",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "dateTime",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "Hora",
                "displayName": "Hora",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "11:00",
                    "value": "11:00"
                  },
                  {
                    "name": "11:30",
                    "value": "11:30"
                  },
                  {
                    "name": "12:00",
                    "value": "12:00"
                  },
                  {
                    "name": "12:30",
                    "value": "12:30"
                  },
                  {
                    "name": "13:00",
                    "value": "13:00"
                  },
                  {
                    "name": "13:30",
                    "value": "13:30"
                  },
                  {
                    "name": "14:00",
                    "value": "14:00"
                  },
                  {
                    "name": "14:30",
                    "value": "14:30"
                  },
                  {
                    "name": "15:00",
                    "value": "15:00"
                  },
                  {
                    "name": "18:00",
                    "value": "18:00"
                  },
                  {
                    "name": "18:30",
                    "value": "18:30"
                  },
                  {
                    "name": "19:00",
                    "value": "19:00"
                  },
                  {
                    "name": "19:30",
                    "value": "19:30"
                  },
                  {
                    "name": "20:00",
                    "value": "20:00"
                  },
                  {
                    "name": "20:30",
                    "value": "20:30"
                  },
                  {
                    "name": "21:00",
                    "value": "21:00"
                  },
                  {
                    "name": "21:30",
                    "value": "21:30"
                  },
                  {
                    "name": "22:00",
                    "value": "22:00"
                  },
                  {
                    "name": "22:30",
                    "value": "22:30"
                  },
                  {
                    "name": "Hora",
                    "value": "Hora"
                  },
                  {
                    "name": "21:15",
                    "value": "21:15"
                  },
                  {
                    "name": "22:15",
                    "value": "22:15"
                  },
                  {
                    "name": "21:45",
                    "value": "21:45"
                  }
                ],
                "readOnly": false,
                "removed": true
              },
              {
                "id": "Personas",
                "displayName": "Personas",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "number",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "Zona",
                "displayName": "Zona",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Barra",
                    "value": "Barra"
                  },
                  {
                    "name": "Salón",
                    "value": "Salón"
                  },
                  {
                    "name": "VIP",
                    "value": "VIP"
                  },
                  {
                    "name": "null",
                    "value": "null"
                  },
                  {
                    "name": "2216140642",
                    "value": "2216140642"
                  },
                  {
                    "name": "2215646765",
                    "value": "2215646765"
                  },
                  {
                    "name": "2216806616",
                    "value": "2216806616"
                  },
                  {
                    "name": "2212201826",
                    "value": "2212201826"
                  },
                  {
                    "name": "2314463724",
                    "value": "2314463724"
                  },
                  {
                    "name": "1131492908",
                    "value": "1131492908"
                  },
                  {
                    "name": "1126883023",
                    "value": "1126883023"
                  },
                  {
                    "name": "2215055545",
                    "value": "2215055545"
                  },
                  {
                    "name": "2215526719",
                    "value": "2215526719"
                  },
                  {
                    "name": "2216524170",
                    "value": "2216524170"
                  },
                  {
                    "name": "1155166182",
                    "value": "1155166182"
                  },
                  {
                    "name": "2215593494",
                    "value": "2215593494"
                  },
                  {
                    "name": "2214350124",
                    "value": "2214350124"
                  },
                  {
                    "name": "2216378878",
                    "value": "2216378878"
                  },
                  {
                    "name": "2216412836",
                    "value": "2216412836"
                  },
                  {
                    "name": "2213608320",
                    "value": "2213608320"
                  },
                  {
                    "name": "2344401322",
                    "value": "2344401322"
                  },
                  {
                    "name": "2216126708",
                    "value": "2216126708"
                  },
                  {
                    "name": "2214948349",
                    "value": "2214948349"
                  },
                  {
                    "name": "1164591361",
                    "value": "1164591361"
                  },
                  {
                    "name": "2215313060",
                    "value": "2215313060"
                  },
                  {
                    "name": "2215959952",
                    "value": "2215959952"
                  },
                  {
                    "name": "2216696898",
                    "value": "2216696898"
                  },
                  {
                    "name": "2216258936",
                    "value": "2216258936"
                  },
                  {
                    "name": "1168792748",
                    "value": "1168792748"
                  },
                  {
                    "name": "2216428480",
                    "value": "2216428480"
                  },
                  {
                    "name": "2213108644",
                    "value": "2213108644"
                  },
                  {
                    "name": "2213075571",
                    "value": "2213075571"
                  },
                  {
                    "name": "2215664069",
                    "value": "2215664069"
                  },
                  {
                    "name": "2214548178",
                    "value": "2214548178"
                  },
                  {
                    "name": "2216266796",
                    "value": "2216266796"
                  },
                  {
                    "name": "2215937739",
                    "value": "2215937739"
                  },
                  {
                    "name": "2213080522",
                    "value": "2213080522"
                  },
                  {
                    "name": "2392401325",
                    "value": "2392401325"
                  },
                  {
                    "name": "3756545164",
                    "value": "3756545164"
                  },
                  {
                    "name": "2216549954",
                    "value": "2216549954"
                  },
                  {
                    "name": "2215406010",
                    "value": "2215406010"
                  },
                  {
                    "name": "2213540035",
                    "value": "2213540035"
                  },
                  {
                    "name": "1135597890",
                    "value": "1135597890"
                  },
                  {
                    "name": "2214954681",
                    "value": "2214954681"
                  },
                  {
                    "name": "2944903818",
                    "value": "2944903818"
                  },
                  {
                    "name": "2216270600",
                    "value": "2216270600"
                  },
                  {
                    "name": "2216074100",
                    "value": "2216074100"
                  },
                  {
                    "name": "2216226714",
                    "value": "2216226714"
                  },
                  {
                    "name": "2216568150",
                    "value": "2216568150"
                  },
                  {
                    "name": "2216726770",
                    "value": "2216726770"
                  },
                  {
                    "name": "2975148882",
                    "value": "2975148882"
                  },
                  {
                    "name": "2216752797",
                    "value": "2216752797"
                  },
                  {
                    "name": "2216814576",
                    "value": "2216814576"
                  },
                  {
                    "name": "2214887141",
                    "value": "2214887141"
                  },
                  {
                    "name": "2215766675",
                    "value": "2215766675"
                  },
                  {
                    "name": "3043718553",
                    "value": "3043718553"
                  },
                  {
                    "name": "2215240636",
                    "value": "2215240636"
                  },
                  {
                    "name": "2235361579",
                    "value": "2235361579"
                  },
                  {
                    "name": "2216551842",
                    "value": "2216551842"
                  },
                  {
                    "name": "2236019323",
                    "value": "2236019323"
                  },
                  {
                    "name": "2216024661",
                    "value": "2216024661"
                  },
                  {
                    "name": "1136403440",
                    "value": "1136403440"
                  },
                  {
                    "name": "2216757175",
                    "value": "2216757175"
                  },
                  {
                    "name": "2216153529",
                    "value": "2216153529"
                  },
                  {
                    "name": "2215400230",
                    "value": "2215400230"
                  },
                  {
                    "name": "2214767425",
                    "value": "2214767425"
                  },
                  {
                    "name": "2213593336",
                    "value": "2213593336"
                  },
                  {
                    "name": "2216390277",
                    "value": "2216390277"
                  },
                  {
                    "name": "2215957295",
                    "value": "2215957295"
                  },
                  {
                    "name": "2213515573",
                    "value": "2213515573"
                  },
                  {
                    "name": "2216033098",
                    "value": "2216033098"
                  },
                  {
                    "name": "2215772403",
                    "value": "2215772403"
                  },
                  {
                    "name": "2216900017",
                    "value": "2216900017"
                  },
                  {
                    "name": "2216216166",
                    "value": "2216216166"
                  },
                  {
                    "name": "2215919777",
                    "value": "2215919777"
                  },
                  {
                    "name": "2215919064",
                    "value": "2215919064"
                  },
                  {
                    "name": "2215347235",
                    "value": "2215347235"
                  },
                  {
                    "name": "2214092192",
                    "value": "2214092192"
                  },
                  {
                    "name": "2214597031",
                    "value": "2214597031"
                  },
                  {
                    "name": "2215568094",
                    "value": "2215568094"
                  },
                  {
                    "name": "2216212109",
                    "value": "2216212109"
                  },
                  {
                    "name": "2216153703",
                    "value": "2216153703"
                  },
                  {
                    "name": "2216031183",
                    "value": "2216031183"
                  },
                  {
                    "name": "1123897569",
                    "value": "1123897569"
                  },
                  {
                    "name": "2216162252",
                    "value": "2216162252"
                  },
                  {
                    "name": "2215697000",
                    "value": "2215697000"
                  },
                  {
                    "name": "2213628246",
                    "value": "2213628246"
                  },
                  {
                    "name": "2215916549",
                    "value": "2215916549"
                  },
                  {
                    "name": "2213102195",
                    "value": "2213102195"
                  },
                  {
                    "name": "1136174103",
                    "value": "1136174103"
                  },
                  {
                    "name": "2216689325",
                    "value": "2216689325"
                  },
                  {
                    "name": "2216000361",
                    "value": "2216000361"
                  },
                  {
                    "name": "2213558536",
                    "value": "2213558536"
                  },
                  {
                    "name": "2213549622",
                    "value": "2213549622"
                  },
                  {
                    "name": "1122919409",
                    "value": "1122919409"
                  },
                  {
                    "name": "2215529583",
                    "value": "2215529583"
                  },
                  {
                    "name": "2215573420",
                    "value": "2215573420"
                  },
                  {
                    "name": "2215402228",
                    "value": "2215402228"
                  },
                  {
                    "name": "2215700223",
                    "value": "2215700223"
                  },
                  {
                    "name": "2216228790",
                    "value": "2216228790"
                  },
                  {
                    "name": "2226689383",
                    "value": "2226689383"
                  },
                  {
                    "name": "2216332608",
                    "value": "2216332608"
                  },
                  {
                    "name": "2214194477",
                    "value": "2214194477"
                  },
                  {
                    "name": "2214356945",
                    "value": "2214356945"
                  },
                  {
                    "name": "2215968131",
                    "value": "2215968131"
                  },
                  {
                    "name": "2314627271",
                    "value": "2314627271"
                  },
                  {
                    "name": "2364459358",
                    "value": "2364459358"
                  },
                  {
                    "name": "2215722824",
                    "value": "2215722824"
                  },
                  {
                    "name": "2213605390",
                    "value": "2213605390"
                  },
                  {
                    "name": "2214181282",
                    "value": "2214181282"
                  },
                  {
                    "name": "2215756403",
                    "value": "2215756403"
                  },
                  {
                    "name": "2213041088",
                    "value": "2213041088"
                  },
                  {
                    "name": "2215712186",
                    "value": "2215712186"
                  },
                  {
                    "name": "2215466428",
                    "value": "2215466428"
                  },
                  {
                    "name": "2216692308",
                    "value": "2216692308"
                  },
                  {
                    "name": "2213100256",
                    "value": "2213100256"
                  },
                  {
                    "name": "2214088384",
                    "value": "2214088384"
                  },
                  {
                    "name": "2215749872",
                    "value": "2215749872"
                  },
                  {
                    "name": "2216062121",
                    "value": "2216062121"
                  },
                  {
                    "name": "2216833841",
                    "value": "2216833841"
                  },
                  {
                    "name": "2216719272",
                    "value": "2216719272"
                  },
                  {
                    "name": "1161553955",
                    "value": "1161553955"
                  },
                  {
                    "name": "2214090607",
                    "value": "2214090607"
                  },
                  {
                    "name": "2213588936",
                    "value": "2213588936"
                  },
                  {
                    "name": "2216210491",
                    "value": "2216210491"
                  },
                  {
                    "name": "2215030824",
                    "value": "2215030824"
                  },
                  {
                    "name": "2216682407",
                    "value": "2216682407"
                  },
                  {
                    "name": "2213625690",
                    "value": "2213625690"
                  },
                  {
                    "name": "2214816881",
                    "value": "2214816881"
                  },
                  {
                    "name": "2215471225",
                    "value": "2215471225"
                  },
                  {
                    "name": "2216314478",
                    "value": "2216314478"
                  },
                  {
                    "name": "2215456346",
                    "value": "2215456346"
                  },
                  {
                    "name": "2216071635",
                    "value": "2216071635"
                  },
                  {
                    "name": "2216569399",
                    "value": "2216569399"
                  },
                  {
                    "name": "2214208586",
                    "value": "2214208586"
                  },
                  {
                    "name": "2215963401",
                    "value": "2215963401"
                  },
                  {
                    "name": "2215521737",
                    "value": "2215521737"
                  },
                  {
                    "name": "2215557753",
                    "value": "2215557753"
                  },
                  {
                    "name": "2216427231",
                    "value": "2216427231"
                  },
                  {
                    "name": "2612436563",
                    "value": "2612436563"
                  },
                  {
                    "name": "2216228125",
                    "value": "2216228125"
                  },
                  {
                    "name": "2214982360",
                    "value": "2214982360"
                  },
                  {
                    "name": "2215928862",
                    "value": "2215928862"
                  },
                  {
                    "name": "2966311016",
                    "value": "2966311016"
                  },
                  {
                    "name": "2216126051",
                    "value": "2216126051"
                  },
                  {
                    "name": "2215037016",
                    "value": "2215037016"
                  },
                  {
                    "name": "2215997976",
                    "value": "2215997976"
                  },
                  {
                    "name": "1157712638",
                    "value": "1157712638"
                  },
                  {
                    "name": "2215617561",
                    "value": "2215617561"
                  },
                  {
                    "name": "2213640059",
                    "value": "2213640059"
                  },
                  {
                    "name": "2215012144",
                    "value": "2215012144"
                  },
                  {
                    "name": "2215485299",
                    "value": "2215485299"
                  },
                  {
                    "name": "2215651077",
                    "value": "2215651077"
                  },
                  {
                    "name": "2215453850",
                    "value": "2215453850"
                  },
                  {
                    "name": "2215921525",
                    "value": "2215921525"
                  },
                  {
                    "name": "2216423783",
                    "value": "2216423783"
                  },
                  {
                    "name": "2215561941",
                    "value": "2215561941"
                  },
                  {
                    "name": "2216036831",
                    "value": "2216036831"
                  },
                  {
                    "name": "2215769235",
                    "value": "2215769235"
                  },
                  {
                    "name": "3516576698",
                    "value": "3516576698"
                  },
                  {
                    "name": "2215413212",
                    "value": "2215413212"
                  },
                  {
                    "name": "2983653361",
                    "value": "2983653361"
                  },
                  {
                    "name": "2215025788",
                    "value": "2215025788"
                  },
                  {
                    "name": "2216219581",
                    "value": "2216219581"
                  },
                  {
                    "name": "2214955532",
                    "value": "2214955532"
                  },
                  {
                    "name": "1154215427",
                    "value": "1154215427"
                  },
                  {
                    "name": "2214403780",
                    "value": "2214403780"
                  },
                  {
                    "name": "2214403865",
                    "value": "2214403865"
                  },
                  {
                    "name": "4605693860",
                    "value": "4605693860"
                  },
                  {
                    "name": "2215613155",
                    "value": "2215613155"
                  },
                  {
                    "name": "2215726855",
                    "value": "2215726855"
                  },
                  {
                    "name": "2213195864",
                    "value": "2213195864"
                  },
                  {
                    "name": "2214811299",
                    "value": "2214811299"
                  },
                  {
                    "name": "2215701178",
                    "value": "2215701178"
                  },
                  {
                    "name": "2215989780",
                    "value": "2215989780"
                  },
                  {
                    "name": "2215639907",
                    "value": "2215639907"
                  },
                  {
                    "name": "2215791741",
                    "value": "2215791741"
                  },
                  {
                    "name": "2214944202",
                    "value": "2214944202"
                  },
                  {
                    "name": "2214633857",
                    "value": "2214633857"
                  },
                  {
                    "name": "2213540993",
                    "value": "2213540993"
                  },
                  {
                    "name": "2215775064",
                    "value": "2215775064"
                  },
                  {
                    "name": "2215990538",
                    "value": "2215990538"
                  },
                  {
                    "name": "2213571603",
                    "value": "2213571603"
                  },
                  {
                    "name": "2216249079",
                    "value": "2216249079"
                  },
                  {
                    "name": "2215073100",
                    "value": "2215073100"
                  },
                  {
                    "name": "2215479735",
                    "value": "2215479735"
                  },
                  {
                    "name": "2214005410",
                    "value": "2214005410"
                  },
                  {
                    "name": "2216044335",
                    "value": "2216044335"
                  },
                  {
                    "name": "1168936347",
                    "value": "1168936347"
                  },
                  {
                    "name": "2215037860",
                    "value": "2215037860"
                  },
                  {
                    "name": "2974396622",
                    "value": "2974396622"
                  },
                  {
                    "name": "2215577059",
                    "value": "2215577059"
                  },
                  {
                    "name": "2221411063",
                    "value": "2221411063"
                  },
                  {
                    "name": "2215892818",
                    "value": "2215892818"
                  },
                  {
                    "name": "2215658172",
                    "value": "2215658172"
                  },
                  {
                    "name": "2213145507",
                    "value": "2213145507"
                  },
                  {
                    "name": "2215948276",
                    "value": "2215948276"
                  },
                  {
                    "name": "2215564604",
                    "value": "2215564604"
                  },
                  {
                    "name": "2215619061",
                    "value": "2215619061"
                  },
                  {
                    "name": "2215935530",
                    "value": "2215935530"
                  },
                  {
                    "name": "2216261406",
                    "value": "2216261406"
                  },
                  {
                    "name": "2215613221",
                    "value": "2215613221"
                  },
                  {
                    "name": "2216721500",
                    "value": "2216721500"
                  },
                  {
                    "name": "2216244133",
                    "value": "2216244133"
                  },
                  {
                    "name": "2215402627",
                    "value": "2215402627"
                  },
                  {
                    "name": "2215776198",
                    "value": "2215776198"
                  },
                  {
                    "name": "1138468955",
                    "value": "1138468955"
                  },
                  {
                    "name": "2995336464",
                    "value": "2995336464"
                  },
                  {
                    "name": "2216149072",
                    "value": "2216149072"
                  },
                  {
                    "name": "2216411859",
                    "value": "2216411859"
                  },
                  {
                    "name": "2215861876",
                    "value": "2215861876"
                  },
                  {
                    "name": "2214089591",
                    "value": "2214089591"
                  },
                  {
                    "name": "2216275090",
                    "value": "2216275090"
                  },
                  {
                    "name": "2215718864",
                    "value": "2215718864"
                  },
                  {
                    "name": "2223465233",
                    "value": "2223465233"
                  },
                  {
                    "name": "2215347022",
                    "value": "2215347022"
                  },
                  {
                    "name": "2215255527",
                    "value": "2215255527"
                  },
                  {
                    "name": "2213088215",
                    "value": "2213088215"
                  },
                  {
                    "name": "2215574577",
                    "value": "2215574577"
                  },
                  {
                    "name": "2213649645",
                    "value": "2213649645"
                  },
                  {
                    "name": "1133138797",
                    "value": "1133138797"
                  },
                  {
                    "name": "2216157827",
                    "value": "2216157827"
                  },
                  {
                    "name": "2215347977",
                    "value": "2215347977"
                  },
                  {
                    "name": "2216028707",
                    "value": "2216028707"
                  },
                  {
                    "name": "1111111111",
                    "value": "1111111111"
                  },
                  {
                    "name": "2214540991",
                    "value": "2214540991"
                  },
                  {
                    "name": "2216723755",
                    "value": "2216723755"
                  },
                  {
                    "name": "2213992518",
                    "value": "2213992518"
                  },
                  {
                    "name": "2214359692",
                    "value": "2214359692"
                  },
                  {
                    "name": "2494028748",
                    "value": "2494028748"
                  },
                  {
                    "name": "2214810989",
                    "value": "2214810989"
                  },
                  {
                    "name": "1159338072",
                    "value": "1159338072"
                  },
                  {
                    "name": "2215682867",
                    "value": "2215682867"
                  },
                  {
                    "name": "2213536603",
                    "value": "2213536603"
                  },
                  {
                    "name": "2216383856",
                    "value": "2216383856"
                  },
                  {
                    "name": "1138173922",
                    "value": "1138173922"
                  },
                  {
                    "name": "2216198563",
                    "value": "2216198563"
                  },
                  {
                    "name": "2215439732",
                    "value": "2215439732"
                  },
                  {
                    "name": "2215484026",
                    "value": "2215484026"
                  },
                  {
                    "name": "1157333754",
                    "value": "1157333754"
                  },
                  {
                    "name": "2216340163",
                    "value": "2216340163"
                  },
                  {
                    "name": "1128936639",
                    "value": "1128936639"
                  },
                  {
                    "name": "111111111",
                    "value": "111111111"
                  },
                  {
                    "name": "2216713382",
                    "value": "2216713382"
                  },
                  {
                    "name": "2215382762",
                    "value": "2215382762"
                  },
                  {
                    "name": "2214545822",
                    "value": "2214545822"
                  },
                  {
                    "name": "2216036907",
                    "value": "2216036907"
                  },
                  {
                    "name": "2216413861",
                    "value": "2216413861"
                  },
                  {
                    "name": "2216414146",
                    "value": "2216414146"
                  },
                  {
                    "name": "1161892106",
                    "value": "1161892106"
                  },
                  {
                    "name": "1135602838",
                    "value": "1135602838"
                  },
                  {
                    "name": "2213142179",
                    "value": "2213142179"
                  },
                  {
                    "name": "2213599122",
                    "value": "2213599122"
                  },
                  {
                    "name": "2215313424",
                    "value": "2215313424"
                  },
                  {
                    "name": "2216292006",
                    "value": "2216292006"
                  },
                  {
                    "name": "2216315233",
                    "value": "2216315233"
                  },
                  {
                    "name": "1124089809",
                    "value": "1124089809"
                  },
                  {
                    "name": "2215571463",
                    "value": "2215571463"
                  },
                  {
                    "name": "2213543194",
                    "value": "2213543194"
                  },
                  {
                    "name": "2215466706",
                    "value": "2215466706"
                  },
                  {
                    "name": "2215907171",
                    "value": "2215907171"
                  },
                  {
                    "name": "2216165527",
                    "value": "2216165527"
                  },
                  {
                    "name": "2213549245",
                    "value": "2213549245"
                  },
                  {
                    "name": "2215401210",
                    "value": "2215401210"
                  },
                  {
                    "name": "2215448548",
                    "value": "2215448548"
                  },
                  {
                    "name": "2215451576",
                    "value": "2215451576"
                  },
                  {
                    "name": "2213563630",
                    "value": "2213563630"
                  },
                  {
                    "name": "2213505683",
                    "value": "2213505683"
                  },
                  {
                    "name": "2352416350",
                    "value": "2352416350"
                  },
                  {
                    "name": "2213602705",
                    "value": "2213602705"
                  },
                  {
                    "name": "2216141932",
                    "value": "2216141932"
                  },
                  {
                    "name": "2214201435",
                    "value": "2214201435"
                  },
                  {
                    "name": "2215909585",
                    "value": "2215909585"
                  }
                ],
                "readOnly": false,
                "removed": true
              },
              {
                "id": "Teléfono",
                "displayName": "Teléfono",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": true
              },
              {
                "id": "Estado",
                "displayName": "Estado",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "options",
                "options": [
                  {
                    "name": "Pendiente",
                    "value": "Pendiente"
                  },
                  {
                    "name": "Confirmada",
                    "value": "Confirmada"
                  },
                  {
                    "name": "Cancelada",
                    "value": "Cancelada"
                  },
                  {
                    "name": "Realizada Sin Confirmar",
                    "value": "Realizada Sin Confirmar"
                  },
                  {
                    "name": "cancelada",
                    "value": "cancelada"
                  },
                  {
                    "name": "cancelada ",
                    "value": "cancelada "
                  }
                ],
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Notas",
                "displayName": "Notas",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "Fecha de Creación",
                "displayName": "Fecha de Creación",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              },
              {
                "id": "Última Modificación",
                "displayName": "Última Modificación",
                "required": false,
                "defaultMatch": false,
                "canBeUsedToMatch": true,
                "display": true,
                "type": "string",
                "readOnly": true,
                "removed": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2.1,
        "position": [
          2800,
          1760
        ],
        "id": "f949bde6-0a78-49b2-9e20-5b717b24f436",
        "name": "Update record1",
        "credentials": {
          "airtableTokenApi": {
            "id": "KlZpJ3cetMbQRAcX",
            "name": "Osaki Tablero"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "db09d781-335e-417d-806f-cfbce2455fa5",
                "name": "Response",
                "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones no se pueden hacer en bloques de minutos 00 y 30, ejemplo: 21:30, 20:00.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          432,
          288
        ],
        "id": "179d5d8b-d6c0-4155-a7f5-fb72ce1bf43d",
        "name": "Response Formato Hora 00 30"
      }
    ],
    "connections": {
      "Agente Principal": {
        "main": [
          [
            {
              "node": "Normaliza Datos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normaliza Datos": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "All Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTML": {
        "main": [
          [
            {
              "node": "Send a message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "HTML",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Actualiza Cliente a Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send a message": {
        "main": [
          [
            {
              "node": "Actualiza Cliente a Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If2": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Crea Reserva Postgres",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Switch2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "If8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Codigo Reserva Valido?1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If3": {
        "main": [
          [
            {
              "node": "If4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge1": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "Edit Fields4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If4": {
        "main": [
          [
            {
              "node": "Edit Fields5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Cancela Reserva",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If5": {
        "main": [
          [
            {
              "node": "Actualiza Reserva",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge2": {
        "main": [
          [
            {
              "node": "Aggregate1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate1": {
        "main": [
          [
            {
              "node": "Edit Fields7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "All Fields": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca Reserva": {
        "main": [
          [
            {
              "node": "Resume Encontradas",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update rows in a table": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca reservaciones1": {
        "main": [
          [
            {
              "node": "If5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Actualiza Reserva": {
        "main": [
          [
            {
              "node": "Update record",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca reservaciones": {
        "main": [
          [
            {
              "node": "If3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Edit Fields8": {
        "main": [
          [
            {
              "node": "All Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Revisa Horarios": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Response Fecha Cercana",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Response Fecha Pasada",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Response Local Cerrado",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Response Nombre Incompleto",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Response Formato Hora 00 30",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "If6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calcula Ocupación": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Lleno?": {
        "main": [
          [
            {
              "node": "Response Lleno",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Es Creación?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If8": {
        "main": [
          [
            {
              "node": "Edit Fields10",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Busca reservaciones",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Menos de 7?": {
        "main": [
          [],
          []
        ]
      },
      "If6": {
        "main": [
          [
            {
              "node": "Response No Zona",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Sushi Libre?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Cliente a Info": {
        "main": [
          [
            {
              "node": "Delete sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Delete sheet": {
        "main": [
          [
            {
              "node": "Create sheet1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Codigo Reserva Valido?": {
        "main": [
          [
            {
              "node": "Busca reservaciones1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Es Creación?": {
        "main": [
          [
            {
              "node": "Busca Reserva",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Codigo Reserva Valido?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "Lleno?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calcula Ocupación1": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "Lleno?1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Lleno?1": {
        "main": [
          [
            {
              "node": "Response Lleno1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Es Creación?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If9": {
        "main": [
          [
            {
              "node": "Calcula Ocupación2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Calcula Ocupación1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sushi Libre?": {
        "main": [
          [
            {
              "node": "If9",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Calcula Ocupación",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create sheet1": {
        "main": [
          [
            {
              "node": "Get Reserv",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Reserv": {
        "main": [
          [
            {
              "node": "Llena Documento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Llena Documento": {
        "main": [
          [
            {
              "node": "Aggregate2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate2": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calcula Ocupación2": {
        "main": [
          [
            {
              "node": "Code in JavaScript2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript2": {
        "main": [
          [
            {
              "node": "Response No Zona1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Codigo Reserva Valido?1": {
        "main": [
          [
            {
              "node": "Busca reservaciones2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca reservaciones2": {
        "main": [
          [
            {
              "node": "If10",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "If10": {
        "main": [
          [
            {
              "node": "Code in JavaScript3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge3": {
        "main": [
          [
            {
              "node": "Aggregate4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate4": {
        "main": [
          [
            {
              "node": "Edit Fields12",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript3": {
        "main": [
          [
            {
              "node": "If7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If7": {
        "main": [
          [
            {
              "node": "Confirma Reserva",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Actualiza Cliente a Info2": {
        "main": [
          [
            {
              "node": "Delete sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Reserv Info": {
        "main": [
          [
            {
              "node": "Update record1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Resume Encontradas": {
        "main": [
          [
            {
              "node": "If2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch2": {
        "main": [
          [
            {
              "node": "Revisa Horarios",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields9",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Client Data": {
        "main": [
          [
            {
              "node": "Crea Reserva AirTable",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crea Reserva Postgres": {
        "main": [
          [
            {
              "node": "Get Client Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Crea Reserva AirTable": {
        "main": [
          [
            {
              "node": "Update rows in a table",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update record": {
        "main": [
          [
            {
              "node": "Edit Fields8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cancela Reserva": {
        "main": [
          [
            {
              "node": "Get Reserv Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Confirma Reserva": {
        "main": [
          [
            {
              "node": "Get Reserv Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update record1": {
        "main": [
          [
            {
              "node": "Actualiza Cliente a Info2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Temikia Agency",
    "name": "Version c4f5d3ab",
    "description": "",
    "autosaved": true
  },
  "activeVersionId": "c4f5d3ab-e897-453e-af4f-caf7e6688968",
  "connections": {
    "Agente Principal": {
      "main": [
        [
          {
            "node": "Normaliza Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normaliza Datos": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "All Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualiza Cliente a Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Actualiza Cliente a Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Crea Reserva Postgres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Codigo Reserva Valido?1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancela Reserva",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Actualiza Reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "All Fields": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca Reserva": {
      "main": [
        [
          {
            "node": "Resume Encontradas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca reservaciones1": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Actualiza Reserva": {
      "main": [
        [
          {
            "node": "Update record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca reservaciones": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        [
          {
            "node": "All Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Revisa Horarios": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Response Fecha Cercana",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Response Fecha Pasada",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Response Local Cerrado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Response Nombre Incompleto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Response Formato Hora 00 30",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calcula Ocupación": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lleno?": {
      "main": [
        [
          {
            "node": "Response Lleno",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Es Creación?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Busca reservaciones",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menos de 7?": {
      "main": [
        [],
        []
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Response No Zona",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sushi Libre?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Cliente a Info": {
      "main": [
        [
          {
            "node": "Delete sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete sheet": {
      "main": [
        [
          {
            "node": "Create sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Codigo Reserva Valido?": {
      "main": [
        [
          {
            "node": "Busca reservaciones1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Es Creación?": {
      "main": [
        [
          {
            "node": "Busca Reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Codigo Reserva Valido?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Lleno?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calcula Ocupación1": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Lleno?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lleno?1": {
      "main": [
        [
          {
            "node": "Response Lleno1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Es Creación?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If9": {
      "main": [
        [
          {
            "node": "Calcula Ocupación2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Calcula Ocupación1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sushi Libre?": {
      "main": [
        [
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Calcula Ocupación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create sheet1": {
      "main": [
        [
          {
            "node": "Get Reserv",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Reserv": {
      "main": [
        [
          {
            "node": "Llena Documento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Llena Documento": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calcula Ocupación2": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Response No Zona1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Codigo Reserva Valido?1": {
      "main": [
        [
          {
            "node": "Busca reservaciones2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca reservaciones2": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Aggregate4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate4": {
      "main": [
        [
          {
            "node": "Edit Fields12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "Confirma Reserva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Cliente a Info2": {
      "main": [
        [
          {
            "node": "Delete sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Reserv Info": {
      "main": [
        [
          {
            "node": "Update record1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resume Encontradas": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Revisa Horarios",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Client Data": {
      "main": [
        [
          {
            "node": "Crea Reserva AirTable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crea Reserva Postgres": {
      "main": [
        [
          {
            "node": "Get Client Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crea Reserva AirTable": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update record": {
      "main": [
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancela Reserva": {
      "main": [
        [
          {
            "node": "Get Reserv Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirma Reserva": {
      "main": [
        [
          {
            "node": "Get Reserv Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update record1": {
      "main": [
        [
          {
            "node": "Actualiza Cliente a Info2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2026-02-17T14:32:00.848Z",
  "id": "su5pBZNPEHVtuYnB",
  "isArchived": false,
  "meta": null,
  "name": "Gestiona Reservacion 2.0",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "reservacion"
            },
            {
              "name": "telefono_solicita"
            },
            {
              "name": "schema"
            },
            {
              "name": "cliente_id",
              "type": "number"
            }
          ]
        }
      },
      "id": "8dc27517-df6a-4780-ad1a-dcc3bcc89108",
      "typeVersion": 1.1,
      "name": "Agente Principal",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -1632,
        1360
      ]
    },
    {
      "parameters": {
        "jsCode": "const resultados = [];\n\nfor (const item of items) {\n  let resultadoFinal = null;\n  let errorLog = null;\n\n  // Obtenemos el valor crudo\n  const raw = item.json?.reservacion; \n\n  // CASO 0: Si es null o undefined, saltamos\n  if (!raw) {\n    resultados.push({ json: { error: \"Input vacío\" } });\n    continue;\n  }\n\n  // CASO 1: Si n8n ya lo detectó como Objeto, lo usamos directo\n  if (typeof raw === 'object') {\n    resultadoFinal = raw;\n  } else {\n    // Limpieza básica universal (Markdown y espacios)\n    const clean = String(raw).replace(/```json|```/g, '').trim();\n\n    try {\n      // --- INTENTO 1: Parseo Estándar ---\n      resultadoFinal = JSON.parse(clean);\n    } catch (e1) {\n      try {\n        // --- INTENTO 2: Parseo con Sanitize ---\n        const sanitized = clean\n          .replace(/\\n/g, \"\\\\n\")\n          .replace(/\\r/g, \"\\\\r\")\n          .replace(/\\t/g, \"\\\\t\");\n        \n        resultadoFinal = JSON.parse(sanitized);\n      } catch (e2) {\n        errorLog = e1.message;\n      }\n    }\n  }\n\n  // VALIDACIÓN Y NORMALIZACIÓN DE PERSONAS\n  if (resultadoFinal) {\n    // Normalizamos el campo personas\n    if (resultadoFinal.hasOwnProperty('personas')) {\n      resultadoFinal.personas = normalizarNumeroPersonas(resultadoFinal.personas);\n    }\n    \n    // También verificamos campos similares comunes\n    const camposPersonas = ['numero_personas', 'cantidad_personas', 'personas', 'pax', 'guests'];\n    for (const campo of camposPersonas) {\n      if (resultadoFinal.hasOwnProperty(campo)) {\n        resultadoFinal[campo] = normalizarNumeroPersonas(resultadoFinal[campo]);\n        break; // Solo normalizamos el primer campo que encontremos\n      }\n    }\n    \n    resultados.push({ json: resultadoFinal });\n  } else {\n    resultados.push({ \n      json: { \n        error: \"No se pudo parsear el JSON\",\n        detalles: errorLog,\n        input_recibido: raw \n      } \n    });\n  }\n}\n\n// Función auxiliar para normalizar el número de personas\nfunction normalizarNumeroPersonas(valor) {\n  if (valor === null || valor === undefined) return 1;\n  \n  // Convertimos a número\n  let numero;\n  if (typeof valor === 'number') {\n    numero = valor;\n  } else if (typeof valor === 'string') {\n    // Limpiamos la cadena y convertimos\n    const limpio = valor.toString().replace(/[^\\d.,]/g, '').replace(',', '.');\n    numero = parseFloat(limpio);\n  } else {\n    numero = Number(valor);\n  }\n  \n  // Validamos que sea un número válido y positivo\n  if (isNaN(numero) || !isFinite(numero) || numero <= 0) {\n    return 1; // Valor por defecto\n  }\n  \n  // Redondeamos al entero más cercano\n  return Math.max(1, Math.round(numero));\n}\n\nreturn resultados;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1424,
        1360
      ],
      "id": "626ac3ba-7354-4f64-b70b-82d38d08831d",
      "name": "Normaliza Datos"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8c5d8ee6-3764-4faa-9219-41cf43cfdb5a",
              "name": "fecha",
              "value": "={{ $('Normaliza Datos').first().json.fecha }}",
              "type": "string"
            },
            {
              "id": "27e2aa1e-c162-40dc-b215-386d42c2a8b7",
              "name": "hora",
              "value": "={{ $('Crea Reserva Postgres').item.json.hora_reservacion }}",
              "type": "string"
            },
            {
              "id": "9c90660d-d6a0-4799-a7f4-3d16ee9e48fa",
              "name": "cliente",
              "value": "={{ $('Crea Reserva Postgres').item.json.cliente }}",
              "type": "string"
            },
            {
              "id": "98595a48-1f1c-4555-8301-3b284a1a140e",
              "name": "personas",
              "value": "={{ $('Crea Reserva Postgres').item.json.numero_personas }}",
              "type": "number"
            },
            {
              "id": "4d77d7ef-814e-42e0-883e-2701a6cef655",
              "name": "notas",
              "value": "={{ $('Crea Reserva Postgres').item.json.notas }}",
              "type": "string"
            },
            {
              "id": "615e1ded-ca87-4479-a87f-84db2eccd7b4",
              "name": "estado",
              "value": "={{ $('Crea Reserva Postgres').item.json.estado }}",
              "type": "string"
            },
            {
              "id": "d92abef2-e128-423a-9573-a36a45656146",
              "name": "correo",
              "value": "={{ $('Crea Reserva Postgres').item.json.correo || 'No proporcionado' }}",
              "type": "string"
            },
            {
              "id": "f0054bbd-48bb-43d6-b48a-e35d5818e11f",
              "name": "=zona",
              "value": "={{ $('Crea Reserva Postgres').item.json.zona }}",
              "type": "string"
            },
            {
              "id": "d27a110c-36b2-468a-ad9c-821c0034fdb8",
              "name": "codigo_reserva",
              "value": "={{ $('Crea Reserva Postgres').item.json.codigo_reserva }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2032,
        1152
      ],
      "id": "7dfe75e0-04b8-4955-947e-b9d6c2cf31a0",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n    <title>Confirmación de Reserva en Osaki</title>\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n    <link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n    <style>\n        /* Estilos generales */\n        body {\n            margin: 0;\n            padding: 0;\n            -webkit-text-size-adjust: 100%;\n            -ms-text-size-adjust: 100%;\n            background-color: #1a1a1a;\n            font-family: 'Montserrat', Arial, sans-serif;\n        }\n\n        table {\n            border-spacing: 0;\n        }\n\n        td {\n            padding: 0;\n        }\n\n        img {\n            border: 0;\n        }\n\n        /* Contenedor principal */\n        .wrapper {\n            width: 100%;\n            table-layout: fixed;\n            background-color: #1a1a1a;\n            padding: 40px 0;\n        }\n\n        .main {\n            background-color: #000000;\n            margin: 0 auto;\n            width: 100%;\n            max-width: 600px;\n            border-spacing: 0;\n            font-family: 'Montserrat', Arial, sans-serif;\n            color: #cccccc;\n            border-radius: 8px;\n            overflow: hidden;\n        }\n        \n        /* Encabezado */\n        .header {\n            background-color: #000000;\n            padding: 30px 0;\n            text-align: center;\n        }\n\n        .logo {\n            width: 120px;\n            max-width: 100%;\n        }\n        \n        /* Contenido */\n        .content {\n            padding: 40px 30px;\n            text-align: left;\n        }\n        \n        h1 {\n            font-size: 24px;\n            margin-top: 0;\n            margin-bottom: 20px;\n            color: #ffffff;\n            font-weight: 700;\n        }\n        \n        p {\n            margin-top: 0;\n            margin-bottom: 16px;\n            line-height: 1.7;\n            font-size: 16px;\n            color: #cccccc;\n        }\n\n        /* Detalles de la reservación */\n        .reservation-details {\n            width: 100%;\n            margin: 30px 0;\n            border-collapse: collapse;\n        }\n\n        .reservation-details td {\n            padding: 15px 0;\n            font-size: 16px;\n            border-bottom: 1px solid #333333;\n        }\n        \n        .reservation-details tr:last-child td {\n            border-bottom: none;\n        }\n\n        .reservation-details strong {\n            color: #ffffff;\n            font-weight: 700;\n        }\n        \n        /* Botón de acción */\n        .button {\n            background-color: #DA291C; /* Rojo corporativo de Osaki */\n            color: #ffffff;\n            padding: 14px 28px;\n            text-decoration: none;\n            border-radius: 5px;\n            font-weight: 700;\n            display: inline-block;\n            font-size: 16px;\n        }\n\n        /* Pie de página */\n        .footer {\n            background-color: #000000;\n            padding: 30px;\n            text-align: center;\n            border-top: 1px solid #333333;\n        }\n\n        .footer p {\n            font-size: 12px;\n            margin-bottom: 8px;\n            color: #888888;\n        }\n\n        .footer a {\n            color: #DA291C;\n            text-decoration: none;\n        }\n\n    </style>\n</head>\n<body>\n    <center class=\"wrapper\">\n        <table class=\"main\" width=\"100%\">\n            <!-- ====== ENCABEZADO CON LOGO ====== -->\n            <tr>\n                <td>\n                    <table width=\"100%\">\n                        <tr>\n                            <td class=\"header\">\n                                <a href=\"https://osakisushi.com/\" target=\"_blank\">\n                                    <img src=\"https://osakisushi.com/wp-content/uploads/2023/12/logo-osaki.png\" alt=\"Logo Osaki Sushi\" class=\"logo\">\n                                </a>\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n\n            <!-- ====== CONTENIDO PRINCIPAL ====== -->\n            <tr>\n                <td class=\"content\">\n                    <h1>Tu reserva está casi lista</h1>\n                    \n                    <!-- n8n usará esta expresión para obtener el nombre del cliente -->\n                    <p>Hola, <strong>{{$json.cliente}}</strong>,</p>\n                    \n                    <p>Hemos recibido tu solicitud de reserva en Osaki. A continuación, te mostramos los detalles. Tené en cuenta que el estado actual es <strong>'Pendiente'</strong>. Recibirás la confirmación final entre 2 y 3 horas antes del horario programado.</p>\n\n                    <!-- ====== TABLA DE DETALLES ====== -->\n                    <table class=\"reservation-details\">\n                        <tr>\n                            <td><strong>Fecha:</strong></td>\n                            <!-- Expresión para la fecha -->\n                            <td align=\"right\">{{$json.fecha}}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Hora:</strong></td>\n                            <!-- Expresión para la hora -->\n                            <td align=\"right\">{{$json.hora}}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Personas:</strong></td>\n                            <!-- Expresión para el número de personas -->\n                            <td align=\"right\">{{$json.personas}}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Zona:</strong></td>\n                             <!-- Expresión para las notas -->\n                            <td align=\"right\">{{$json.zona}}</td>\n                        </tr>\n                         <tr>\n                            <td><strong>Estado:</strong></td>\n                             <!-- Expresión para el estado -->\n                            <td align=\"right\"><strong>{{$json.estado}}</strong></td>\n                        </tr>\n                    </table>\n\n                    <p>Si necesitás hacer algún cambio o cancelar, por favor contactanos lo antes posible.</p>\n                    <p>Te esperamos.</p>\n\n                    <!-- ====== BOTÓN DE ACCIÓN ====== -->\n                    <table width=\"100%\" style=\"margin-top: 30px;\">\n                        <tr>\n                            <td style=\"text-align: center;\">\n                                <a href=\"https://osakisushi.com/menu/\" target=\"_blank\" class=\"button\">Conocé nuestro menú</a>\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n\n            <!-- ====== PIE DE PÁGINA ====== -->\n            <tr>\n                <td class=\"footer\">\n                    <p><strong>Nuestras sucursales</strong></p>\n                    <p>La Plata: Calle 47 N°717 | Palermo: Gorriti 4977</p>\n                    <p>\n                        © 2024 Osaki. Todos los derechos reservados.\n                        <br>\n                        <a href=\"https://osakisushi.com/sucursales/\" target=\"_blank\">Ver todas las sucursales</a>\n                    </p>\n                </td>\n            </tr>\n        </table>\n    </center>\n</body>\n</html>\n\n"
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        2704,
        1216
      ],
      "id": "3bfa52be-7ea4-4bdd-8529-61ecfb44ef2c",
      "name": "HTML",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c7a7b722-1cdc-4606-8482-c5271a7e8714",
              "leftValue": "={{ $('Normaliza Datos').first().json.correo.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "ab2015dd-ec4c-4a1e-ba74-90489d2927fb",
              "leftValue": "={{ $('Normaliza Datos').first().json.correo }}",
              "rightValue": "No proporcionado",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2448,
        1328
      ],
      "id": "2a97e46d-d26a-4e5d-9ad5-349d06ea0702",
      "name": "If1"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Normaliza Datos').item.json.correo || $('All Fields').item.json.correo }}",
        "subject": "=[Osaki Sushi] {{ $('Normaliza Datos').item.json.tipo }} de Cita - {{ $('All Fields').item.json.cliente }} ",
        "message": "={{ $json.html }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2880,
        1216
      ],
      "id": "b5610df6-f81c-4687-b34c-6b8e3d43fad6",
      "name": "Send a message",
      "webhookId": "d2e63633-f754-426c-a943-c723a3226bc7",
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7931de9a-83e9-4c31-81a6-58834edb9200",
              "name": "Response",
              "value": "={{\n  $('Normaliza Datos').first().json.tipo\n + \": OK\" +\n\n\"\\nNombre: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.cliente,\n  $('Get Reserv Info').item.json.cliente\n) +\n\n\"\\nReserva: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.fecha ?.slice(0,10),\n  $('Get Reserv Info').item.json.fecha_reservacion?.slice(0,10)\n)\n+ \" \"\n+ $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.hora,\n  $('Get Reserv Info').item.json.hora_reservacion\n) +\n\n\"\\nPersonas: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.personas,\n  $('Get Reserv Info').item.json.numero_personas\n) +\n\n\"\\nZona: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.zona,\n  $('Get Reserv Info').item.json.zona\n) +\n\n\"\\nCódigo: \" + $if(\n  $('All Fields').isExecuted,\n  $('All Fields').first().json.codigo_reserva,\n  $('Get Reserv Info').item.json.codigo_reserva\n) +\n\n\"\\n\\nImportante: Proporcionar el código al usuario para el seguimiento de su reservación.\"\n}}\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4656,
        1760
      ],
      "id": "13368b8c-bf1b-4291-8a78-ef4919e31ce6",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bb9644e3-019c-4cde-b54d-9373d31bb0b0",
              "leftValue": "={{ $('Normaliza Datos').first().json.tipo }}",
              "rightValue": "creacion",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "53b6b373-3544-427b-ac59-8ed0701ee7ea",
              "leftValue": "={{ $json.total_reservas }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            },
            {
              "id": "daee3ffd-d29f-4d40-a2ee-5ca8f4faf32c",
              "leftValue": "={{ $('Normaliza Datos').first().json.modo }}",
              "rightValue": "=Forzada",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "9e2993e6-ae9c-4ed0-aef5-56321c91fed8",
              "leftValue": "={{ $('Normaliza Datos').first().json.nombre_completo }}",
              "rightValue": "Invitado Osaki",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2144,
        864
      ],
      "id": "fe686c88-ec4c-4095-9db0-3e920f8bac81",
      "name": "If2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c822e4f8-2713-4f24-943a-cce25ee3761b",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nEl cliente ({{ $('Normaliza Datos').first().json.nombre_completo }}) ya cuenta con al menos una futura activa -> Verificar con el usuario.\nReservaciones encontradas:\n{{ $('Resume Encontradas').item.json.lista_reservaciones.toJsonString()}}\nSi se desea una nueva para el mismo cliente llama de nuevo a la herramienta cambiando el `modo` a \"Forzada\" (uso interno del sistema).",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2336,
        624
      ],
      "id": "91d88b5f-b73a-4ba6-b4e3-5d4a831d55b3",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '') == 'creacion' || $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '') == 'modificacion' }}",
                    "rightValue": "creacion",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "3acfaed1-14b0-4f19-a367-cf57fb0dc090"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Creación O Modificación"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8ceae83e-dffc-459c-9703-52f8ee55a2e5",
                    "leftValue": "={{ $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '')  }}",
                    "rightValue": "cancelacion",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancelación"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fa79b9b7-a498-41f2-ae82-96dc2bcd8924",
                    "leftValue": "={{ $('Normaliza Datos').item.json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '')  }}",
                    "rightValue": "confirmacion",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Confirmación"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Otro"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1248,
        1328
      ],
      "id": "3d762660-1211-4e46-a85f-9e19cfbc4f42",
      "name": "Switch"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a683569-77af-4513-838f-1090e69a084b",
              "leftValue": "={{ $json.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1088,
        1488
      ],
      "id": "075e14f7-a211-450f-80e3-074ed65eb3e1",
      "name": "If3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e67be385-8e0f-484f-ae64-daa7292020f1",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nNo se encontró ninguna reservación con el código ingresado ({{ $('Normaliza Datos').first().json.codigo_reserva }}). Favor de proporcionar un código válido. {{ $json.data[1].error ?? 'Sin errores detectados'  }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1680,
        1744
      ],
      "id": "f2df318e-84d4-44b7-9e72-6df84b46de35",
      "name": "Edit Fields4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1312,
        1744
      ],
      "id": "0dc6e65b-9c43-4396-8528-e6bcc89aee85",
      "name": "Merge1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1504,
        1744
      ],
      "id": "004336bb-393a-4ea0-b0b7-449d2f7c354d",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1b870dee-b24c-4c69-a80e-640569eb59e9",
              "leftValue": "={{ $json[\"Estado de Reservación\"] }}",
              "rightValue": "Cancelada",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1312,
        1472
      ],
      "id": "f3562853-adb6-4ae0-9372-c8704aacf3bf",
      "name": "If4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "25292be3-bf74-44c2-b93d-0ce1ba6e5469",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nLa reservación ya se encontraba Cancelada, nada que hacer",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1680,
        1456
      ],
      "id": "1ca294e4-e8c9-42b5-875f-17eb30fd567f",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a683569-77af-4513-838f-1090e69a084b",
              "leftValue": "={{ $json.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1072,
        1232
      ],
      "id": "2fa0cf00-5bf0-4b48-9a4d-3ad07547dd96",
      "name": "If5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e67be385-8e0f-484f-ae64-daa7292020f1",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nNo se encontró ninguna reservación con el id ingresado ({{ $('Normaliza Datos').first().json.codigo_reserva }}). Favor de proporcionar un código válido. {{ $json.data[1].error ?? 'Sin errores detectados'  }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1680,
        1312
      ],
      "id": "34729c1e-67e8-4b5b-b400-52bd24d7f938",
      "name": "Edit Fields7"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1296,
        1312
      ],
      "id": "8876c42d-e981-464b-922d-62d90aac0a89",
      "name": "Merge2"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1488,
        1312
      ],
      "id": "60f79ca7-69a0-4074-a1f3-94c0f1743a52",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2878d7bf-f508-4cba-b708-6fb6ff4f781d",
              "name": "fecha",
              "value": "={{ $json.fecha }}",
              "type": "string"
            },
            {
              "id": "f3f3779f-5437-4b22-830b-1fe7c4c9a705",
              "name": "hora",
              "value": "={{ $json.hora }}",
              "type": "string"
            },
            {
              "id": "0e428a9f-a2da-4f01-8164-e05f48d16576",
              "name": "cliente",
              "value": "={{ $json.cliente }}",
              "type": "string"
            },
            {
              "id": "bc9589e1-19ba-40a9-be4b-4930e2a837f1",
              "name": "personas",
              "value": "={{ $json.personas }}",
              "type": "number"
            },
            {
              "id": "a25d44c9-8c7c-4815-81b7-e6a6d92332ed",
              "name": "notas",
              "value": "={{ $json.notas }}",
              "type": "string"
            },
            {
              "id": "a31e3b72-a46c-4773-881d-c70fe4582217",
              "name": "estado",
              "value": "={{ $json.estado }}",
              "type": "string"
            },
            {
              "id": "fea67368-b880-4f6b-bd2e-832be4c86c3e",
              "name": "correo",
              "value": "={{ $json.correo }}",
              "type": "string"
            },
            {
              "id": "d745d432-6945-4edc-8827-a2c3872b552e",
              "name": "zona",
              "value": "={{ $json.zona }}",
              "type": "string"
            },
            {
              "id": "fa11193f-9906-4876-a43b-4460e43747b2",
              "name": "codigo_reserva",
              "value": "={{ $json.codigo_reserva }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2240,
        1328
      ],
      "id": "c5ce685a-d46b-4857-b76a-db557794a40d",
      "name": "All Fields"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM {{ $('Agente Principal').first().json.schema }}.reservaciones\nWHERE cliente = '{{ $('Normaliza Datos').first().json.nombre_completo }}'\nAND fecha_reservacion >= '{{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}'\nAND estado != 'Cancelada'",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1728,
        864
      ],
      "id": "804d2516-a27a-4a6d-ab70-0068ed2b119d",
      "name": "Busca Reserva",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Get Client Data').item.json.id }}",
            "total_reservaciones": "={{  $('Get Client Data').item.json.total_reservaciones + 1 }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "ult_reservacion": "={{ $('Normaliza Datos').item.json.fecha }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_bloqueo",
              "displayName": "sucursal_bloqueo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3216,
        928
      ],
      "id": "fdef9b47-d575-44c4-a978-c7a1dd675e79",
      "name": "Update rows in a table",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "where": {
          "values": [
            {
              "column": "codigo_reserva",
              "value": "={{ $('Normaliza Datos').first().json.codigo_reserva.replaceAll(' ','').trim() }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        752,
        1312
      ],
      "id": "393a490d-2af4-4660-b0ab-5ea5ec85cd66",
      "name": "Busca reservaciones1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "hora_reservacion": "={{ $('Normaliza Datos').first().json.hora }}",
            "fecha_reservacion": "={{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}",
            "estado": "Pendiente",
            "dia_semana": "={{ new Date($('Normaliza Datos').first().json.fecha).getDay() }}",
            "notas": "={{ $('Normaliza Datos').first().json.notas }}",
            "zona": "={{ $('Normaliza Datos').first().json.zona }}",
            "ubicacion": "={{ $('Normaliza Datos').first().json.ubicacion }}",
            "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "codigo_reserva": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}",
            "mesas_reserva": "={{\n  (function() {\n    const p = $('Normaliza Datos').first().json.personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
            "numero_personas": "={{ $('Normaliza Datos').first().json.personas }}"
          },
          "matchingColumns": [
            "codigo_reserva"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ubicacion",
              "displayName": "ubicacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_solicitante",
              "displayName": "telefono_solicitante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mesas_reserva",
              "displayName": "mesas_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "intento_confirmacion",
              "displayName": "intento_confirmacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Canal",
              "displayName": "Canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1296,
        1152
      ],
      "id": "db8d88f9-8494-430d-bd58-0e34148649dc",
      "name": "Actualiza Reserva",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "where": {
          "values": [
            {
              "column": "codigo_reserva",
              "value": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        896,
        1744
      ],
      "id": "3f3a01fe-349e-4427-894e-a6fa8973239d",
      "name": "Busca reservaciones",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8c5d8ee6-3764-4faa-9219-41cf43cfdb5a",
              "name": "fecha",
              "value": "={{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}",
              "type": "string"
            },
            {
              "id": "27e2aa1e-c162-40dc-b215-386d42c2a8b7",
              "name": "hora",
              "value": "={{ $('Actualiza Reserva').first().json.hora_reservacion }}",
              "type": "string"
            },
            {
              "id": "9c90660d-d6a0-4799-a7f4-3d16ee9e48fa",
              "name": "cliente",
              "value": "={{ $('Actualiza Reserva').first().json.cliente }}",
              "type": "string"
            },
            {
              "id": "98595a48-1f1c-4555-8301-3b284a1a140e",
              "name": "personas",
              "value": "={{ $('Actualiza Reserva').first().json.numero_personas }}",
              "type": "number"
            },
            {
              "id": "4d77d7ef-814e-42e0-883e-2701a6cef655",
              "name": "notas",
              "value": "={{ $('Actualiza Reserva').first().json.notas }}",
              "type": "string"
            },
            {
              "id": "615e1ded-ca87-4479-a87f-84db2eccd7b4",
              "name": "estado",
              "value": "={{ $('Actualiza Reserva').first().json.estado }}",
              "type": "string"
            },
            {
              "id": "d92abef2-e128-423a-9573-a36a45656146",
              "name": "correo",
              "value": "={{ $('Actualiza Reserva').first().json.correo || 'No proporcionado' }}",
              "type": "string"
            },
            {
              "id": "f0054bbd-48bb-43d6-b48a-e35d5818e11f",
              "name": "=zona",
              "value": "={{ $('Actualiza Reserva').first().json.zona }}",
              "type": "string"
            },
            {
              "id": "7e1e05b9-4696-455f-87fa-699857595436",
              "name": "codigo_reserva",
              "value": "={{ $('Actualiza Reserva').first().json.codigo_reserva }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1680,
        1152
      ],
      "id": "ee54f73b-98a9-4914-8381-96986f6c0e3f",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "25085d83-dbca-42c1-926e-ee68ed19cc8a",
              "name": "Response",
              "value": "Discúlpate con el usuario, te equivocaste; Informa al usuario que las reservas de 7 o más personas requiere VIP, canaliza con equipo del restaurante.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -608,
        992
      ],
      "id": "3dc8a1e6-a48e-4e5b-b05f-d65eeb183e90",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n\n// Reglas de salida única (prioridad):\n// 1) CIERRE: Lunes (\"Día\") o Ventana (\"Horario\") -> { mensaje: \"Cerrado\", motivo: \"...\", ahora: \"...\" }\n// 2) FORMATO HORA: Solo bloques de :00 o :30 -> { mensaje: \"FormatoHora\", detalle: \"Solo bloques de 30 min\", ahora: \"...\" }\n// 3) Pasado/ahora: fecha/hora <= ahora -> { mensaje: \"Pasado\", ahora: \"<...>\" }\n// 4) Futura: fecha/hora > ahora + 3 meses -> { mensaje: \"Futuro\", ahora: \"<...>\" }\n// 5) Muy próxima: (ahora, ahora + 60 min) -> { mensaje: \"Cercano\", ahora: \"<...>\" }\n// 6) Válida: devolver input original + NUEVO CAMPO 'dia_semana'.\n\nconst OFFSET_TZ_MIN = 3 * 60;    // Argentina UTC-3\nconst WINDOW_MIN = 60;           // \"Muy próxima\" = 60 minutos\nconst MAX_FUTURE_MONTHS = 3;     // Límite de meses en el futuro\n\nconst DIAS_SEMANA = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];\n\nconst CLOSED_WINDOWS = [\n  { startMin: 16 * 60,        endMin: 18 * 60 },       // 16:00–18:00\n  { startMin: 0,              endMin: 10 * 60 + 30 },  // 00:00–10:30\n];\n\n// --- FUNCIONES HELPER ---\n\nfunction parseDateParts(fechaStr) {\n  const clean = String(fechaStr || '').trim().replace(/-/g, '/');\n  const [y, m, d] = clean.split('/').map(n => parseInt(n, 10));\n  if (![y, m, d].every(Number.isFinite)) return null;\n  return { y, m, d };\n}\n\nfunction parseTimeParts(horaStr) {\n  const parts = String(horaStr || '').trim().split(':');\n  const hh = parseInt(parts[0], 10);\n  const mm = parseInt(parts[1] ?? '0', 10);\n  if (![hh, mm].every(Number.isFinite)) return null;\n  return { hh, mm };\n}\n\n// [NUEVO] Valida si los minutos son 00 o 30\nfunction isValidMinuteBlock(horaStr) {\n  const t = parseTimeParts(horaStr);\n  if (!t) return false;\n  return t.mm === 0 || t.mm === 30;\n}\n\nfunction toUtcMsFromARG(fechaStr, horaStr) {\n  const d = parseDateParts(fechaStr);\n  const t = parseTimeParts(horaStr);\n  if (!d || !t) return NaN;\n  return Date.UTC(d.y, d.m - 1, d.d, t.hh + Math.floor(OFFSET_TZ_MIN / 60), t.mm, 0, 0);\n}\n\nfunction getDiaSemanaNombre(fechaStr) {\n  const d = parseDateParts(fechaStr);\n  if (!d) return null;\n  const dow = new Date(Date.UTC(d.y, d.m - 1, d.d)).getUTCDay(); \n  return DIAS_SEMANA[dow];\n}\n\nfunction isWithinClosedWindow(horaStr) {\n  const mins = (t => t ? t.hh * 60 + t.mm : null)(parseTimeParts(horaStr));\n  if (mins == null) return false;\n  return CLOSED_WINDOWS.some(w => mins >= w.startMin && mins < w.endMin);\n}\n\nfunction pad2(n){ return n < 10 ? '0' + n : '' + n; }\n\nfunction nowARGString() {\n  const d = new Date(Date.now() - OFFSET_TZ_MIN * 60 * 1000);\n  return `${d.getUTCFullYear()}-${pad2(d.getUTCMonth() + 1)}-${pad2(d.getUTCDate())} ${pad2(d.getUTCHours())}:${pad2(d.getUTCMinutes())}`;\n}\n\n// --- LÓGICA PRINCIPAL ---\n\nconst items = await $input.all();\nconst nowUtcMs = Date.now();\nconst soonLimitUtcMs = nowUtcMs + WINDOW_MIN * 60 * 1000;\nconst ahora = nowARGString();\n\nconst futureLimitDate = new Date();\nfutureLimitDate.setMonth(futureLimitDate.getMonth() + MAX_FUTURE_MONTHS);\nconst futureLimitUtcMs = futureLimitDate.getTime();\n\nlet motivoCierre = null; \nlet hasInvalidBlock = false;\nlet hasPastOrNow = false;\nlet hasFuture = false;\nlet hasSoon = false;\n\nfor (const item of items) {\n  const { fecha, hora } = item.json || {};\n  const nombreDia = getDiaSemanaNombre(fecha);\n  \n  if (item.json) item.json.dia_semana = nombreDia;\n\n  // Regla 1: CIERRE\n  if (nombreDia === 'Lunes') { motivoCierre = 'Lunes'; break; }\n  if (isWithinClosedWindow(hora)) { motivoCierre = 'Horario'; break; }\n\n  // Regla 2: [NUEVA] Validación de bloques de 30 min\n  if (!isValidMinuteBlock(hora)) {\n    hasInvalidBlock = true;\n    break;\n  }\n\n  const targetUtcMs = toUtcMsFromARG(fecha, hora);\n\n  // Regla 3: Pasado\n  if (!Number.isFinite(targetUtcMs) || targetUtcMs <= nowUtcMs) { hasPastOrNow = true; break; }\n\n  // Regla 4: Futura\n  if (targetUtcMs > futureLimitUtcMs) { hasFuture = true; break; }\n\n  // Regla 5: Muy próxima\n  if (targetUtcMs < soonLimitUtcMs) { hasSoon = true; }\n}\n\n// Retornos por prioridad\nif (motivoCierre) return [{ json: { mensaje: 'Cerrado', motivo: motivoCierre, ahora } }];\nif (hasInvalidBlock) return [{ json: { mensaje: 'FormatoHora', detalle: 'Solo se aceptan bloques de 00 o 30 minutos', ahora } }];\nif (hasPastOrNow) return [{ json: { mensaje: 'Pasado', ahora } }];\nif (hasFuture) return [{ json: { mensaje: 'Futuro', ahora } }];\nif (hasSoon) return [{ json: { mensaje: 'Cercano', ahora } }];\n\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        768
      ],
      "id": "4c8126ab-01a3-43ad-bd30-e92b31293e3e",
      "name": "Revisa Horarios"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.mensaje }}",
                    "rightValue": "=Cercano",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "3668be81-2050-40ba-983a-a1691781e241"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cercano"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2b3c51f2-6658-49d8-b10c-fdf9fe863332",
                    "leftValue": "={{ $json.mensaje }}",
                    "rightValue": "Pasado",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Pasado"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "565499bf-bb35-4ed0-9b71-699f5eec818f",
                    "leftValue": "={{ $json.mensaje }}",
                    "rightValue": "Cerrado",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cerrado"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1ede6c35-793e-4269-878a-325791500ea1",
                    "leftValue": "={{ $json.mensaje }}",
                    "rightValue": "Futuro",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Futuro"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a8e5178e-b0e4-4276-afa8-502624efcab7",
                    "leftValue": "={{ $json.mensaje }}",
                    "rightValue": "FormatoHora",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Formato Hora"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "OK"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -416,
        720
      ],
      "id": "2e16a090-e464-41dc-84ea-08be1578518a",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    v.zona_obj as zona,\n    coalesce(SUM(r.mesas_reserva),0) as num_mesas,        -- Cuenta coincidencias reales\n    COALESCE(SUM(r.numero_personas), 0) as num_personas -- Pone 0 si es NULL\nFROM (VALUES ('Salón'), ('Barra')) AS v(zona_obj)  -- 1. Definimos las zonas obligatorias\nLEFT JOIN {{ $('Agente Principal').first().json.schema }}.reservaciones r \n    ON v.zona_obj = r.zona \n    AND r.fecha_reservacion = $1         -- 2. El filtro de fecha va AQUÍ, no en el WHERE\n    AND EXTRACT(HOUR FROM hora_reservacion) = $2  \n    AND r.estado != 'Cancelada'\nGROUP BY v.zona_obj;",
        "options": {
          "queryReplacement": "={{ $json.fecha }},{{ $json.hora.split(\":\")[0] }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        752,
        864
      ],
      "id": "b5006741-230a-48d8-a0e3-53ee52005f58",
      "name": "Calcula Ocupación",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c0cb9b0f-8e5c-441d-9163-633c69645a35",
              "leftValue": "={{ ($('Normaliza Datos').first().json.zona == \"Salón\" && ($json[\"Salón\"].num_mesas) >= 12 ) ||  ($('Normaliza Datos').first().json.zona == \"Barra\" && ($json[\"Barra\"].num_personas) >= 12 ) }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1216,
        864
      ],
      "id": "87b4fb03-0146-4478-874e-bb07b4487a6e",
      "name": "Lleno?"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nOcupaciones llenas en \"{{ $('Normaliza Datos').first().json.zona }}\" para reservaciones a las {{ $('Normaliza Datos').first().json.hora }}. Sugiere otra zona, fecha u horario. Si es día de evento ofrece otra fecha para la siguiente semana u otro día, revisa horarios de las promociones/eventos. \nOcupación Actual:\nBarra: {{ $json.Barra.num_personas }}/12 (personas)\nSalón: {{ $json[\"Salón\"].num_mesas }}/12 (mesas)\n\n\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1504,
        720
      ],
      "id": "569e9410-ba85-47ba-bea2-1e62559b39c7",
      "name": "Response Lleno"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c42f423-efec-448c-989c-86a47f11bda7",
              "leftValue": "={{ /^OSK-\\d{6}-[A-Z]{4}$/.test($('Normaliza Datos').first().json.codigo_reserva) }}",
              "rightValue": "=",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        416,
        1664
      ],
      "id": "b92ddc8f-0ab9-4dff-ab48-99236519e73e",
      "name": "If8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cc33b4df-2fae-4854-9644-7eb8df6236b2",
              "name": "Response",
              "value": "No proporcionaste un código válido, p. ej. \"OSK-YYMMDD-XXXX\". Corrige y vuelve a llamar a la herramienta.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        768,
        1552
      ],
      "id": "d4594a69-6556-4f75-af2d-e152df6eab9c",
      "name": "Edit Fields10"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "166d3778-c7a9-4e0d-8e5d-9c9a2f6da6b4",
              "leftValue": "={{ $json.personas }}",
              "rightValue": 6,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1296,
        768
      ],
      "id": "0104a6ee-e95f-40de-adb1-ac4e1c24639b",
      "name": "Menos de 7?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "145a515a-382f-44a6-a14c-e0e33bf22e1f",
              "leftValue": "={{ ['barra', 'salon'].includes(\n    $('Normaliza Datos').item.json.zona\n        .toLowerCase()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '')\n        .replace(/[^a-z]/g, '')\n)}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        832
      ],
      "id": "8763c37c-4e04-461e-889f-dde9779347bd",
      "name": "If6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Elegiste una zona que no existe. Las únicas disponibles son \"Salón\" y \"Barra\". Si son más de 6 se habilita una zona \"VIP\" por medio de gestión con el equipo  del restaurante.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        480
      ],
      "id": "bfd2c4c4-0a98-4756-9ea1-4ebc7c631918",
      "name": "Response No Zona"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Elegiste un {{ $json.motivo }} en el que el local está cerrado. Hora actual es {{ $('Revisa Horarios').item.json.ahora }}. Sugiere otra fecha u horario.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        -16
      ],
      "id": "a48dbdd6-933e-4b28-b07a-9f159a05a91e",
      "name": "Response Local Cerrado"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones no se pueden hacer hacía el pasado. Hora actual es {{ $json.ahora }}. Sugiere otra fecha u horario.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        -128
      ],
      "id": "cbeba0dc-0c22-4331-9c65-1521bf0a674d",
      "name": "Response Fecha Pasada"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones mínimas hacen para dentro de 1 hora hacía delante. Hora actual es {{ $('Revisa Horarios').item.json.ahora }}. Sugiere otra fecha u horario. Procura usar horas cerradas. Revisa horarios de atención.",
              "type": "string"
            },
            {
              "id": "35ddc4c7-c99f-4794-82b9-937a19825c22",
              "name": "ahora",
              "value": "=",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        -240
      ],
      "id": "e8409aaf-28a2-46dd-b51b-c88ad2ca5afa",
      "name": "Response Fecha Cercana"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Agente Principal').first().json.cliente_id }}",
            "intencion": "Información",
            "ult_reservacion": "={{ $('All Fields').item.json.fecha }}",
            "pregunta_verifica_reserva": false
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3136,
        1520
      ],
      "id": "30c65a1c-63e8-4444-9f89-7a2826577456",
      "name": "Actualiza Cliente a Info",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones no se pueden hacer más de 3 meses en el futuro. Hora actual es {{ $json.ahora }}. Sugiere otra fecha y horario.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        336,
        112
      ],
      "id": "af6d0f97-6c5c-45c5-9482-41ba311c02c0",
      "name": "Response Nombre Incompleto"
    },
    {
      "parameters": {
        "operation": "remove",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Normaliza Datos').first().json.fecha ||  $('Get Reserv Info').item.json.fecha_formateada }}",
          "mode": "name"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3456,
        1760
      ],
      "id": "5a2a5dde-fe72-4876-930c-fabf7ed72474",
      "name": "Delete sheet",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c42f423-efec-448c-989c-86a47f11bda7",
              "leftValue": "={{ /^OSK-\\d{6}-[A-Z]{4}$/.test($('Normaliza Datos').first().json.codigo_reserva) }}",
              "rightValue": "=",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        432,
        1328
      ],
      "id": "bf85ee51-f22a-4efd-bf7d-1424483b7038",
      "name": "Codigo Reserva Valido?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b1b8ede7-4405-458b-9fbc-2389cc05040a",
              "leftValue": "={{ $('Normaliza Datos').first().json.tipo.replace(/ó/g, 'o').toLowerCase().replace(/\\s/g, '') == 'creacion' }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1440,
        880
      ],
      "id": "df589cd6-42ff-4e50-a2a1-2e38707ed765",
      "name": "Es Creación?"
    },
    {
      "parameters": {
        "jsCode": "// 1. Inicializamos el objeto vacío donde guardaremos los resultados\nconst resultado = {};\n\n// 2. Iteramos sobre todos los items que llegaron del nodo anterior\nfor (const item of $input.all()) {\n  const data = item.json;\n  \n  // Verificamos que la zona exista para evitar errores\n  if (data.zona) {\n    // 3. Asignamos la zona como clave (ej: \"Salón\" o \"Barra\")\n    resultado[data.zona] = {\n      num_mesas: data.num_mesas,\n      num_personas: data.num_personas\n    };\n  }\n}\n\n// 4. Retornamos el resultado en el formato estándar de n8n\nreturn [ { json: resultado } ];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        864
      ],
      "id": "166e2390-72c4-4b28-b74a-4ae6c0fbcaae",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    v.zona_obj as zona,\n    coalesce(SUM(r.mesas_reserva),0) as num_mesas,        -- Cuenta coincidencias reales\n    COALESCE(SUM(r.numero_personas), 0) as num_personas -- Pone 0 si es NULL\nFROM (VALUES ('Salón'), ('Barra')) AS v(zona_obj)  -- 1. Definimos las zonas obligatorias\nLEFT JOIN {{ $('Agente Principal').first().json.schema }}.reservaciones r \n    ON v.zona_obj = r.zona \n    AND r.fecha_reservacion = $1         -- 2. El filtro de fecha va AQUÍ, no en el WHERE\n    AND EXTRACT(HOUR FROM hora_reservacion) >=21  \n    AND r.estado != 'Cancelada'\nGROUP BY v.zona_obj;",
        "options": {
          "queryReplacement": "={{ $json.fecha }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        752,
        672
      ],
      "id": "aea2588c-57ac-4fea-9b75-88982259d032",
      "name": "Calcula Ocupación1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. Inicializamos el objeto vacío donde guardaremos los resultados\nconst resultado = {};\n\n// 2. Iteramos sobre todos los items que llegaron del nodo anterior\nfor (const item of $input.all()) {\n  const data = item.json;\n  \n  // Verificamos que la zona exista para evitar errores\n  if (data.zona) {\n    // 3. Asignamos la zona como clave (ej: \"Salón\" o \"Barra\")\n    resultado[data.zona] = {\n      num_mesas: data.num_mesas,\n      num_personas: data.num_personas\n    };\n  }\n}\n\n// 4. Retornamos el resultado en el formato estándar de n8n\nreturn [ { json: resultado } ];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        672
      ],
      "id": "2f3769f5-4b77-4cd4-9fd3-11993d29f275",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c0cb9b0f-8e5c-441d-9163-633c69645a35",
              "leftValue": "={{ ($('Normaliza Datos').first().json.zona == \"Salón\" && ($json[\"Salón\"].num_mesas) >= 12 ) ||  ($('Normaliza Datos').first().json.zona == \"Barra\" && ($json[\"Barra\"].num_personas) >= 12 ) }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1216,
        672
      ],
      "id": "1241348a-8cb6-47a4-9000-69802a0655df",
      "name": "Lleno?1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nOcupaciones llenas en \"{{ $('Normaliza Datos').first().json.zona }}\" para el evento. Ofrece otra fecha o zona si hay disponible, revisa horarios y fechas de las promociones/eventos. \nOcupación Actual:\nBarra: {{ $json.Barra.num_personas }}/16 (personas)\nSalón: {{ $json[\"Salón\"].num_mesas }}/12 (mesas)\n\n\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1504,
        528
      ],
      "id": "6f732ef2-29ae-4104-b893-e0f4a019cf56",
      "name": "Response Lleno1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "59ed34f2-56f2-4d29-8469-866100e4b4e2",
              "name": "Response",
              "value": "=Cambia la intención a \"Reservación\" y confirma los datos para la reservación de nuevo. Revisa el llamado a esta herramienta. Mensaje Interno: {{ $json.detalles }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -128,
        2256
      ],
      "id": "4244a5f3-fc21-4afe-bb84-731edad1a816",
      "name": "Edit Fields11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4c00a43b-e339-45c6-bcbe-7bba4aa6e8f8",
              "leftValue": "={{ $json.hora.split(\":\")[0].toNumber() }}",
              "rightValue": 21,
              "operator": {
                "type": "number",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        432,
        656
      ],
      "id": "cec68618-696b-42b2-8daa-e94c7554afc7",
      "name": "If9"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. El evento Sushi Libre solo admite reservaciones a las 21 hrs con hasta 15 min de tolerancia.\nOcupación Actual:\nBarra: {{ $json.Barra.num_personas }}/12 (personas)\nSalón: {{ $json[\"Salón\"].num_mesas }}/12 (mesas)\n\n\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1200,
        448
      ],
      "id": "a2609503-d7f0-45e0-8808-e3111c4f2c12",
      "name": "Response No Zona1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a5a8173a-0304-48f7-9dfb-2f17d6b6ed17",
              "leftValue": "={{ $json.evento }}",
              "rightValue": "Sushi Libre",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "8532c9e3-c169-491a-bf94-7013d4d2e85e",
              "leftValue": "={{ $json.dia_semana =='Miércoles' && ( $json.hora.split(\":\")[0].toNumber()>=21  || ( $json.hora.split(\":\")[0].toNumber()>=20 &&  $json.hora.split(\":\")[1].toNumber()>=30) )  }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        208,
        848
      ],
      "id": "0cc2cbed-4812-46f8-8eb7-52cef799804e",
      "name": "Sushi Libre?"
    },
    {
      "parameters": {
        "operation": "create",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "title": "={{ $('Normaliza Datos').first().json.fecha ||  $('Get Reserv Info').item.json.fecha_formateada }}",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3696,
        1760
      ],
      "id": "5298d9d7-4462-4911-adac-f24889425a68",
      "name": "Create sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\nSELECT \n    codigo_reserva, \n    cliente, \n    fecha_reservacion::text, \n    hora_reservacion::text, \n    CASE EXTRACT(DOW FROM fecha_reservacion)\n        WHEN 0 THEN 'Domingo'\n        WHEN 1 THEN 'Lunes'\n        WHEN 2 THEN 'Martes'\n        WHEN 3 THEN 'Miércoles'\n        WHEN 4 THEN 'Jueves'\n        WHEN 5 THEN 'Viernes'\n        WHEN 6 THEN 'Sábado'\n    END AS dia_semana,\n    numero_personas, \n    mesas_reserva as mesas_sugeridas,\n    zona, \n    email_contacto,\n    telefono_contacto,  \n    estado,\n  notas,\n  'No' as actualiza_base,\n    TO_CHAR(created_at, 'YYYY-MM-DD HH24:MI:SS') AS created_at\nFROM {{ $('Agente Principal').first().json.schema }}.reservaciones \n  WHERE fecha_reservacion = '{{ $('Normaliza Datos').first().json.fecha || $('Get Reserv Info').item.json.fecha_formateada}}'  \norder by estado asc, zona desc, hora_reservacion asc, id asc ;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3952,
        1760
      ],
      "id": "f3bcab91-8a11-4dcc-b25b-d5c16f1822f6",
      "name": "Get Reserv",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/16_ULxHa4l-N5DHhhpIkytQdPY0hPqZF6_E2Xcu83_S0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Normaliza Datos').first().json.fecha || $('Get Reserv Info').item.json.fecha_formateada }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "mesas_sugeridas",
              "displayName": "mesas_sugeridas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "actualiza_base",
              "displayName": "actualiza_base",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4224,
        1760
      ],
      "id": "fef7b5aa-9583-4f6f-b945-1d6d71c7274d",
      "name": "Llena Documento",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OnTQvkOeBX8Kq3DU",
          "name": "Google Sheets Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4432,
        1760
      ],
      "id": "5dd671c2-2d90-4935-b565-ab940dfd18b9",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    v.zona_obj as zona,\n    coalesce(SUM(r.mesas_reserva),0) as num_mesas,        -- Cuenta coincidencias reales\n    COALESCE(SUM(r.numero_personas), 0) as num_personas -- Pone 0 si es NULL\nFROM (VALUES ('Salón'), ('Barra')) AS v(zona_obj)  -- 1. Definimos las zonas obligatorias\nLEFT JOIN {{ $('Agente Principal').first().json.schema }}.reservaciones r \n    ON v.zona_obj = r.zona \n    AND r.fecha_reservacion = $1         -- 2. El filtro de fecha va AQUÍ, no en el WHERE\n    AND EXTRACT(HOUR FROM hora_reservacion) >=21\nGROUP BY v.zona_obj;",
        "options": {
          "queryReplacement": "={{ $json.fecha }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        800,
        448
      ],
      "id": "94979a92-3aac-4c31-a47c-04a67f114bf9",
      "name": "Calcula Ocupación2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// 1. Inicializamos el objeto vacío donde guardaremos los resultados\nconst resultado = {};\n\n// 2. Iteramos sobre todos los items que llegaron del nodo anterior\nfor (const item of $input.all()) {\n  const data = item.json;\n  \n  // Verificamos que la zona exista para evitar errores\n  if (data.zona) {\n    // 3. Asignamos la zona como clave (ej: \"Salón\" o \"Barra\")\n    resultado[data.zona] = {\n      num_mesas: data.num_mesas,\n      num_personas: data.num_personas\n    };\n  }\n}\n\n// 4. Retornamos el resultado en el formato estándar de n8n\nreturn [ { json: resultado } ];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        992,
        448
      ],
      "id": "3ab5edc6-3b97-432b-bcc3-65e6fc4ccc3e",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3c42f423-efec-448c-989c-86a47f11bda7",
              "leftValue": "={{ /^OSK-\\d{6}-[A-Z]{4}$/.test($('Normaliza Datos').first().json.codigo_reserva) }}",
              "rightValue": "=",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        336,
        2032
      ],
      "id": "f2e74331-dffa-4fc2-83f5-9b1efc61ae65",
      "name": "Codigo Reserva Valido?1"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "where": {
          "values": [
            {
              "column": "codigo_reserva",
              "value": "={{ $('Normaliza Datos').first().json.codigo_reserva.replaceAll(' ','').trim() }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        752,
        2304
      ],
      "id": "1f7c1639-042c-4a7c-b01c-f34e0f98c1f3",
      "name": "Busca reservaciones2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a683569-77af-4513-838f-1090e69a084b",
              "leftValue": "={{ $json.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        976,
        2176
      ],
      "id": "580e5837-3075-45d7-9e24-ae59faaa3b6a",
      "name": "If10"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e67be385-8e0f-484f-ae64-daa7292020f1",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nNo se encontró ninguna reservación con el código ingresado ({{ $('Normaliza Datos').first().json.codigo_reserva }}). Favor de proporcionar un id válido. {{ $json.data[1].error ?? 'Sin errores detectados'  }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1632,
        2304
      ],
      "id": "7bbd2b42-bbb2-4ebd-8a09-f64150ee690b",
      "name": "Edit Fields12"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1248,
        2304
      ],
      "id": "af7a189e-7285-4bde-908b-4ee15d9390bc",
      "name": "Merge3"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1440,
        2304
      ],
      "id": "2b5855c5-1b78-42c9-b6e2-d4774a8e1a71",
      "name": "Aggregate4"
    },
    {
      "parameters": {
        "jsCode": "// Configuración: Usamos el nombre oficial de la zona horaria (IANA)\n// Esto maneja automáticamente cambios de horario de verano/invierno si ocurren.\nconst timeZone = 'America/Argentina/Buenos_Aires';\n\nfor (const item of $input.all()) {\n\n  const fechaRaw = item.json.fecha_reservacion; // \"2025-12-04T00:00:00...\"\n  const horaRaw = item.json.hora_reservacion;   // \"22:00:00\"\n\n  if (fechaRaw && horaRaw) {\n    // -----------------------------------------------------------\n    // PASO 1: Normalizar la Fecha Objetivo (Reserva)\n    // -----------------------------------------------------------\n    // Extraemos YYYY-MM-DD\n    const fechaSolo = fechaRaw.split('T')[0];\n    \n    // Creamos una fecha \"ficticia\" en UTC con los datos de la reserva\n    // Le agregamos la 'Z' para forzar a JS a creer que es UTC.\n    // Hacemos esto para tener un punto de comparación matemático neutro.\n    const targetDateISO = `${fechaSolo}T${horaRaw}Z`; \n    const targetDate = new Date(targetDateISO);\n\n    // -----------------------------------------------------------\n    // PASO 2: Obtener la Hora Actual en Argentina Dinámicamente\n    // -----------------------------------------------------------\n    const now = new Date();\n\n    // Usamos Intl para descomponer la hora actual según la zona horaria de Argentina\n    const formatter = new Intl.DateTimeFormat('en-US', {\n      timeZone: timeZone,\n      year: 'numeric', month: '2-digit', day: '2-digit',\n      hour: '2-digit', minute: '2-digit', second: '2-digit',\n      hour12: false\n    });\n\n    // Extraemos las partes (año, mes, dia, hora...) de la hora actual argentina\n    const parts = formatter.formatToParts(now);\n    const mapping = {};\n    parts.forEach(p => mapping[p.type] = p.value);\n\n    // Reconstruimos la fecha actual de Argentina como si fuera UTC (para que coincida con el Paso 1)\n    // Formato: YYYY-MM-DDTHH:mm:ssZ\n    const nowArgISO = `${mapping.year}-${mapping.month}-${mapping.day}T${mapping.hour}:${mapping.minute}:${mapping.second}Z`;\n    const nowArgDate = new Date(nowArgISO);\n\n    // -----------------------------------------------------------\n    // PASO 3: Calcular Diferencia\n    // -----------------------------------------------------------\n    // Al restar dos objetos Date, obtenemos milisegundos\n    const diffMs = targetDate - nowArgDate;\n    const diferenciaHoras = diffMs / (1000 * 60 * 60);\n\n    // -----------------------------------------------------------\n    // PASO 4: Tu Lógica de Negocio\n    // -----------------------------------------------------------\n    \n    // Si la diferencia es positiva (futuro) Y es menor a 1 hora\n    if (diferenciaHoras > 0 && diferenciaHoras < 1) {\n      item.json.mensaje_validacion = \"Todo es correcto (Menor a 1h)\";\n      item.json.procede_actualizacion = \"Sí\";\n    \n    } else if (diferenciaHoras <= 0) {\n      item.json.mensaje_validacion = \"No es posible de confirmar (La reservación ya pasó: \"+targetDateISO+\")\";\n      item.json.procede_actualizacion = \"No\";\n      \n    } else {\n      item.json.mensaje_validacion = \"Informa al usuario que la reserva está asegurada pero la confirmación aún no es posible (Falta más de 1h).\";\n      item.json.procede_actualizacion = \"No\";\n    }\n\n    // Debug (opcional)\n    item.json.debug_target = targetDateISO;\n    item.json.debug_now_arg = nowArgISO;\n    item.json.debug_diff = diferenciaHoras;\n\n  } else {\n    item.json.mensaje_validacion = \"Error: Faltan datos\";\n    item.json.procede_actualizacion = \"No\";\n  }\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1248,
        2032
      ],
      "id": "ac51b551-71c4-47c1-880d-260aca0cac91",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2b6afc51-55ff-4eb3-ba94-db89d55b8170",
              "leftValue": "={{ $json.procede_actualizacion }}",
              "rightValue": "Sí",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1456,
        2032
      ],
      "id": "2473e5af-5678-4b27-b1dc-2574d13cb70e",
      "name": "If7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8c5d8ee6-3764-4faa-9219-41cf43cfdb5a",
              "name": "Response",
              "value": "={{ $json.mensaje_validacion }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1696,
        2128
      ],
      "id": "83484619-c57d-4958-b69a-50f08b2c5ff1",
      "name": "Edit Fields14"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Agente Principal').first().json.cliente_id }}",
            "intencion": "Información",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal_bloqueo",
              "displayName": "sucursal_bloqueo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        3136,
        1760
      ],
      "id": "477dcbea-af8e-458e-b382-7cd026f9a392",
      "name": "Actualiza Cliente a Info2",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  const fechaOriginal = item.json.fecha_reservacion;\n\n  // Convertir a YYYY-MM-DD\n  const fechaFormateada = new Date(fechaOriginal).toISOString().slice(0, 10);\n\n  item.json.fecha_formateada = fechaFormateada;\n}\n\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2528,
        1760
      ],
      "id": "e78ef911-7ce1-4164-b35e-07a097fe7d91",
      "name": "Get Reserv Info"
    },
    {
      "parameters": {
        "jsCode": "// Obtiene todos los items\nconst items = $input.all();\n\n// --- CORRECCIÓN AQUÍ ---\n// Filtramos para quedarnos solo con los items que tengan datos reales (por ejemplo, que tengan \"id\")\nconst itemsReales = items.filter(item => item.json.id);\n\n// 1. Calcular la cantidad basándonos en los items REALES\nconst cantidad = itemsReales.length;\n\n// 2. Crear la lista y formatear la fecha usando solo los items reales\nconst listaDetalles = itemsReales.map(item => {\n  const fechaRaw = item.json.fecha_reservacion;\n  // Cortamos el string en la 'T' para obtener YYYY-MM-DD\n  const fechaFormateada = fechaRaw ? fechaRaw.split('T')[0] : null;\n  // const codigo = item.json.codigo_reserva;\n\n  return {\n    fecha: fechaFormateada, \n    hora: item.json.hora_reservacion,\n    codigo: item.json.codigo_reserva\n  };\n});\n\n// 3. Devolver resultado\nreturn [\n  {\n    json: {\n      total_reservas: cantidad,\n      lista_reservaciones: listaDetalles\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1936,
        864
      ],
      "id": "cc268b70-d6ee-4535-adc1-637a1b4b66cb",
      "name": "Resume Encontradas"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.personas }}",
                    "rightValue": 6,
                    "operator": {
                      "type": "number",
                      "operation": "lte"
                    },
                    "id": "d24457f4-836e-4ed0-baea-22e7341dffea"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Menos 6"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "eb7032c9-ba2f-458d-aa8a-a0dbe4ead1dd",
                    "leftValue": "={{ $json.personas }}",
                    "rightValue": 6,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "VIP"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Otro"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -1040,
        976
      ],
      "id": "de34f8a5-fed9-45c8-9025-a84770775ed2",
      "name": "Switch2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "25085d83-dbca-42c1-926e-ee68ed19cc8a",
              "name": "Response",
              "value": "No se proporcionaron todos los datos que usa la herramienta, corrige y llámala de nuevo.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -608,
        1184
      ],
      "id": "7570b9fa-2635-4b6e-b0c8-1b2e8ee9966b",
      "name": "Edit Fields13"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "osaki_main",
          "mode": "list",
          "cachedResultName": "osaki_main"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ $('Agente Principal').first().json.cliente_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2672,
        928
      ],
      "id": "14905efc-d44b-466f-8174-51ae1f207e5b",
      "name": "Get Client Data",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "hora_reservacion": "={{ $('Normaliza Datos').first().json.hora }}",
            "fecha_reservacion": "={{ (raw => {\n  const d = new Date(raw);\n  return `${d.getUTCFullYear()}-${String(d.getUTCMonth()+1).padStart(2,'0')}-${String(d.getUTCDate()).padStart(2,'0')}`;\n})($('Normaliza Datos').first().json.fecha) }}",
            "cliente": "={{ $('Normaliza Datos').first().json.nombre_completo }}",
            "numero_personas": "={{ $('Normaliza Datos').first().json.personas }}",
            "estado": "Pendiente",
            "dia_semana": "={{ new Date($('Normaliza Datos').first().json.fecha).getDay() }}",
            "email_contacto": "={{ $('Normaliza Datos').first().json.correo}}",
            "telefono_contacto": "={{ $('Normaliza Datos').first().json.telefono}}",
            "notas": "={{ $('Normaliza Datos').first().json.notas || 'Ninguna' }}",
            "zona": "={{ $('Normaliza Datos').first().json.zona  }}",
            "ubicacion": "={{ $('Normaliza Datos').first().json.ubicacion  }}",
            "telefono_solicitante": "={{ $('Agente Principal').first().json.telefono_solicita  }}",
            "created_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "codigo_reserva": "={{ `OSK-${new Date().toLocaleDateString('sv-SE', { timeZone: 'America/Argentina/Buenos_Aires' }).slice(2).replace(/-/g, '')}-${Array.from({length: 4}, () => String.fromCharCode(65 + Math.floor(Math.random() * 26))).join('')}` }}",
            "mesas_reserva": "={{\n  (function() {\n    const p = $('Normaliza Datos').first().json.personas;\n    return p <= 2 ? 1 : p <= 4 ? 2 : 3;\n  })()\n}}",
            "Canal": "WhatsApp"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ubicacion",
              "displayName": "ubicacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono_solicitante",
              "displayName": "telefono_solicitante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mesas_reserva",
              "displayName": "mesas_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "intento_confirmacion",
              "displayName": "intento_confirmacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Canal",
              "displayName": "Canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2448,
        928
      ],
      "id": "88545167-067e-44ea-9bf2-7ed3ee6ae73c",
      "name": "Crea Reserva Postgres",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "apprK9MtBIY9lyLQT",
          "mode": "list",
          "cachedResultName": "Sistema Osaki",
          "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT"
        },
        "table": {
          "__rl": true,
          "value": "tbls1xSwHHWBarhDd",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT/tbls1xSwHHWBarhDd"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Código": "={{ $('Crea Reserva Postgres').item.json.codigo_reserva }}",
            "Nombre": "={{ $('Normaliza Datos').first().json.nombre_completo }}",
            "Fecha": "={{ $('Crea Reserva Postgres').item.json.fecha_reservacion }}",
            "Hora": "={{ $('Normaliza Datos').first().json.hora }}",
            "Personas": "={{ $('Normaliza Datos').first().json.personas }}",
            "Zona": "={{ $('Normaliza Datos').first().json.zona }}",
            "Teléfono": "={{ $('Normaliza Datos').item.json.telefono.toNumber() }}",
            "Estado": "Pendiente",
            "Notas": "={{ $('Normaliza Datos').item.json.notas }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Código",
              "displayName": "Código",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Fecha",
              "displayName": "Fecha",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Hora",
              "displayName": "Hora",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "11:00",
                  "value": "11:00"
                },
                {
                  "name": "11:30",
                  "value": "11:30"
                },
                {
                  "name": "12:00",
                  "value": "12:00"
                },
                {
                  "name": "12:30",
                  "value": "12:30"
                },
                {
                  "name": "13:00",
                  "value": "13:00"
                },
                {
                  "name": "13:30",
                  "value": "13:30"
                },
                {
                  "name": "14:00",
                  "value": "14:00"
                },
                {
                  "name": "14:30",
                  "value": "14:30"
                },
                {
                  "name": "15:00",
                  "value": "15:00"
                },
                {
                  "name": "18:00",
                  "value": "18:00"
                },
                {
                  "name": "18:30",
                  "value": "18:30"
                },
                {
                  "name": "19:00",
                  "value": "19:00"
                },
                {
                  "name": "19:30",
                  "value": "19:30"
                },
                {
                  "name": "20:00",
                  "value": "20:00"
                },
                {
                  "name": "20:30",
                  "value": "20:30"
                },
                {
                  "name": "21:00",
                  "value": "21:00"
                },
                {
                  "name": "21:30",
                  "value": "21:30"
                },
                {
                  "name": "22:00",
                  "value": "22:00"
                },
                {
                  "name": "22:30",
                  "value": "22:30"
                },
                {
                  "name": "Hora",
                  "value": "Hora"
                },
                {
                  "name": "21:15",
                  "value": "21:15"
                },
                {
                  "name": "22:15",
                  "value": "22:15"
                },
                {
                  "name": "21:45",
                  "value": "21:45"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Personas",
              "displayName": "Personas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Zona",
              "displayName": "Zona",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Barra",
                  "value": "Barra"
                },
                {
                  "name": "Salón",
                  "value": "Salón"
                },
                {
                  "name": "VIP",
                  "value": "VIP"
                },
                {
                  "name": "null",
                  "value": "null"
                },
                {
                  "name": "2216140642",
                  "value": "2216140642"
                },
                {
                  "name": "2215646765",
                  "value": "2215646765"
                },
                {
                  "name": "2216806616",
                  "value": "2216806616"
                },
                {
                  "name": "2212201826",
                  "value": "2212201826"
                },
                {
                  "name": "2314463724",
                  "value": "2314463724"
                },
                {
                  "name": "1131492908",
                  "value": "1131492908"
                },
                {
                  "name": "1126883023",
                  "value": "1126883023"
                },
                {
                  "name": "2215055545",
                  "value": "2215055545"
                },
                {
                  "name": "2215526719",
                  "value": "2215526719"
                },
                {
                  "name": "2216524170",
                  "value": "2216524170"
                },
                {
                  "name": "1155166182",
                  "value": "1155166182"
                },
                {
                  "name": "2215593494",
                  "value": "2215593494"
                },
                {
                  "name": "2214350124",
                  "value": "2214350124"
                },
                {
                  "name": "2216378878",
                  "value": "2216378878"
                },
                {
                  "name": "2216412836",
                  "value": "2216412836"
                },
                {
                  "name": "2213608320",
                  "value": "2213608320"
                },
                {
                  "name": "2344401322",
                  "value": "2344401322"
                },
                {
                  "name": "2216126708",
                  "value": "2216126708"
                },
                {
                  "name": "2214948349",
                  "value": "2214948349"
                },
                {
                  "name": "1164591361",
                  "value": "1164591361"
                },
                {
                  "name": "2215313060",
                  "value": "2215313060"
                },
                {
                  "name": "2215959952",
                  "value": "2215959952"
                },
                {
                  "name": "2216696898",
                  "value": "2216696898"
                },
                {
                  "name": "2216258936",
                  "value": "2216258936"
                },
                {
                  "name": "1168792748",
                  "value": "1168792748"
                },
                {
                  "name": "2216428480",
                  "value": "2216428480"
                },
                {
                  "name": "2213108644",
                  "value": "2213108644"
                },
                {
                  "name": "2213075571",
                  "value": "2213075571"
                },
                {
                  "name": "2215664069",
                  "value": "2215664069"
                },
                {
                  "name": "2214548178",
                  "value": "2214548178"
                },
                {
                  "name": "2216266796",
                  "value": "2216266796"
                },
                {
                  "name": "2215937739",
                  "value": "2215937739"
                },
                {
                  "name": "2213080522",
                  "value": "2213080522"
                },
                {
                  "name": "2392401325",
                  "value": "2392401325"
                },
                {
                  "name": "3756545164",
                  "value": "3756545164"
                },
                {
                  "name": "2216549954",
                  "value": "2216549954"
                },
                {
                  "name": "2215406010",
                  "value": "2215406010"
                },
                {
                  "name": "2213540035",
                  "value": "2213540035"
                },
                {
                  "name": "1135597890",
                  "value": "1135597890"
                },
                {
                  "name": "2214954681",
                  "value": "2214954681"
                },
                {
                  "name": "2944903818",
                  "value": "2944903818"
                },
                {
                  "name": "2216270600",
                  "value": "2216270600"
                },
                {
                  "name": "2216074100",
                  "value": "2216074100"
                },
                {
                  "name": "2216226714",
                  "value": "2216226714"
                },
                {
                  "name": "2216568150",
                  "value": "2216568150"
                },
                {
                  "name": "2216726770",
                  "value": "2216726770"
                },
                {
                  "name": "2975148882",
                  "value": "2975148882"
                },
                {
                  "name": "2216752797",
                  "value": "2216752797"
                },
                {
                  "name": "2216814576",
                  "value": "2216814576"
                },
                {
                  "name": "2214887141",
                  "value": "2214887141"
                },
                {
                  "name": "2215766675",
                  "value": "2215766675"
                },
                {
                  "name": "3043718553",
                  "value": "3043718553"
                },
                {
                  "name": "2215240636",
                  "value": "2215240636"
                },
                {
                  "name": "2235361579",
                  "value": "2235361579"
                },
                {
                  "name": "2216551842",
                  "value": "2216551842"
                },
                {
                  "name": "2236019323",
                  "value": "2236019323"
                },
                {
                  "name": "2216024661",
                  "value": "2216024661"
                },
                {
                  "name": "1136403440",
                  "value": "1136403440"
                },
                {
                  "name": "2216757175",
                  "value": "2216757175"
                },
                {
                  "name": "2216153529",
                  "value": "2216153529"
                },
                {
                  "name": "2215400230",
                  "value": "2215400230"
                },
                {
                  "name": "2214767425",
                  "value": "2214767425"
                },
                {
                  "name": "2213593336",
                  "value": "2213593336"
                },
                {
                  "name": "2216390277",
                  "value": "2216390277"
                },
                {
                  "name": "2215957295",
                  "value": "2215957295"
                },
                {
                  "name": "2213515573",
                  "value": "2213515573"
                },
                {
                  "name": "2216033098",
                  "value": "2216033098"
                },
                {
                  "name": "2215772403",
                  "value": "2215772403"
                },
                {
                  "name": "2216900017",
                  "value": "2216900017"
                },
                {
                  "name": "2216216166",
                  "value": "2216216166"
                },
                {
                  "name": "2215919777",
                  "value": "2215919777"
                },
                {
                  "name": "2215919064",
                  "value": "2215919064"
                },
                {
                  "name": "2215347235",
                  "value": "2215347235"
                },
                {
                  "name": "2214092192",
                  "value": "2214092192"
                },
                {
                  "name": "2214597031",
                  "value": "2214597031"
                },
                {
                  "name": "2215568094",
                  "value": "2215568094"
                },
                {
                  "name": "2216212109",
                  "value": "2216212109"
                },
                {
                  "name": "2216153703",
                  "value": "2216153703"
                },
                {
                  "name": "2216031183",
                  "value": "2216031183"
                },
                {
                  "name": "1123897569",
                  "value": "1123897569"
                },
                {
                  "name": "2216162252",
                  "value": "2216162252"
                },
                {
                  "name": "2215697000",
                  "value": "2215697000"
                },
                {
                  "name": "2213628246",
                  "value": "2213628246"
                },
                {
                  "name": "2215916549",
                  "value": "2215916549"
                },
                {
                  "name": "2213102195",
                  "value": "2213102195"
                },
                {
                  "name": "1136174103",
                  "value": "1136174103"
                },
                {
                  "name": "2216689325",
                  "value": "2216689325"
                },
                {
                  "name": "2216000361",
                  "value": "2216000361"
                },
                {
                  "name": "2213558536",
                  "value": "2213558536"
                },
                {
                  "name": "2213549622",
                  "value": "2213549622"
                },
                {
                  "name": "1122919409",
                  "value": "1122919409"
                },
                {
                  "name": "2215529583",
                  "value": "2215529583"
                },
                {
                  "name": "2215573420",
                  "value": "2215573420"
                },
                {
                  "name": "2215402228",
                  "value": "2215402228"
                },
                {
                  "name": "2215700223",
                  "value": "2215700223"
                },
                {
                  "name": "2216228790",
                  "value": "2216228790"
                },
                {
                  "name": "2226689383",
                  "value": "2226689383"
                },
                {
                  "name": "2216332608",
                  "value": "2216332608"
                },
                {
                  "name": "2214194477",
                  "value": "2214194477"
                },
                {
                  "name": "2214356945",
                  "value": "2214356945"
                },
                {
                  "name": "2215968131",
                  "value": "2215968131"
                },
                {
                  "name": "2314627271",
                  "value": "2314627271"
                },
                {
                  "name": "2364459358",
                  "value": "2364459358"
                },
                {
                  "name": "2215722824",
                  "value": "2215722824"
                },
                {
                  "name": "2213605390",
                  "value": "2213605390"
                },
                {
                  "name": "2214181282",
                  "value": "2214181282"
                },
                {
                  "name": "2215756403",
                  "value": "2215756403"
                },
                {
                  "name": "2213041088",
                  "value": "2213041088"
                },
                {
                  "name": "2215712186",
                  "value": "2215712186"
                },
                {
                  "name": "2215466428",
                  "value": "2215466428"
                },
                {
                  "name": "2216692308",
                  "value": "2216692308"
                },
                {
                  "name": "2213100256",
                  "value": "2213100256"
                },
                {
                  "name": "2214088384",
                  "value": "2214088384"
                },
                {
                  "name": "2215749872",
                  "value": "2215749872"
                },
                {
                  "name": "2216062121",
                  "value": "2216062121"
                },
                {
                  "name": "2216833841",
                  "value": "2216833841"
                },
                {
                  "name": "2216719272",
                  "value": "2216719272"
                },
                {
                  "name": "1161553955",
                  "value": "1161553955"
                },
                {
                  "name": "2214090607",
                  "value": "2214090607"
                },
                {
                  "name": "2213588936",
                  "value": "2213588936"
                },
                {
                  "name": "2216210491",
                  "value": "2216210491"
                },
                {
                  "name": "2215030824",
                  "value": "2215030824"
                },
                {
                  "name": "2216682407",
                  "value": "2216682407"
                },
                {
                  "name": "2213625690",
                  "value": "2213625690"
                },
                {
                  "name": "2214816881",
                  "value": "2214816881"
                },
                {
                  "name": "2215471225",
                  "value": "2215471225"
                },
                {
                  "name": "2216314478",
                  "value": "2216314478"
                },
                {
                  "name": "2215456346",
                  "value": "2215456346"
                },
                {
                  "name": "2216071635",
                  "value": "2216071635"
                },
                {
                  "name": "2216569399",
                  "value": "2216569399"
                },
                {
                  "name": "2214208586",
                  "value": "2214208586"
                },
                {
                  "name": "2215963401",
                  "value": "2215963401"
                },
                {
                  "name": "2215521737",
                  "value": "2215521737"
                },
                {
                  "name": "2215557753",
                  "value": "2215557753"
                },
                {
                  "name": "2216427231",
                  "value": "2216427231"
                },
                {
                  "name": "2612436563",
                  "value": "2612436563"
                },
                {
                  "name": "2216228125",
                  "value": "2216228125"
                },
                {
                  "name": "2214982360",
                  "value": "2214982360"
                },
                {
                  "name": "2215928862",
                  "value": "2215928862"
                },
                {
                  "name": "2966311016",
                  "value": "2966311016"
                },
                {
                  "name": "2216126051",
                  "value": "2216126051"
                },
                {
                  "name": "2215037016",
                  "value": "2215037016"
                },
                {
                  "name": "2215997976",
                  "value": "2215997976"
                },
                {
                  "name": "1157712638",
                  "value": "1157712638"
                },
                {
                  "name": "2215617561",
                  "value": "2215617561"
                },
                {
                  "name": "2213640059",
                  "value": "2213640059"
                },
                {
                  "name": "2215012144",
                  "value": "2215012144"
                },
                {
                  "name": "2215485299",
                  "value": "2215485299"
                },
                {
                  "name": "2215651077",
                  "value": "2215651077"
                },
                {
                  "name": "2215453850",
                  "value": "2215453850"
                },
                {
                  "name": "2215921525",
                  "value": "2215921525"
                },
                {
                  "name": "2216423783",
                  "value": "2216423783"
                },
                {
                  "name": "2215561941",
                  "value": "2215561941"
                },
                {
                  "name": "2216036831",
                  "value": "2216036831"
                },
                {
                  "name": "2215769235",
                  "value": "2215769235"
                },
                {
                  "name": "3516576698",
                  "value": "3516576698"
                },
                {
                  "name": "2215413212",
                  "value": "2215413212"
                },
                {
                  "name": "2983653361",
                  "value": "2983653361"
                },
                {
                  "name": "2215025788",
                  "value": "2215025788"
                },
                {
                  "name": "2216219581",
                  "value": "2216219581"
                },
                {
                  "name": "2214955532",
                  "value": "2214955532"
                },
                {
                  "name": "1154215427",
                  "value": "1154215427"
                },
                {
                  "name": "2214403780",
                  "value": "2214403780"
                },
                {
                  "name": "2214403865",
                  "value": "2214403865"
                },
                {
                  "name": "4605693860",
                  "value": "4605693860"
                },
                {
                  "name": "2215613155",
                  "value": "2215613155"
                },
                {
                  "name": "2215726855",
                  "value": "2215726855"
                },
                {
                  "name": "2213195864",
                  "value": "2213195864"
                },
                {
                  "name": "2214811299",
                  "value": "2214811299"
                },
                {
                  "name": "2215701178",
                  "value": "2215701178"
                },
                {
                  "name": "2215989780",
                  "value": "2215989780"
                },
                {
                  "name": "2215639907",
                  "value": "2215639907"
                },
                {
                  "name": "2215791741",
                  "value": "2215791741"
                },
                {
                  "name": "2214944202",
                  "value": "2214944202"
                },
                {
                  "name": "2214633857",
                  "value": "2214633857"
                },
                {
                  "name": "2213540993",
                  "value": "2213540993"
                },
                {
                  "name": "2215775064",
                  "value": "2215775064"
                },
                {
                  "name": "2215990538",
                  "value": "2215990538"
                },
                {
                  "name": "2213571603",
                  "value": "2213571603"
                },
                {
                  "name": "2216249079",
                  "value": "2216249079"
                },
                {
                  "name": "2215073100",
                  "value": "2215073100"
                },
                {
                  "name": "2215479735",
                  "value": "2215479735"
                },
                {
                  "name": "2214005410",
                  "value": "2214005410"
                },
                {
                  "name": "2216044335",
                  "value": "2216044335"
                },
                {
                  "name": "1168936347",
                  "value": "1168936347"
                },
                {
                  "name": "2215037860",
                  "value": "2215037860"
                },
                {
                  "name": "2974396622",
                  "value": "2974396622"
                },
                {
                  "name": "2215577059",
                  "value": "2215577059"
                },
                {
                  "name": "2221411063",
                  "value": "2221411063"
                },
                {
                  "name": "2215892818",
                  "value": "2215892818"
                },
                {
                  "name": "2215658172",
                  "value": "2215658172"
                },
                {
                  "name": "2213145507",
                  "value": "2213145507"
                },
                {
                  "name": "2215948276",
                  "value": "2215948276"
                },
                {
                  "name": "2215564604",
                  "value": "2215564604"
                },
                {
                  "name": "2215619061",
                  "value": "2215619061"
                },
                {
                  "name": "2215935530",
                  "value": "2215935530"
                },
                {
                  "name": "2216261406",
                  "value": "2216261406"
                },
                {
                  "name": "2215613221",
                  "value": "2215613221"
                },
                {
                  "name": "2216721500",
                  "value": "2216721500"
                },
                {
                  "name": "2216244133",
                  "value": "2216244133"
                },
                {
                  "name": "2215402627",
                  "value": "2215402627"
                },
                {
                  "name": "2215776198",
                  "value": "2215776198"
                },
                {
                  "name": "1138468955",
                  "value": "1138468955"
                },
                {
                  "name": "2995336464",
                  "value": "2995336464"
                },
                {
                  "name": "2216149072",
                  "value": "2216149072"
                },
                {
                  "name": "2216411859",
                  "value": "2216411859"
                },
                {
                  "name": "2215861876",
                  "value": "2215861876"
                },
                {
                  "name": "2214089591",
                  "value": "2214089591"
                },
                {
                  "name": "2216275090",
                  "value": "2216275090"
                },
                {
                  "name": "2215718864",
                  "value": "2215718864"
                },
                {
                  "name": "2223465233",
                  "value": "2223465233"
                },
                {
                  "name": "2215347022",
                  "value": "2215347022"
                },
                {
                  "name": "2215255527",
                  "value": "2215255527"
                },
                {
                  "name": "2213088215",
                  "value": "2213088215"
                },
                {
                  "name": "2215574577",
                  "value": "2215574577"
                },
                {
                  "name": "2213649645",
                  "value": "2213649645"
                },
                {
                  "name": "1133138797",
                  "value": "1133138797"
                },
                {
                  "name": "2216157827",
                  "value": "2216157827"
                },
                {
                  "name": "2215347977",
                  "value": "2215347977"
                },
                {
                  "name": "2216028707",
                  "value": "2216028707"
                },
                {
                  "name": "1111111111",
                  "value": "1111111111"
                },
                {
                  "name": "2214540991",
                  "value": "2214540991"
                },
                {
                  "name": "2216723755",
                  "value": "2216723755"
                },
                {
                  "name": "2213992518",
                  "value": "2213992518"
                },
                {
                  "name": "2214359692",
                  "value": "2214359692"
                },
                {
                  "name": "2494028748",
                  "value": "2494028748"
                },
                {
                  "name": "2214810989",
                  "value": "2214810989"
                },
                {
                  "name": "1159338072",
                  "value": "1159338072"
                },
                {
                  "name": "2215682867",
                  "value": "2215682867"
                },
                {
                  "name": "2213536603",
                  "value": "2213536603"
                },
                {
                  "name": "2216383856",
                  "value": "2216383856"
                },
                {
                  "name": "1138173922",
                  "value": "1138173922"
                },
                {
                  "name": "2216198563",
                  "value": "2216198563"
                },
                {
                  "name": "2215439732",
                  "value": "2215439732"
                },
                {
                  "name": "2215484026",
                  "value": "2215484026"
                },
                {
                  "name": "1157333754",
                  "value": "1157333754"
                },
                {
                  "name": "2216340163",
                  "value": "2216340163"
                },
                {
                  "name": "1128936639",
                  "value": "1128936639"
                },
                {
                  "name": "111111111",
                  "value": "111111111"
                },
                {
                  "name": "2216713382",
                  "value": "2216713382"
                },
                {
                  "name": "2215382762",
                  "value": "2215382762"
                },
                {
                  "name": "2214545822",
                  "value": "2214545822"
                },
                {
                  "name": "2216036907",
                  "value": "2216036907"
                },
                {
                  "name": "2216413861",
                  "value": "2216413861"
                },
                {
                  "name": "2216414146",
                  "value": "2216414146"
                },
                {
                  "name": "1161892106",
                  "value": "1161892106"
                },
                {
                  "name": "1135602838",
                  "value": "1135602838"
                },
                {
                  "name": "2213142179",
                  "value": "2213142179"
                },
                {
                  "name": "2213599122",
                  "value": "2213599122"
                },
                {
                  "name": "2215313424",
                  "value": "2215313424"
                },
                {
                  "name": "2216292006",
                  "value": "2216292006"
                },
                {
                  "name": "2216315233",
                  "value": "2216315233"
                },
                {
                  "name": "1124089809",
                  "value": "1124089809"
                },
                {
                  "name": "2215571463",
                  "value": "2215571463"
                },
                {
                  "name": "2213543194",
                  "value": "2213543194"
                },
                {
                  "name": "2215466706",
                  "value": "2215466706"
                },
                {
                  "name": "2215907171",
                  "value": "2215907171"
                },
                {
                  "name": "2216165527",
                  "value": "2216165527"
                },
                {
                  "name": "2213549245",
                  "value": "2213549245"
                },
                {
                  "name": "2215401210",
                  "value": "2215401210"
                },
                {
                  "name": "2215448548",
                  "value": "2215448548"
                },
                {
                  "name": "2215451576",
                  "value": "2215451576"
                },
                {
                  "name": "2213563630",
                  "value": "2213563630"
                },
                {
                  "name": "2213505683",
                  "value": "2213505683"
                },
                {
                  "name": "2352416350",
                  "value": "2352416350"
                },
                {
                  "name": "2213602705",
                  "value": "2213602705"
                },
                {
                  "name": "2216141932",
                  "value": "2216141932"
                },
                {
                  "name": "2214201435",
                  "value": "2214201435"
                },
                {
                  "name": "2215909585",
                  "value": "2215909585"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Pendiente",
                  "value": "Pendiente"
                },
                {
                  "name": "Confirmada",
                  "value": "Confirmada"
                },
                {
                  "name": "Cancelada",
                  "value": "Cancelada"
                },
                {
                  "name": "Realizada Sin Confirmar",
                  "value": "Realizada Sin Confirmar"
                },
                {
                  "name": "cancelada",
                  "value": "cancelada"
                },
                {
                  "name": "cancelada ",
                  "value": "cancelada "
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Notas",
              "displayName": "Notas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Fecha de Creación",
              "displayName": "Fecha de Creación",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Última Modificación",
              "displayName": "Última Modificación",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        2912,
        928
      ],
      "id": "7af8ca3a-7910-4ef4-9f5d-e40d3a68a3c9",
      "name": "Crea Reserva AirTable",
      "credentials": {
        "airtableTokenApi": {
          "id": "KlZpJ3cetMbQRAcX",
          "name": "Osaki Tablero"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "apprK9MtBIY9lyLQT",
          "mode": "list",
          "cachedResultName": "Sistema Osaki",
          "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT"
        },
        "table": {
          "__rl": true,
          "value": "tbls1xSwHHWBarhDd",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT/tbls1xSwHHWBarhDd"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Personas": "={{ $('Normaliza Datos').item.json.personas }}",
            "Código": "={{ $('Normaliza Datos').item.json.codigo_reserva }}",
            "Nombre": "={{ $('Normaliza Datos').item.json.nombre_completo }}",
            "Fecha": "={{ $json.fecha_reservacion }}",
            "Hora": "={{ $('Normaliza Datos').first().json.hora }}",
            "Zona": "={{ $('Normaliza Datos').item.json.zona }}",
            "Teléfono": "={{ $('Normaliza Datos').item.json.telefono }}",
            "Estado": "={{ $json.estado }}",
            "Notas": "={{ $('Normaliza Datos').item.json.notas }}"
          },
          "matchingColumns": [
            "Código"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Código",
              "displayName": "Código",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Fecha",
              "displayName": "Fecha",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Hora",
              "displayName": "Hora",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "11:00",
                  "value": "11:00"
                },
                {
                  "name": "11:30",
                  "value": "11:30"
                },
                {
                  "name": "12:00",
                  "value": "12:00"
                },
                {
                  "name": "12:30",
                  "value": "12:30"
                },
                {
                  "name": "13:00",
                  "value": "13:00"
                },
                {
                  "name": "13:30",
                  "value": "13:30"
                },
                {
                  "name": "14:00",
                  "value": "14:00"
                },
                {
                  "name": "14:30",
                  "value": "14:30"
                },
                {
                  "name": "15:00",
                  "value": "15:00"
                },
                {
                  "name": "18:00",
                  "value": "18:00"
                },
                {
                  "name": "18:30",
                  "value": "18:30"
                },
                {
                  "name": "19:00",
                  "value": "19:00"
                },
                {
                  "name": "19:30",
                  "value": "19:30"
                },
                {
                  "name": "20:00",
                  "value": "20:00"
                },
                {
                  "name": "20:30",
                  "value": "20:30"
                },
                {
                  "name": "21:00",
                  "value": "21:00"
                },
                {
                  "name": "21:30",
                  "value": "21:30"
                },
                {
                  "name": "22:00",
                  "value": "22:00"
                },
                {
                  "name": "22:30",
                  "value": "22:30"
                },
                {
                  "name": "Hora",
                  "value": "Hora"
                },
                {
                  "name": "21:15",
                  "value": "21:15"
                },
                {
                  "name": "22:15",
                  "value": "22:15"
                },
                {
                  "name": "21:45",
                  "value": "21:45"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Personas",
              "displayName": "Personas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Zona",
              "displayName": "Zona",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Barra",
                  "value": "Barra"
                },
                {
                  "name": "Salón",
                  "value": "Salón"
                },
                {
                  "name": "VIP",
                  "value": "VIP"
                },
                {
                  "name": "null",
                  "value": "null"
                },
                {
                  "name": "2216140642",
                  "value": "2216140642"
                },
                {
                  "name": "2215646765",
                  "value": "2215646765"
                },
                {
                  "name": "2216806616",
                  "value": "2216806616"
                },
                {
                  "name": "2212201826",
                  "value": "2212201826"
                },
                {
                  "name": "2314463724",
                  "value": "2314463724"
                },
                {
                  "name": "1131492908",
                  "value": "1131492908"
                },
                {
                  "name": "1126883023",
                  "value": "1126883023"
                },
                {
                  "name": "2215055545",
                  "value": "2215055545"
                },
                {
                  "name": "2215526719",
                  "value": "2215526719"
                },
                {
                  "name": "2216524170",
                  "value": "2216524170"
                },
                {
                  "name": "1155166182",
                  "value": "1155166182"
                },
                {
                  "name": "2215593494",
                  "value": "2215593494"
                },
                {
                  "name": "2214350124",
                  "value": "2214350124"
                },
                {
                  "name": "2216378878",
                  "value": "2216378878"
                },
                {
                  "name": "2216412836",
                  "value": "2216412836"
                },
                {
                  "name": "2213608320",
                  "value": "2213608320"
                },
                {
                  "name": "2344401322",
                  "value": "2344401322"
                },
                {
                  "name": "2216126708",
                  "value": "2216126708"
                },
                {
                  "name": "2214948349",
                  "value": "2214948349"
                },
                {
                  "name": "1164591361",
                  "value": "1164591361"
                },
                {
                  "name": "2215313060",
                  "value": "2215313060"
                },
                {
                  "name": "2215959952",
                  "value": "2215959952"
                },
                {
                  "name": "2216696898",
                  "value": "2216696898"
                },
                {
                  "name": "2216258936",
                  "value": "2216258936"
                },
                {
                  "name": "1168792748",
                  "value": "1168792748"
                },
                {
                  "name": "2216428480",
                  "value": "2216428480"
                },
                {
                  "name": "2213108644",
                  "value": "2213108644"
                },
                {
                  "name": "2213075571",
                  "value": "2213075571"
                },
                {
                  "name": "2215664069",
                  "value": "2215664069"
                },
                {
                  "name": "2214548178",
                  "value": "2214548178"
                },
                {
                  "name": "2216266796",
                  "value": "2216266796"
                },
                {
                  "name": "2215937739",
                  "value": "2215937739"
                },
                {
                  "name": "2213080522",
                  "value": "2213080522"
                },
                {
                  "name": "2392401325",
                  "value": "2392401325"
                },
                {
                  "name": "3756545164",
                  "value": "3756545164"
                },
                {
                  "name": "2216549954",
                  "value": "2216549954"
                },
                {
                  "name": "2215406010",
                  "value": "2215406010"
                },
                {
                  "name": "2213540035",
                  "value": "2213540035"
                },
                {
                  "name": "1135597890",
                  "value": "1135597890"
                },
                {
                  "name": "2214954681",
                  "value": "2214954681"
                },
                {
                  "name": "2944903818",
                  "value": "2944903818"
                },
                {
                  "name": "2216270600",
                  "value": "2216270600"
                },
                {
                  "name": "2216074100",
                  "value": "2216074100"
                },
                {
                  "name": "2216226714",
                  "value": "2216226714"
                },
                {
                  "name": "2216568150",
                  "value": "2216568150"
                },
                {
                  "name": "2216726770",
                  "value": "2216726770"
                },
                {
                  "name": "2975148882",
                  "value": "2975148882"
                },
                {
                  "name": "2216752797",
                  "value": "2216752797"
                },
                {
                  "name": "2216814576",
                  "value": "2216814576"
                },
                {
                  "name": "2214887141",
                  "value": "2214887141"
                },
                {
                  "name": "2215766675",
                  "value": "2215766675"
                },
                {
                  "name": "3043718553",
                  "value": "3043718553"
                },
                {
                  "name": "2215240636",
                  "value": "2215240636"
                },
                {
                  "name": "2235361579",
                  "value": "2235361579"
                },
                {
                  "name": "2216551842",
                  "value": "2216551842"
                },
                {
                  "name": "2236019323",
                  "value": "2236019323"
                },
                {
                  "name": "2216024661",
                  "value": "2216024661"
                },
                {
                  "name": "1136403440",
                  "value": "1136403440"
                },
                {
                  "name": "2216757175",
                  "value": "2216757175"
                },
                {
                  "name": "2216153529",
                  "value": "2216153529"
                },
                {
                  "name": "2215400230",
                  "value": "2215400230"
                },
                {
                  "name": "2214767425",
                  "value": "2214767425"
                },
                {
                  "name": "2213593336",
                  "value": "2213593336"
                },
                {
                  "name": "2216390277",
                  "value": "2216390277"
                },
                {
                  "name": "2215957295",
                  "value": "2215957295"
                },
                {
                  "name": "2213515573",
                  "value": "2213515573"
                },
                {
                  "name": "2216033098",
                  "value": "2216033098"
                },
                {
                  "name": "2215772403",
                  "value": "2215772403"
                },
                {
                  "name": "2216900017",
                  "value": "2216900017"
                },
                {
                  "name": "2216216166",
                  "value": "2216216166"
                },
                {
                  "name": "2215919777",
                  "value": "2215919777"
                },
                {
                  "name": "2215919064",
                  "value": "2215919064"
                },
                {
                  "name": "2215347235",
                  "value": "2215347235"
                },
                {
                  "name": "2214092192",
                  "value": "2214092192"
                },
                {
                  "name": "2214597031",
                  "value": "2214597031"
                },
                {
                  "name": "2215568094",
                  "value": "2215568094"
                },
                {
                  "name": "2216212109",
                  "value": "2216212109"
                },
                {
                  "name": "2216153703",
                  "value": "2216153703"
                },
                {
                  "name": "2216031183",
                  "value": "2216031183"
                },
                {
                  "name": "1123897569",
                  "value": "1123897569"
                },
                {
                  "name": "2216162252",
                  "value": "2216162252"
                },
                {
                  "name": "2215697000",
                  "value": "2215697000"
                },
                {
                  "name": "2213628246",
                  "value": "2213628246"
                },
                {
                  "name": "2215916549",
                  "value": "2215916549"
                },
                {
                  "name": "2213102195",
                  "value": "2213102195"
                },
                {
                  "name": "1136174103",
                  "value": "1136174103"
                },
                {
                  "name": "2216689325",
                  "value": "2216689325"
                },
                {
                  "name": "2216000361",
                  "value": "2216000361"
                },
                {
                  "name": "2213558536",
                  "value": "2213558536"
                },
                {
                  "name": "2213549622",
                  "value": "2213549622"
                },
                {
                  "name": "1122919409",
                  "value": "1122919409"
                },
                {
                  "name": "2215529583",
                  "value": "2215529583"
                },
                {
                  "name": "2215573420",
                  "value": "2215573420"
                },
                {
                  "name": "2215402228",
                  "value": "2215402228"
                },
                {
                  "name": "2215700223",
                  "value": "2215700223"
                },
                {
                  "name": "2216228790",
                  "value": "2216228790"
                },
                {
                  "name": "2226689383",
                  "value": "2226689383"
                },
                {
                  "name": "2216332608",
                  "value": "2216332608"
                },
                {
                  "name": "2214194477",
                  "value": "2214194477"
                },
                {
                  "name": "2214356945",
                  "value": "2214356945"
                },
                {
                  "name": "2215968131",
                  "value": "2215968131"
                },
                {
                  "name": "2314627271",
                  "value": "2314627271"
                },
                {
                  "name": "2364459358",
                  "value": "2364459358"
                },
                {
                  "name": "2215722824",
                  "value": "2215722824"
                },
                {
                  "name": "2213605390",
                  "value": "2213605390"
                },
                {
                  "name": "2214181282",
                  "value": "2214181282"
                },
                {
                  "name": "2215756403",
                  "value": "2215756403"
                },
                {
                  "name": "2213041088",
                  "value": "2213041088"
                },
                {
                  "name": "2215712186",
                  "value": "2215712186"
                },
                {
                  "name": "2215466428",
                  "value": "2215466428"
                },
                {
                  "name": "2216692308",
                  "value": "2216692308"
                },
                {
                  "name": "2213100256",
                  "value": "2213100256"
                },
                {
                  "name": "2214088384",
                  "value": "2214088384"
                },
                {
                  "name": "2215749872",
                  "value": "2215749872"
                },
                {
                  "name": "2216062121",
                  "value": "2216062121"
                },
                {
                  "name": "2216833841",
                  "value": "2216833841"
                },
                {
                  "name": "2216719272",
                  "value": "2216719272"
                },
                {
                  "name": "1161553955",
                  "value": "1161553955"
                },
                {
                  "name": "2214090607",
                  "value": "2214090607"
                },
                {
                  "name": "2213588936",
                  "value": "2213588936"
                },
                {
                  "name": "2216210491",
                  "value": "2216210491"
                },
                {
                  "name": "2215030824",
                  "value": "2215030824"
                },
                {
                  "name": "2216682407",
                  "value": "2216682407"
                },
                {
                  "name": "2213625690",
                  "value": "2213625690"
                },
                {
                  "name": "2214816881",
                  "value": "2214816881"
                },
                {
                  "name": "2215471225",
                  "value": "2215471225"
                },
                {
                  "name": "2216314478",
                  "value": "2216314478"
                },
                {
                  "name": "2215456346",
                  "value": "2215456346"
                },
                {
                  "name": "2216071635",
                  "value": "2216071635"
                },
                {
                  "name": "2216569399",
                  "value": "2216569399"
                },
                {
                  "name": "2214208586",
                  "value": "2214208586"
                },
                {
                  "name": "2215963401",
                  "value": "2215963401"
                },
                {
                  "name": "2215521737",
                  "value": "2215521737"
                },
                {
                  "name": "2215557753",
                  "value": "2215557753"
                },
                {
                  "name": "2216427231",
                  "value": "2216427231"
                },
                {
                  "name": "2612436563",
                  "value": "2612436563"
                },
                {
                  "name": "2216228125",
                  "value": "2216228125"
                },
                {
                  "name": "2214982360",
                  "value": "2214982360"
                },
                {
                  "name": "2215928862",
                  "value": "2215928862"
                },
                {
                  "name": "2966311016",
                  "value": "2966311016"
                },
                {
                  "name": "2216126051",
                  "value": "2216126051"
                },
                {
                  "name": "2215037016",
                  "value": "2215037016"
                },
                {
                  "name": "2215997976",
                  "value": "2215997976"
                },
                {
                  "name": "1157712638",
                  "value": "1157712638"
                },
                {
                  "name": "2215617561",
                  "value": "2215617561"
                },
                {
                  "name": "2213640059",
                  "value": "2213640059"
                },
                {
                  "name": "2215012144",
                  "value": "2215012144"
                },
                {
                  "name": "2215485299",
                  "value": "2215485299"
                },
                {
                  "name": "2215651077",
                  "value": "2215651077"
                },
                {
                  "name": "2215453850",
                  "value": "2215453850"
                },
                {
                  "name": "2215921525",
                  "value": "2215921525"
                },
                {
                  "name": "2216423783",
                  "value": "2216423783"
                },
                {
                  "name": "2215561941",
                  "value": "2215561941"
                },
                {
                  "name": "2216036831",
                  "value": "2216036831"
                },
                {
                  "name": "2215769235",
                  "value": "2215769235"
                },
                {
                  "name": "3516576698",
                  "value": "3516576698"
                },
                {
                  "name": "2215413212",
                  "value": "2215413212"
                },
                {
                  "name": "2983653361",
                  "value": "2983653361"
                },
                {
                  "name": "2215025788",
                  "value": "2215025788"
                },
                {
                  "name": "2216219581",
                  "value": "2216219581"
                },
                {
                  "name": "2214955532",
                  "value": "2214955532"
                },
                {
                  "name": "1154215427",
                  "value": "1154215427"
                },
                {
                  "name": "2214403780",
                  "value": "2214403780"
                },
                {
                  "name": "2214403865",
                  "value": "2214403865"
                },
                {
                  "name": "4605693860",
                  "value": "4605693860"
                },
                {
                  "name": "2215613155",
                  "value": "2215613155"
                },
                {
                  "name": "2215726855",
                  "value": "2215726855"
                },
                {
                  "name": "2213195864",
                  "value": "2213195864"
                },
                {
                  "name": "2214811299",
                  "value": "2214811299"
                },
                {
                  "name": "2215701178",
                  "value": "2215701178"
                },
                {
                  "name": "2215989780",
                  "value": "2215989780"
                },
                {
                  "name": "2215639907",
                  "value": "2215639907"
                },
                {
                  "name": "2215791741",
                  "value": "2215791741"
                },
                {
                  "name": "2214944202",
                  "value": "2214944202"
                },
                {
                  "name": "2214633857",
                  "value": "2214633857"
                },
                {
                  "name": "2213540993",
                  "value": "2213540993"
                },
                {
                  "name": "2215775064",
                  "value": "2215775064"
                },
                {
                  "name": "2215990538",
                  "value": "2215990538"
                },
                {
                  "name": "2213571603",
                  "value": "2213571603"
                },
                {
                  "name": "2216249079",
                  "value": "2216249079"
                },
                {
                  "name": "2215073100",
                  "value": "2215073100"
                },
                {
                  "name": "2215479735",
                  "value": "2215479735"
                },
                {
                  "name": "2214005410",
                  "value": "2214005410"
                },
                {
                  "name": "2216044335",
                  "value": "2216044335"
                },
                {
                  "name": "1168936347",
                  "value": "1168936347"
                },
                {
                  "name": "2215037860",
                  "value": "2215037860"
                },
                {
                  "name": "2974396622",
                  "value": "2974396622"
                },
                {
                  "name": "2215577059",
                  "value": "2215577059"
                },
                {
                  "name": "2221411063",
                  "value": "2221411063"
                },
                {
                  "name": "2215892818",
                  "value": "2215892818"
                },
                {
                  "name": "2215658172",
                  "value": "2215658172"
                },
                {
                  "name": "2213145507",
                  "value": "2213145507"
                },
                {
                  "name": "2215948276",
                  "value": "2215948276"
                },
                {
                  "name": "2215564604",
                  "value": "2215564604"
                },
                {
                  "name": "2215619061",
                  "value": "2215619061"
                },
                {
                  "name": "2215935530",
                  "value": "2215935530"
                },
                {
                  "name": "2216261406",
                  "value": "2216261406"
                },
                {
                  "name": "2215613221",
                  "value": "2215613221"
                },
                {
                  "name": "2216721500",
                  "value": "2216721500"
                },
                {
                  "name": "2216244133",
                  "value": "2216244133"
                },
                {
                  "name": "2215402627",
                  "value": "2215402627"
                },
                {
                  "name": "2215776198",
                  "value": "2215776198"
                },
                {
                  "name": "1138468955",
                  "value": "1138468955"
                },
                {
                  "name": "2995336464",
                  "value": "2995336464"
                },
                {
                  "name": "2216149072",
                  "value": "2216149072"
                },
                {
                  "name": "2216411859",
                  "value": "2216411859"
                },
                {
                  "name": "2215861876",
                  "value": "2215861876"
                },
                {
                  "name": "2214089591",
                  "value": "2214089591"
                },
                {
                  "name": "2216275090",
                  "value": "2216275090"
                },
                {
                  "name": "2215718864",
                  "value": "2215718864"
                },
                {
                  "name": "2223465233",
                  "value": "2223465233"
                },
                {
                  "name": "2215347022",
                  "value": "2215347022"
                },
                {
                  "name": "2215255527",
                  "value": "2215255527"
                },
                {
                  "name": "2213088215",
                  "value": "2213088215"
                },
                {
                  "name": "2215574577",
                  "value": "2215574577"
                },
                {
                  "name": "2213649645",
                  "value": "2213649645"
                },
                {
                  "name": "1133138797",
                  "value": "1133138797"
                },
                {
                  "name": "2216157827",
                  "value": "2216157827"
                },
                {
                  "name": "2215347977",
                  "value": "2215347977"
                },
                {
                  "name": "2216028707",
                  "value": "2216028707"
                },
                {
                  "name": "1111111111",
                  "value": "1111111111"
                },
                {
                  "name": "2214540991",
                  "value": "2214540991"
                },
                {
                  "name": "2216723755",
                  "value": "2216723755"
                },
                {
                  "name": "2213992518",
                  "value": "2213992518"
                },
                {
                  "name": "2214359692",
                  "value": "2214359692"
                },
                {
                  "name": "2494028748",
                  "value": "2494028748"
                },
                {
                  "name": "2214810989",
                  "value": "2214810989"
                },
                {
                  "name": "1159338072",
                  "value": "1159338072"
                },
                {
                  "name": "2215682867",
                  "value": "2215682867"
                },
                {
                  "name": "2213536603",
                  "value": "2213536603"
                },
                {
                  "name": "2216383856",
                  "value": "2216383856"
                },
                {
                  "name": "1138173922",
                  "value": "1138173922"
                },
                {
                  "name": "2216198563",
                  "value": "2216198563"
                },
                {
                  "name": "2215439732",
                  "value": "2215439732"
                },
                {
                  "name": "2215484026",
                  "value": "2215484026"
                },
                {
                  "name": "1157333754",
                  "value": "1157333754"
                },
                {
                  "name": "2216340163",
                  "value": "2216340163"
                },
                {
                  "name": "1128936639",
                  "value": "1128936639"
                },
                {
                  "name": "111111111",
                  "value": "111111111"
                },
                {
                  "name": "2216713382",
                  "value": "2216713382"
                },
                {
                  "name": "2215382762",
                  "value": "2215382762"
                },
                {
                  "name": "2214545822",
                  "value": "2214545822"
                },
                {
                  "name": "2216036907",
                  "value": "2216036907"
                },
                {
                  "name": "2216413861",
                  "value": "2216413861"
                },
                {
                  "name": "2216414146",
                  "value": "2216414146"
                },
                {
                  "name": "1161892106",
                  "value": "1161892106"
                },
                {
                  "name": "1135602838",
                  "value": "1135602838"
                },
                {
                  "name": "2213142179",
                  "value": "2213142179"
                },
                {
                  "name": "2213599122",
                  "value": "2213599122"
                },
                {
                  "name": "2215313424",
                  "value": "2215313424"
                },
                {
                  "name": "2216292006",
                  "value": "2216292006"
                },
                {
                  "name": "2216315233",
                  "value": "2216315233"
                },
                {
                  "name": "1124089809",
                  "value": "1124089809"
                },
                {
                  "name": "2215571463",
                  "value": "2215571463"
                },
                {
                  "name": "2213543194",
                  "value": "2213543194"
                },
                {
                  "name": "2215466706",
                  "value": "2215466706"
                },
                {
                  "name": "2215907171",
                  "value": "2215907171"
                },
                {
                  "name": "2216165527",
                  "value": "2216165527"
                },
                {
                  "name": "2213549245",
                  "value": "2213549245"
                },
                {
                  "name": "2215401210",
                  "value": "2215401210"
                },
                {
                  "name": "2215448548",
                  "value": "2215448548"
                },
                {
                  "name": "2215451576",
                  "value": "2215451576"
                },
                {
                  "name": "2213563630",
                  "value": "2213563630"
                },
                {
                  "name": "2213505683",
                  "value": "2213505683"
                },
                {
                  "name": "2352416350",
                  "value": "2352416350"
                },
                {
                  "name": "2213602705",
                  "value": "2213602705"
                },
                {
                  "name": "2216141932",
                  "value": "2216141932"
                },
                {
                  "name": "2214201435",
                  "value": "2214201435"
                },
                {
                  "name": "2215909585",
                  "value": "2215909585"
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Pendiente",
                  "value": "Pendiente"
                },
                {
                  "name": "Confirmada",
                  "value": "Confirmada"
                },
                {
                  "name": "Cancelada",
                  "value": "Cancelada"
                },
                {
                  "name": "Realizada Sin Confirmar",
                  "value": "Realizada Sin Confirmar"
                },
                {
                  "name": "cancelada",
                  "value": "cancelada"
                },
                {
                  "name": "cancelada ",
                  "value": "cancelada "
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Notas",
              "displayName": "Notas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Fecha de Creación",
              "displayName": "Fecha de Creación",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Última Modificación",
              "displayName": "Última Modificación",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1504,
        1152
      ],
      "id": "a09c7b2f-e3f4-446c-9e31-ff5ed5f7163c",
      "name": "Update record",
      "credentials": {
        "airtableTokenApi": {
          "id": "KlZpJ3cetMbQRAcX",
          "name": "Osaki Tablero"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "estado": "Cancelada",
            "notas": "={{ $('Normaliza Datos').first().json.notas }}",
            "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "codigo_reserva": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}",
            "intento_confirmacion": "={{ true }}"
          },
          "matchingColumns": [
            "codigo_reserva"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ubicacion",
              "displayName": "ubicacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_solicitante",
              "displayName": "telefono_solicitante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mesas_reserva",
              "displayName": "mesas_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intento_confirmacion",
              "displayName": "intento_confirmacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Canal",
              "displayName": "Canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2192,
        1616
      ],
      "id": "fdc20643-48c1-49cf-b845-df7ceb1675fe",
      "name": "Cancela Reserva",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Agente Principal').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "reservaciones",
          "mode": "list",
          "cachedResultName": "reservaciones"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "estado": "Confirmada",
            "updated_at": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "codigo_reserva": "={{ $json.codigo_reserva.replaceAll(' ','').trim() }}",
            "intento_confirmacion": "={{ true }}"
          },
          "matchingColumns": [
            "codigo_reserva"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "cliente",
              "displayName": "cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_reservacion",
              "displayName": "fecha_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "hora_reservacion",
              "displayName": "hora_reservacion",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "time",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "numero_personas",
              "displayName": "numero_personas",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "estado",
              "displayName": "estado",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "dia_semana",
              "displayName": "dia_semana",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "email_contacto",
              "displayName": "email_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_contacto",
              "displayName": "telefono_contacto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "zona",
              "displayName": "zona",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ubicacion",
              "displayName": "ubicacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono_solicitante",
              "displayName": "telefono_solicitante",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "codigo_reserva",
              "displayName": "codigo_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mesas_reserva",
              "displayName": "mesas_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intento_confirmacion",
              "displayName": "intento_confirmacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Canal",
              "displayName": "Canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2192,
        1856
      ],
      "id": "caa82849-5d29-450e-a0ce-e5b691bc234f",
      "name": "Confirma Reserva",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "base": {
          "__rl": true,
          "value": "apprK9MtBIY9lyLQT",
          "mode": "list",
          "cachedResultName": "Sistema Osaki",
          "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT"
        },
        "table": {
          "__rl": true,
          "value": "tbls1xSwHHWBarhDd",
          "mode": "list",
          "cachedResultName": "Reservaciones",
          "cachedResultUrl": "https://airtable.com/apprK9MtBIY9lyLQT/tbls1xSwHHWBarhDd"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Código": "={{ $json.codigo_reserva }}",
            "Estado": "={{ $json.estado }}",
            "Notas": "={{ $json.notas }}"
          },
          "matchingColumns": [
            "Código"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Código",
              "displayName": "Código",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Fecha",
              "displayName": "Fecha",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Hora",
              "displayName": "Hora",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "11:00",
                  "value": "11:00"
                },
                {
                  "name": "11:30",
                  "value": "11:30"
                },
                {
                  "name": "12:00",
                  "value": "12:00"
                },
                {
                  "name": "12:30",
                  "value": "12:30"
                },
                {
                  "name": "13:00",
                  "value": "13:00"
                },
                {
                  "name": "13:30",
                  "value": "13:30"
                },
                {
                  "name": "14:00",
                  "value": "14:00"
                },
                {
                  "name": "14:30",
                  "value": "14:30"
                },
                {
                  "name": "15:00",
                  "value": "15:00"
                },
                {
                  "name": "18:00",
                  "value": "18:00"
                },
                {
                  "name": "18:30",
                  "value": "18:30"
                },
                {
                  "name": "19:00",
                  "value": "19:00"
                },
                {
                  "name": "19:30",
                  "value": "19:30"
                },
                {
                  "name": "20:00",
                  "value": "20:00"
                },
                {
                  "name": "20:30",
                  "value": "20:30"
                },
                {
                  "name": "21:00",
                  "value": "21:00"
                },
                {
                  "name": "21:30",
                  "value": "21:30"
                },
                {
                  "name": "22:00",
                  "value": "22:00"
                },
                {
                  "name": "22:30",
                  "value": "22:30"
                },
                {
                  "name": "Hora",
                  "value": "Hora"
                },
                {
                  "name": "21:15",
                  "value": "21:15"
                },
                {
                  "name": "22:15",
                  "value": "22:15"
                },
                {
                  "name": "21:45",
                  "value": "21:45"
                }
              ],
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Personas",
              "displayName": "Personas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Zona",
              "displayName": "Zona",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Barra",
                  "value": "Barra"
                },
                {
                  "name": "Salón",
                  "value": "Salón"
                },
                {
                  "name": "VIP",
                  "value": "VIP"
                },
                {
                  "name": "null",
                  "value": "null"
                },
                {
                  "name": "2216140642",
                  "value": "2216140642"
                },
                {
                  "name": "2215646765",
                  "value": "2215646765"
                },
                {
                  "name": "2216806616",
                  "value": "2216806616"
                },
                {
                  "name": "2212201826",
                  "value": "2212201826"
                },
                {
                  "name": "2314463724",
                  "value": "2314463724"
                },
                {
                  "name": "1131492908",
                  "value": "1131492908"
                },
                {
                  "name": "1126883023",
                  "value": "1126883023"
                },
                {
                  "name": "2215055545",
                  "value": "2215055545"
                },
                {
                  "name": "2215526719",
                  "value": "2215526719"
                },
                {
                  "name": "2216524170",
                  "value": "2216524170"
                },
                {
                  "name": "1155166182",
                  "value": "1155166182"
                },
                {
                  "name": "2215593494",
                  "value": "2215593494"
                },
                {
                  "name": "2214350124",
                  "value": "2214350124"
                },
                {
                  "name": "2216378878",
                  "value": "2216378878"
                },
                {
                  "name": "2216412836",
                  "value": "2216412836"
                },
                {
                  "name": "2213608320",
                  "value": "2213608320"
                },
                {
                  "name": "2344401322",
                  "value": "2344401322"
                },
                {
                  "name": "2216126708",
                  "value": "2216126708"
                },
                {
                  "name": "2214948349",
                  "value": "2214948349"
                },
                {
                  "name": "1164591361",
                  "value": "1164591361"
                },
                {
                  "name": "2215313060",
                  "value": "2215313060"
                },
                {
                  "name": "2215959952",
                  "value": "2215959952"
                },
                {
                  "name": "2216696898",
                  "value": "2216696898"
                },
                {
                  "name": "2216258936",
                  "value": "2216258936"
                },
                {
                  "name": "1168792748",
                  "value": "1168792748"
                },
                {
                  "name": "2216428480",
                  "value": "2216428480"
                },
                {
                  "name": "2213108644",
                  "value": "2213108644"
                },
                {
                  "name": "2213075571",
                  "value": "2213075571"
                },
                {
                  "name": "2215664069",
                  "value": "2215664069"
                },
                {
                  "name": "2214548178",
                  "value": "2214548178"
                },
                {
                  "name": "2216266796",
                  "value": "2216266796"
                },
                {
                  "name": "2215937739",
                  "value": "2215937739"
                },
                {
                  "name": "2213080522",
                  "value": "2213080522"
                },
                {
                  "name": "2392401325",
                  "value": "2392401325"
                },
                {
                  "name": "3756545164",
                  "value": "3756545164"
                },
                {
                  "name": "2216549954",
                  "value": "2216549954"
                },
                {
                  "name": "2215406010",
                  "value": "2215406010"
                },
                {
                  "name": "2213540035",
                  "value": "2213540035"
                },
                {
                  "name": "1135597890",
                  "value": "1135597890"
                },
                {
                  "name": "2214954681",
                  "value": "2214954681"
                },
                {
                  "name": "2944903818",
                  "value": "2944903818"
                },
                {
                  "name": "2216270600",
                  "value": "2216270600"
                },
                {
                  "name": "2216074100",
                  "value": "2216074100"
                },
                {
                  "name": "2216226714",
                  "value": "2216226714"
                },
                {
                  "name": "2216568150",
                  "value": "2216568150"
                },
                {
                  "name": "2216726770",
                  "value": "2216726770"
                },
                {
                  "name": "2975148882",
                  "value": "2975148882"
                },
                {
                  "name": "2216752797",
                  "value": "2216752797"
                },
                {
                  "name": "2216814576",
                  "value": "2216814576"
                },
                {
                  "name": "2214887141",
                  "value": "2214887141"
                },
                {
                  "name": "2215766675",
                  "value": "2215766675"
                },
                {
                  "name": "3043718553",
                  "value": "3043718553"
                },
                {
                  "name": "2215240636",
                  "value": "2215240636"
                },
                {
                  "name": "2235361579",
                  "value": "2235361579"
                },
                {
                  "name": "2216551842",
                  "value": "2216551842"
                },
                {
                  "name": "2236019323",
                  "value": "2236019323"
                },
                {
                  "name": "2216024661",
                  "value": "2216024661"
                },
                {
                  "name": "1136403440",
                  "value": "1136403440"
                },
                {
                  "name": "2216757175",
                  "value": "2216757175"
                },
                {
                  "name": "2216153529",
                  "value": "2216153529"
                },
                {
                  "name": "2215400230",
                  "value": "2215400230"
                },
                {
                  "name": "2214767425",
                  "value": "2214767425"
                },
                {
                  "name": "2213593336",
                  "value": "2213593336"
                },
                {
                  "name": "2216390277",
                  "value": "2216390277"
                },
                {
                  "name": "2215957295",
                  "value": "2215957295"
                },
                {
                  "name": "2213515573",
                  "value": "2213515573"
                },
                {
                  "name": "2216033098",
                  "value": "2216033098"
                },
                {
                  "name": "2215772403",
                  "value": "2215772403"
                },
                {
                  "name": "2216900017",
                  "value": "2216900017"
                },
                {
                  "name": "2216216166",
                  "value": "2216216166"
                },
                {
                  "name": "2215919777",
                  "value": "2215919777"
                },
                {
                  "name": "2215919064",
                  "value": "2215919064"
                },
                {
                  "name": "2215347235",
                  "value": "2215347235"
                },
                {
                  "name": "2214092192",
                  "value": "2214092192"
                },
                {
                  "name": "2214597031",
                  "value": "2214597031"
                },
                {
                  "name": "2215568094",
                  "value": "2215568094"
                },
                {
                  "name": "2216212109",
                  "value": "2216212109"
                },
                {
                  "name": "2216153703",
                  "value": "2216153703"
                },
                {
                  "name": "2216031183",
                  "value": "2216031183"
                },
                {
                  "name": "1123897569",
                  "value": "1123897569"
                },
                {
                  "name": "2216162252",
                  "value": "2216162252"
                },
                {
                  "name": "2215697000",
                  "value": "2215697000"
                },
                {
                  "name": "2213628246",
                  "value": "2213628246"
                },
                {
                  "name": "2215916549",
                  "value": "2215916549"
                },
                {
                  "name": "2213102195",
                  "value": "2213102195"
                },
                {
                  "name": "1136174103",
                  "value": "1136174103"
                },
                {
                  "name": "2216689325",
                  "value": "2216689325"
                },
                {
                  "name": "2216000361",
                  "value": "2216000361"
                },
                {
                  "name": "2213558536",
                  "value": "2213558536"
                },
                {
                  "name": "2213549622",
                  "value": "2213549622"
                },
                {
                  "name": "1122919409",
                  "value": "1122919409"
                },
                {
                  "name": "2215529583",
                  "value": "2215529583"
                },
                {
                  "name": "2215573420",
                  "value": "2215573420"
                },
                {
                  "name": "2215402228",
                  "value": "2215402228"
                },
                {
                  "name": "2215700223",
                  "value": "2215700223"
                },
                {
                  "name": "2216228790",
                  "value": "2216228790"
                },
                {
                  "name": "2226689383",
                  "value": "2226689383"
                },
                {
                  "name": "2216332608",
                  "value": "2216332608"
                },
                {
                  "name": "2214194477",
                  "value": "2214194477"
                },
                {
                  "name": "2214356945",
                  "value": "2214356945"
                },
                {
                  "name": "2215968131",
                  "value": "2215968131"
                },
                {
                  "name": "2314627271",
                  "value": "2314627271"
                },
                {
                  "name": "2364459358",
                  "value": "2364459358"
                },
                {
                  "name": "2215722824",
                  "value": "2215722824"
                },
                {
                  "name": "2213605390",
                  "value": "2213605390"
                },
                {
                  "name": "2214181282",
                  "value": "2214181282"
                },
                {
                  "name": "2215756403",
                  "value": "2215756403"
                },
                {
                  "name": "2213041088",
                  "value": "2213041088"
                },
                {
                  "name": "2215712186",
                  "value": "2215712186"
                },
                {
                  "name": "2215466428",
                  "value": "2215466428"
                },
                {
                  "name": "2216692308",
                  "value": "2216692308"
                },
                {
                  "name": "2213100256",
                  "value": "2213100256"
                },
                {
                  "name": "2214088384",
                  "value": "2214088384"
                },
                {
                  "name": "2215749872",
                  "value": "2215749872"
                },
                {
                  "name": "2216062121",
                  "value": "2216062121"
                },
                {
                  "name": "2216833841",
                  "value": "2216833841"
                },
                {
                  "name": "2216719272",
                  "value": "2216719272"
                },
                {
                  "name": "1161553955",
                  "value": "1161553955"
                },
                {
                  "name": "2214090607",
                  "value": "2214090607"
                },
                {
                  "name": "2213588936",
                  "value": "2213588936"
                },
                {
                  "name": "2216210491",
                  "value": "2216210491"
                },
                {
                  "name": "2215030824",
                  "value": "2215030824"
                },
                {
                  "name": "2216682407",
                  "value": "2216682407"
                },
                {
                  "name": "2213625690",
                  "value": "2213625690"
                },
                {
                  "name": "2214816881",
                  "value": "2214816881"
                },
                {
                  "name": "2215471225",
                  "value": "2215471225"
                },
                {
                  "name": "2216314478",
                  "value": "2216314478"
                },
                {
                  "name": "2215456346",
                  "value": "2215456346"
                },
                {
                  "name": "2216071635",
                  "value": "2216071635"
                },
                {
                  "name": "2216569399",
                  "value": "2216569399"
                },
                {
                  "name": "2214208586",
                  "value": "2214208586"
                },
                {
                  "name": "2215963401",
                  "value": "2215963401"
                },
                {
                  "name": "2215521737",
                  "value": "2215521737"
                },
                {
                  "name": "2215557753",
                  "value": "2215557753"
                },
                {
                  "name": "2216427231",
                  "value": "2216427231"
                },
                {
                  "name": "2612436563",
                  "value": "2612436563"
                },
                {
                  "name": "2216228125",
                  "value": "2216228125"
                },
                {
                  "name": "2214982360",
                  "value": "2214982360"
                },
                {
                  "name": "2215928862",
                  "value": "2215928862"
                },
                {
                  "name": "2966311016",
                  "value": "2966311016"
                },
                {
                  "name": "2216126051",
                  "value": "2216126051"
                },
                {
                  "name": "2215037016",
                  "value": "2215037016"
                },
                {
                  "name": "2215997976",
                  "value": "2215997976"
                },
                {
                  "name": "1157712638",
                  "value": "1157712638"
                },
                {
                  "name": "2215617561",
                  "value": "2215617561"
                },
                {
                  "name": "2213640059",
                  "value": "2213640059"
                },
                {
                  "name": "2215012144",
                  "value": "2215012144"
                },
                {
                  "name": "2215485299",
                  "value": "2215485299"
                },
                {
                  "name": "2215651077",
                  "value": "2215651077"
                },
                {
                  "name": "2215453850",
                  "value": "2215453850"
                },
                {
                  "name": "2215921525",
                  "value": "2215921525"
                },
                {
                  "name": "2216423783",
                  "value": "2216423783"
                },
                {
                  "name": "2215561941",
                  "value": "2215561941"
                },
                {
                  "name": "2216036831",
                  "value": "2216036831"
                },
                {
                  "name": "2215769235",
                  "value": "2215769235"
                },
                {
                  "name": "3516576698",
                  "value": "3516576698"
                },
                {
                  "name": "2215413212",
                  "value": "2215413212"
                },
                {
                  "name": "2983653361",
                  "value": "2983653361"
                },
                {
                  "name": "2215025788",
                  "value": "2215025788"
                },
                {
                  "name": "2216219581",
                  "value": "2216219581"
                },
                {
                  "name": "2214955532",
                  "value": "2214955532"
                },
                {
                  "name": "1154215427",
                  "value": "1154215427"
                },
                {
                  "name": "2214403780",
                  "value": "2214403780"
                },
                {
                  "name": "2214403865",
                  "value": "2214403865"
                },
                {
                  "name": "4605693860",
                  "value": "4605693860"
                },
                {
                  "name": "2215613155",
                  "value": "2215613155"
                },
                {
                  "name": "2215726855",
                  "value": "2215726855"
                },
                {
                  "name": "2213195864",
                  "value": "2213195864"
                },
                {
                  "name": "2214811299",
                  "value": "2214811299"
                },
                {
                  "name": "2215701178",
                  "value": "2215701178"
                },
                {
                  "name": "2215989780",
                  "value": "2215989780"
                },
                {
                  "name": "2215639907",
                  "value": "2215639907"
                },
                {
                  "name": "2215791741",
                  "value": "2215791741"
                },
                {
                  "name": "2214944202",
                  "value": "2214944202"
                },
                {
                  "name": "2214633857",
                  "value": "2214633857"
                },
                {
                  "name": "2213540993",
                  "value": "2213540993"
                },
                {
                  "name": "2215775064",
                  "value": "2215775064"
                },
                {
                  "name": "2215990538",
                  "value": "2215990538"
                },
                {
                  "name": "2213571603",
                  "value": "2213571603"
                },
                {
                  "name": "2216249079",
                  "value": "2216249079"
                },
                {
                  "name": "2215073100",
                  "value": "2215073100"
                },
                {
                  "name": "2215479735",
                  "value": "2215479735"
                },
                {
                  "name": "2214005410",
                  "value": "2214005410"
                },
                {
                  "name": "2216044335",
                  "value": "2216044335"
                },
                {
                  "name": "1168936347",
                  "value": "1168936347"
                },
                {
                  "name": "2215037860",
                  "value": "2215037860"
                },
                {
                  "name": "2974396622",
                  "value": "2974396622"
                },
                {
                  "name": "2215577059",
                  "value": "2215577059"
                },
                {
                  "name": "2221411063",
                  "value": "2221411063"
                },
                {
                  "name": "2215892818",
                  "value": "2215892818"
                },
                {
                  "name": "2215658172",
                  "value": "2215658172"
                },
                {
                  "name": "2213145507",
                  "value": "2213145507"
                },
                {
                  "name": "2215948276",
                  "value": "2215948276"
                },
                {
                  "name": "2215564604",
                  "value": "2215564604"
                },
                {
                  "name": "2215619061",
                  "value": "2215619061"
                },
                {
                  "name": "2215935530",
                  "value": "2215935530"
                },
                {
                  "name": "2216261406",
                  "value": "2216261406"
                },
                {
                  "name": "2215613221",
                  "value": "2215613221"
                },
                {
                  "name": "2216721500",
                  "value": "2216721500"
                },
                {
                  "name": "2216244133",
                  "value": "2216244133"
                },
                {
                  "name": "2215402627",
                  "value": "2215402627"
                },
                {
                  "name": "2215776198",
                  "value": "2215776198"
                },
                {
                  "name": "1138468955",
                  "value": "1138468955"
                },
                {
                  "name": "2995336464",
                  "value": "2995336464"
                },
                {
                  "name": "2216149072",
                  "value": "2216149072"
                },
                {
                  "name": "2216411859",
                  "value": "2216411859"
                },
                {
                  "name": "2215861876",
                  "value": "2215861876"
                },
                {
                  "name": "2214089591",
                  "value": "2214089591"
                },
                {
                  "name": "2216275090",
                  "value": "2216275090"
                },
                {
                  "name": "2215718864",
                  "value": "2215718864"
                },
                {
                  "name": "2223465233",
                  "value": "2223465233"
                },
                {
                  "name": "2215347022",
                  "value": "2215347022"
                },
                {
                  "name": "2215255527",
                  "value": "2215255527"
                },
                {
                  "name": "2213088215",
                  "value": "2213088215"
                },
                {
                  "name": "2215574577",
                  "value": "2215574577"
                },
                {
                  "name": "2213649645",
                  "value": "2213649645"
                },
                {
                  "name": "1133138797",
                  "value": "1133138797"
                },
                {
                  "name": "2216157827",
                  "value": "2216157827"
                },
                {
                  "name": "2215347977",
                  "value": "2215347977"
                },
                {
                  "name": "2216028707",
                  "value": "2216028707"
                },
                {
                  "name": "1111111111",
                  "value": "1111111111"
                },
                {
                  "name": "2214540991",
                  "value": "2214540991"
                },
                {
                  "name": "2216723755",
                  "value": "2216723755"
                },
                {
                  "name": "2213992518",
                  "value": "2213992518"
                },
                {
                  "name": "2214359692",
                  "value": "2214359692"
                },
                {
                  "name": "2494028748",
                  "value": "2494028748"
                },
                {
                  "name": "2214810989",
                  "value": "2214810989"
                },
                {
                  "name": "1159338072",
                  "value": "1159338072"
                },
                {
                  "name": "2215682867",
                  "value": "2215682867"
                },
                {
                  "name": "2213536603",
                  "value": "2213536603"
                },
                {
                  "name": "2216383856",
                  "value": "2216383856"
                },
                {
                  "name": "1138173922",
                  "value": "1138173922"
                },
                {
                  "name": "2216198563",
                  "value": "2216198563"
                },
                {
                  "name": "2215439732",
                  "value": "2215439732"
                },
                {
                  "name": "2215484026",
                  "value": "2215484026"
                },
                {
                  "name": "1157333754",
                  "value": "1157333754"
                },
                {
                  "name": "2216340163",
                  "value": "2216340163"
                },
                {
                  "name": "1128936639",
                  "value": "1128936639"
                },
                {
                  "name": "111111111",
                  "value": "111111111"
                },
                {
                  "name": "2216713382",
                  "value": "2216713382"
                },
                {
                  "name": "2215382762",
                  "value": "2215382762"
                },
                {
                  "name": "2214545822",
                  "value": "2214545822"
                },
                {
                  "name": "2216036907",
                  "value": "2216036907"
                },
                {
                  "name": "2216413861",
                  "value": "2216413861"
                },
                {
                  "name": "2216414146",
                  "value": "2216414146"
                },
                {
                  "name": "1161892106",
                  "value": "1161892106"
                },
                {
                  "name": "1135602838",
                  "value": "1135602838"
                },
                {
                  "name": "2213142179",
                  "value": "2213142179"
                },
                {
                  "name": "2213599122",
                  "value": "2213599122"
                },
                {
                  "name": "2215313424",
                  "value": "2215313424"
                },
                {
                  "name": "2216292006",
                  "value": "2216292006"
                },
                {
                  "name": "2216315233",
                  "value": "2216315233"
                },
                {
                  "name": "1124089809",
                  "value": "1124089809"
                },
                {
                  "name": "2215571463",
                  "value": "2215571463"
                },
                {
                  "name": "2213543194",
                  "value": "2213543194"
                },
                {
                  "name": "2215466706",
                  "value": "2215466706"
                },
                {
                  "name": "2215907171",
                  "value": "2215907171"
                },
                {
                  "name": "2216165527",
                  "value": "2216165527"
                },
                {
                  "name": "2213549245",
                  "value": "2213549245"
                },
                {
                  "name": "2215401210",
                  "value": "2215401210"
                },
                {
                  "name": "2215448548",
                  "value": "2215448548"
                },
                {
                  "name": "2215451576",
                  "value": "2215451576"
                },
                {
                  "name": "2213563630",
                  "value": "2213563630"
                },
                {
                  "name": "2213505683",
                  "value": "2213505683"
                },
                {
                  "name": "2352416350",
                  "value": "2352416350"
                },
                {
                  "name": "2213602705",
                  "value": "2213602705"
                },
                {
                  "name": "2216141932",
                  "value": "2216141932"
                },
                {
                  "name": "2214201435",
                  "value": "2214201435"
                },
                {
                  "name": "2215909585",
                  "value": "2215909585"
                }
              ],
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Teléfono",
              "displayName": "Teléfono",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Estado",
              "displayName": "Estado",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Pendiente",
                  "value": "Pendiente"
                },
                {
                  "name": "Confirmada",
                  "value": "Confirmada"
                },
                {
                  "name": "Cancelada",
                  "value": "Cancelada"
                },
                {
                  "name": "Realizada Sin Confirmar",
                  "value": "Realizada Sin Confirmar"
                },
                {
                  "name": "cancelada",
                  "value": "cancelada"
                },
                {
                  "name": "cancelada ",
                  "value": "cancelada "
                }
              ],
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Notas",
              "displayName": "Notas",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Fecha de Creación",
              "displayName": "Fecha de Creación",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            },
            {
              "id": "Última Modificación",
              "displayName": "Última Modificación",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        2800,
        1760
      ],
      "id": "f949bde6-0a78-49b2-9e20-5b717b24f436",
      "name": "Update record1",
      "credentials": {
        "airtableTokenApi": {
          "id": "KlZpJ3cetMbQRAcX",
          "name": "Osaki Tablero"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "db09d781-335e-417d-806f-cfbce2455fa5",
              "name": "Response",
              "value": "={{ $('Normaliza Datos').first().json.tipo }}: NO exitoso.\nTe equivocaste en la gestión, discúlpate con el usuario. Las reservaciones no se pueden hacer en bloques de minutos 00 y 30, ejemplo: 21:30, 20:00.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        288
      ],
      "id": "179d5d8b-d6c0-4155-a7f5-fb72ce1bf43d",
      "name": "Response Formato Hora 00 30"
    }
  ],
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "timezone": "America/Argentina/Buenos_Aires",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "ZpYgShc1li13uf3h"
  },
  "shared": [
    {
      "updatedAt": "2026-02-17T14:32:00.854Z",
      "createdAt": "2026-02-17T14:32:00.854Z",
      "role": "workflow:owner",
      "workflowId": "su5pBZNPEHVtuYnB",
      "projectId": "ROVo9T66IPW6MHN4"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2026-02-23T19:50:34.151Z",
  "versionId": "c4f5d3ab-e897-453e-af4f-caf7e6688968"
}