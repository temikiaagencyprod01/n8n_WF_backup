{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Obtiene Registros osakisucursal": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Registra Pedido",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update rows in a table1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Select rows from a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table": {
      "main": [
        [
          {
            "node": "Select rows from a table1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ingresa Registro ReConfirmacion": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Forma Respuestas Mostrador",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Forma Respuestas Delivery",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Forma Respuestas Mostrador": {
      "main": [
        [
          {
            "node": "Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensaje": {
      "main": [
        [
          {
            "node": "Ingresa Registro ReConfirmacion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Forma Respuestas Delivery": {
      "main": [
        [
          {
            "node": "Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table1": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Registra Cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualiza Clientes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registra Cliente": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Clientes": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Detalle Pedido": {
      "main": [
        [
          {
            "node": "Agrupa Articulos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obtiene Pedido": {
      "main": [
        [
          {
            "node": "Obtiene Detalle Pedido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agrupa Articulos": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Mensaje1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registra Pedido": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Traduce nombre": {
      "main": [
        [
          {
            "node": "Obtiene Pedido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ingresa Registro ReConfirmacion1": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select rows from a table2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Registra Cliente1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Actualiza Clientes1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Registra Cliente1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualiza Clientes1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Traduce nombre",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cada 10 min": {
      "main": [
        [
          {
            "node": "Get Data Inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data Inicial": {
      "main": [
        [
          {
            "node": "Obtiene Registros osakisucursal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Forma Respuestas En Viaje",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Forma Respuestas En Viaje": {
      "main": [
        [
          {
            "node": "Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        []
      ]
    },
    "Mensaje1": {
      "main": [
        [
          {
            "node": "Ingresa Registro ReConfirmacion1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Envia Mensaje WA Calle 47",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Envia Mensaje WA Calle 9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia Mensaje WA Calle 47": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia Mensaje WA Calle 9": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Envia Mensaje WA Calle 47 (nuevo)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Enviar texto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia Mensaje WA Calle 47 (nuevo)": {
      "main": [
        [
          {
            "node": "Select rows from a table2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia Mensaje WA Calle 9(nuevo)": {
      "main": [
        []
      ]
    },
    "Enviar texto1": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution bot": {
      "main": [
        [
          {
            "node": "Select rows from a table2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Evolution bot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-11T18:04:31.760Z",
  "id": "zuCaTofEfyHPk7VE",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Notificacion Pedidos",
  "nodes": [
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    'Calle 47' as sucursal,\n    a.idventa,\n    CASE \n        WHEN A.CodigoPedidoPlataforma IS NULL THEN 'TAKE AWAY' \n        WHEN A.CodigoPedidoPlataforma = '' THEN 'TAKE AWAY' \n        ELSE A.CodigoPedidoPlataforma \n    END AS CodigoPedidoPlataforma,\n    REPLACE(REPLACE(e.descripcion, 'Osaki2-', ''), 'Osaki-', '') as plataforma,\n    CASE \n        WHEN a.EntregaTipo = '1' THEN 'Delivery Propio' \n        WHEN a.EntregaTipo = '2' THEN 'Mostrador' \n        WHEN a.EntregaTipo = '3' THEN 'Delivery Externo' \n    END AS TipoEntrega,\n    CASE \n        WHEN b.Etapa = 'EP' THEN 'En PreparaciÃ³n'\n        WHEN b.Etapa = 'PR' THEN 'Preparado'\n        WHEN b.Etapa = 'PE' THEN 'Por Entregar'\n        WHEN b.Etapa = 'EV' THEN 'En Viaje'\n        WHEN b.Etapa = 'E' THEN 'Entregado'\n        WHEN b.Etapa = 'RG' THEN 'Pedido Cancelado'\n        ELSE 'Sin ClasificaciÃ³n' \n    END AS etapaPedido,\n    d.nombre,\n    c.Telefono,\n    CONCAT(c.Calle, ';', c.Numero) AS direccion,\n    b.FechaHoraApertura,\n    b.FechaHoraCierre,\n    a.FechaHoraEntrega\nFROM osakisucursal5.ventas_datospedido a\nJOIN osakisucursal5.ventas b \n    ON (b.IdVenta = a.IdVenta)\nJOIN osakisucursal5.clientespedidos_lugaresentrega c \n    ON (a.IdClientePedido = c.IdClientePedido AND a.IdLugarEntrega = c.IdLugarEntrega)\nJOIN osakisucursal5.clientespedidos d \n    ON (a.IdClientePedido = d.IdClientePedido)\nJOIN osakicentral.tvc_pedidos_plataformas e \n    ON (e.IdIntegracionPedidos = a.IdIntegracionPedidos)\n/* CAMBIO AQUÃ: Filtra por FechaHoraApertura en las Ãºltimas 4 horas desde AHORA mismo */\nWHERE b.FechaHoraApertura >= DATE_SUB(NOW(), INTERVAL 12 HOUR)\n\nUNION ALL\n\nSELECT \n    'Calle 9' as Sucursal,\n    a.idventa,\n    CASE \n        WHEN A.CodigoPedidoPlataforma IS NULL THEN 'TAKE AWAY' \n        WHEN A.CodigoPedidoPlataforma = '' THEN 'TAKE AWAY' \n        ELSE A.CodigoPedidoPlataforma \n    END AS CodigoPedidoPlataforma,\n    REPLACE(REPLACE(e.descripcion, 'Osaki2-', ''), 'Osaki-', '') as plataforma,\n    CASE \n        WHEN a.EntregaTipo = '1' THEN 'Delivery Propio' \n        WHEN a.EntregaTipo = '2' THEN 'Mostrador' \n        WHEN a.EntregaTipo = '3' THEN 'Delivery Externo' \n    END AS TipoEntrega,\n    CASE \n        WHEN b.Etapa = 'EP' THEN 'En PreparaciÃ³n'\n        WHEN b.Etapa = 'PR' THEN 'Preparado'\n        WHEN b.Etapa = 'PE' THEN 'Por Entregar'\n        WHEN b.Etapa = 'EV' THEN 'En Viaje'\n        WHEN b.Etapa = 'E' THEN 'Entregado'\n        WHEN b.Etapa = 'RG' THEN 'Pedido Cancelado'\n        ELSE 'Sin ClasificaciÃ³n' \n    END AS etapaPedido,\n    d.nombre,\n    c.Telefono,\n    CONCAT(c.Calle, ' ; ', c.Numero) AS direccion,\n    b.FechaHoraApertura,\n    b.FechaHoraCierre,\n    a.FechaHoraEntrega\nFROM osakisucursal4.ventas_datospedido a\nJOIN osakisucursal4.ventas b \n    ON (b.IdVenta = a.IdVenta)\nJOIN osakisucursal4.clientespedidos_lugaresentrega c \n    ON (a.IdClientePedido = c.IdClientePedido AND a.IdLugarEntrega = c.IdLugarEntrega)\nJOIN osakisucursal4.clientespedidos d \n    ON (a.IdClientePedido = d.IdClientePedido)\nJOIN osakicentral.tvc_pedidos_plataformas e \n    ON (e.IdIntegracionPedidos = a.IdIntegracionPedidos)\n/* CAMBIO AQUÃ: Filtra por FechaHoraApertura en las Ãºltimas 4 horas desde AHORA mismo */\nWHERE b.FechaHoraApertura >= DATE_SUB(NOW(), INTERVAL 12 HOUR);",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -3920,
        656
      ],
      "id": "47de3081-1992-454d-be6b-cbe6a10f04e9",
      "name": "Obtiene Registros osakisucursal",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "sFauwBpvViqW5yF3",
          "name": "MySQL Osaki-Ayres"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Contenedor para los resultados\nconst results = [];\n\n// Set para evitar telÃ©fonos repetidos\nconst seenNumbers = new Set();\n\nfor (const item of items) {\n  try {\n    const json = item.json;\n    \n    // --- LÃ“GICA 1: PROCESAMIENTO DE TELÃ‰FONO ---\n    const rawPhone = json.Telefono;\n    \n    // Si no hay telÃ©fono, descartamos la fila (segÃºn lÃ³gica anterior)\n    if (!rawPhone) continue;\n\n    // Separamos por barra, coma o guiÃ³n\n    // NO invertimos, porque queremos el PRIMERO (Izquierda)\n    const phoneParts = String(rawPhone).split(/[\\/|,]/);\n    let finalPhone = null;\n\n    for (const part of phoneParts) {\n      // Dejar solo nÃºmeros\n      const digits = part.replace(/\\D/g, '');\n\n      // Regla: MÃ­nimo 10 dÃ­gitos\n      if (digits.length >= 10) {\n        // Tomamos los Ãºltimos 10\n        finalPhone = digits.slice(-10);\n        // Break inmediato: Tomamos el PRIMERO vÃ¡lido que encontramos\n        break; \n      }\n    }\n\n    // Si no encontramos un telÃ©fono vÃ¡lido, saltamos al siguiente item\n    if (!finalPhone) continue;\n\n    // Regla: \"Sin repetirse\" (DeduplicaciÃ³n por telÃ©fono)\n    if (seenNumbers.has(finalPhone)) continue;\n    \n    // Si es Ãºnico, lo guardamos en el set y procedemos\n    seenNumbers.add(finalPhone);\n\n    // --- NUEVO CAMPO: CONSTRUCCIÃ“N DE SESSION ID ---\n    // Construir sessionId en formato: 5492215709598@s.whatsapp.net\n    // Usando el nÃºmero de telÃ©fono procesado\n    const sessionId = `549${finalPhone}@s.whatsapp.net`;\n\n    // --- LÃ“GICA 2: PROCESAMIENTO CÃ“DIGO DE PEDIDO ---\n    // Regla: \"Cuando tenga '/' muestre lo que estÃ¡ despuÃ©s\" (Derecha)\n    let finalCode = json.CodigoPedidoPlataforma; // Valor por defecto\n\n    if (finalCode) {\n      const codeStr = String(finalCode);\n      if (codeStr.includes('/')) {\n        const codeParts = codeStr.split('/');\n        // Tomamos el ÃšLTIMO elemento (lo que estÃ¡ despuÃ©s de la barra)\n        // .trim() elimina espacios en blanco accidentales\n        finalCode = codeParts[codeParts.length - 1].trim();\n      }\n    }\n\n    // --- CONSTRUCCIÃ“N DE SALIDA ---\n    // Clonamos el objeto original\n    const newItem = { ...json };\n    \n    // Actualizamos ambos campos con los valores limpios\n    newItem.Telefono = finalPhone;\n    newItem.CodigoPedidoPlataforma = finalCode;\n    \n    // Agregamos el nuevo campo sessionId\n    newItem.sessionId = sessionId;\n\n    results.push({ json: newItem });\n\n  } catch (error) {\n    console.log(`Error procesando fila ID ${item.json.idventa || '?'}:`, error);\n  }\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3632,
        656
      ],
      "id": "07a3fea5-1ccc-423b-8eb5-e07fa21bce29",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a692547c-39cd-41ad-9cbe-ade1a819b295",
              "leftValue": "={{ $json.isEmpty()}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3040,
        672
      ],
      "id": "2ba026ce-e247-4fc6-b942-1f7980e7ccbd",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "notificacion_pedidos",
          "mode": "list",
          "cachedResultName": "notificacion_pedidos"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $json.Telefono }}"
            },
            {
              "column": "idventa",
              "value": "={{ $json.idventa }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3216,
        672
      ],
      "id": "dab90e91-38cb-4949-86a1-8e8f9362f9f6",
      "name": "Select rows from a table",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -3424,
        656
      ],
      "id": "0df71809-29b2-424c-9b0a-0fe07bd1601a",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "notificacion_pedidos",
          "mode": "list",
          "cachedResultName": "notificacion_pedidos"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "notificacion_flag": true,
            "id": "={{ $('Select rows from a table').item.json.id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "idventa",
              "displayName": "idventa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "codigo_pedido",
              "displayName": "codigo_pedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal",
              "displayName": "sucursal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "plataforma",
              "displayName": "plataforma",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipoentrega",
              "displayName": "tipoentrega",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "etapapedido",
              "displayName": "etapapedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fechahoraapertura",
              "displayName": "fechahoraapertura",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fechahoracierre",
              "displayName": "fechahoracierre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fechahoraentrega",
              "displayName": "fechahoraentrega",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notificacion_flag",
              "displayName": "notificacion_flag",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            },
            {
              "id": "direccion",
              "displayName": "direccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -64,
        640
      ],
      "id": "b8efd3a8-0d15-43d9-bbb8-13862c8eb266",
      "name": "Update rows in a table",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $if( $(\"Get Data Inicial\").isExecuted, $('Get Data Inicial').first().json.schema,\"osaki_main\") }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "=n8n_chat_histories_delivery_{{ $json.sucursal }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Loop Over Items').item.json.sessionId }}",
            "message": "={\n  \"type\": \"ai\",\n  \"content\": \"{{ $json.mensaje }}\",\n  \"tool_calls\": [],\n  \"additional_kwargs\": {},\n  \"response_metadata\": {},\n  \"invalid_tool_calls\": []\n}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1072,
        640
      ],
      "id": "a8f7958e-9c31-4ce5-8073-bf983d2610b5",
      "name": "Ingresa Registro ReConfirmacion",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.tipoentrega }}",
                    "rightValue": "Mostrador",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "81d61675-4fc5-4122-9d13-df375599f3bd"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Mostrador"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d8b26676-a1a4-4175-b0d2-e1b522a5d4ad",
                    "leftValue": "={{ $json.tipoentrega }}",
                    "rightValue": "Delivery Propio",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Delivery Propio"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2400,
        672
      ],
      "id": "d3836b1b-188e-4438-96f0-d6c75dfcca4d",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para limpiar caracteres no alfanumÃ©ricos al inicio y final\nfunction limpiarString(str) {\n  if (!str) return '';\n  return str.toString().replace(/^[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘Ã¼Ãœ]+|[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘Ã¼Ãœ]+$/g, '');\n}\n\nreturn items.map(item => {\n  const datos = item.json;\n\n  // 1. Limpieza de variables\n  const nombre = limpiarString(datos.nombre);\n  const codigo = limpiarString(datos.codigo_pedido);\n  const sucursal = limpiarString(datos.sucursal);\n  const direccion = limpiarString(datos.direccion);\n\n  // 2. ExtracciÃ³n \"Literal\" de la hora (Sin conversiÃ³n de zona horaria)\n  // Input esperado: \"2025-12-13T15:31:47.000Z\" -> Queremos \"15:31\"\n  let horaSalidaTexto = \"00:00\";\n  \n  if (datos.fechahoraentrega && typeof datos.fechahoraentrega === 'string') {\n    // Dividimos por la \"T\" y tomamos los primeros 5 caracteres de la segunda parte\n    const partes = datos.fechahoraentrega.split('T'); \n    if (partes.length > 1) {\n        horaSalidaTexto = partes[1].substring(0, 5); \n    }\n  }\n\n  // 3. Plantillas de mensajes\n  const variantes = [\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENTREGA POR MOSTRADOR - CALOR HUMANO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `ğŸ‘‹ Hola *${nombre}*, Tu pedido *${codigo}* ya estÃ¡ listo y esperÃ¡ndote con mucho cariÃ±o en Osaki *${sucursal}*. Â¡Te esperamos! -Emi`,\n  `Â¡Todo listo con mucho amor, *${nombre}*! ğŸ›ï¸ Puedes pasar por Osaki *${sucursal}* a recoger tu orden *${codigo}*. Â¡Preparamos todo pensando en que lo disfrutes!`,\n  `âœ… *${nombre}*, nuestro equipo en Osaki *${sucursal}* terminÃ³ de preparar tu pedido *${codigo}* con toda la dedicaciÃ³n. ğŸ’• Â¡Puedes venir cuando gustes, estaremos encantados de verte!`,\n  `Tu pedido *${codigo}* te espera con ilusiÃ³n en Osaki *${sucursal}*, *${nombre}*. â¤ï¸ Â¡Gracias de corazÃ³n por elegirnos y confiar en nuestro trabajo!`,\n  `ğŸš€ Â¡Listo para entregarte! *${nombre}*, ya puedes retirar el pedido *${codigo}* en Osaki *${sucursal}*. Â¡Preparamos cada detalle pensando en ti!`,\n  `Hola *${nombre}*, te confirmamos con alegrÃ­a que tu orden *${codigo}* estÃ¡ empaquetada con cuidado y lista en Osaki *${sucursal}*. ğŸ˜Š Â¡Esperamos verte pronto!`,\n  `ğŸ”” AtenciÃ³n especial para ti, *${nombre}*: Tu pedido *${codigo}* se encuentra listo y perfecto en mostrador de Osaki *${sucursal}*. Â¡Te lo preparamos con todo nuestro amor! -Emi`,\n  `*${nombre}*, no olvides pasar por Osaki *${sucursal}*. ğŸ± Tu pedido *${codigo}* ya estÃ¡ esperÃ¡ndote con ese toque especial que tanto te gusta. Â¡Gracias por ser parte de nuestra familia!`,\n  `Â¡Ya estÃ¡ aquÃ­ listo para ti, *${nombre}*! âœ¨ Ven a Osaki *${sucursal}* por tu pedido *${codigo}*. Â¡Que lo disfrutes tanto como nosotros disfrutamos prepararlo!`,\n  `Solo para avisarte con mucho cariÃ±o, *${nombre}*: â¤ï¸ El pedido *${codigo}* estÃ¡ listo para pickup en Osaki *${sucursal}*. Â¡Tu satisfacciÃ³n es nuestra mayor alegrÃ­a!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENTREGA POR MOSTRADOR - TONO CERCANO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `ğŸ¥¡ *${nombre}*, tu comida estÃ¡ lista y fresquita, reciÃ©n preparada. Referencia: *${codigo}*. Lugar de retiro: Osaki *${sucursal}*. Â¡Gracias por elegir calidad!`,\n  `Â¡MisiÃ³n cumplida con Ã©xito! ğŸ¯ El pedido *${codigo}* para *${nombre}* estÃ¡ listo y perfecto en Osaki *${sucursal}*. Â¡Te esperamos con los brazos abiertos!`,\n  `Estimado/a *${nombre}*, con mucho gusto le informamos que su orden *${codigo}* puede ser retirada en Osaki *${sucursal}* desde este momento. ğŸ™ Â¡Gracias por su confianza!`,\n  `ğŸ½ï¸ Â¡A comer con alegrÃ­a, *${nombre}*! ğŸ‰ Pasa por Osaki *${sucursal}* con tu cÃ³digo *${codigo}*. Â¡Te tenemos todo listo para que disfrutes al mÃ¡ximo! -Emi`,\n  `Tu pedido *${codigo}* estÃ¡ listo, fresco y con ese sabor Ãºnico en Osaki *${sucursal}*, *${nombre}*. â¤ï¸ Â¡Te vemos pronto, serÃ¡ un gusto saludarte personalmente!`,\n  `Hola, *${nombre}*, ya tenemos tu orden *${codigo}* lista y esperÃ¡ndote en Osaki *${sucursal}*. ğŸ˜Š Â¡Pasa a buscarlo cuando puedas, estamos aquÃ­ para ti!`,\n  `Hola, *${nombre}*, nuestro chef avisa personalmente que el pedido *${codigo}* estÃ¡ listo y perfecto en Osaki *${sucursal}*. ğŸ‘¨â€ğŸ³ Â¡Preparado con toda la pasiÃ³n culinaria!`,\n  `Â¡Confirmado con mucha ilusiÃ³n, *${nombre}*! âœ¨ Orden *${codigo}* lista en Osaki *${sucursal}*. Â¿Vienes en camino? Â¡Te estamos esperando con alegrÃ­a! -Emi`,\n  `ğŸ“¦ *${nombre}*, tu entrega de mostrador (*${codigo}*) estÃ¡ lista y cuidadosamente preparada en Osaki *${sucursal}* para ti. ğŸ’• Â¡Gracias por permitirnos servirte hoy!`,\n  `Â¡Hey *${nombre}*! Ya puedes buscar el pedido *${codigo}* en Osaki *${sucursal}*. ğŸš€ Â¡Gracias por tu compra y por ser un cliente tan especial para nosotros!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENTREGA POR MOSTRADOR - APRECIO GENUINO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, tu pedido *${codigo}* estÃ¡ listo en Osaki *${sucursal}* y lo preparamos pensando en tu sonrisa. ğŸ˜Š Â¡Ven cuando quieras, serÃ¡ un placer verte!`,\n  `Â¡Excelentes noticias, *${nombre}*! ğŸŠ Tu orden *${codigo}* ya estÃ¡ terminada en Osaki *${sucursal}*. Â¡Preparada con dedicaciÃ³n y cariÃ±o! -Emi`,\n  `Hola *${nombre}*, solo querÃ­a avisarte personalmente que tu pedido *${codigo}* estÃ¡ listo en Osaki *${sucursal}*. â¤ï¸ Â¡Te esperamos con mucho cariÃ±o!`,\n  `âœ… Todo en orden, *${nombre}*! Tu pedido *${codigo}* estÃ¡ listo para ti en Osaki *${sucursal}*. Â¡Gracias por tu paciencia y confianza en nosotros!`,\n  `*${nombre}*, tu comida ya estÃ¡ lista y empaquetada con cuidado en Osaki *${sucursal}*. ğŸ± CÃ³digo: *${codigo}*. Â¡Esperamos que te encante tanto como a nosotros nos encanta prepararla!`,\n  `Â¡Listo y perfecto para ti, *${nombre}*! âœ¨ El pedido *${codigo}* te espera en Osaki *${sucursal}*. Â¡Gracias por elegirnos una vez mÃ¡s!`,\n  `Hola *${nombre}*, tenemos una sorpresa lista para ti en Osaki *${sucursal}*. ğŸ Tu pedido *${codigo}* estÃ¡ terminado. Â¡Ven a disfrutarlo! -Emi`,\n  `*${nombre}*, nuestro equipo terminÃ³ tu orden *${codigo}* con toda la dedicaciÃ³n en Osaki *${sucursal}*. ğŸ’ª Â¡Puedes retirarla cuando te sea cÃ³modo!`,\n  `Â¡Aviso especial para *${nombre}*: ğŸ›ï¸ Tu pedido *${codigo}* estÃ¡ listo en mostrador de Osaki *${sucursal}*. Â¡Preparado con ese toque especial que tanto te gusta!`,\n  `*${nombre}*, ya puedes venir por tu pedido *${codigo}* a Osaki *${sucursal}*. â¤ï¸ Â¡Lo preparamos con todo el cariÃ±o del mundo para ti!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENTREGA POR MOSTRADOR - INVITACIÃ“N CÃLIDA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `ğŸ‘‹ Â¡Hola de nuevo, *${nombre}*! Tu pedido *${codigo}* estÃ¡ listo y te espera en Osaki *${sucursal}*. Â¡SerÃ¡ un gusto saludarte personalmente! -Emi`,\n  `Â¡Todo preparado con ilusiÃ³n, *${nombre}*! ğŸ›ï¸ Tu orden *${codigo}* estÃ¡ lista en Osaki *${sucursal}*. Â¡Ven cuando puedas, estaremos felices de verte!`,\n  `âœ… MisiÃ³n cumplida con excelencia, *${nombre}*! El equipo de Osaki *${sucursal}* terminÃ³ tu pedido *${codigo}*. ğŸ’« Â¡Puedes pasar a recogerlo cuando quieras!`,\n  `Tu pedido *${codigo}* te espera con alegrÃ­a en Osaki *${sucursal}*, *${nombre}*. â¤ï¸ Â¡Gracias por ser un cliente tan especial para nosotros!`,\n  `ğŸš€ Â¡Listo para hacerte feliz! *${nombre}*, ya puedes retirar el pedido *${codigo}* en Osaki *${sucursal}*. Â¡Preparado con toda nuestra pasiÃ³n culinaria!`,\n  `Hola *${nombre}*, te confirmamos con mucha alegrÃ­a que tu orden *${codigo}* estÃ¡ empaquetada y lista en Osaki *${sucursal}*. ğŸ˜Š Â¡Esperamos verte muy pronto!`,\n  `ğŸ”” AtenciÃ³n, *${nombre}*: Tu pedido *${codigo}* se encuentra listo y perfecto en mostrador de Osaki *${sucursal}*. Â¡Te lo preparamos pensando en tu disfrute! -Emi`,\n  `*${nombre}*, recuerda pasar por Osaki *${sucursal}*. ğŸ± Tu pedido *${codigo}* ya estÃ¡ esperÃ¡ndote con ese sabor inigualable. Â¡Gracias por tu preferencia!`,\n  `Â¡Ya estÃ¡ aquÃ­ listo para endulzar tu dÃ­a, *${nombre}*! âœ¨ Ven a Osaki *${sucursal}* por tu pedido *${codigo}*. Â¡Que lo disfrutes muchÃ­simo!`,\n  `Solo un aviso con cariÃ±o, *${nombre}*: â¤ï¸ El pedido *${codigo}* estÃ¡ listo para pickup en Osaki *${sucursal}*. Â¡Tu felicidad es nuestra prioridad!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ENTREGA POR MOSTRADOR - CIERRE AFECTUOSO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `ğŸ¥¡ *${nombre}*, tu comida estÃ¡ lista y reciÃ©n hecha con amor. Referencia: *${codigo}*. Lugar: Osaki *${sucursal}*. Â¡Gracias por permitirnos servirte!`,\n  `Â¡MisiÃ³n cumplida con mucho corazÃ³n! ğŸ¯ El pedido *${codigo}* para *${nombre}* estÃ¡ listo en Osaki *${sucursal}*. Â¡Te esperamos con los brazos abiertos! -Emi`,\n  `Estimado/a *${nombre}*, es un placer informarle que su orden *${codigo}* estÃ¡ lista para retirar en Osaki *${sucursal}*. ğŸ™ Â¡Agradecemos profundamente su confianza!`,\n  `ğŸ½ï¸ Â¡A disfrutar con alegrÃ­a, *${nombre}*! ğŸ‰ Pasa por Osaki *${sucursal}* con tu cÃ³digo *${codigo}*. Â¡Todo listo para que tengas un momento delicioso!`,\n  `Tu pedido *${codigo}* estÃ¡ listo, fresco y con todo el sabor Osaki en *${sucursal}*, *${nombre}*. â¤ï¸ Â¡Te esperamos con una sonrisa!`,\n  `Hola, *${nombre}*, ya tenemos tu orden *${codigo}* lista y esperando por ti en Osaki *${sucursal}*. ğŸ˜Š Â¡Cuando quieras pasar, serÃ¡ un gusto atenderte!`,\n  `Hola, *${nombre}*, nuestro chef personalmente supervisÃ³ que el pedido *${codigo}* estÃ© perfecto en Osaki *${sucursal}*. ğŸ‘¨â€ğŸ³ Â¡Preparado con toda la maestrÃ­a! -Emi`,\n  `Â¡Confirmado con emociÃ³n, *${nombre}*! âœ¨ Orden *${codigo}* lista en Osaki *${sucursal}*. Â¡Estamos ansiosos por verte y que disfrutes tu pedido!`,\n  `ğŸ“¦ *${nombre}*, tu entrega (*${codigo}*) estÃ¡ lista y cuidadosamente preparada en Osaki *${sucursal}*. ğŸ’• Â¡Gracias por ser parte de nuestra historia!`,\n  `Â¡Hey *${nombre}*! Ya puedes venir por el pedido *${codigo}* a Osaki *${sucursal}*. ğŸš€ Â¡Gracias por tu compra y por hacernos parte de tu dÃ­a! -Emi`\n];\n\n  // 4. SelecciÃ³n aleatoria\n  const respuestaAleatoria = variantes[Math.floor(Math.random() * variantes.length)];\n\n  // 5. Retorno\n  return {\n    json: {\n      ...datos,\n      // Sobrescribimos las variables limpias para usarlas luego si hace falta\n      nombre, \n      direccion, \n      sucursal,\n      codigo_pedido: codigo,\n      // Agregamos los campos calculados\n      hora_salida_arg: horaSalidaTexto, \n      mensaje_en_viaje: respuestaAleatoria,\n      timestamp_generacion: new Date().toISOString()\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2128,
        576
      ],
      "id": "b0a6ea2a-a33f-4d18-9008-8e6675216a0b",
      "name": "Forma Respuestas Mostrador"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c685e5f2-4e6d-4aa7-9544-cf1f7657c370",
              "name": "mensaje",
              "value": "={{ $json.mensaje_en_viaje || $json.mensaje_retiro || $json.mensaje_delivery }}",
              "type": "string"
            },
            {
              "id": "255eb966-27be-4e1e-a2ad-87c288543642",
              "name": "sucursal",
              "value": "={{ $json.sucursal.replace(' ','_').toLowerCase() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1296,
        640
      ],
      "id": "951d906c-3e35-41ee-b6d3-939df90ea648",
      "name": "Mensaje"
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para limpiar caracteres no alfanumÃ©ricos al inicio y final\nfunction limpiarString(str) {\n  if (!str) return '';\n  return str.toString().replace(/^[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘Ã¼Ãœ]+|[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘Ã¼Ãœ]+$/g, '');\n}\n\nreturn items.map(item => {\n  const datos = item.json;\n\n  // 1. Limpieza de variables\n  const nombre = limpiarString(datos.nombre);\n  const codigo = limpiarString(datos.codigo_pedido);\n  const sucursal = limpiarString(datos.sucursal);\n  const direccion = limpiarString(datos.direccion);\n\n  // 2. ExtracciÃ³n \"Literal\" de la hora (Sin conversiÃ³n de zona horaria)\n  // Input esperado: \"2025-12-13T15:31:47.000Z\" -> Queremos \"15:31\"\n  let horaSalidaTexto = \"00:00\";\n  \n  if (datos.fechahoraentrega && typeof datos.fechahoraentrega === 'string') {\n    // Dividimos por la \"T\" y tomamos los primeros 5 caracteres de la segunda parte\n    const partes = datos.fechahoraentrega.split('T'); \n    if (partes.length > 1) {\n        horaSalidaTexto = partes[1].substring(0, 5); \n    }\n  }\n\n\n    // --- ESCENARIO A: CON DIRECCIÃ“N ---\n    // Incluye: Nombre, CÃ³digo, Sucursal y DirecciÃ³n\n    variantes = [\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL INICIO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    `Â¡A las *${horaSalidaTexto}* saliÃ³ desde Osaki *${sucursal}* hacia *${direccion}*, *${nombre}*! ğŸ›µ Tu pedido *${codigo}* ya estÃ¡ en camino con mucho cuidado. Â¡Gracias por tu confianza! -Emi`,\n    `A las *${horaSalidaTexto}* partiÃ³ con prontitud hacia *${direccion}*, *${nombre}*. âœ¨ Tu pedido *${codigo}* de Osaki ya va en camino desde *${sucursal}*. Â¡Que disfrutes cada bocado con amor!`,\n    `Nuestro repartidor saliÃ³ a las *${horaSalidaTexto}*, *${nombre}*. ğŸ’• Tu orden *${codigo}* de Osaki *${sucursal}* ya estÃ¡ rumbo a *${direccion}*. Â¡Aprecio enormemente tu paciencia!`,\n    `A las *${horaSalidaTexto}* exactamente emprendiÃ³ el viaje hacia *${direccion}*, *${nombre}*. ğŸš€ Tu pedido *${codigo}* de Osaki ya saliÃ³. Â¡Te lo enviamos con todo nuestro cariÃ±o!`,\n    `El delivery partiÃ³ a las *${horaSalidaTexto}*, *${nombre}*. ğŸ™ Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ en ruta hacia *${direccion}*. Â¡Mil gracias por elegirnos hoy!`,\n    `A las *${horaSalidaTexto}* comenzÃ³ el trayecto hacia *${direccion}*, *${nombre}*. ğŸ˜Š Tu sushi de Osaki ya va camino a tu direcciÃ³n. Â¡Gracias por confiar en nosotros!`,\n    `Nuestro repartidor saliÃ³ puntual a las *${horaSalidaTexto}*, *${nombre}*. ğŸ’« Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ viajando hacia *${direccion}*. Â¡Valoro muchÃ­simo tu preferencia! -Emi`,\n    `A las *${horaSalidaTexto}* dejamos atrÃ¡s nuestro local rumbo a *${direccion}*, *${nombre}*. ğŸ£ Tu pedido *${codigo}* de Osaki ya estÃ¡ en movimiento. Â¡Esperamos que te encante!`,\n    `El viaje comenzÃ³ a las *${horaSalidaTexto}*, *${nombre}*. â¤ï¸ Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ en camino hacia *${direccion}*. Â¡Gracias de corazÃ³n por pensar en nosotros!`,\n    `A las *${horaSalidaTexto}* partiÃ³ con toda la prisa hacia *${direccion}*, *${nombre}*. ğŸ›µ Tu pedido *${codigo}* de Osaki ya saliÃ³. Â¡Estamos felices de servirte! -Emi`,\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TEMPRANO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    `Â¡Buenas noticias, *${nombre}*! ğŸ‰ El pedido *${codigo}* de Osaki *${sucursal}* ya va en camino hacia *${direccion}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu increÃ­ble paciencia! -Emi`,\n    `*${nombre}*, tu sushi de Osaki ya va rumbo a *${direccion}* con mucho amor. â¤ï¸ El pedido *${codigo}* saliÃ³ desde *${sucursal}* a las *${horaSalidaTexto}*. Â¡Esperamos que te guste tanto como a nosotros prepararlo!`,\n    `Hola *${nombre}*! Con alegrÃ­a te aviso que el repartidor saliÃ³ de Osaki *${sucursal}* ğŸ›µ con tu pedido *${codigo}* a las *${horaSalidaTexto}* hacia *${direccion}*. Â¡Te agradezco de todo corazÃ³n!`,\n    `*${nombre}*, tu orden *${codigo}* de Osaki *${sucursal}* va hacia *${direccion}* con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Gracias por ser parte de nuestra familia Osaki!`,\n    `*${nombre}*, te avisamos con mucha ilusiÃ³n que el pedido *${codigo}* de Osaki ya estÃ¡ viajando desde *${sucursal}* hacia *${direccion}*. ğŸš— Salimos a las *${horaSalidaTexto}*. Â¡Tu satisfacciÃ³n es nuestra mayor recompensa! -Emi`,\n    `Â¡Listo, *${nombre}*! âœ¨ El repartidor de Osaki ya lleva tu pedido *${codigo}* desde *${sucursal}* hacia *${direccion}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por permitirnos acompaÃ±ar tu dÃ­a!`,\n    `*${nombre}*, tu pedido *${codigo}* saliÃ³ reciÃ©n de Osaki *${sucursal}* con mucho cuidado. â¤ï¸ Salimos a las *${horaSalidaTexto}* hacia *${direccion}*. Â¡Que lo disfrutes con quienes mÃ¡s quieres!`,\n    `Hola *${nombre}*! Con alegrÃ­a confirmo que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. ğŸ£ Ya estÃ¡ en viaje hacia *${direccion}*. Â¡Gracias por elegir calidad y sabor!`,\n    `*${nombre}*, el delivery ya partiÃ³ de Osaki *${sucursal}* ğŸš€ con tu pedido *${codigo}* a las *${horaSalidaTexto}*. Va derecho hacia *${direccion}*. Â¡Agradezco profundamente tu confianza! -Emi`,\n    `*${nombre}*, tu pedido *${codigo}* de Osaki *${sucursal}* estÃ¡ oficialmente *en viaje* con toda la prontitud hacia *${direccion}*. ğŸ’« Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu paciencia y comprensiÃ³n!`,\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TARDÃO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    `Â¡AtenciÃ³n *${nombre}*! ğŸ˜Š Tu pedido *${codigo}* ya dejÃ³ Osaki *${sucursal}* a las *${horaSalidaTexto}* y va camino a *${direccion}*. Â¡Gracias por hacernos parte de tu dÃ­a! -Emi`,\n    `Hola *${nombre}*! Con mucha alegrÃ­a te cuento que el pedido *${codigo}* estÃ¡ viajando desde Osaki *${sucursal}* hacia *${direccion}*. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Es un placer servirte!`,\n    `*${nombre}*, el delivery saliÃ³ de Osaki *${sucursal}* con tu orden *${codigo}* a las *${horaSalidaTexto}* y mucho cuidado. ğŸš— Ya estÃ¡ rumbo a *${direccion}*. Â¡Gracias por tu increÃ­ble apoyo!`,\n    `*${nombre}*, tu pedido *${codigo}* ya va avanzando desde Osaki *${sucursal}* con toda prontitud hacia *${direccion}*. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Que tengas un momento delicioso! -Emi`,\n    `Â¡Ya estÃ¡ en camino, *${nombre}*! âœ¨ El repartidor de Osaki *${sucursal}* lleva tu pedido *${codigo}* hacia *${direccion}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por preferir nuestro sabor!`,\n    `*${nombre}*, el pedido *${codigo}* estÃ¡ viajando desde Osaki *${sucursal}* con toda seguridad hacia *${direccion}*. ğŸ›µ Salimos a las *${horaSalidaTexto}*. Â¡Apreciamos mucho que nos elijas una y otra vez!`,\n    `Hola *${nombre}*! Con ilusiÃ³n te aviso que el pedido *${codigo}* saliÃ³ en viaje desde Osaki *${sucursal}* a las *${horaSalidaTexto}* hacia *${direccion}*. â¤ï¸ Â¡Gracias por tu maravillosa paciencia! -Emi`,\n    `*${nombre}*, tu sushi ya estÃ¡ viajando con mucho amor hacia *${direccion}*. ğŸ£ El pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. Â¡Esperamos que sea tan rico como esperas!`,\n    `*${nombre}*, confirmamos con alegrÃ­a que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}* hacia *${direccion}*. ğŸš€ Â¡Gracias por confiar en nuestro trabajo!`,\n    `Hola *${nombre}*! El repartidor de Osaki *${sucursal}* ya lleva tu pedido *${codigo}* con toda prontitud hacia *${direccion}*. ğŸ’« Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu fidelidad! -Emi`,\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL FINAL (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    `*${nombre}*, tu pedido *${codigo}* de Osaki estÃ¡ en trÃ¡nsito con mucho cuidado hacia *${direccion}*. â¤ï¸ SaliÃ³ reciÃ©n de *${sucursal}* a las *${horaSalidaTexto}*. Â¡Gracias por tu increÃ­ble confianza!`,\n    `*${nombre}*, el pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* con toda prontitud a las *${horaSalidaTexto}*. ğŸ˜Š Va camino a *${direccion}*. Â¡Que disfrutes cada momento! -Emi`,\n    `Hola *${nombre}*! Tu pedido *${codigo}* saliÃ³ en viaje desde Osaki *${sucursal}* con mucho amor hacia *${direccion}*. ğŸ£ Salimos a las *${horaSalidaTexto}*. Â¡Gracias por permitirnos endulzar tu dÃ­a!`,\n    `*${nombre}*, te avisamos con alegrÃ­a que el pedido *${codigo}* va desde Osaki *${sucursal}* hacia *${direccion}*. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Apreciamos mucho tu preferencia!`,\n    `*${nombre}*, tu orden *${codigo}* ya dejÃ³ Osaki *${sucursal}* con toda seguridad a las *${horaSalidaTexto}*. ğŸš— En viaje directo hacia *${direccion}*. Â¡Gracias por ser un cliente tan especial! -Emi`,\n    `Hola *${nombre}*! Tu pedido *${codigo}* de Osaki *${sucursal}* estÃ¡ en ruta con mucho cuidado hacia *${direccion}*. âœ¨ Salimos a las *${horaSalidaTexto}*. Â¡Es un honor servirte hoy!`,\n    `*${nombre}*, gracias de corazÃ³n por elegir Osaki. ğŸ™ Tu pedido *${codigo}* saliÃ³ desde *${sucursal}* a las *${horaSalidaTexto}* hacia *${direccion}*. Â¡Que tengas un excelente dÃ­a!`,\n    `*${nombre}*, el pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ acercÃ¡ndose con toda prontitud hacia *${direccion}*. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu maravillosa paciencia! -Emi`,\n    `Hola *${nombre}*! El pedido *${codigo}* ya estÃ¡ en movimiento desde Osaki *${sucursal}* con mucho cuidado hacia *${direccion}*. ğŸš€ Salimos a las *${horaSalidaTexto}*. Â¡Agradezco profundamente tu elecciÃ³n!`,\n    `*${nombre}*, tu pedido *${codigo}* de Osaki ya estÃ¡ en camino desde *${sucursal}* con toda la dedicaciÃ³n hacia *${direccion}*. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Gracias por ser parte de nuestra historia! -Emi`,\n\n    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA COMO INCISO / FRAGMENTADA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n    `*${nombre}*, Â¡excelentes noticias! ğŸŠ Tu pedido *${codigo}* de Osaki *${sucursal}* ya saliÃ³ (a las *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Gracias por tu confianza infinita! -Emi`,\n    `Â¡Buenas noticias, *${nombre}*! âœ¨ El pedido *${codigo}* de Osaki *${sucursal}* ya va en camino â€”salimos a las *${horaSalidaTexto}*â€” hacia *${direccion}*. Â¡Que tengas un momento maravilloso!`,\n    `*${nombre}*, tu sushi de Osaki ya va rumbo a *${direccion}* con todo nuestro amor. â¤ï¸ El pedido *${codigo}* saliÃ³ desde *${sucursal}* (a las *${horaSalidaTexto}*). Â¡Gracias por tu increÃ­ble apoyo! -Emi`,\n    `Hola *${nombre}*! Con mucha alegrÃ­a te aviso que el repartidor saliÃ³ de Osaki *${sucursal}* con tu pedido *${codigo}* ğŸ›µ (salida: *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Te agradezco de todo corazÃ³n!`,\n    `*${nombre}*, tu orden *${codigo}* de Osaki *${sucursal}* va hacia *${direccion}* â€”salida a las *${horaSalidaTexto}*â€”. ğŸ’• Â¡Gracias por tu paciencia y comprensiÃ³n! -Emi`,\n    `*${nombre}*, te avisamos con ilusiÃ³n que el pedido *${codigo}* de Osaki ya estÃ¡ viajando desde *${sucursal}* (salida: *${horaSalidaTexto}*) hacia *${direccion}*. ğŸš— Â¡Es un placer poder servirte hoy!`,\n    `Â¡Listo, *${nombre}*! â¤ï¸ El repartidor de Osaki ya lleva tu pedido *${codigo}* desde *${sucursal}* â€”salida *${horaSalidaTexto}*â€” hacia *${direccion}*. Â¡Gracias por ser un cliente tan especial! -Emi`,\n    `*${nombre}*, tu pedido *${codigo}* saliÃ³ reciÃ©n de Osaki *${sucursal}* con mucho cuidado âœ¨ (a las *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Que disfrutes este momento con quienes mÃ¡s quieres!`,\n    `Hola *${nombre}*! Con alegrÃ­a confirmo que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* ğŸ£ (a las *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Gracias por preferir la calidad Osaki! -Emi`,\n    `*${nombre}*, el delivery ya partiÃ³ de Osaki *${sucursal}* con tu pedido *${codigo}* â€”salida *${horaSalidaTexto}*â€” hacia *${direccion}*. ğŸš€ Â¡Gracias por permitirnos acompaÃ±ar tus momentos especiales!`,\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL INICIO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡A las *${horaSalidaTexto}* saliÃ³ desde Osaki *${sucursal}*, *${nombre}*! ğŸ›µ Tu pedido *${codigo}* ya estÃ¡ en camino con mucho cuidado. Â¡Gracias por tu confianza! -Emi`,\n  `A las *${horaSalidaTexto}* partiÃ³ con prontitud, *${nombre}*. âœ¨ Tu pedido *${codigo}* de Osaki ya va en camino desde nuestra cocina. Â¡Que disfrutes cada bocado con amor!`,\n  `Nuestro repartidor saliÃ³ a las *${horaSalidaTexto}*, *${nombre}*. ğŸ’• Tu orden *${codigo}* de Osaki *${sucursal}* ya estÃ¡ rumbo hacia ti. Â¡Aprecio enormemente tu paciencia!`,\n  `A las *${horaSalidaTexto}* exactamente emprendiÃ³ el viaje, *${nombre}*. ğŸš€ Tu pedido *${codigo}* de Osaki ya saliÃ³. Â¡Te lo enviamos con todo nuestro cariÃ±o!`,\n  `El delivery partiÃ³ a las *${horaSalidaTexto}*, *${nombre}*. ğŸ™ Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ en ruta hacia tu domicilio. Â¡Mil gracias por elegirnos hoy!`,\n  `A las *${horaSalidaTexto}* comenzÃ³ el trayecto, *${nombre}*. ğŸ˜Š Tu sushi de Osaki ya va camino hacia vos. Â¡Gracias por confiar en nosotros!`,\n  `Nuestro repartidor saliÃ³ puntual a las *${horaSalidaTexto}*, *${nombre}*. ğŸ’« Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ viajando hacia ti. Â¡Valoro muchÃ­simo tu preferencia! -Emi`,\n  `A las *${horaSalidaTexto}* dejamos atrÃ¡s nuestro local, *${nombre}*. ğŸ£ Tu pedido *${codigo}* de Osaki ya estÃ¡ en movimiento hacia tu direcciÃ³n. Â¡Esperamos que te encante!`,\n  `El viaje comenzÃ³ a las *${horaSalidaTexto}*, *${nombre}*. â¤ï¸ Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ en camino hacia vos. Â¡Gracias de corazÃ³n por pensar en nosotros!`,\n  `A las *${horaSalidaTexto}* partiÃ³ con toda la prisa, *${nombre}*. ğŸ›µ Tu pedido *${codigo}* de Osaki ya saliÃ³. Â¡Estamos felices de servirte! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TEMPRANO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡Buenas noticias, *${nombre}*! ğŸ‰ El pedido *${codigo}* de Osaki *${sucursal}* ya va en camino. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu increÃ­ble paciencia! -Emi`,\n  `*${nombre}*, tu sushi de Osaki ya va rumbo a vos con mucho amor. â¤ï¸ El pedido *${codigo}* saliÃ³ desde *${sucursal}* a las *${horaSalidaTexto}*. Â¡Esperamos que te guste tanto como a nosotros prepararlo!`,\n  `Hola *${nombre}*! Con alegrÃ­a te aviso que el repartidor saliÃ³ de Osaki *${sucursal}* ğŸ›µ con tu pedido *${codigo}* a las *${horaSalidaTexto}*. Â¡Te agradezco de todo corazÃ³n!`,\n  `*${nombre}*, tu orden *${codigo}* de Osaki *${sucursal}* va hacia tu direcciÃ³n con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Gracias por ser parte de nuestra familia Osaki!`,\n  `*${nombre}*, te avisamos con mucha ilusiÃ³n que el pedido *${codigo}* de Osaki ya estÃ¡ viajando desde *${sucursal}*. ğŸš— Salimos a las *${horaSalidaTexto}*. Â¡Tu satisfacciÃ³n es nuestra mayor recompensa! -Emi`,\n  `Â¡Listo, *${nombre}*! âœ¨ El repartidor de Osaki ya lleva tu pedido *${codigo}* desde *${sucursal}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por permitirnos acompaÃ±ar tu dÃ­a!`,\n  `*${nombre}*, tu pedido *${codigo}* saliÃ³ reciÃ©n de Osaki *${sucursal}* con mucho cuidado. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Que lo disfrutes con quienes mÃ¡s quieres!`,\n  `Hola *${nombre}*! Con alegrÃ­a confirmo que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. ğŸ£ Ya estÃ¡ en viaje hacia vos. Â¡Gracias por elegir calidad y sabor!`,\n  `*${nombre}*, el delivery ya partiÃ³ de Osaki *${sucursal}* ğŸš€ con tu pedido *${codigo}* a las *${horaSalidaTexto}*. Va derecho hacia tu domicilio. Â¡Agradezco profundamente tu confianza! -Emi`,\n  `*${nombre}*, tu pedido *${codigo}* de Osaki *${sucursal}* estÃ¡ oficialmente *en viaje* con toda la prontitud. ğŸ’« Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu paciencia y comprensiÃ³n!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TARDÃO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡AtenciÃ³n *${nombre}*! ğŸ˜Š Tu pedido *${codigo}* ya dejÃ³ Osaki *${sucursal}* a las *${horaSalidaTexto}* y va camino hacia vos. Â¡Gracias por hacernos parte de tu dÃ­a! -Emi`,\n  `Hola *${nombre}*! Con mucha alegrÃ­a te cuento que el pedido *${codigo}* estÃ¡ viajando desde Osaki *${sucursal}*. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Es un placer servirte!`,\n  `*${nombre}*, el delivery saliÃ³ de Osaki *${sucursal}* con tu orden *${codigo}* a las *${horaSalidaTexto}* y mucho cuidado. ğŸš— Ya estÃ¡ rumbo a tu domicilio. Â¡Gracias por tu increÃ­ble apoyo!`,\n  `*${nombre}*, tu pedido *${codigo}* ya va avanzando desde Osaki *${sucursal}* con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Que tengas un momento delicioso! -Emi`,\n  `Â¡Ya estÃ¡ en camino, *${nombre}*! âœ¨ El repartidor de Osaki *${sucursal}* lleva tu pedido *${codigo}* hacia tu direcciÃ³n. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por preferir nuestro sabor!`,\n  `*${nombre}*, el pedido *${codigo}* estÃ¡ viajando desde Osaki *${sucursal}* con toda seguridad. ğŸ›µ Salimos a las *${horaSalidaTexto}*. Â¡Apreciamos mucho que nos elijas una y otra vez!`,\n  `Hola *${nombre}*! Con ilusiÃ³n te aviso que el pedido *${codigo}* saliÃ³ en viaje desde Osaki *${sucursal}* a las *${horaSalidaTexto}*. â¤ï¸ Â¡Gracias por tu maravillosa paciencia! -Emi`,\n  `*${nombre}*, tu sushi ya estÃ¡ viajando con mucho amor hacia tu domicilio. ğŸ£ El pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. Â¡Esperamos que sea tan rico como esperas!`,\n  `*${nombre}*, confirmamos con alegrÃ­a que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. ğŸš€ El repartidor va hacia tu direcciÃ³n. Â¡Gracias por confiar en nuestro trabajo!`,\n  `Hola *${nombre}*! El repartidor de Osaki *${sucursal}* ya lleva tu pedido *${codigo}* con toda prontitud. ğŸ’« Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu fidelidad! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL FINAL (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, tu pedido *${codigo}* de Osaki estÃ¡ en trÃ¡nsito con mucho cuidado. â¤ï¸ SaliÃ³ reciÃ©n de *${sucursal}* a las *${horaSalidaTexto}*. Â¡Gracias por tu increÃ­ble confianza!`,\n  `*${nombre}*, el pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* con toda prontitud a las *${horaSalidaTexto}*. ğŸ˜Š Va camino a entregarse. Â¡Que disfrutes cada momento! -Emi`,\n  `Hola *${nombre}*! Tu pedido *${codigo}* saliÃ³ en viaje desde Osaki *${sucursal}* con mucho amor. ğŸ£ Salimos a las *${horaSalidaTexto}*. Â¡Gracias por permitirnos endulzar tu dÃ­a!`,\n  `*${nombre}*, te avisamos con alegrÃ­a que el pedido *${codigo}* va desde Osaki *${sucursal}* hacia tu domicilio. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Apreciamos mucho tu preferencia!`,\n  `*${nombre}*, tu orden *${codigo}* ya dejÃ³ Osaki *${sucursal}* con toda seguridad a las *${horaSalidaTexto}*. ğŸš— En viaje directo hacia vos. Â¡Gracias por ser un cliente tan especial! -Emi`,\n  `Hola *${nombre}*! Tu pedido *${codigo}* de Osaki *${sucursal}* estÃ¡ en ruta con mucho cuidado. âœ¨ Salimos a las *${horaSalidaTexto}*. Â¡Es un honor servirte hoy!`,\n  `*${nombre}*, gracias de corazÃ³n por elegir Osaki. ğŸ™ Tu pedido *${codigo}* saliÃ³ desde *${sucursal}* a las *${horaSalidaTexto}*. Â¡Que tengas un excelente dÃ­a!`,\n  `*${nombre}*, el pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ acercÃ¡ndose con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu maravillosa paciencia! -Emi`,\n  `Hola *${nombre}*! El pedido *${codigo}* ya estÃ¡ en movimiento desde Osaki *${sucursal}* con mucho cuidado. ğŸš€ Salimos a las *${horaSalidaTexto}*. Â¡Agradezco profundamente tu elecciÃ³n!`,\n  `*${nombre}*, tu pedido *${codigo}* de Osaki ya estÃ¡ en camino desde *${sucursal}* con toda la dedicaciÃ³n. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Gracias por ser parte de nuestra historia! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA COMO INCISO / FRAGMENTADA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, Â¡excelentes noticias! ğŸŠ Tu pedido *${codigo}* de Osaki *${sucursal}* ya saliÃ³ (a las *${horaSalidaTexto}*). Â¡Gracias por tu confianza infinita! -Emi`,\n  `Â¡Buenas noticias, *${nombre}*! âœ¨ El pedido *${codigo}* de Osaki *${sucursal}* ya va en camino â€”salimos a las *${horaSalidaTexto}*â€”. Â¡Que tengas un momento maravilloso!`,\n  `*${nombre}*, tu sushi de Osaki ya va rumbo a vos con todo nuestro amor. â¤ï¸ El pedido *${codigo}* saliÃ³ desde *${sucursal}* (a las *${horaSalidaTexto}*). Â¡Gracias por tu increÃ­ble apoyo! -Emi`,\n  `Hola *${nombre}*! Con mucha alegrÃ­a te aviso que el repartidor saliÃ³ de Osaki *${sucursal}* con tu pedido *${codigo}* ğŸ›µ (salida: *${horaSalidaTexto}*). Â¡Te agradezco de todo corazÃ³n!`,\n  `*${nombre}*, tu orden *${codigo}* de Osaki *${sucursal}* va hacia tu domicilio â€”salida a las *${horaSalidaTexto}*â€”. ğŸ’• Â¡Gracias por tu paciencia y comprensiÃ³n! -Emi`,\n  `*${nombre}*, te avisamos con ilusiÃ³n que el pedido *${codigo}* de Osaki ya estÃ¡ viajando desde *${sucursal}* (salida: *${horaSalidaTexto}*). ğŸš— Â¡Es un placer poder servirte hoy!`,\n  `Â¡Listo, *${nombre}*! â¤ï¸ El repartidor de Osaki ya lleva tu pedido *${codigo}* desde *${sucursal}* â€”salida *${horaSalidaTexto}*â€”. Â¡Gracias por ser un cliente tan especial! -Emi`,\n  `*${nombre}*, tu pedido *${codigo}* saliÃ³ reciÃ©n de Osaki *${sucursal}* con mucho cuidado âœ¨ (a las *${horaSalidaTexto}*). Â¡Que disfrutes este momento con quienes mÃ¡s quieres!`,\n  `Hola *${nombre}*! Con alegrÃ­a confirmo que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* ğŸ£ (a las *${horaSalidaTexto}*). Â¡Gracias por preferir la calidad Osaki! -Emi`,\n  `*${nombre}*, el delivery ya partiÃ³ de Osaki *${sucursal}* con tu pedido *${codigo}* â€”salida *${horaSalidaTexto}*â€”. ğŸš€ Â¡Gracias por permitirnos acompaÃ±ar tus momentos especiales!`\n];\n\n\n\n  // 4. SelecciÃ³n aleatoria\n  const respuestaAleatoria = variantes[Math.floor(Math.random() * variantes.length)];\n\n  // 5. Retorno\n  return {\n    json: {\n      ...datos,\n      // Sobrescribimos las variables limpias para usarlas luego si hace falta\n      nombre, \n      direccion, \n      sucursal,\n      codigo_pedido: codigo,\n      // Agregamos los campos calculados\n      hora_salida_arg: horaSalidaTexto, \n      mensaje_en_viaje: respuestaAleatoria,\n      timestamp_generacion: new Date().toISOString()\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2128,
        736
      ],
      "id": "9b0b0e0e-76fb-42a6-8e46-62ff56bd0994",
      "name": "Forma Respuestas Delivery"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "notificacion_pedidos",
          "mode": "list",
          "cachedResultName": "notificacion_pedidos"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "etapapedido": "={{ $('Loop Over Items').item.json.etapaPedido }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "idventa",
              "displayName": "idventa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "codigo_pedido",
              "displayName": "codigo_pedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "sucursal",
              "displayName": "sucursal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "plataforma",
              "displayName": "plataforma",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipoentrega",
              "displayName": "tipoentrega",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "etapapedido",
              "displayName": "etapapedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fechahoraapertura",
              "displayName": "fechahoraapertura",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fechahoracierre",
              "displayName": "fechahoracierre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fechahoraentrega",
              "displayName": "fechahoraentrega",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "notificacion_flag",
              "displayName": "notificacion_flag",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "direccion",
              "displayName": "direccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2832,
        688
      ],
      "id": "b65c646c-30cb-44a1-9dab-9fecc739f594",
      "name": "Update rows in a table1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $('Loop Over Items').item.json.Telefono }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        160,
        640
      ],
      "id": "238738e1-82a0-4f2a-b691-b80cad1001cc",
      "name": "Select rows from a table1",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21f3249c-0daa-4ac1-9be2-e89b189dffbd",
              "leftValue": "={{ $json.isEmpty()}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        368,
        640
      ],
      "id": "174a8aad-76b6-41fa-9f61-e9a84dc590db",
      "name": "If"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha_registro": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "canal": "Whatsapp",
            "telefono": "={{ $('Loop Over Items').item.json.Telefono }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "tipo_atencion": "IA",
            "notas": "Seguimiento Pedido",
            "status": "NotificaciÃ³n Pedido Listo",
            "tipo_cliente": "Pedidos",
            "intencion": "Pedido"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        576,
        576
      ],
      "id": "dbdba73d-5b13-4b02-9756-9f7c447a97c9",
      "name": "Registra Cliente",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "intencion": "Pedido",
            "tipo_atencion": "IA"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        576,
        704
      ],
      "id": "e64e4d62-a5af-4040-b337-7b184b00bcf8",
      "name": "Actualiza Clientes",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        784,
        640
      ],
      "id": "e41f0775-c24d-4356-b0e4-a070a983aacd",
      "name": "Wait",
      "webhookId": "a7979626-304a-4fc3-8881-8c04861116b6"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT a.IdVenta, c.Descripcion as Articulo, c.DescripcionDetalle as Articulo_Detalle, b.Observaciones\nFROM osakisucursal{{  $('Traduce nombre').item.json.sucursal }}.ventas_comandas A\nJOIN osakisucursal{{  $('Traduce nombre').item.json.sucursal }}.ventas_comandas_items B\nON (a.IdComanda= b.IdComanda)\njoin osakicentral.articulos C\nON (b.IdArticulo=c.IdArticulo)\njoin osakisucursal{{  $('Traduce nombre').item.json.sucursal }}.ventas_datospedido d\non (d.IdVenta=a.IdVenta)\njoin osakisucursal{{  $('Traduce nombre').item.json.sucursal }}.clientespedidos e\non (e.IdClientePedido = d.IdClientePedido) \njoin osakicentral.tvc_pedidos_plataformas f\non (d.IdIntegracionPedidos = f.IdIntegracionPedidos)\nwhere c.idarticulo  not in (551,549,548,550)\nand  a.IdVenta = {{ $json.idventa }}\n;",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -1936,
        0
      ],
      "id": "64cd7592-9fac-4279-8a56-e4ef16877bb0",
      "name": "Obtiene Detalle Pedido",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "sFauwBpvViqW5yF3",
          "name": "MySQL Osaki-Ayres"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "\n\nSELECT a.idventa, \nCASE \nWHEN a.EntregaTipo = '1' THEN 'Delivery Propio' \nWHEN a.EntregaTipo = '2' THEN 'Mostrador' \nWHEN a.EntregaTipo = '3' THEN 'Delivery Externo' \nEND AS TipoEntrega,\nreplace(replace(e.descripcion,'Osaki2-',''),'Osaki-','') as plataforma,\nCASE \n    WHEN TRIM(COALESCE(a.CodigoPedidoPlataforma, '')) = '' THEN 'TAKE AWAY'\n    ELSE REGEXP_SUBSTR(a.CodigoPedidoPlataforma, '[0-9]+$')\nEND AS CodigoPedidoPlataforma,\nCASE WHEN b.Etapa = 'EP' THEN 'En PreparaciÃ³n'\n     WHEN b.Etapa = 'PR' THEN 'Preparado'\n     WHEN b.Etapa = 'PE' THEN 'Por Entregar'\n     WHEN b.Etapa = 'EV' THEN 'En Viaje'\n     WHEN (b.Etapa = 'E' AND a.EntregaTipo in ('3','1') ) THEN 'En reparto'\n     WHEN (b.Etapa = 'E' AND a.EntregaTipo = '2' ) THEN 'Listo para retiro'\n     WHEN b.Etapa = 'RG' THEN 'Pedido Cancelado'\n     ELSE 'Sin ClasificaciÃ³n' END as etapaPedido,\n     d.nombre as Nombre, c.Telefono, c.Calle, c.Numero, c.EntreCalles, c.Localidad, c.Observaciones,\nCASE WHEN A.CanceladoExterno = 0 THEN 'No'\n     ELSE 'SÃ­' END as PedidoCancelado,\n CASE \n    WHEN b.Observaciones LIKE '%|%' THEN TRIM(SUBSTRING_INDEX(b.Observaciones, '|', -1))\n    ELSE NULL\n    END as Observaciones_Pedido, b.FechaContable as diaPedido,\n     b.FechaHoraApertura as FechaHoraInicio,\n\t a.FechaHoraPreparado,\n\ta.FechaHoraEntregado as FechaHoraSalidaCocina,\n    a.FechaHoraEntrega as FechaHoraEstimadoSalidaAEntrega,\n     a.FechaHoraEnViaje\nfrom osakisucursal{{ $('Traduce nombre').item.json.sucursal }}.ventas_datospedido a\njoin osakisucursal{{ $('Traduce nombre').item.json.sucursal }}.ventas b\non (b.IdVenta=a.IdVenta)\njoin osakisucursal{{ $('Traduce nombre').item.json.sucursal }}.clientespedidos_lugaresentrega c\non (a.IdClientePedido = c.IdClientePedido and a.IdLugarEntrega = c.IdLugarEntrega)\njoin osakisucursal{{ $('Traduce nombre').item.json.sucursal }}.clientespedidos d\non (a.IdClientePedido = d.IdClientePedido)\njoin osakicentral.tvc_pedidos_plataformas e\non (e.IdIntegracionPedidos = a.IdIntegracionPedidos)\nwhere a.IdVenta ={{ $('Registra Pedido').item.json.idventa }}\n;",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -2160,
        0
      ],
      "id": "2056fee7-ebcd-4645-b0e7-11b896c33a83",
      "name": "Obtiene Pedido",
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "sFauwBpvViqW5yF3",
          "name": "MySQL Osaki-Ayres"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "Articulo"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -1712,
        0
      ],
      "id": "119e0169-6a03-4178-89f2-554bdd1d0d25",
      "name": "Agrupa Articulos"
    },
    {
      "parameters": {
        "jsCode": "// 1. OBTENCIÃ“N DE DATOS DE LOS TRES NODOS\nconst listaPedidos = $('Obtiene Pedido').all();\nconst listaArticulos = $('Agrupa Articulos').all();\nconst listaSucursales = $('Registra Pedido').all();\n\n// 2. ITERACIÃ“N SINCRONIZADA\nreturn listaPedidos.map((itemPedido, index) => {\n  \n  const datosP = itemPedido.json;\n  const datosA = listaArticulos[index] ? listaArticulos[index].json : {};\n  const datosS = listaSucursales[index] ? listaSucursales[index].json : {};\n\n  // ----------------------------------------------------\n  // 3. LIMPIEZA DE VARIABLES Y CÃLCULOS DE TIEMPO\n  // ----------------------------------------------------\n  const nombre = datosP.Nombre || \"Amigo/a\";\n  const codigo = datosP.CodigoPedidoPlataforma ? String(datosP.CodigoPedidoPlataforma) : \"S/N\";\n  const estado = datosP.etapaPedido ? datosP.etapaPedido.toString() : \"Ingresado\";\n  const sucursal = datosS.sucursal || \"nuestro local\";\n  const tipoEntrega = datosP.TipoEntrega || \"\";\n\n  // ArtÃ­culos\n  const articulos = Array.isArray(datosA.Articulo) \n    ? datosA.Articulo.join(\", \") \n    : (datosA.Articulo || \"tus productos\");\n\n  // --- LÃ“GICA DE FECHAS Y HORAS ---\n  \n  // Extraemos la hora estimada (HH:MM) para mostrarla en el mensaje\n  let horaSalidaTexto = \"su hora\";\n  let segundosEstimados = \"99\"; // Valor por defecto que no sea '00'\n  let esProgramado = false;\n\n  if (datosP.FechaHoraEstimadoSalidaAEntrega && datosP.FechaHoraInicio) {\n    // 1. Obtener Hora HH:MM para el texto\n    const partes = datosP.FechaHoraEstimadoSalidaAEntrega.split(' ');\n    if (partes.length > 1) {\n      horaSalidaTexto = partes[1].substring(0, 5); // Ej: \"14:30\"\n      segundosEstimados = partes[1].substring(6, 8); // Ej: \"00\"\n    }\n\n    // 2. Calcular diferencia en minutos entre Inicio y Estimado\n    const fechaInicio = new Date(datosP.FechaHoraInicio);\n    const fechaEstimada = new Date(datosP.FechaHoraEstimadoSalidaAEntrega);\n    const diferenciaMinutos = (fechaEstimada - fechaInicio) / 1000 / 60;\n\n    // 3. Evaluar condiciÃ³n de PEDIDO PROGRAMADO\n    // (Mostrador + Segundos en '00' + Diferencia > 5 min)\n    if (tipoEntrega === 'Mostrador' && segundosEstimados === '00' && diferenciaMinutos > 5) {\n      esProgramado = true;\n    }\n  }\n\n  let variantes = [];\n\n  // ----------------------------------------------------\n  // 4. SELECCIÃ“N DE FRASES SEGÃšN CONDICIÃ“N\n  // ----------------------------------------------------\n\n  if (esProgramado) {\n    // === CASO C: MOSTRADOR PROGRAMADO (Nuevo) ===\n  variantes = [\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL INICIO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `A las *${horaSalidaTexto}* dejamos todo listo con mucho cuidado en Osaki *${sucursal}* ğŸ§‘â€ğŸ³. Â¡Hola *${nombre}*! Tu pedido *${codigo}* (${articulos}) quedÃ³ agendado y te agradecemos de verdad la confianza en Osaki.`,\n  `A las *${horaSalidaTexto}* va a estar preparado como corresponde en Osaki. *${nombre}*, confirmamos personalmente tu pedido *${codigo}* (${articulos}) en *${sucursal}*. Gracias por elegirnos ğŸ™.`,\n  `A las *${horaSalidaTexto}* ya estÃ¡ todo coordinado en cocina Osaki. Registramos tu pedido *${codigo}* (${articulos}) en *${sucursal}*, *${nombre}*, y lo cuidamos como si fuera para nosotros ğŸ’š.`,\n  `A las *${horaSalidaTexto}* lo retirÃ¡s tranquilo y sin apuros en Osaki. *${nombre}*, tu pedido *${codigo}* (${articulos}) quedÃ³ agendado en *${sucursal}*. Gracias por organizarte con tiempo.`,\n  `A las *${horaSalidaTexto}* lo tenemos muy presente en la cocina de Osaki. Hola *${nombre}*, pedido *${codigo}* (${articulos}) confirmado en *${sucursal}*. Nos encanta que hayas elegido nuestro local ğŸ˜Š.`,\n  `A las *${horaSalidaTexto}* queda todo listo y en su punto en Osaki *${sucursal}*. *${nombre}*, tu pedido *${codigo}* (${articulos}) ya estÃ¡ registrado con toda nuestra atenciÃ³n.`,\n  `A las *${horaSalidaTexto}* estÃ¡ previsto el retiro y lo vamos a respetar en Osaki. En *${sucursal}* ya tenemos cargado tu pedido *${codigo}* (${articulos}), *${nombre}*, gracias por confiar ğŸ™Œ.`,\n  `A las *${horaSalidaTexto}* va a salir tal como lo esperÃ¡s desde Osaki. *${nombre}*, dejamos reservado tu pedido *${codigo}* (${articulos}) en *${sucursal}* y lo seguimos de cerca ğŸ‘€.`,\n  `A las *${horaSalidaTexto}* te esperamos con todo listo en Osaki *${sucursal}* ğŸ•. Pedido *${codigo}* (${articulos}) confirmado, *${nombre}*, gracias por volver a elegir Osaki.`,\n  `A las *${horaSalidaTexto}* estÃ¡ programada la entrega con mucho cuidado en Osaki. *${nombre}*, tu pedido *${codigo}* (${articulos}) ya estÃ¡ en agenda en *${sucursal}*.`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TEMPRANO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Tu pedido *${codigo}* (${articulos}) a las *${horaSalidaTexto}* ya quedÃ³ agendado en Osaki *${sucursal}* âœ…. Â¡Hola *${nombre}*! Gracias de corazÃ³n por elegirnos.`,\n  `Confirmamos que a las *${horaSalidaTexto}* el pedido *${codigo}* (${articulos}) va a estar listo en Osaki *${sucursal}*, *${nombre}*, y lo vamos a preparar con dedicaciÃ³n.`,\n  `En cocina Osaki ya tomamos nota: a las *${horaSalidaTexto}* el pedido *${codigo}* (${articulos}) sale desde *${sucursal}*, *${nombre}*. Gracias por avisar con tiempo â°.`,\n  `Registramos tu pedido *${codigo}* (${articulos}) para las *${horaSalidaTexto}* en Osaki *${sucursal}*. Todo en orden, *${nombre}*, nos encanta atenderte ğŸ˜Š.`,\n  `Dejamos cargado que a las *${horaSalidaTexto}* el pedido *${codigo}* (${articulos}) estÃ© listo en Osaki *${sucursal}*, *${nombre}*. Gracias por la confianza en nuestro equipo.`,\n  `El pedido *${codigo}* (${articulos}) quedÃ³ programado para las *${horaSalidaTexto}* en Osaki *${sucursal}*. Gracias *${nombre}* por elegir Osaki para tu comida ğŸ£.`,\n  `Ya estÃ¡ en agenda de Osaki que a las *${horaSalidaTexto}* el pedido *${codigo}* (${articulos}) se retire en *${sucursal}*, *${nombre}*. Lo vamos a hacer con cariÃ±o ğŸ’•.`,\n  `Confirmado en Osaki: el pedido *${codigo}* (${articulos}) a las *${horaSalidaTexto}* estarÃ¡ listo en *${sucursal}*, *${nombre}*. Gracias por organizarte con nosotros.`,\n  `Cargamos tu pedido *${codigo}* (${articulos}) para las *${horaSalidaTexto}* y lo coordinamos con Osaki *${sucursal}*, *${nombre}*, como corresponde ğŸ‘Œ.`,\n  `Tu reserva en Osaki indica que a las *${horaSalidaTexto}* el pedido *${codigo}* (${articulos}) queda listo en *${sucursal}*, *${nombre}*. Gracias por pensar en nosotros ğŸ¤—.`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TARDÃO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Hola *${nombre}*, tu pedido *${codigo}* (${articulos}) quedÃ³ registrado en Osaki *${sucursal}* para las *${horaSalidaTexto}*. Nos ocupamos personalmente ğŸ™‹â€â™‚ï¸.`,\n  `*${nombre}*, confirmamos tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, listo para las *${horaSalidaTexto}*. Gracias por elegir nuestra cocina Osaki ğŸœ.`,\n  `Tu pedido *${codigo}* (${articulos}) ya estÃ¡ cargado en Osaki *${sucursal}*, con retiro a las *${horaSalidaTexto}*, *${nombre}*. Lo preparamos con cuidado como siempre en Osaki âœ¨.`,\n  `En Osaki *${sucursal}* tenemos muy presente tu pedido *${codigo}* (${articulos}), *${nombre}*, para las *${horaSalidaTexto}*. Gracias por la confianza en nuestro equipo.`,\n  `Registramos correctamente el pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, para las *${horaSalidaTexto}*. Todo bajo control en Osaki ğŸ¯.`,\n  `*${nombre}*, el pedido *${codigo}* (${articulos}) ya figura en Osaki *${sucursal}* para las *${horaSalidaTexto}*. Nos encanta atenderte en Osaki ğŸ˜„.`,\n  `En sistema de Osaki quedÃ³ cargado el pedido *${codigo}* (${articulos}) en *${sucursal}*, *${nombre}*, para las *${horaSalidaTexto}*. Gracias por anticiparte.`,\n  `Tu pedido *${codigo}* (${articulos}) estÃ¡ alineado en Osaki *${sucursal}*, *${nombre}*, para las *${horaSalidaTexto}*. Lo seguimos de cerca desde Osaki ğŸ¤—.`,\n  `Confirmamos en cocina Osaki el pedido *${codigo}* (${articulos}) en *${sucursal}*, *${nombre}*, para entregÃ¡rtelo a las *${horaSalidaTexto}*. Gracias por confiar en nuestro trabajo ğŸ’ª.`,\n  `*${nombre}*, dejamos programado el pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* para las *${horaSalidaTexto}*. Va a salir tal como esperÃ¡s de Osaki ğŸš€.`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL FINAL (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡Hola *${nombre}*! ğŸ–ï¸ Ya tenemos agendado tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* con mucho cuidado, a las *${horaSalidaTexto}*. Gracias por elegir Osaki.`,\n  `Confirmamos tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, y lo vamos a preparar con dedicaciÃ³n a las *${horaSalidaTexto}* ğŸ‘¨â€ğŸ³.`,\n  `Registramos correctamente tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, cuidando cada detalle a las *${horaSalidaTexto}*.`,\n  `Tu pedido *${codigo}* (${articulos}) quedÃ³ listo en sistema en Osaki *${sucursal}*, *${nombre}*, para las *${horaSalidaTexto}*. Gracias por elegir Osaki ğŸ‰.`,\n  `En Osaki *${sucursal}* ya tenemos tu pedido *${codigo}* (${articulos}) confirmado, *${nombre}*, para las *${horaSalidaTexto}*.`,\n  `Todo quedÃ³ organizado con tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, a las *${horaSalidaTexto}* âœ….`,\n  `Dejamos alineado tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, con retiro a las *${horaSalidaTexto}*.`,\n  `Tu pedido *${codigo}* (${articulos}) estÃ¡ asegurado en Osaki *${sucursal}*, *${nombre}*, para las *${horaSalidaTexto}*. Gracias por la confianza en Osaki ğŸ¤.`,\n  `ConfirmaciÃ³n completa del pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, a las *${horaSalidaTexto}* ğŸ“‹.`,\n  `QuedÃ³ todo listo con tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*, para las *${horaSalidaTexto}* ğŸŠ.`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA COMO INCISO / FRAGMENTADA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Tu pedido *${codigo}* (${articulos}) -retirÃ¡s a las *${horaSalidaTexto}*- ya estÃ¡ agendado en Osaki *${sucursal}*, *${nombre}*. Gracias por elegir Osaki ğŸ˜Š.`,\n  `Confirmamos el pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* (horario: *${horaSalidaTexto}*), *${nombre}*. Lo preparamos con mucho cuidado ğŸ½ï¸.`,\n  `En Osaki *${sucursal}* quedÃ³ cargado tu pedido *${codigo}* (${articulos}), con retiro a las *${horaSalidaTexto}*, *${nombre}*. Nos ocupamos desde Osaki ğŸ’¼.`,\n  `Pedido *${codigo}* (${articulos}) listo en sistema Osaki -a las *${horaSalidaTexto}*- en *${sucursal}*, *${nombre}*. Gracias por la confianza ğŸ™.`,\n  `*${nombre}*, dejamos confirmado el pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*; horario *${horaSalidaTexto}*. Lo seguimos de cerca.`,\n  `Tu pedido *${codigo}* (${articulos}) estÃ¡ asegurado en Osaki *${sucursal}*, *${nombre}* (retiro *${horaSalidaTexto}*). Gracias por anticiparte a Osaki â³.`,\n  `En cocina Osaki ya figura tu pedido *${codigo}* (${articulos}), *${nombre}*, con horario *${horaSalidaTexto}* en *${sucursal}* ğŸ“.`,\n  `Pedido *${codigo}* (${articulos}) correctamente agendado en Osaki *${sucursal}* -*${horaSalidaTexto}*- *${nombre}*. Gracias por elegir Osaki ğŸ¥¡.`,\n  `Todo listo con tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*, *${nombre}*; hora prevista *${horaSalidaTexto}*.`,\n  `ConfirmaciÃ³n hecha en Osaki: pedido *${codigo}* (${articulos}) en *${sucursal}*, *${nombre}*, a retirar *${horaSalidaTexto}* ğŸ””.`\n];\n\n\n\n\n\n  } else if (tipoEntrega === 'Delivery Propio') {\n    // === CASO A: DELIVERY PROPIO ===\n    variantes = [\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL INICIO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡A las *${horaSalidaTexto}* calculamos que saldrÃ¡ tu pedido, *${nombre}*! ğŸ’• Acabo de revisar el pedido *${codigo}* (${articulos}) aquÃ­ en Osaki *${sucursal}* y estÃ¡ *${estado}*. Te agradezco de corazÃ³n la paciencia. -Emi`,\n  `Aproximadamente a las *${horaSalidaTexto}* saldrÃ­a el repartidor con tu pedido, querido/a *${nombre}*. ğŸš€ Tu orden *${codigo}* (${articulos}) ya estÃ¡ *${estado}* en Osaki *${sucursal}*. Gracias por confiar en nosotros.`,\n  `Hacia las *${horaSalidaTexto}* estimamos el envÃ­o, *${nombre}*. ğŸ™ Estoy revisando tu pedido *${codigo}* (${articulos}) que estÃ¡ *${estado}* aquÃ­ en *${sucursal}*. Â¡Valoro mucho tu elecciÃ³n! -Emi`,\n  `Calculamos que a las *${horaSalidaTexto}* estarÃ¡ saliendo tu comida, *${nombre}*. â¤ï¸ Te cuento que acabo de chequear el pedido *${codigo}* (${articulos}) en *${sucursal}* y estÃ¡ *${estado}*. Â¡Gracias por pensar en nosotros!`,\n  `Alrededor de las *${horaSalidaTexto}* deberÃ­a partir el delivery, *${nombre}*. ğŸ˜Š Estoy pendiente de tu pedido *${codigo}* (${articulos}) que ya estÃ¡ *${estado}* en Osaki *${sucursal}*. Â¡Aprecio mucho tu confianza!`,\n  `Nuestro equipo de Osaki estima las *${horaSalidaTexto}* para el despacho, *${nombre}*. âœ¨ QuerÃ­a avisarte personalmente que tu pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* y lo cuidamos con mucho cariÃ±o en *${sucursal}*.`,\n  `A las *${horaSalidaTexto}* aproximadamente saldrÃ­a hacia ti, *${nombre}*. ğŸ’« Me asegurÃ© de que tu pedido *${codigo}* (${articulos}) estÃ© *${estado}* aquÃ­ en Osaki *${sucursal}*. Â¡Gracias por elegirnos una vez mÃ¡s!`,\n  `Para alrededor de las *${horaSalidaTexto}* tenemos prevista la salida, *${nombre}*. ğŸŒŸ Estoy al tanto de tu orden *${codigo}* (${articulos}) que estÃ¡ *${estado}* en *${sucursal}*. Â¡Tu satisfacciÃ³n es mi prioridad! -Emi`,\n  `Hacia las *${horaSalidaTexto}* calculamos el envÃ­o, querido/a *${nombre}*. ğŸ¥° Acabo de verificar personalmente tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* y estÃ¡ *${estado}*. Â¡Mil gracias!`,\n  `Nuestra meta es las *${horaSalidaTexto}* para la salida, *${nombre}*. ğŸ™‹â€â™€ï¸ Te escribo personalmente para confirmar que tu pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* y en las mejores manos aquÃ­ en *${sucursal}*.`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TEMPRANO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡Hola *${nombre}*! Recibimos con alegrÃ­a tu pedido *${codigo}* (${articulos}) y calculamos que saldrÃ¡ a reparto cerca de las *${horaSalidaTexto}*. ğŸ• EstÃ¡ *${estado}* aquÃ­ en Osaki *${sucursal}* y lo preparamos con todo nuestro cariÃ±o. Â¡Gracias por confiar en nosotros! -Emi`,\n  `Querido/a *${nombre}*, gracias por tu compra. ğŸ’– Tu pedido *${codigo}* con ${articulos} estÃ¡ *${estado}* en Osaki *${sucursal}* y nuestro equipo estima despacharlo a las *${horaSalidaTexto}*. Â¡Estamos muy pendientes!`,\n  `Â¡QuÃ© alegrÃ­a saludarte *${nombre}*! ğŸ˜Š Tu orden *${codigo}* (${articulos}) entrÃ³ a nuestra cocina en *${sucursal}*. EstÃ¡ *${estado}* y planeamos que salga rumbo a tu casa cerca de las *${horaSalidaTexto}*. Â¡Te lo enviaremos con mucho amor!`,\n  `Hola *${nombre}*, soy Emi del equipo de Osaki *${sucursal}*. ğŸ¥¡ Tu pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* y nos estamos apurando con mucho cariÃ±o para enviÃ¡rtelo a las *${horaSalidaTexto}* aproximadamente. Â¡Valoro tu paciencia!`,\n  `*${nombre}*, con mucho gusto recibimos tu pedido *${codigo}* (${articulos}). â¤ï¸ En Osaki *${sucursal}* ya lo tenemos *${estado}* y la hora estimada de salida a entrega es *${horaSalidaTexto}*. Â¡Gracias por pensar en nosotros!`,\n  `Â¡Gracias por la confianza *${nombre}*! ğŸ™ Tu pedido *${codigo}* de ${articulos} estÃ¡ *${estado}* en Osaki *${sucursal}* y haremos lo posible por despacharlo con todo cuidado a las *${horaSalidaTexto}*. Â¡Tu satisfacciÃ³n me importa mucho! -Emi`,\n  `*${nombre}*, tu comida estÃ¡ en las mejores manos. ğŸ‘¨â€ğŸ³ Pedido *${codigo}* (${articulos}) marcado como *${estado}* en Osaki *${sucursal}* y prevemos que el repartidor salga a las *${horaSalidaTexto}*. Â¡Te agradezco de corazÃ³n!`,\n  `Â¡Manos a la obra con mucha ilusiÃ³n, *${nombre}*! ğŸ’ª Tu pedido *${codigo}* (${articulos}) se estÃ¡ gestionando en Osaki *${sucursal}* (*${estado}*). Estimamos la salida del local a las *${horaSalidaTexto}*. Â¡Estoy al pendiente!`,\n  `Hola *${nombre}*, aquÃ­ en Osaki *${sucursal}* ya vimos tu orden *${codigo}* (${articulos}) con mucha atenciÃ³n. ğŸ˜Œ EstÃ¡ *${estado}* y estamos trabajando con dedicaciÃ³n para que salga a las *${horaSalidaTexto}*. Â¡Gracias por elegirnos!`,\n  `Querido/a *${nombre}*, personalmente revisÃ© tu pedido *${codigo}* (${articulos}). âœ¨ EstÃ¡ *${estado}* en Osaki *${sucursal}* y coordinamos con esmero para que salga a reparto a las *${horaSalidaTexto}*. Â¡Aprecio mucho tu confianza! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TARDÃO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, ya pusimos en marcha tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* con mucho entusiasmo. ğŸ˜Š Figura como *${estado}* y la hora aprox. de salida es *${horaSalidaTexto}*. Â¡Te va a encantar, lo preparamos pensando en ti! -Emi`,\n  `Desde Osaki *${sucursal}* te confirmamos, *${nombre}*: Pedido *${codigo}* (${articulos}) estÃ¡ *${estado}*. Nos esforzamos con dedicaciÃ³n para que salga a las *${horaSalidaTexto}*. Â¡Gracias por tu paciencia!`,\n  `Â¡Todo listo para empezar con mucha energÃ­a, *${nombre}*! ğŸš€ Pedido *${codigo}* (${articulos}) recibido en Osaki *${sucursal}*. Estatus *${estado}*. Salida estimada del local: *${horaSalidaTexto}*. Â¡Aprecio que confÃ­es en nosotros!`,\n  `*${nombre}*, tu orden *${codigo}* (${articulos}) es nuestra prioridad en Osaki *${sucursal}*. ğŸ’« EstÃ¡ *${estado}* y calculamos el despacho con cuidado para las *${horaSalidaTexto}*. Â¡Gracias por elegirnos!`,\n  `Hola *${nombre}*, validamos con atenciÃ³n tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ˜Œ Se encuentra *${estado}*. Hora objetivo de salida: *${horaSalidaTexto}*. Â¡Tu satisfacciÃ³n nos importa bastante! -Emi`,\n  `Â¡Gracias por esperarnos con tanta amabilidad, *${nombre}*! ğŸ™ Pedido *${codigo}* con ${articulos} estÃ¡ *${estado}* en Osaki *${sucursal}*. Preparamos todo con ilusiÃ³n para salir a las *${horaSalidaTexto}*.`,\n  `*${nombre}*, estamos preparando con mucho cariÃ±o tu orden *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ˜Š Se encuentra *${estado}* y saldrÃ­a a reparto a las *${horaSalidaTexto}*. Â¡Estoy revisando!`,\n  `Â¡En marcha con toda la dedicaciÃ³n, *${nombre}*! ğŸ’ª Pedido *${codigo}* (${articulos}) recibido en Osaki *${sucursal}* (*${estado}*). Estimamos el despacho para las *${horaSalidaTexto}*. Â¡Valoro muchÃ­simo tu elecciÃ³n!`,\n  `Saludos con cariÃ±o *${nombre}*, tu delivery *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. â¤ï¸ Haremos lo posible con todo nuestro empeÃ±o para enviarlo a las *${horaSalidaTexto}*. Â¡Gracias por confiar!`,\n  `Â¡QuÃ© bueno tenerte por acÃ¡, *${nombre}*! ğŸ˜„ Pedido *${codigo}* (${articulos}) en proceso (*${estado}*) en Osaki *${sucursal}*. Sale a las *${horaSalidaTexto}* aprox. Â¡Tu fidelidad nos llena de alegrÃ­a! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL FINAL (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, confirmamos con mucha alegrÃ­a tu pedido *${codigo}* con ${articulos} en Osaki *${sucursal}*. ğŸ˜Š EstÃ¡ *${estado}* y el delivery deberÃ­a salir con todo nuestro cuidado a las *${horaSalidaTexto}*. Â¡Gracias por pensar en nosotros!`,\n  `Â¡Hey *${nombre}*! Mil gracias por pedir en Osaki *${sucursal}*. â¤ï¸ Tu orden *${codigo}* (${articulos}) estÃ¡ *${estado}*. Estimamos terminar de cocinar con dedicaciÃ³n y despachar a las *${horaSalidaTexto}*. -Emi`,\n  `Hola *${nombre}*, ya vimos con atenciÃ³n tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ˜Œ EstÃ¡ *${estado}*. Coordinamos la entrega con esmero para salir a las *${horaSalidaTexto}*. Â¡Aprecio tu confianza!`,\n  `*${nombre}*, tu pedido *${codigo}* (${articulos}) estÃ¡ siendo atendido con mucho cariÃ±o en Osaki *${sucursal}*. ğŸ’• Estado: *${estado}*. Prevemos salida con todo listo a las *${horaSalidaTexto}*. Â¡Gracias por elegirnos!`,\n  `Â¡AtenciÃ³n *${nombre}*! Con gran alegrÃ­a recibimos tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ‰ EstÃ¡ *${estado}* y el repartidor saldrÃ­a con toda prontitud a las *${horaSalidaTexto}*. -Emi`,\n  `*${nombre}*, gracias de corazÃ³n por pedir. ğŸ™ Tu orden *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. Estimamos despacho con cuidado a las *${horaSalidaTexto}*. Â¡Tu satisfacciÃ³n es mi prioridad!`,\n  `Desde Osaki *${sucursal}* para ti, *${nombre}*: ğŸ’– Pedido *${codigo}* (${articulos}) recibido con gratitud. Estado *${estado}*. Salida programada aprox: *${horaSalidaTexto}*. Â¡Estoy personalmente pendiente!`,\n  `Â¡Hola *${nombre}*! Nos ponemos las pilas con mucha ilusiÃ³n con tu pedido *${codigo}* (${articulos}). ğŸš€ EstÃ¡ *${estado}* en Osaki *${sucursal}* y sale cerca de las *${horaSalidaTexto}*. Â¡Gracias por confiar en nosotros!`,\n  `*${nombre}*, tu comida estÃ¡ en marcha con toda nuestra dedicaciÃ³n. ğŸ‘¨â€ğŸ³ Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* (*${estado}*). Hora objetivo de salida: *${horaSalidaTexto}*. Â¡Valoro mucho tu paciencia! -Emi`,\n  `Â¡Todo ok, *${nombre}*! Con alegrÃ­a registramos tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ˜Š Estado: *${estado}*. Salida estimada: *${horaSalidaTexto}*. Â¡Gracias por pensar en nosotros!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA COMO INCISO / FRAGMENTADA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡Buenas noticias, *${nombre}*! ğŸŠ Tu pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}* (salida estimada: *${horaSalidaTexto}*). Nos apuramos con cariÃ±o para que llegue perfecto. Â¡Gracias por tu confianza! -Emi`,\n  `*${nombre}*, ya estamos cocinando tu idea con mucho amor. ğŸ’• Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* (*${estado}*) â€”salida prevista *${horaSalidaTexto}*â€”. Â¡Estoy supervisando personalmente ğŸ˜‰!`,\n  `Hola *${nombre}*, tu orden *${codigo}* (${articulos}) entrÃ³ joya en Osaki *${sucursal}*. ğŸ˜Œ EstÃ¡ *${estado}* y planeamos enviarla con cuidado (a las *${horaSalidaTexto}*). Â¡Aprecio mucho que nos elijas!`,\n  `*${nombre}*, pedido *${codigo}* (${articulos}) validado con atenciÃ³n en Osaki *${sucursal}*. âœ¨ Se encuentra *${estado}* â€”hora de salida aproximada: *${horaSalidaTexto}*â€”. Â¡Tu satisfacciÃ³n nos importa demasiado! -Emi`,\n  `Â¡Gracias por la espera con tanta paciencia, *${nombre}*! ğŸ™ Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* (*${estado}*). Nuestro equipo lo despacha con esmero (a las *${horaSalidaTexto}*).`,\n  `*${nombre}*, activamos con entusiasmo tu pedido *${codigo}* (${articulos}). ğŸš€ En Osaki *${sucursal}* figura *${estado}* â€”hora estimada de salida: *${horaSalidaTexto}*â€”. Â¡Gracias por confiar en nosotros!`,\n  `Confirmado con alegrÃ­a, *${nombre}*: âœ… Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. Estado: *${estado}*. Salida estimada: *${horaSalidaTexto}*. Â¡Estamos muy al pendiente! -Emi`,\n  `*${nombre}*, tu orden *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. ğŸ’– Despacho aprox: *${horaSalidaTexto}*. Â¡Lo preparamos pensando en que disfrutes cada bocado!`,\n  `Hola *${nombre}*, acabo de chequear personalmente. ğŸ‘€ Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* estÃ¡ *${estado}* â€”sale hacia ti a las *${horaSalidaTexto}*â€”. Â¡Mil gracias por tu confianza!`,\n  `Â¡Todo en orden, *${nombre}*! ğŸŒŸ Pedido *${codigo}* (${articulos}) gestionado en Osaki *${sucursal}* (*${estado}*). Hora salida: *${horaSalidaTexto}*. Â¡Aprecio de corazÃ³n que nos elijas! -Emi`\n];\n\n  } else {\n    // === CASO B: NORMAL (Mostrador Inmediato / App Externa) ===\n    variantes = [\n        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL INICIO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        `Â¡Hola *${nombre}*! Te escribe de Emi, estoy feliz de contarte que recibimos tu pedido *${codigo}* con ${articulos}. ğŸ˜Š Mi equipo en Osaki *${sucursal}* ya lo tiene como *${estado}* y lo cuidaremos con mucho cariÃ±o.`,\n        `Estimado/a *${nombre}*, mil gracias de corazÃ³n. ğŸ’– He confirmado personalmente que tu pedido *${codigo}* (${articulos}) ya aparece como *${estado}* en nuestra sucursal Osaki *${sucursal}*.`,\n        `Â¡QuÃ© alegrÃ­a saludarte, *${nombre}*! ğŸ‰ Tu orden *${codigo}* (${articulos}) acaba de entrar al sistema de Osaki *${sucursal}*. Su estado es *${estado}* y le pondremos todo nuestro amor. -Emi`,\n        `Hola *${nombre}*, valoramos profundamente tu preferencia. â¤ï¸ Tu pedido *${codigo}* (${articulos}) ya estÃ¡ en Osaki *${sucursal}* y figura como *${estado}*. Trabajamos con ilusiÃ³n para ti.`,\n        `Â¡Bienvenido, *${nombre}*! Con mucha alegrÃ­a recibimos tu pedido *${codigo}* con ${articulos}. ğŸ™ Nuestro personal en Osaki *${sucursal}* lo marcÃ³ como *${estado}*. Â¡Gracias por confiar en nosotros!`,\n        `*${nombre}*, es un honor y un placer cocinarte. ğŸ‘¨â€ğŸ³ Tu pedido *${codigo}* (${articulos}) llegÃ³ a Osaki *${sucursal}*. EstÃ¡ *${estado}* y nos aseguraremos personalmente de que salga perfecto. -Emi`,\n        `Â¡Hola *${nombre}*! Tu pedido *${codigo}* (${articulos}) es nuestra prioridad absoluta en Osaki *${sucursal}*. âœ¨ Ya se encuentra *${estado}* y estamos atentos a cada detalle con cariÃ±o.`,\n        `Un gusto enorme saludarte, *${nombre}*. ğŸ˜Œ Confirmamos con atenciÃ³n que tu selecciÃ³n (${articulos}) bajo el cÃ³digo *${codigo}* estÃ¡ *${estado}* en Osaki *${sucursal}*. Â¡ValdrÃ¡ cada minuto de espera!`,\n        `Â¡Hey *${nombre}*! Gracias de corazÃ³n por apoyarnos. ğŸ’• Tu orden *${codigo}* con ${articulos} ya estÃ¡ con nosotros en Osaki *${sucursal}*, marcada como *${estado}*. Â¡A cocinar con amor!`,\n        `*${nombre}*, recibimos con gratitud tu orden *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ˜Š Nos encanta que nos elijas; el estado es *${estado}* y estamos listos para darte lo mejor. -Emi`,\n\n        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TEMPRANO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        `Â¡Manos a la obra con mucha ilusiÃ³n, *${nombre}*! ğŸ’ª En Osaki *${sucursal}* ya recibimos tu pedido *${codigo}* (${articulos}). Lo tenemos *${estado}* y le pondremos toda nuestra dedicaciÃ³n.`,\n        `Hola *${nombre}*, desde Osaki *${sucursal}* con cariÃ±o. â¤ï¸ Tu pedido *${codigo}* de ${articulos} entrÃ³ y estÃ¡ *${estado}*. El equipo se esforzarÃ¡ con pasiÃ³n para que quede delicioso. -Emi`,\n        `*${nombre}*, tu comida estÃ¡ en las mejores manos. ğŸ‘Œ El pedido *${codigo}* (${articulos}) se encuentra *${estado}* en Osaki *${sucursal}*. Todo saldrÃ¡ fresco, rico y con mucho amor.`,\n        `Â¡Excelente elecciÃ³n, *${nombre}*! ğŸ¯ Gestionando con entusiasmo tus ${articulos} del pedido *${codigo}* en Osaki *${sucursal}*. Estado: *${estado}*. Trabajamos con pasiÃ³n y cuidado.`,\n        `Aviso especial para *${nombre}*: â¤ï¸ Tu orden *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. Le pondremos el toque especial de la casa con todo nuestro cariÃ±o. -Emi`,\n        `Hola *${nombre}*, nuestro chef en Osaki *${sucursal}* ya tiene la comanda de tu pedido *${codigo}* (${articulos}). ğŸ‘¨â€ğŸ³ EstÃ¡ *${estado}* y prometemos mÃ¡xima calidad y sabor.`,\n        `*${nombre}*, en Osaki *${sucursal}* nos pusimos en marcha con mucha energÃ­a con tu pedido *${codigo}* (${articulos}). ğŸš€ Figura como *${estado}*. Â¡Para chuparse los dedos, te lo aseguro!`,\n        `Â¡AtenciÃ³n *${nombre}*! Con alegrÃ­a recibimos tu pedido *${codigo}* con ${articulos} en Osaki *${sucursal}*. ğŸŠ Estado: *${estado}*. Entregaremos lo mejor de nuestra cocina. -Emi`,\n        `Saludos con cariÃ±o, *${nombre}*. ğŸ˜Š El pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. Estamos cuidando cada ingrediente especialmente para ti.`,\n        `Â¡Hola *${nombre}*! RevisÃ© personalmente y vi tu pedido *${codigo}* (${articulos}) en el sistema de Osaki *${sucursal}*. âœ¨ EstÃ¡ *${estado}* y le ponemos todo el amor y dedicaciÃ³n.`,\n\n        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TARDÃO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        `*${nombre}*, solo para confirmarte con mucha alegrÃ­a: Tu pedido *${codigo}* con ${articulos} estÃ¡ seguro y en buenas manos en Osaki *${sucursal}*. ğŸ˜Š Su estado es *${estado}*. -Emi`,\n        `*${nombre}*, no te preocupes por nada. â¤ï¸ Tu orden *${codigo}* (${articulos}) llegÃ³ perfectamente a Osaki *${sucursal}* y estÃ¡ *${estado}*. Nosotros nos encargamos con todo cariÃ±o.`,\n        `Â¡Todo en orden y con mucha gratitud, *${nombre}*! ğŸ™ Tu pedido *${codigo}* (${articulos}) estÃ¡ registrado en Osaki *${sucursal}* como *${estado}*. Gracias por dejarnos servirte hoy.`,\n        `Info personal para *${nombre}*: ğŸ‘€ Hola, tus productos (${articulos}) estÃ¡n *${estado}* aquÃ­ en Osaki *${sucursal}*. Felices y agradecidos de atenderte.`,\n        `*${nombre}*, tomamos nota con mucha atenciÃ³n. ğŸ“ Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* pasa a estado: *${estado}*. Â¡Esperamos de corazÃ³n que te encante! -Emi`,\n        `Desde Osaki *${sucursal}* confirmamos con cariÃ±o, *${nombre}*: ğŸ’– Tu pedido *${codigo}* con ${articulos} estÃ¡ *${estado}*. Gracias por confiar en nuestro sabor y dedicaciÃ³n.`,\n        `Â¡Confirmado con alegrÃ­a, *${nombre}*! ğŸ‰ Tu pedido *${codigo}* (${articulos}) ya estÃ¡ en lista en Osaki *${sucursal}*. Estado: *${estado}*. Â¡Gracias por preferirnos siempre!`,\n        `Hola *${nombre}*, revisÃ© personalmente el sistema y tu pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. ğŸ˜Š Â¡Trabajamos con gusto y dedicaciÃ³n para ti! -Emi`,\n        `*${nombre}*, orden *${codigo}* (${articulos}) en proceso con mucha ilusiÃ³n en Osaki *${sucursal}*. ğŸ’« Estado: *${estado}*. Â¡Gracias por la oportunidad de servirte!`,\n        `Â¡Registro listo y con gratitud, *${nombre}*! âœ… Tu pedido *${codigo}* con ${articulos} estÃ¡ *${estado}* en Osaki *${sucursal}*. Â¡Haremos nuestro mejor esfuerzo con amor!`,\n\n        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL FINAL (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        `Â¡Hola *${nombre}*! QuÃ© bueno saludarte y atenderte hoy. ğŸ˜Š Tu pedido *${codigo}* (${articulos}) ya ingresÃ³ a Osaki *${sucursal}*. Estado actual: *${estado}*.`,\n        `*${nombre}*, gracias de corazÃ³n por elegir Osaki hoy. â¤ï¸ Recibimos tu pedido *${codigo}* (${articulos}) en *${sucursal}* y ya figura como *${estado}*. -Emi`,\n        `Â¡Bien ahÃ­, *${nombre}*! Con mucha alegrÃ­a recibimos tu orden *${codigo}* (${articulos}) que llegÃ³ perfecta a Osaki *${sucursal}*. ğŸŠ Su estado es *${estado}*. Â¡A trabajar con amor!`,\n        `Estimado/a *${nombre}*, confirmamos con gratitud la entrada de tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸ™ Se encuentra *${estado}*.`,\n        `*${nombre}*, nos encanta cocinarte y servirte. ğŸ‘¨â€ğŸ³ Pedido *${codigo}* (${articulos}) recibido con cariÃ±o en Osaki *${sucursal}*. Estado: *${estado}*. Â¡QuedarÃ¡ rico, te lo prometo! -Emi`,\n        `Â¡Hola *${nombre}*! Ya le pasÃ© personalmente tu pedido *${codigo}* (${articulos}) a nuestro equipo en Osaki *${sucursal}*. ğŸ’ª EstÃ¡ *${estado}* y en proceso con dedicaciÃ³n.`,\n        `*${nombre}*, tu pedido *${codigo}* (${articulos}) estÃ¡ seguro y cuidado con nosotros en Osaki *${sucursal}*. â¤ï¸ Lo marcamos como *${estado}*. Â¡Gracias por tu confianza!`,\n        `Â¡LlegÃ³ tu orden con mucha alegrÃ­a, *${nombre}*! ğŸ‰ El pedido *${codigo}* (${articulos}) ya aparece en Osaki *${sucursal}* con estado *${estado}*. Nos ocupamos ya mismo con cariÃ±o. -Emi`,\n        `Hola *${nombre}*, gracias de corazÃ³n por tu compra y confianza. ğŸ™ Tu pedido *${codigo}* (${articulos}) estÃ¡ *${estado}* en Osaki *${sucursal}*. Le pondremos todo el cariÃ±o y dedicaciÃ³n.`,\n        `*${nombre}*, aviso de recepciÃ³n con gratitud: Pedido *${codigo}* (${articulos}) ingresado en Osaki *${sucursal}*. ğŸ˜Š Estado actual: *${estado}*.`,\n\n        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA COMO INCISO / FRAGMENTADA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        `Â¡QuÃ© gusto inmenso, *${nombre}*! ğŸ’• Tu pedido *${codigo}* (${articulos}) ya estÃ¡ en la fila de Osaki *${sucursal}* y figura como *${estado}*. -Emi`,\n        `*${nombre}*, recibimos perfectamente tu pedido *${codigo}* (${articulos}). âœ… Estamos en Osaki *${sucursal}* dejÃ¡ndolo todo listo con dedicaciÃ³n. Estado: *${estado}*.`,\n        `Â¡Buenas noticias, *${nombre}*! ğŸŠ Tu selecciÃ³n *${codigo}* (${articulos}) entrÃ³ al sistema de Osaki *${sucursal}*. Estado: *${estado}*. Â¡Manos a la obra con mucho amor!`,\n        `*${nombre}*, gracias por la confianza de siempre que nos brindas. â¤ï¸ Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. Estado: *${estado}*. -Emi`,\n        `Â¡Confirmado con alegrÃ­a, *${nombre}*! âœ¨ Ya tenemos tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. EstÃ¡ *${estado}* y avanzando con toda nuestra dedicaciÃ³n.`,\n        `Hola *${nombre}*, te escribo personalmente desde Osaki *${sucursal}*. ğŸ‘‹ Vimos tu pedido *${codigo}* (${articulos}) y ya estÃ¡ *${estado}*. Â¡Gracias de corazÃ³n por pedir con nosotros!`,\n        `*${nombre}*, tu orden *${codigo}* (${articulos}) es muy importante para nosotros. ğŸ’« En Osaki *${sucursal}* ya estÃ¡ *${estado}* y la cuidamos con especial atenciÃ³n. -Emi`,\n        `Â¡Hey *${nombre}*! Todo listo para empezar con mucha ilusiÃ³n tu pedido *${codigo}* (${articulos}) en Osaki *${sucursal}*. ğŸš€ Estado: *${estado}*.`,\n        `*${nombre}*, gestiÃ³n iniciada con dedicaciÃ³n. ğŸ“‹ Pedido *${codigo}* (${articulos}) en Osaki *${sucursal}* pasa a estado *${estado}*. Â¡Esperamos de corazÃ³n que lo disfrutes mucho!`,\n        `Â¡Saludos con cariÃ±o, *${nombre}*! ğŸ˜Š Tu pedido *${codigo}* (${articulos}) aterrizÃ³ en Osaki *${sucursal}*. Estado: *${estado}*. Â¡Lo preparamos con todo nuestro gusto y amor! -Emi`\n        ];\n  }\n\n  // SelecciÃ³n Aleatoria\n  const respuestaAleatoria = variantes[Math.floor(Math.random() * variantes.length)];\n\n  // Retorno\n  return {\n    json: {\n      ...datosP, \n      articulos_texto: articulos,\n      sucursal_origen: sucursal,\n      es_programado: esProgramado, // Debug: Para saber si entrÃ³ en la condiciÃ³n\n      mensaje_recepcion: respuestaAleatoria,\n      timestamp: new Date().toISOString()\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1488,
        0
      ],
      "id": "e288736f-ce26-449e-97ec-f00b93874723",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "notificacion_pedidos",
          "mode": "list",
          "cachedResultName": "notificacion_pedidos"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "notificacion_flag": false,
            "idventa": "={{ $('Loop Over Items').item.json.idventa }}",
            "telefono": "={{ $('Loop Over Items').item.json.Telefono }}",
            "plataforma": "={{ $('Loop Over Items').item.json.plataforma }}",
            "tipoentrega": "={{ $('Loop Over Items').item.json.TipoEntrega }}",
            "etapapedido": "={{ $('Loop Over Items').item.json.etapaPedido }}",
            "nombre": "={{ $('Loop Over Items').item.json.nombre }}",
            "fechahoraapertura": "={{ \n  $('Loop Over Items').item.json.FechaHoraApertura\n    ? $('Loop Over Items').item.json.FechaHoraApertura.replace(' ', 'T') + '.000Z'\n    : null\n}}",
            "fechahoracierre": "={{ \n  $('Loop Over Items').item.json.FechaHoraCierre \n    ? $('Loop Over Items').item.json.FechaHoraCierre.replace(' ', 'T') + '.000Z' \n    : null \n}}",
            "fechahoraentrega": "={{ \n  $('Loop Over Items').item.json.FechaHoraEntrega\n    ? $('Loop Over Items').item.json.FechaHoraEntrega.replace(' ', 'T') + '.000Z'\n    : null\n}}",
            "sucursal": "={{ $('Loop Over Items').item.json.sucursal }}",
            "codigo_pedido": "={{ $('Loop Over Items').item.json.CodigoPedidoPlataforma}}",
            "direccion": "={{ $('Loop Over Items').item.json.direccion }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "idventa",
              "displayName": "idventa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "codigo_pedido",
              "displayName": "codigo_pedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "sucursal",
              "displayName": "sucursal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "plataforma",
              "displayName": "plataforma",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipoentrega",
              "displayName": "tipoentrega",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "etapapedido",
              "displayName": "etapapedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "fechahoraapertura",
              "displayName": "fechahoraapertura",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "fechahoracierre",
              "displayName": "fechahoracierre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "fechahoraentrega",
              "displayName": "fechahoraentrega",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "notificacion_flag",
              "displayName": "notificacion_flag",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true
            },
            {
              "id": "direccion",
              "displayName": "direccion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2816,
        16
      ],
      "id": "47327d0c-f1a5-401f-a7cb-e36c3f78e62b",
      "name": "Registra Pedido",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "898e2a0b-e56d-4f4e-8a18-6b1f4f72d477",
              "name": "sucursal",
              "value": "={{ $('Registra Pedido').item.json.sucursal == \"Calle 47\" && '5' || '4' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2384,
        0
      ],
      "id": "6ecccd1d-4c6e-4d22-9c5c-3b0703ea72b0",
      "name": "Traduce nombre"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "=n8n_chat_histories_delivery_{{ $json.sucursal }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Loop Over Items').item.json.sessionId }}",
            "message": "={\n  \"type\": \"ai\",\n  \"content\": \"{{ $('Code in JavaScript1').item.json.mensaje_recepcion }}\",\n  \"tool_calls\": [],\n  \"additional_kwargs\": {},\n  \"response_metadata\": {},\n  \"invalid_tool_calls\": []\n}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1072,
        0
      ],
      "id": "7cb40456-48d6-41c8-bb59-9783a941c1e0",
      "name": "Ingresa Registro ReConfirmacion1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "where": {
          "values": [
            {
              "column": "telefono",
              "value": "={{ $('Loop Over Items').item.json.Telefono }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        208,
        -16
      ],
      "id": "2eae947e-bb44-4db4-92e3-28fd70994699",
      "name": "Select rows from a table2",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21f3249c-0daa-4ac1-9be2-e89b189dffbd",
              "leftValue": "={{ $json.isEmpty()}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        416,
        -16
      ],
      "id": "67a12255-12c7-4b52-8fc7-9e8914320644",
      "name": "If3"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "fecha_registro": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "canal": "Whatsapp",
            "telefono": "={{ $('Loop Over Items').item.json.Telefono }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "tipo_atencion": "IA",
            "notas": "Seguimiento Pedido",
            "status": "Inicio Pedido",
            "tipo_cliente": "Pedidos",
            "intencion": "NotificaciÃ³n"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        624,
        -96
      ],
      "id": "0bd5a311-8261-4c1a-96e3-03e083ec9923",
      "name": "Registra Cliente1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "value": "={{ $('Get Data Inicial').first().json.schema }}",
          "mode": "name"
        },
        "table": {
          "__rl": true,
          "value": "clientes",
          "mode": "list",
          "cachedResultName": "clientes"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "fecha_modificacion": "={{ $now.setZone('America/Argentina/Buenos_Aires').toFormat(\"yyyy-MM-dd'T'HH:mm:ss.000'Z'\") }}",
            "intencion": "Pedido",
            "tipo_atencion": "IA"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_registro",
              "displayName": "fecha_registro",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "canal",
              "displayName": "canal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "fecha_modificacion",
              "displayName": "fecha_modificacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            },
            {
              "id": "tipo_atencion",
              "displayName": "tipo_atencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notas",
              "displayName": "notas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "post_cita",
              "displayName": "post_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "intencion",
              "displayName": "intencion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "num_mensaje_largo",
              "displayName": "num_mensaje_largo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "actitud",
              "displayName": "actitud",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "negativos_intentos",
              "displayName": "negativos_intentos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "preferencias_alimentarias",
              "displayName": "preferencias_alimentarias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "total_reservaciones",
              "displayName": "total_reservaciones",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ult_reservacion",
              "displayName": "ult_reservacion",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tipo_cliente",
              "displayName": "tipo_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "alergias",
              "displayName": "alergias",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "pregunta_verifica_reserva",
              "displayName": "pregunta_verifica_reserva",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "chatid",
              "displayName": "chatid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        624,
        48
      ],
      "id": "cde2ebc5-d826-408d-a8b9-b7856b36a05d",
      "name": "Actualiza Clientes1",
      "credentials": {
        "postgres": {
          "id": "sk75eTZ4yDkbl8mt",
          "name": "Postgres Osaki-TemikiaProd01"
        }
      }
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        832,
        -16
      ],
      "id": "961f0a2a-232c-4c9d-b7f6-ec8f7cb32fa5",
      "name": "Wait1",
      "webhookId": "a7979626-304a-4fc3-8881-8c04861116b6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7b7cfcce-edd2-4363-9fd2-f90706f9bbd5",
              "leftValue": "={{  $json.tipoentrega == 'Mostrador' || ( $json.tipoentrega == 'Delivery Propio')   }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2624,
        16
      ],
      "id": "c23ea718-6191-47bb-a130-afefc25c2702",
      "name": "If4"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 */2 10-23 * * * "
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -4464,
        656
      ],
      "id": "665ad332-5ddf-48bc-ab12-d5ae67eb4855",
      "name": "Cada 10 min"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "77d1c36a-901f-46ce-bb1b-36ed256548f9",
              "name": "fecha_hoy",
              "value": "={{ new Date().toLocaleString('en-CA', { timeZone: 'America/Argentina/Buenos_Aires', year: 'numeric', month: '2-digit', day: '2-digit' }) }}",
              "type": "string"
            },
            {
              "id": "4c0d264c-a98f-418c-b424-81ce227f92d8",
              "name": "=hora_ahora",
              "value": "={{ new Date().toLocaleString('en-GB', { timeZone: 'America/Argentina/Buenos_Aires', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) }}",
              "type": "string"
            },
            {
              "id": "5beed38e-1087-4ec6-8ffb-c77119e18396",
              "name": "schema",
              "value": "osaki_main",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4192,
        656
      ],
      "id": "74d9086d-7472-4197-b2b1-89e1e91970eb",
      "name": "Get Data Inicial"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0603ee14-2bc5-48d1-ac69-9e3614d5c1aa",
                    "leftValue": "={{ $json.etapapedido == 'En Viaje' && $json.notificacion_flag ==false }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "En Viaje"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ ($json.etapapedido == 'Entregado' || $json.etapapedido == 'Preparado') && $json.notificacion_flag ==false }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "e8fee587-2e55-4b3c-b80b-a08295d1d9ba"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Entregado"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2640,
        672
      ],
      "id": "10183da6-0f17-450e-89b8-6a9fadebeb1d",
      "name": "Switch1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ecd0ab4c-5484-4c5d-8cd5-7720ada4c261",
              "leftValue": "={{ $json.tipoentrega }}",
              "rightValue": "Delivery Propio",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2432,
        464
      ],
      "id": "2c202743-4dc7-44fd-8ff8-09662ded7a13",
      "name": "If2"
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para limpiar caracteres no alfanumÃ©ricos al inicio y final\nfunction limpiarString(str) {\n  if (!str) return '';\n  return str.toString().replace(/^[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘Ã¼Ãœ]+|[^a-zA-Z0-9Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘Ã¼Ãœ]+$/g, '');\n}\n\nreturn items.map(item => {\n  const datos = item.json;\n\n  // 1. Limpieza de variables\n  const nombre = limpiarString(datos.nombre);\n  const codigo = limpiarString(datos.codigo_pedido);\n  const sucursal = limpiarString(datos.sucursal);\n  const direccion = limpiarString(datos.direccion);\n\n  // 2. ExtracciÃ³n \"Literal\" de la hora (Sin conversiÃ³n de zona horaria)\n  // Input esperado: \"2025-12-13T15:31:47.000Z\" -> Queremos \"15:31\"\n  let horaSalidaTexto = \"00:00\";\n  \n  if (datos.fechahoraentrega && typeof datos.fechahoraentrega === 'string') {\n    // Dividimos por la \"T\" y tomamos los primeros 5 caracteres de la segunda parte\n    const partes = datos.fechahoraentrega.split('T'); \n    if (partes.length > 1) {\n        horaSalidaTexto = partes[1].substring(0, 5); \n    }\n  }\n\n  // 3. Plantillas de mensajes\n  const variantes = [\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL INICIO (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡A las *${horaSalidaTexto}* saliÃ³ desde Osaki *${sucursal}* hacia *${direccion}*, *${nombre}*! ğŸš—ğŸ’¨ Tu pedido *${codigo}* ya estÃ¡ en viaje. Â¡Gracias por tu confianza! -Emi`,\n  `A las *${horaSalidaTexto}* partiÃ³ con prontitud hacia *${direccion}*, *${nombre}*. âœ¨ Tu pedido *${codigo}* de Osaki ya va en camino. Â¡Que disfrutes cada bocado con mucho amor!`,\n  `Nuestro repartidor saliÃ³ a las *${horaSalidaTexto}*, *${nombre}*. ğŸ’• Tu orden *${codigo}* de Osaki *${sucursal}* ya estÃ¡ rumbo a *${direccion}*. Â¡Apreciamos enormemente tu paciencia!`,\n  `A las *${horaSalidaTexto}* exactamente emprendiÃ³ el viaje hacia *${direccion}*, *${nombre}*. ğŸš€ Tu pedido *${codigo}* de Osaki ya saliÃ³. Â¡Te lo enviamos con todo nuestro cariÃ±o!`,\n  `El delivery partiÃ³ a las *${horaSalidaTexto}*, *${nombre}*. ğŸ™ Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ en ruta hacia tu domicilio. Â¡Mil gracias por elegirnos hoy!`,\n  `A las *${horaSalidaTexto}* comenzÃ³ el trayecto, *${nombre}*. ğŸ˜Š Tu sushi de Osaki ya va camino a *${direccion}*. El pedido *${codigo}* saliÃ³ hace momentos. Â¡Gracias por confiar en nosotros!`,\n  `Nuestro repartidor saliÃ³ puntual a las *${horaSalidaTexto}*, *${nombre}*. ğŸ’« Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ viajando hacia vos. Â¡Valoro muchÃ­simo tu preferencia! -Emi`,\n  `A las *${horaSalidaTexto}* dejamos atrÃ¡s nuestro local rumbo a *${direccion}*, *${nombre}*. ğŸ£ Tu pedido *${codigo}* de Osaki ya estÃ¡ en movimiento. Â¡Esperamos que te encante!`,\n  `El viaje comenzÃ³ a las *${horaSalidaTexto}*, *${nombre}*. â¤ï¸ Tu pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ en camino hacia tu direcciÃ³n. Â¡Gracias de corazÃ³n por pensar en nosotros!`,\n  `A las *${horaSalidaTexto}* partiÃ³ con toda la prisa, *${nombre}*. ğŸ›µ Tu pedido *${codigo}* de Osaki ya saliÃ³ hacia *${direccion}*. Â¡Estamos felices de servirte! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TEMPRANO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡Buenas noticias, *${nombre}*! ğŸ‰ El pedido *${codigo}* de Osaki *${sucursal}* ya va en camino hacia *${direccion}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu increÃ­ble paciencia! -Emi`,\n  `*${nombre}*, tu sushi de Osaki ya va rumbo a *${direccion}* con mucho amor. â¤ï¸ El pedido *${codigo}* saliÃ³ desde *${sucursal}* a las *${horaSalidaTexto}*. Â¡Esperamos que te guste tanto como a nosotros prepararlo!`,\n  `Hola *${nombre}*! Con alegrÃ­a te aviso que el repartidor saliÃ³ de Osaki *${sucursal}* ğŸš— con tu pedido *${codigo}* a las *${horaSalidaTexto}* hacia *${direccion}*. Â¡Te agradezco de todo corazÃ³n!`,\n  `*${nombre}*, tu orden *${codigo}* de Osaki *${sucursal}* va hacia *${direccion}* con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Gracias por ser parte de nuestra familia Osaki!`,\n  `*${nombre}*, te avisamos con mucha ilusiÃ³n que el pedido *${codigo}* de Osaki ya estÃ¡ viajando desde *${sucursal}*. ğŸ›µ Salimos a las *${horaSalidaTexto}*. Â¡Tu satisfacciÃ³n es nuestra mayor recompensa! -Emi`,\n  `Â¡Listo, *${nombre}*! âœ¨ El repartidor de Osaki ya lleva tu pedido *${codigo}* desde *${sucursal}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por permitirnos acompaÃ±ar tu dÃ­a!`,\n  `*${nombre}*, tu pedido *${codigo}* saliÃ³ reciÃ©n de Osaki *${sucursal}* con mucho cuidado. â¤ï¸ Salimos a las *${horaSalidaTexto}* hacia *${direccion}*. Â¡Que lo disfrutes bastante!`,\n  `Hola *${nombre}*! Con alegrÃ­a confirmo que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. ğŸ£ Ya estÃ¡ en viaje hacia *${direccion}*. Â¡Gracias por elegir calidad y sabor!`,\n  `*${nombre}*, el delivery ya partiÃ³ de Osaki *${sucursal}* ğŸš€ con tu pedido *${codigo}* a las *${horaSalidaTexto}*. Va derecho hacia *${direccion}*. Â¡Agradecemos profundamente tu confianza! -Emi`,\n  `*${nombre}*, tu pedido *${codigo}* de Osaki *${sucursal}* estÃ¡ oficialmente *en viaje* con toda la prontitud. ğŸ’« Salimos a las *${horaSalidaTexto}*. Â¡Gracias por tu paciencia y comprensiÃ³n!`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL MEDIO (TARDÃO) (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `Â¡AtenciÃ³n *${nombre}*! ğŸ˜Š Tu pedido *${codigo}* ya dejÃ³ Osaki *${sucursal}* a las *${horaSalidaTexto}* y va camino a *${direccion}*. Â¡Gracias por hacernos parte de tu dÃ­a! -Emi`,\n  `Hola *${nombre}*! Con mucha alegrÃ­a te cuento que el pedido *${codigo}* estÃ¡ viajando desde Osaki *${sucursal}*. â¤ï¸ Salimos a las *${horaSalidaTexto}* hacia tu domicilio. Â¡Es un placer servirte!`,\n  `*${nombre}*, el delivery saliÃ³ de Osaki *${sucursal}* con tu orden *${codigo}* a las *${horaSalidaTexto}* y mucho cuidado. ğŸš— Ya estÃ¡ rumbo a *${direccion}*. Â¡Gracias por tu increÃ­ble apoyo!`,\n  `*${nombre}*, tu pedido *${codigo}* ya va avanzando desde Osaki *${sucursal}* con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}*. Â¡Que tengas un momento delicioso! -Emi`,\n  `Â¡Ya estÃ¡ en camino, *${nombre}*! âœ¨ El repartidor de Osaki *${sucursal}* lleva tu pedido *${codigo}* hacia *${direccion}*. Salimos a las *${horaSalidaTexto}*. Â¡Gracias por preferir nuestro sabor!`,\n  `*${nombre}*, el pedido *${codigo}* estÃ¡ viajando desde Osaki *${sucursal}* con toda seguridad. ğŸ›µ Salimos a las *${horaSalidaTexto}*. Â¡Apreciamos mucho que nos elijas una y otra vez!`,\n  `Hola *${nombre}*! Con ilusiÃ³n te aviso que el pedido *${codigo}* saliÃ³ en viaje desde Osaki *${sucursal}* a las *${horaSalidaTexto}*. â¤ï¸ Â¡Gracias por tu maravillosa paciencia! -Emi`,\n  `*${nombre}*, tu sushi ya estÃ¡ viajando con mucho amor hacia *${direccion}*. ğŸ£ El pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. Â¡Esperamos que sea tan rico como esperas!`,\n  `*${nombre}*, confirmamos con alegrÃ­a que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* a las *${horaSalidaTexto}*. ğŸš€ El repartidor va hacia *${direccion}*. Â¡Gracias por confiar en nuestro trabajo!`,\n  `Hola *${nombre}*! El repartidor de Osaki *${sucursal}* ya lleva tu pedido *${codigo}* con toda prontitud. ğŸ’« Salimos a las *${horaSalidaTexto}* hacia tu domicilio. Â¡Gracias por tu fidelidad! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA AL FINAL (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, tu pedido *${codigo}* de Osaki estÃ¡ en trÃ¡nsito con mucho cuidado hacia *${direccion}*. â¤ï¸ SaliÃ³ reciÃ©n de *${sucursal}* a las *${horaSalidaTexto}*. Â¡Gracias por tu increÃ­ble confianza!`,\n  `*${nombre}*, el pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* con toda prontitud a las *${horaSalidaTexto}*. ğŸ˜Š Va camino a tu direcciÃ³n. Â¡Que disfrutes cada momento! -Emi`,\n  `Hola *${nombre}*! Tu pedido *${codigo}* saliÃ³ en viaje desde Osaki *${sucursal}* con mucho amor. ğŸ£ Salimos a las *${horaSalidaTexto}*. Â¡Gracias por permitirnos endulzar tu dÃ­a!`,\n  `*${nombre}*, te avisamos con alegrÃ­a que el pedido *${codigo}* va desde Osaki *${sucursal}* hacia tu domicilio: *${direccion}*. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Apreciamos mucho tu preferencia!`,\n  `*${nombre}*, tu orden *${codigo}* ya dejÃ³ Osaki *${sucursal}* con toda seguridad a las *${horaSalidaTexto}*. ğŸš— En viaje directo hacia vos. Â¡Gracias por ser un cliente tan especial! -Emi`,\n  `Hola *${nombre}*! Tu pedido *${codigo}* de Osaki *${sucursal}* estÃ¡ en ruta con mucho cuidado. âœ¨ Salimos a las *${horaSalidaTexto}*. Â¡Es un honor servirte hoy!`,\n  `*${nombre}*, gracias de corazÃ³n por elegir Osaki. ğŸ™ Tu pedido *${codigo}* saliÃ³ desde *${sucursal}* a las *${horaSalidaTexto}* y va camino a entregarse. Â¡Que tengas un dÃ­a precioso!`,\n  `*${nombre}*, el pedido *${codigo}* de Osaki *${sucursal}* ya estÃ¡ acercÃ¡ndose con toda prontitud. ğŸ’• Salimos a las *${horaSalidaTexto}* hacÃ­a *${direccion}*. Â¡Gracias por tu maravillosa paciencia! -Emi`,\n  `Hola *${nombre}*! El pedido *${codigo}* ya estÃ¡ en movimiento desde Osaki *${sucursal}* con mucho cuidado. ğŸš€ Salimos a las *${horaSalidaTexto}*. Â¡Agradecemos profundamente tu elecciÃ³n!`,\n  `*${nombre}*, tu pedido *${codigo}* de Osaki ya estÃ¡ en camino desde *${sucursal}* a *${direccion}* con toda la dedicaciÃ³n. â¤ï¸ Salimos a las *${horaSalidaTexto}*. Â¡Gracias por ser parte de nuestra historia! -Emi`,\n\n  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HORA COMO INCISO / FRAGMENTADA (10) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  `*${nombre}*, Â¡excelentes noticias! ğŸŠ Tu pedido *${codigo}* de Osaki *${sucursal}* ya saliÃ³ (a las *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Gracias por tu confianza infinita! -Emi`,\n  `Â¡Buenas noticias, *${nombre}*! âœ¨ El pedido *${codigo}* de Osaki *${sucursal}* ya va en camino â€”salimos a las *${horaSalidaTexto}*â€” hacia *${direccion}*. Â¡Que tengas un momento maravilloso!`,\n  `*${nombre}*, tu sushi de Osaki ya va rumbo a *${direccion}* con todo nuestro amor. â¤ï¸ El pedido *${codigo}* saliÃ³ desde *${sucursal}* (a las *${horaSalidaTexto}*). Â¡Gracias por tu increÃ­ble apoyo! -Emi`,\n  `Hola *${nombre}*! Con mucha alegrÃ­a te aviso que el repartidor saliÃ³ de Osaki *${sucursal}* con tu pedido *${codigo}* ğŸš— (salida: *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Te agradezco de todo corazÃ³n!`,\n  `*${nombre}*, tu orden *${codigo}* de Osaki *${sucursal}* va hacia *${direccion}* â€”salida a las *${horaSalidaTexto}*â€”. ğŸ’• Â¡Gracias por tu paciencia y comprensiÃ³n! -Emi`,\n  `*${nombre}*, te avisamos con ilusiÃ³n que el pedido *${codigo}* de Osaki ya estÃ¡ viajando desde *${sucursal}* (salida: *${horaSalidaTexto}*). ğŸ›µ Â¡Es un placer poder servirte hoy!`,\n  `Â¡Listo, *${nombre}*! â¤ï¸ El repartidor de Osaki ya lleva tu pedido *${codigo}* desde *${sucursal}* â€”salida *${horaSalidaTexto}*â€” hacia *${direccion}*. Â¡Gracias por ser un cliente tan especial! -Emi`,\n  `*${nombre}*, tu pedido *${codigo}* saliÃ³ reciÃ©n de Osaki *${sucursal}* con mucho cuidado âœ¨ (a las *${horaSalidaTexto}*). Â¡Que disfrutes este momento!`,\n  `Hola *${nombre}*! Con alegrÃ­a confirmo que tu pedido *${codigo}* saliÃ³ de Osaki *${sucursal}* ğŸ£ (a las *${horaSalidaTexto}*) hacia *${direccion}*. Â¡Gracias por preferir la calidad Osaki! -Emi`,\n  `*${nombre}*, el delivery ya partiÃ³ de Osaki *${sucursal}* con tu pedido *${codigo}* â€”salida *${horaSalidaTexto}*â€” hacia *${direccion}*. ğŸš€ Â¡Gracias por permitirnos acompaÃ±ar tus momentos especiales!`\n];\n\n  // 4. SelecciÃ³n aleatoria\n  const respuestaAleatoria = variantes[Math.floor(Math.random() * variantes.length)];\n\n  // 5. Retorno\n  return {\n    json: {\n      ...datos,\n      // Sobrescribimos las variables limpias para usarlas luego si hace falta\n      nombre, \n      direccion, \n      sucursal,\n      codigo_pedido: codigo,\n      // Agregamos los campos calculados\n      hora_salida_arg: horaSalidaTexto, \n      mensaje_en_viaje: respuestaAleatoria,\n      timestamp_generacion: new Date().toISOString()\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2128,
        416
      ],
      "id": "245acffd-ad36-4bd5-a3ad-982659a32378",
      "name": "Forma Respuestas En Viaje"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -2144,
        992
      ],
      "id": "80fd03f1-d2d1-45cb-a2fa-fe200dd28b42",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "255eb966-27be-4e1e-a2ad-87c288543642",
              "name": "sucursal",
              "value": "={{ $json.sucursal_origen.replace(' ','_').toLowerCase() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1280,
        0
      ],
      "id": "7e92d147-7a1f-4b34-ba2d-ed7761a50f38",
      "name": "Mensaje1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "19582c69-f36f-4d27-b5f2-d9bb661a140e",
              "leftValue": "={{ $('Mensaje').item.json.sucursal }}",
              "rightValue": "calle_47",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -864,
        640
      ],
      "id": "ca7a63f7-6ad4-4e20-8013-32ecc89f8c30",
      "name": "If5"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution-api-evolution-api.2hxkvh.easypanel.host/message/sendText/Osaki-Delivery",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "=F1A31EB07B60-4B92-835E-5C6F13AFCCC5"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Loop Over Items').item.json.sessionId }}"
            },
            {
              "name": "text",
              "value": "={{ $('Mensaje').item.json.mensaje }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -368,
        480
      ],
      "id": "0052648c-02b1-46dd-a495-161169359c94",
      "name": "Envia Mensaje WA Calle 47",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution-api-evolution-api.2hxkvh.easypanel.host/message/sendText/Osaki-Delivery-Calle-9",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "=D802368AAC4A-4355-A614-ADF7B45CC549"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Loop Over Items').item.json.sessionId }}"
            },
            {
              "name": "text",
              "value": "={{ $('Mensaje').item.json.mensaje }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -368,
        832
      ],
      "id": "3e01d43b-94f7-4167-8b61-980472e0201d",
      "name": "Envia Mensaje WA Calle 9",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "19582c69-f36f-4d27-b5f2-d9bb661a140e",
              "leftValue": "={{ $('Mensaje1').item.json.sucursal }}",
              "rightValue": "calle_47",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -880,
        0
      ],
      "id": "d345321b-1ef2-4a72-8402-7fc3a0e6e733",
      "name": "If6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution-api-evolution-api.2hxkvh.easypanel.host/message/sendText/Osaki-Delivery",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "=F1A31EB07B60-4B92-835E-5C6F13AFCCC5"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Loop Over Items').item.json.sessionId }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message.content }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -352,
        -112
      ],
      "id": "206ee7ec-9cde-459d-b24d-6574056d63fb",
      "name": "Envia Mensaje WA Calle 47 (nuevo)",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolution-api-evolution-api.2hxkvh.easypanel.host/message/sendText/Osaki-Delivery-Calle-9",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "=D802368AAC4A-4355-A614-ADF7B45CC549"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Loop Over Items').item.json.sessionId }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message.content }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -320,
        -288
      ],
      "id": "d6aba771-c29a-4478-8f46-51d89a6f182e",
      "name": "Envia Mensaje WA Calle 9(nuevo)",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "=Osaki-Delivery-Calle-9",
        "remoteJid": "={{ $('Loop Over Items').item.json.sessionId }}",
        "messageText": "={{ $json.message.content }}",
        "options_message": {
          "delay": "={{ $json.message.length * 20 }}"
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -624,
        96
      ],
      "id": "69fcb2a8-20fb-4679-a716-4127907ddc08",
      "name": "Enviar texto1",
      "credentials": {
        "evolutionApi": {
          "id": "9xktnR3DFRTQS3QC",
          "name": "Evolution Osaki"
        }
      }
    },
    {
      "parameters": {
        "resource": "integrations-api",
        "operation": "evolution-bot",
        "instanceName": "=Osaki-Delivery-Calle-9",
        "resourceForEvolutionBot": "changeStatusEvolutionBot",
        "evolutionBotId": "={{ $('Data Filter').first().json.message_id }}",
        "remoteJid": "={{ $('Data Filter').first().json.chat_id }}",
        "status": "closed"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -112,
        96
      ],
      "id": "81fd15c0-6012-44f1-b8de-1313529e1063",
      "name": "Evolution bot",
      "credentials": {
        "evolutionApi": {
          "id": "9xktnR3DFRTQS3QC",
          "name": "Evolution Osaki"
        }
      }
    },
    {
      "parameters": {
        "amount": "={{ Math.floor(Math.random() * 4) + 2 }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -368,
        96
      ],
      "id": "faf2d24a-794a-465e-8eed-1eee3f96c16b",
      "name": "Wait2",
      "webhookId": "35a86228-f3b3-49dd-96ba-7f7fdd551a9d"
    }
  ],
  "pinData": {
    "When clicking â€˜Execute workflowâ€™": [
      {
        "json": {
          "id": "485",
          "idventa": 58809,
          "codigo_pedido": "8538764",
          "sucursal": "Calle 9",
          "plataforma": "MasDelivery",
          "tipoentrega": "Delivery Propio",
          "etapapedido": "Preparado",
          "nombre": "LucÃ­a  GuichÃ³n",
          "telefono": "2216253969",
          "fechahoraapertura": "2025-12-16T23:11:42.000Z",
          "fechahoracierre": null,
          "fechahoraentrega": "2025-12-16T23:11:16.000Z",
          "notificacion_flag": false,
          "direccion": "C. 15 ; 747",
          "hora_salida_arg": "23:11",
          "mensaje_en_viaje": "Hola *LucÃ­a  GuichÃ³n*! El repartidor de Osaki *Calle 9* ya lleva tu pedido *8538764* con toda prontitud hacia *C. 15 ; 747*. ğŸ’« Salimos a las *23:11*. Â¡Gracias por tu fidelidad! -Emi",
          "timestamp_generacion": "2025-12-17T02:20:16.539Z"
        }
      }
    ],
    "Cada 10 min": [
      {
        "json": {
          "timestamp": "2025-12-17T11:46:00.004-03:00",
          "Readable date": "December 17th 2025, 11:46:00 am",
          "Readable time": "11:46:00 am",
          "Day of week": "Wednesday",
          "Year": "2025",
          "Month": "December",
          "Day of month": "17",
          "Hour": "11",
          "Minute": "46",
          "Second": "00",
          "Timezone": "America/Argentina/Buenos_Aires (UTC-03:00)"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "ZpYgShc1li13uf3h",
    "timezone": "America/Argentina/Buenos_Aires",
    "saveManualExecutions": true
  },
  "shared": [
    {
      "updatedAt": "2025-12-11T18:04:31.766Z",
      "createdAt": "2025-12-11T18:04:31.766Z",
      "role": "workflow:owner",
      "workflowId": "zuCaTofEfyHPk7VE",
      "projectId": "ROVo9T66IPW6MHN4"
    }
  ],
  "staticData": {
    "node:Cada 10 min": {
      "recurrenceRules": []
    }
  },
  "tags": [
    {
      "updatedAt": "2026-01-11T13:58:58.227Z",
      "createdAt": "2026-01-11T13:58:58.227Z",
      "id": "KkeQFkJULwWdcCpc",
      "name": "ProducciÃ³n"
    },
    {
      "updatedAt": "2026-01-11T13:59:07.966Z",
      "createdAt": "2026-01-11T13:59:07.966Z",
      "id": "TEy2u6jFlivu8kn7",
      "name": "SubProceso"
    },
    {
      "updatedAt": "2026-01-11T13:58:36.789Z",
      "createdAt": "2026-01-11T13:58:36.789Z",
      "id": "hFyftivmZQVr0Mx5",
      "name": "Osaki"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2026-01-11T14:01:35.438Z",
  "versionId": "0f9c14d6-498f-4c91-b452-85078d741bf0"
}